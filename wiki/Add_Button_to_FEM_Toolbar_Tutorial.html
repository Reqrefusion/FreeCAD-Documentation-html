<link href="site.css" rel="stylesheet" type="text/css"/>
<div class="mw-page-container"><h1 class="firstHeading mw-first-heading" id="firstHeading"><span class="mw-page-title-main">Add Button to FEM Toolbar Tutorial</span></h1><div class="mw-parser-output"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Add_Button_to_FEM_Toolbar_Tutorial.html" lang="de" title="Anleitung Schaltfläche zur FEM-Symbolleiste hinzufügen (100% translated)">Deutsch</a></li>
<li><span class="mw-pt-languages-ui mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" dir="ltr" lang="en">English</span></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Add_Button_to_FEM_Toolbar_Tutorial.html" lang="fr" title="FEM Tutoriel pour ajouter un bouton dans la barre d'outils FEM (100% translated)">français</a></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Add_Button_to_FEM_Toolbar_Tutorial.html" lang="it" title="Tutorial su come aggiungere un pulsante alla barra strumenti di FEM (100% translated)">italiano</a></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="Add_Button_to_FEM_Toolbar_Tutorial.html" lang="pl" title="Poradnik: Dodaj przycisk do paska narzędzi MES (100% translated)">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" style="width: 230px; float: right; margin-left: 1em">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;"><span typeof="mw:File"><span><img decoding="async" height="32" src="File/Freecad.svg" width="32"/></span></span> Tutorial
</td></tr>
<tr>
<th class="ctOdd">Topic
</th></tr>
<tr>
<td class="ctEven">FEM
</td></tr>
<tr>
<th class="ctOdd">Level
</th></tr>
<tr>
<td class="ctEven">Advanced
</td></tr>
<tr>
<th class="ctOdd">Time to complete
</th></tr>
<tr>
<td class="ctEven">60 min
</td></tr>
<tr>
<th class="ctOdd">Authors
</th></tr>
<tr>
<td class="ctEven"><a class="new" href="index.php?title=User;JohnWang&amp;action=edit&amp;redlink=1.html" title="User:JohnWang (page does not exist)">JohnWang</a>
</td></tr>
<tr>
<th class="ctOdd">FreeCAD version
</th></tr>
<tr>
<td class="ctEven">0.19
</td></tr>
<tr>
<th class="ctOdd">Example files
</th></tr>
<tr>
<td class="ctEven">
</td></tr>
<tr>
<th class="ctOdd">See also
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<td class="ctToc"><br/><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Create_a_new_icon_file"><span class="tocnumber">2</span> <span class="toctext">Create a new icon file</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Register_the_new_icon_file"><span class="tocnumber">3</span> <span class="toctext">Register the new icon file</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Create_a_new_command_class"><span class="tocnumber">4</span> <span class="toctext">Create a new command class</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Add_new_command_to_workbench"><span class="tocnumber">5</span> <span class="toctext">Add new command to workbench</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Related"><span class="tocnumber">6</span> <span class="toctext">Related</span></a></li>
</ul>
</div>
</td></tr></tbody></table>
<h2><span class="mw-headline" id="Introduction">Introduction</span></h2>
<p>The FEM workbench has toolbars and menus. This tutorial shows how to add a test button to a toolbar. It also shows how to add a menu item to a menu.
</p><p>The task can be split into four parts:
</p>
<ul><li><b>Create a new icon file</b>.</li>
<li><b>Register the new icon file</b>. Modification needed to <code>src/Mod/Fem/Gui/Resources/Fem.qrc</code></li>
<li><b>Create a new command class</b>. Modification needed to <code>src/Mod/Fem/femcommands/commands.py</code></li>
<li><b>Add new command to workbench</b>. Modification needed to <code>src/Mod/Fem/Gui/Workbench.cpp</code></li></ul>
<h2><span class="mw-headline" id="Create_a_new_icon_file">Create a new icon file</span></h2>
<p>For the button, we need an icon file. You can use any of your favorite tools to create it, but it must be in the SVG format. Here we will use the <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">FEM_testButton.svg</span> file as an example. 
</p><p>It must be placed in: <code>src/Mod/Fem/Gui/Resources/icons/</code>.
</p>
<h2><span class="mw-headline" id="Register_the_new_icon_file">Register the new icon file</span></h2>
<p>The new SVG icon file has to be registered for the GUI button by inserting it in <code>src/Mod/Fem/Gui/Resources/Fem.qrc</code>:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span><span class="n">icons</span><span class="o">/</span><span class="n">FEM_testButton</span><span class="o">.</span><span class="n">svg</span><span class="o">&lt;/</span><span class="n">file</span><span class="o">&gt;</span>
</pre></div>
<h2><span class="mw-headline" id="Create_a_new_command_class">Create a new command class</span></h2>
<p>A new command class has to be added to the <code>src/Mod/Fem/femcommands/commands.py</code> module. 
</p><p>Just copy/paste an existing command, then adjust the icon, menu text and tool-tip in <code>__init__(self)</code>:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">_testButton</span><span class="p">(</span><span class="n">CommandManager</span><span class="p">):</span>
    <span class="s2">"The FEM_testButton command definition"</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_testButton</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menuetext</span> <span class="o">=</span> <span class="s2">"test Button"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span> <span class="o">=</span> <span class="s2">"This is a test button"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="s2">"always"</span>
        <span class="c1">#self.do_activated = "add_obj_on_gui_selobj_noset_edit"</span>
</pre></div>
<p>Don't forget to register the command at the bottom of the module file with the <code>addCommand(...)</code> method:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">FreeCADGui</span><span class="o">.</span><span class="n">addCommand</span><span class="p">(</span>
    <span class="s2">"FEM_testButton"</span><span class="p">,</span>
    <span class="n">_testButton</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
<p><b>Note</b>: Please see this <a class="external text" href="https://forum.freecadweb.org/viewtopic.php?f=18&amp;t=46693&amp;start=10#p402004" rel="nofollow">discussion thread</a> in the forum if icons are involved.
</p>
<h2><span class="mw-headline" id="Add_new_command_to_workbench">Add new command to workbench</span></h2>
<p>We will add the new command to both the <b>solve</b> toolbar and the <b>solve</b> menu. 
</p><p>Search for the following code snippet in <code>/Gui/Workbench.cpp</code> and add the new command:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">Gui</span><span class="p">::</span><span class="n">ToolBarItem</span><span class="o">*</span> <span class="n">solve</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Gui</span><span class="p">::</span><span class="n">ToolBarItem</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
     <span class="n">solve</span><span class="o">-&gt;</span><span class="n">setCommand</span><span class="p">(</span><span class="s2">"Solve"</span><span class="p">);</span>
     <span class="o">*</span><span class="n">solve</span> <span class="o">&lt;&lt;</span> <span class="s2">"FEM_SolverCalculixCxxtools"</span>
            <span class="o">&lt;&lt;</span> <span class="s2">"FEM_SolverCalculiX"</span>
            <span class="o">&lt;&lt;</span> <span class="s2">"FEM_SolverElmer"</span>
<span class="o">+</span>           <span class="o">&lt;&lt;</span> <span class="s2">"FEM_testButton"</span>
            <span class="o">&lt;&lt;</span> <span class="s2">"Separator"</span>
</pre></div>
<p>To add the command to the <b>solve</b> menu of the FEM workbench, search for the following code snippet in <code>Workbench.cpp</code>:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">Gui</span><span class="p">::</span><span class="n">MenuItem</span><span class="o">*</span> <span class="n">solve</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Gui</span><span class="p">::</span><span class="n">MenuItem</span><span class="p">;</span>
    <span class="n">root</span><span class="o">-&gt;</span><span class="n">insertItem</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">solve</span><span class="p">);</span>
    <span class="n">solve</span><span class="o">-&gt;</span><span class="n">setCommand</span><span class="p">(</span><span class="s2">"&amp;Solve"</span><span class="p">);</span>
    <span class="o">*</span><span class="n">solve</span> <span class="o">&lt;&lt;</span> <span class="s2">"FEM_SolverCalculixCxxtools"</span>
           <span class="o">&lt;&lt;</span> <span class="s2">"FEM_SolverCalculiX"</span>
           <span class="o">&lt;&lt;</span> <span class="s2">"FEM_SolverElmer"</span>
           <span class="o">&lt;&lt;</span> <span class="s2">"FEM_SolverZ88"</span>
<span class="o">+</span>          <span class="o">&lt;&lt;</span> <span class="s2">"FEM_testButton"</span>
           <span class="o">&lt;&lt;</span> <span class="s2">"Separator"</span>
</pre></div>
<p><b>Result</b>: You should have just successfully added a test button to a FEM workbench toolbar and menu. Now, you can <a href="Compiling.html" title="Compiling">compile FreeCAD</a> and test your new button.
</p>
<h2><span class="mw-headline" id="Related">Related</span></h2>
<ul><li><a href="Extend_FEM_Module.html" title="Extend FEM Module">Extend FEM Module</a></li>
<li><a href="Onboarding_FEM_Devs.html" title="Onboarding FEM Devs">Onboarding FEM Devs</a></li></ul>
<!-- 
NewPP limit report
Cached time: 20241129212620
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc, no‐toc‐conversion]
CPU time usage: 0.048 seconds
Real time usage: 0.064 seconds
Preprocessor visited node count: 207/1000000
Post‐expand include size: 1663/2097152 bytes
Template argument size: 1318/2097152 bytes
Highest expansion depth: 4/100
Expensive parser function count: 5/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 6222/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   10.150      1 -total
 32.65%    3.314      1 Template:FileName
 27.09%    2.749      5 Template:Code
 18.30%    1.857     10 Template:Incode
 13.39%    1.359      1 Template:TutorialInfo
-->
<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:252812-0!canonical and timestamp 20241129212620 and revision id 1354457. Rendering was triggered because: api-parse
 -->
</div></div><script src="script.js"></script>
