<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro FreeCAD to Kerkythea/it</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="it" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Macro+FreeCAD+to+Kerkythea&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><a href="../de/Macro_FreeCAD_to_Kerkythea.html" class="mw-pt-progress mw-pt-progress--complete" title="Makro FreeCAD to Kerkythea (100% translated)" lang="de" dir="ltr">Deutsch</a></li>
<li><a href="../Macro_FreeCAD_to_Kerkythea.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro FreeCAD to Kerkythea (100% translated)" lang="en" dir="ltr">English</a></li>
<li><a href="../fr/Macro_FreeCAD_to_Kerkythea.html" class="mw-pt-progress mw-pt-progress--complete" title="Macro FreeCAD to Kerkythea (100% translated)" lang="fr" dir="ltr">fran&ccedil;ais</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--med" lang="it" dir="ltr">italiano</span></li>
<li><a href="../pl/Macro_FreeCAD_to_Kerkythea.html" class="mw-pt-progress mw-pt-progress--low" title="Makrodefinicja: FreeCAD do Kerkythea (9% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../index.php?title=Macro_FreeCAD_to_Kerkythea.png&amp;filetimestamp=20190707152027&amp;.html" class="mw-file-description"><img src="../File/Macro_FreeCAD_to_Kerkythea.png" decoding="async" width="32" height="32" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span><span> </span>
FC in Kerkythea
</p>
</td></tr>
<tr>
<th class="ctOdd">Descrizione
</th></tr>
<tr>
<td class="ctEven left macro-description">Esporta un modello FreeCAD in Kerkythea<br><br>Versione macro: 1.0<br>Ultima modifica: 2015-05-30<br>Versione FreeCAD: 0.17 and above<br>Download: <a rel="nofollow" class="external text" href="https://www.freecad.org/wiki/images/8/8c/Macro_FreeCAD_to_Kerkythea.png">ToolBar Icon</a><br>Autore: marmni<br>
</td></tr>
<tr>
<th class="ctOdd">Autore
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../index.php?title=User;Marmni&amp;action=edit&amp;redlink=1.html" class="new" title="User:Marmni (page does not exist)">marmni</a>
</td></tr>
<tr>
<th class="ctOdd">Download
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://www.freecad.org/wiki/images/8/8c/Macro_FreeCAD_to_Kerkythea.png">ToolBar Icon</a>
</td></tr>
<tr>
<th class="ctOdd">Link
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../it/Macros_recipes.html" title="Macros recipes/it">Raccolta di macro</a><br><a href="../it/How_to_install_macros.html" title="How to install macros/it">Come installare le macro</a><br><a href="../it/Customize_Toolbars.html" title="Customize Toolbars/it">Personalizzare la  toolbar</a>
</td></tr>
<tr>
<th class="ctOdd">Versione macro
</th></tr>
<tr>
<td class="ctEven macro-version">1.0
</td></tr>
<tr>
<th class="ctOdd">Data ultima modifica
</th></tr>
<tr>
<td class="ctEven macro-date">2015-05-30
</td></tr>
<tr>
<th class="ctOdd">Versioni di FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">0.17 and above
</td></tr>
<tr>
<th class="ctOdd">Scorciatoia
</th></tr>
<tr>
<td class="ctEven"><i>Nessuna</i>
</td></tr>
<tr>
<th class="ctOdd">Vedere anche
</th></tr>
<tr>
<td class="ctEven"><i>Nessuno</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Description">Description</span></h2>
</div>
<div class="mw-translate-fuzzy">
<h2><span class="mw-headline" id="Descrizione">Descrizione</span></h2>
<p>Macro per esportare il proprio modello nel programma di raytracing <a rel="nofollow" class="external text" href="http://www.kerkythea.net/cms/">Kerkythea</a>.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
</div>
<div class="mw-translate-fuzzy">
<h2><span class="mw-headline" id="Utilizzo">Utilizzo</span></h2>
<p>La macro &egrave; disponibile nel seguente repository github: <a rel="nofollow" class="external text" href="https://github.com/marmni/FreeCAD-Kerkythea">FreeCAD to Kerkythea-Exporter</a>
</p>
</div>
<div class="mw-translate-fuzzy">
<p>E' praticamente auto-esplicativa.
Al momento ci sono problemi per esportare le luci e la posizione della telecamera.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Link">Link</span></h2>
</div>
<h2><span class="mw-headline" id="Link_2">Link</span></h2>
<p>La pagina di discussione: <a rel="nofollow" class="external text" href="http://forum.freecad.org/viewtopic.php?t=8861">Kerkythea Rendering System</a>
</p><p><span id="Script"></span>
</p>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<p>Macro ExportToKerkythea.py
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>ToolBar Icon <span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=Macro_FreeCAD_to_Kerkythea.png&amp;filetimestamp=20190707152027&amp;.html" class="mw-file-description"><img src="../File/Macro_FreeCAD_to_Kerkythea.png" decoding="async" width="64" height="64" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span>
</p>
</div>
<p><b>Macro ExportToKerkythea.py</b>
</p>
<pre># -*- coding: utf8 -*-
#**************************************************************************************
#*                                                                                    *
#*   Kerkythea exporter                                                               *
#*   Copyright (c) 2014,2015                                                          *
#*   marmni &lt;marmni@onet.eu&gt;                                                          *
#*                                                                                    *
#*   This program is free software; you can redistribute it and/or modify             *
#*   it under the terms of the GNU Lesser General Public License (LGPL)               *
#*   as published by the Free Software Foundation; either version 2 of                *
#*   the License, or (at your option) any later version.                              *
#*   for detail see the LICENCE text file.                                            *
#*                                                                                    *
#*   This program is distributed in the hope that it will be useful,                  *
#*   but WITHOUT ANY WARRANTY; without even the implied warranty of                   *
#*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                    *
#*   GNU Library General Public License for more details.                             *
#*                                                                                    *
#*   You should have received a copy of the GNU Library General Public                *
#*   License along with this program; if not, write to the Free Software              *
#*   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307             *
#*   USA                                                                              *
#*                                                                                    *
#**************************************************************************************

#**************************************************************************************
#*                                                                                    *
#*                                 BASED ON                                           *
#*                                                                                    *
#* IOANNIS PANTAZOPOULOS                                                              *
#*                                                                                    *
#* Sample code exporting basic Kerkythea XML file.                                    *
#*                                                                                    *
#* Version v1.0                                                                       *
#*                                                                                    *
#**************************************************************************************

__title__="Kerkythea exporter"
__author__ = "marmni &lt;marmni@onet.eu&gt;"
__url__ = ["https://freecad.org"]


import FreeCAD, FreeCADGui
import re
import random
import __builtin__
import Mesh
from PySide import QtCore, QtGui
import sys
import os


##############################################
#
##############################################
class point3D:
	def __init__(self, point):
		self.x = "%.4f"&nbsp;% (point[0] * 0.001)
		self.y = "%.4f"&nbsp;% (point[1] * 0.001)
		self.z = "%.4f"&nbsp;% (point[2] * 0.001)

	def __str__(self):
		return '&lt;P xyz="{0} {1} {2}"/&gt;'.format(self.x, self.y, self.z)

	#def __eq__(self, other):
		#if self.x == other.x and self.y == other.y and self.z == other.z:
			#return True
		#else:
			#return False 


##############################################
#
##############################################
class indexListPoint3D:
	def __init__(self, point):
		self.i = point[0]
		self.j = point[1]
		self.k = point[2]

	def __str__(self):
		return '&lt;F ijk="{0} {1} {2}"/&gt;'.format(self.i, self.j, self.k)


##############################################
#
##############################################
class Material:
	def __init__(self):
		self.diffuse = None  # Texture()
		self.shininess = 1000.0
		self.ior = 2.0

	def write(self, file):
		file.write('''&lt;Object Identifier="Whitted Material" Label="Whitted Material" Name="" Type="Material"&gt;\n''')

		self.diffuse.write(file, "Diffuse")
		self.diffuse.write(file, "Translucent")
		self.diffuse.write(file, "Specular")
		self.diffuse.write(file, "Transmitted")

		file.write('''&lt;Parameter Name="Shininess" Type="Real" Value="{shininess}"/&gt;
&lt;Parameter Name="Transmitted Shininess" Type="Real" Value="{shininess}"/&gt;
&lt;Parameter Name="Index of Refraction" Type="Real" Value="{ior}"/&gt;
&lt;/Object&gt;\n'''.format(shininess=self.shininess, ior=self.ior))


##############################################
#
##############################################
class Texture:
	def __init__(self, color):
		self.color = color
		
	def getColorSTR(self):
		return '{0} {1} {2}'.format(self.color[0], self.color[1], self.color[2])

	def toGrayscale(self):
		RGB = 0.299 * self.color[0] + 0.587 * self.color[1] + 0.114 * self.color[2]
		self.color = [RGB, RGB, RGB]

	def write(self, file, identifier):
		file.write('''&lt;Object Identifier="./{identifier}/Constant Texture" Label="Constant Texture" Name="" Type="Texture"&gt;
&lt;Parameter Name="Color" Type="RGB" Value="{color}"/&gt;
&lt;/Object&gt;\n'''.format(identifier=identifier, color=self.getColorSTR()))


##############################################
#
##############################################
class Model:
	def __init__(self):
		self.vertexList = []
		self.normalList = []
		self.indexList = []
		
		self.name = self.wygenerujID(5, 5)
		self.material = Material()
		
	def addFace(self, face):
		mesh = self.meshFace(face)
		for pp in mesh.Facets:
			num = len(self.vertexList)
			for kk in pp.Points:
				self.vertexList.append(point3D(kk))
			self.indexList.append(indexListPoint3D([num, num + 1, num + 2]))
		
	def meshFace(self, shape):
		faces = []
		triangles = shape.tessellate(1) # the number represents the precision of the tessellation
		for tri in triangles[1]:
			face = []
			for i in range(3):
				vindex = tri[i]
				face.append(triangles[0][vindex])
			faces.append(face)
		m = Mesh.Mesh(faces)
		#Mesh.show(m)
		return m
		
	def wygenerujID(self, ll, lc):
		''' generate random model name '''
		numerID = ""

		for i in range(ll):
			numerID += random.choice('abcdefghij')
		numerID += "_"
		for i in range(lc):
			numerID += str(random.randrange(0, 99, 1))
		
		return numerID

	def write(self, file):
		file.write('''
&lt;Object Identifier="./Models/{name}" Label="Default Model" Name="{name}" Type="Model"&gt; 
&lt;Object Identifier="Triangular Mesh" Label="Triangular Mesh" Name="" Type="Surface"&gt;
&lt;Parameter Name="Vertex List" Type="Point3D List" Value="{pointListSize}"&gt;\n'''.format(name=self.name, pointListSize=len(self.vertexList)))

		for i in self.vertexList:
			file.write('{0}\n'.format(i))

		file.write('''&lt;/Parameter&gt;
&lt;Parameter Name="Normal List" Type="Point3D List" Value="{pointListSize}"&gt;\n'''.format(pointListSize=len(self.vertexList)))
		file.write('&lt;P xyz="0 0 -1"/&gt;\n' * len(self.vertexList))
		file.write('''&lt;/Parameter&gt;
&lt;Parameter Name="Index List" Type="Triangle Index List" Value="{indexListSize}"&gt;\n'''.format(indexListSize=len(self.indexList)))

		for i in self.indexList:
			file.write('{0}\n'.format(i))

		file.write('''&lt;/Parameter&gt;\n&lt;/Object&gt;\n''')

		self.material.write(file)
		
		file.write('&lt;/Object&gt;\n')


##############################################
#
##############################################
class Camera:
	def __init__(self):
		self.name = "Camera_1"
		self.f_number = "Pinhole"
		self.resolution = "1024x768"
		self.focusDistance = "1"
		self.lensSamples = "3"
		self.blades = "3"
		self.diaphragm = "Circular"
		self.projection = "Planar"

	def addParameter(self, name, pType, value):
		return '&lt;Parameter Name="{0}" Type="{1}" Value="{2}"/&gt;\n'.format(name, pType, value)
		
	def write(self, file):
		cam = FreeCADGui.ActiveDocument.ActiveView.getCameraNode()
		camValues = cam.position.getValue()
		
		x = "%.4f"&nbsp;% (30 * .0254)
		y = "%.4f"&nbsp;% (30 * .0254)
		z = "%.4f"&nbsp;% (30 * .0254)
		
		file.write('&lt;Object Identifier="./Cameras/{0}" Label="Pinhole Camera" Name="{0}" Type="Camera"&gt;\n'.format(self.name))
		file.write(self.addParameter("Resolution", "String", self.resolution))
		file.write(self.addParameter("Frame", "Transform", "-0.609474 0.471636 -0.63726 {0} 0.792806 0.362576 -0.489895 {1} 2.70762e-06 -0.803802 -0.594897 {2}".format(x, y, z)))
		file.write(self.addParameter("Focus Distance", "Real", self.focusDistance))
		file.write(self.addParameter("f-number", "String", self.f_number))
		file.write(self.addParameter("Lens Samples", "Integer",self.lensSamples ))
		file.write(self.addParameter("Blades", "Integer", self.blades))
		file.write(self.addParameter("Diaphragm", "String", self.diaphragm))
		file.write(self.addParameter("Projection", "String", self.projection))
		file.write('&lt;/Object&gt;\n')


##############################################
#
##############################################
class exportTokerkythea:
	def __init__(self):
		self.models = []
		self.cameras = []
		modelsMultiColors = False

	def write(self, file, name):
		file = __builtin__.open(file, "w")
		#
		self.writeHeader(file, name)
		
		if self.modelsMultiColors:
			for i, j in self.models.items():
				file.write('&lt;Object Identifier="./Models/{0}" Label="Default Model" Name="{0}" Type="Model"&gt;\n'.format(i))
				for k in j:
					k.write(file)
				file.write('&lt;/Object&gt;\n')
		else:
			for i in self.models.values():
				i.write(file)
		# CAMERA
		activeCamera = self.cameras[0][0].name
		for i in self.cameras:
			i[0].write(file)
			if i[1]:
				activeCamera = i[0].name
		#
		file.write('&lt;Parameter Name="./Cameras/Active" Type="String" Value="{0}"/&gt;\n'.format(activeCamera))

		self.writeFooter(file, name)

	def writeHeader(self, file, name):
		file.write('''&lt;Root Label="Kernel" Name="" Type="Kernel"&gt;
&lt;Object Identifier="./Ray Tracers/Metropolis Light Transport" Label="Metropolis Light Transport" Name="Metropolis Light Transport" Type="Ray Tracer"&gt;
&lt;/Object&gt;
&lt;Object Identifier="./Environments/Octree Environment" Label="Octree Environment" Name="Octree Environment" Type="Environment"&gt;
&lt;/Object&gt;
&lt;Object Identifier="./Filters/Simple Tone Mapping" Label="Simple Tone Mapping" Name="" Type="Filter"&gt;
&lt;/Object&gt;
&lt;Object Identifier="./Scenes/{0}" Label="Default Scene" Name="{0}" Type="Scene"&gt;\n
'''.format(name))

	def writeFooter(self, file, name):
		file.write('''&lt;/Object&gt;
&lt;Parameter Name="Mip Mapping" Type="Boolean" Value="1"/&gt;
&lt;Parameter Name="./Interfaces/Active" Type="String" Value="Null Interface"/&gt;
&lt;Parameter Name="./Modellers/Active" Type="String" Value="XML Modeller"/&gt;
&lt;Parameter Name="./Image Handlers/Active" Type="String" Value="Free Image Support"/&gt;
&lt;Parameter Name="./Ray Tracers/Active" Type="String" Value="Metropolis Light Transport"/&gt;
&lt;Parameter Name="./Irradiance Estimators/Active" Type="String" Value="Null Irradiance Estimator"/&gt;
&lt;Parameter Name="./Direct Light Estimators/Active" Type="String" Value="Null Direct Light Estimator"/&gt;
&lt;Parameter Name="./Environments/Active" Type="String" Value="Octree Environment"/&gt;
&lt;Parameter Name="./Filters/Active" Type="String" Value="Simple Tone Mapping"/&gt;
&lt;Parameter Name="./Scenes/Active" Type="String" Value="{0}"/&gt;
&lt;Parameter Name="./Libraries/Active" Type="String" Value="Material Librarian"/&gt;
&lt;/Root&gt;'''.format(name))


##############################################
#
##############################################

class exportKerkytheaDialog(QtGui.QDialog):
	def __init__(self, parent=None):
		QtGui.QDialog.__init__(self, parent)

		self.setWindowTitle(u'Export to Kerkythea v1.1')
		self.setFixedSize(500, 550)

		#
		self.buttonAccept = QtGui.QPushButton('Accept')
		#
		tab = QtGui.QTabWidget()
		tab.addTab(self.addGeneralPage(), u'General')
		tab.addTab(self.addLightsPage(), u'Light')
		tab.addTab(self.addCmerasPage(), u'Camera')
		#
		lay = QtGui.QVBoxLayout(self)
		lay.addWidget(tab)
		lay.addWidget(self.buttonAccept)

	def changePathF(self):
		path = QtGui.QFileDialog().getSaveFileName(self, u"Save as", os.path.expanduser("~"), "*.xml")
		
		fileName = path[0]
		if not fileName == "":
			if not fileName.endswith('xml'):
				fileName = fileName + '.xml'
			self.filePath.setText(fileName)
			
	def addGeneralPage(self):
		self.filePath = QtGui.QLineEdit(os.path.join(os.path.expanduser("~"), 'Unnamed.xml'))
		self.filePath.setReadOnly(True)

		changePath = QtGui.QPushButton('...')
		changePath.setFixedWidth(30)
		self.connect(changePath, QtCore.SIGNAL("clicked ()"), self.changePathF)

		generalBox = QtGui.QGroupBox(u'General')
		generalBoxLay = QtGui.QGridLayout(generalBox)
		generalBoxLay.addWidget(QtGui.QLabel(u'Path           '), 0, 0, 1, 1)
		generalBoxLay.addWidget(self.filePath, 0, 1, 1, 2)
		generalBoxLay.addWidget(changePath, 0, 3, 1, 1)

		generalBoxLay.setColumnStretch(1, 10)
		#
		self.exportObjects_All = QtGui.QRadioButton(u'All visible objects')
		self.exportObjects_All.setChecked(True)
		self.exportObjects_Selected = QtGui.QRadioButton(u'All selected objects')
		self.exportObjects_SelectedFaces = QtGui.QRadioButton(u'All selected faces')
		self.exportObjects_SelectedFaces.setDisabled(True)
		
		exportObjectsBox = QtGui.QGroupBox(u'Export objects')
		exportObjectsBoxLay = QtGui.QVBoxLayout(exportObjectsBox)
		exportObjectsBoxLay.addWidget(self.exportObjects_All)
		exportObjectsBoxLay.addWidget(self.exportObjects_Selected)
		exportObjectsBoxLay.addWidget(self.exportObjects_SelectedFaces)
		#
		self.exportObjectsAs_YES = QtGui.QRadioButton(u'Yes')
		self.exportObjectsAs_YES.setChecked(True)
		self.exportObjectsAs_NO = QtGui.QRadioButton(u'No')
		
		exportObjectsAsBox = QtGui.QGroupBox(u'Group models by color')
		exportObjectsAsBoxLay = QtGui.QVBoxLayout(exportObjectsAsBox)
		exportObjectsAsBoxLay.addWidget(self.exportObjectsAs_YES)
		exportObjectsAsBoxLay.addWidget(self.exportObjectsAs_NO)
		#
		self.exportObjectColor_MulCol = QtGui.QRadioButton(u'Multi colors')
		self.exportObjectColor_Gray = QtGui.QRadioButton(u'Grayscale')
		self.exportObjectColor_SinCol = QtGui.QRadioButton(u'Single color (random)')
		self.exportObjectColor_SinCol.setChecked(True)

		self.exportObjectColorBox = QtGui.QGroupBox(u'Colors')
		self.exportObjectColorBox.setDisabled(True)
		exportObjectColorBoxLay = QtGui.QVBoxLayout(self.exportObjectColorBox)
		exportObjectColorBoxLay.addWidget(self.exportObjectColor_MulCol)
		exportObjectColorBoxLay.addWidget(self.exportObjectColor_Gray)
		exportObjectColorBoxLay.addWidget(self.exportObjectColor_SinCol)
		#####
		widget = QtGui.QWidget()
		
		lay = QtGui.QGridLayout(widget)
		lay.addWidget(generalBox, 0, 0, 1, 4)
		lay.addWidget(exportObjectsBox, 1, 0, 1, 4)
		lay.addWidget(exportObjectsAsBox, 2, 0, 1, 2)
		lay.addWidget(self.exportObjectColorBox, 2, 2, 1, 2)
		
		lay.setRowStretch(10, 10)
		#lay.setColumnStretch(10, 10)
		return widget
		
	def addLightsPage(self):
		widget = QtGui.QWidget()
		
		return widget
		
	def addCmerasPage(self):
		self.resolution = QtGui.QComboBox()
		self.resolution.addItems(['200x200', '320x200', '320x240', '500x500', '512x384', '640x480', '768x576', '800x600', '1024x768', '1280x1024', '1600x1200', '2048x1536', '2816x2112'])
		self.resolution.setCurrentIndex(self.resolution.findText('1024x768'))

		self.cameraName = QtGui.QLineEdit(u'Camera 1')

		filmBox = QtGui.QGroupBox(u'General')
		filmBoxLay = QtGui.QGridLayout(filmBox)
		filmBoxLay.addWidget(QtGui.QLabel(u'Camera name'), 0, 0, 1, 1)
		filmBoxLay.addWidget(self.cameraName, 0, 1, 1, 1)
		filmBoxLay.addWidget(QtGui.QLabel(u'Resolution'), 1, 0, 1, 1)
		filmBoxLay.addWidget(self.resolution, 1, 1, 1, 1)

		filmBoxLay.setHorizontalSpacing(50)
		#
		self.fNumber = QtGui.QComboBox()
		self.fNumber.addItems(['1', '1.4', '2', '2.8', '4', '5.6', '8', '16', '22', 'Pinhole'])
		self.fNumber.setCurrentIndex(self.fNumber.findText('Pinhole'))

		self.focusDistance = QtGui.QDoubleSpinBox()
		self.focusDistance.setValue(1.0)
		self.focusDistance.setRange(0.0, 1000.0)

		self.lensSamples = QtGui.QSpinBox()
		self.lensSamples.setValue(3)
		self.lensSamples.setRange(0, 1000)

		lensBox = QtGui.QGroupBox(u'Lens')
		lensBoxLay = QtGui.QGridLayout(lensBox)
		lensBoxLay.addWidget(QtGui.QLabel(u'f-number'), 0, 0, 1, 1, QtCore.Qt.AlignHCenter)
		lensBoxLay.addWidget(self.fNumber, 1, 0, 1, 1)
		lensBoxLay.addWidget(QtGui.QLabel(u'Focus Distance'), 0, 1, 1, 1, QtCore.Qt.AlignHCenter)
		lensBoxLay.addWidget(self.focusDistance, 1, 1, 1, 1)
		lensBoxLay.addWidget(QtGui.QLabel(u'Lens Samples'), 0, 2, 1, 1, QtCore.Qt.AlignHCenter)
		lensBoxLay.addWidget(self.lensSamples, 1, 2, 1, 1)

		lensBoxLay.setHorizontalSpacing(50)
		#
		self.projection = QtGui.QComboBox()
		self.projection.addItems(['Planar', 'Cylindrical', 'Spherical', 'Parallel'])
		self.projection.setCurrentIndex(self.projection.findText('Planar'))

		self.diaphragm = QtGui.QComboBox()
		self.diaphragm.addItems(['Circular', 'Polygonal'])
		self.diaphragm.setCurrentIndex(self.diaphragm.findText('Circular'))
		
		self.blades = QtGui.QSpinBox()
		self.blades.setValue(3)
		self.blades.setRange(3, 1000)

		geometryBox = QtGui.QGroupBox(u'Geometry')
		geometryBoxLay = QtGui.QGridLayout(geometryBox)
		geometryBoxLay.addWidget(QtGui.QLabel(u'Projection'), 0, 0, 1, 1, QtCore.Qt.AlignHCenter)
		geometryBoxLay.addWidget(self.projection, 1, 0, 1, 1)
		geometryBoxLay.addWidget(QtGui.QLabel(u'Diaphragm'), 0, 1, 1, 1, QtCore.Qt.AlignHCenter)
		geometryBoxLay.addWidget(self.diaphragm, 1, 1, 1, 1)
		geometryBoxLay.addWidget(QtGui.QLabel(u'Blades'), 0, 2, 1, 1, QtCore.Qt.AlignHCenter)
		geometryBoxLay.addWidget(self.blades, 1, 2, 1, 1)

		geometryBoxLay.setHorizontalSpacing(50)
		#
		#####
		widget = QtGui.QWidget()
		lay = QtGui.QVBoxLayout(widget)
		lay.addWidget(filmBox)
		lay.addWidget(lensBox)
		lay.addWidget(geometryBox)
		lay.addStretch(10)

		return widget
		


class exportKerkythea(exportKerkytheaDialog):
	def __init__(self, parent=None):
		exportKerkytheaDialog.__init__(self, parent)

		self.connect(self.buttonAccept, QtCore.SIGNAL("clicked ()"), self.acceptw)
		self.connect(self.exportObjectsAs_YES, QtCore.SIGNAL("clicked ()"), self.setColors)
		self.connect(self.exportObjectsAs_NO, QtCore.SIGNAL("clicked ()"), self.setColors)

	def setColors(self):
		if self.exportObjectsAs_YES.isChecked():
			self.exportObjectColor_SinCol.setChecked(True)
			self.exportObjectColorBox.setDisabled(True)
		else:
			self.exportObjectColorBox.setDisabled(False)

	def acceptw(self):
		if self.exportObjects_All.isChecked():
			projectObjects = [i for i in FreeCAD.ActiveDocument.Objects if i.ViewObject.Visibility]
		elif self.exportObjects_Selected.isChecked():
			projectObjects = []
			for i in FreeCADGui.Selection.getSelection():
				if i.ViewObject.Visibility and i not in projectObjects:
					projectObjects.append(i)
		#

		projectModels = {}
		for i in projectObjects:  # objects in document
			try:
				objectColors = i.ViewObject.DiffuseColor
				shape = i.Shape.Faces
			except:
				continue
				
			for j in range(len(i.Shape.Faces)):  # object faces
				# get face color
				if len(objectColors) == len(i.Shape.Faces):
					modelType = objectColors[j]
				else:
					modelType = objectColors[0]
				#
				if self.exportObjectsAs_YES.isChecked():
					modelID = str(modelType)
				else:
					modelID = i.Label
				#
				if self.exportObjectColor_SinCol.isChecked():
					modelsMultiColors = False

					if not modelID in projectModels:
						model = Model()
						if self.exportObjectsAs_NO.isChecked():
							model.name = modelID
						model.material.diffuse = Texture(modelType)
						projectModels[modelID] = model
					else:
						model = projectModels[modelID]
				else:
					modelsMultiColors = True

					if not modelID in projectModels:
						projectModels[modelID] = []

					model = Model()
					model.name = 'Face {0}'.format(j)
					model.material.diffuse = Texture(modelType)
					if self.exportObjectColor_Gray.isChecked():
						model.material.diffuse.toGrayscale()
					projectModels[modelID].append(model)
				   
#					model = Model()
#					model.material.diffuse = Texture(modelType)
#					projectModels[i.Label].append(model)
				#
				model.addFace(i.Shape.Faces[j])

		exporter = exportTokerkythea()
	   	exporter.modelsMultiColors = modelsMultiColors
		exporter.models = projectModels
		# CAMERA
		camera = Camera()
		camera.name = self.cameraName.text()
		camera.f_number = self.fNumber.currentText()
		camera.resolution = self.resolution.currentText()
		camera.focusDistance = self.focusDistance.value()
		camera.lensSamples = self.lensSamples.value()
		camera.blades = self.blades.value()
		camera.diaphragm = self.diaphragm.currentText()
		camera.projection = self.projection.currentText()
		
		exporter.cameras.append([camera, True])
		#
		exporter.write(self.filePath.text(), FreeCAD.ActiveDocument.Label)

		self.close()

exportKerkythea().exec_()</pre>
<div style="clear:both"></div>
<!-- 
NewPP limit report
Cached time: 20251009170206
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.054 seconds
Real time usage: 0.088 seconds
Preprocessor visited node count: 107/1000000
Post&#8208;expand include size: 2040/2097152 bytes
Template argument size: 21583/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 22659/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    5.485      1 -total
 48.48%    2.659      1 Template:Macro/it
 27.71%    1.520      1 Template:MacroCode
 18.47%    1.013      1 Template:Clear
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:59530-0!canonical and timestamp 20251009170206 and revision id 1659117. Rendering was triggered because: api-parse
 -->
</div>
</div><script src="../site.js"></script>