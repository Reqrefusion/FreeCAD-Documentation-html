<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro export transient FEM results/it</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="it" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Macro+export+transient+FEM+results&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><a href="../de/Macro_export_transient_FEM_results.html" class="mw-pt-progress mw-pt-progress--complete" title="Makro Exportieren von transienten FEM-Ergebnissen (100% translated)" lang="de" dir="ltr">Deutsch</a></li>
<li><a href="../Macro_export_transient_FEM_results.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro export transient FEM results (100% translated)" lang="en" dir="ltr">English</a></li>
<li><a href="../fr/Macro_export_transient_FEM_results.html" class="mw-pt-progress mw-pt-progress--complete" title="Macro Exportation de r&eacute;sultats transitoires FEM (100% translated)" lang="fr" dir="ltr">fran&ccedil;ais</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--med" lang="it" dir="ltr">italiano</span></li>
<li><a href="../pl/Macro_export_transient_FEM_results.html" class="mw-pt-progress mw-pt-progress--low" title="Makrodefinicja: Eksport przej&#347;ciowych wynik&oacute;w MES (5% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../index.php?title=Text-x-python.png&amp;filetimestamp=20121224162851&amp;.html" class="mw-file-description" title="Icona macro generica. Crea la tua icona personale con lo stesso nome della macro"><img alt="Icona macro generica. Crea la tua icona personale con lo stesso nome della macro" src="../File/Text-x-python.png" decoding="async" width="32" height="32" class="mw-file-element" data-file-width="48" data-file-height="48"></a></span><span> </span>
export transient FEM results
</p>
</td></tr>
<tr>
<th class="ctOdd">Descrizione
</th></tr>
<tr>
<td class="ctEven left macro-description">Esporta pi&ugrave; risultati FEM da un'analisi transitoria per la post-elaborazione in ParaView.<br><br>Versione macro: 0.1<br>Ultima modifica: 2019-08-30<br>Versione FreeCAD: All<br>Download: <a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing">Macro file (3 kB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing">Example file without results (200 kB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing">Example file with results (10 MB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing">All example files, including the vtk-export folder (21 MB)</a><br>Autore: Luftschraube<br>
</td></tr>
<tr>
<th class="ctOdd">Autore
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../index.php?title=User;Luftschraube&amp;action=edit&amp;redlink=1.html" class="new" title="User:Luftschraube (page does not exist)">Luftschraube</a>
</td></tr>
<tr>
<th class="ctOdd">Download
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing">Macro file (3 kB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing">Example file without results (200 kB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing">Example file with results (10 MB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing">All example files, including the vtk-export folder (21 MB)</a>
</td></tr>
<tr>
<th class="ctOdd">Link
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../it/Macros_recipes.html" title="Macros recipes/it">Raccolta di macro</a><br><a href="../it/How_to_install_macros.html" title="How to install macros/it">Come installare le macro</a><br><a href="../it/Customize_Toolbars.html" title="Customize Toolbars/it">Personalizzare la  toolbar</a>
</td></tr>
<tr>
<th class="ctOdd">Versione macro
</th></tr>
<tr>
<td class="ctEven macro-version">0.1
</td></tr>
<tr>
<th class="ctOdd">Data ultima modifica
</th></tr>
<tr>
<td class="ctEven macro-date">2019-08-30
</td></tr>
<tr>
<th class="ctOdd">Versioni di FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">All
</td></tr>
<tr>
<th class="ctOdd">Scorciatoia
</th></tr>
<tr>
<td class="ctEven"><i>Nessuna</i>
</td></tr>
<tr>
<th class="ctOdd">Vedere anche
</th></tr>
<tr>
<td class="ctEven"><i>Nessuno</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<p><span id="Description"></span>
</p>
<h2><span class="mw-headline" id="Descrizione">Descrizione</span></h2>
<p>Questa macro esporta pi&ugrave; oggetti risultato FEM da un'analisi transitoria nel formato VTK e genera un file PVU che pu&ograve; essere utilizzato per caricare i risultati direttamente in ParaView per la post-elaborazione.
</p><p><span id="Background"></span>
</p>
<h2><span class="mw-headline" id="Contesto">Contesto</span></h2>
<p>Un'analisi transitoria in FreeCAD genera una serie di oggetti di risultati FEM, uno per ogni marca temporale. I singoli risultati possono essere analizzati direttamente in FreeCAD e post-elaborati utilizzando le <a href="../it/FEM_PostPipelineFromResult.html" title="FEM PostPipelineFromResult/it">pipeline</a>. Tuttavia, le possibilit&agrave; offerte da FreeCAD sono ancora limitate, soprattutto per le analisi transitorie. Uno strumento migliore per la post-elaborazione e la visualizzazione &egrave; ParaView. &Egrave; possibile esportare singoli oggetti risultato FEM da FreeCAD come file .vtk o .vtu, che possono poi essere aperti con ParaView. Purtroppo, l'ambiente di lavoro FEM non supporta (ancora) l'esportazione di pi&ugrave; file .vtk contemporaneamente. &Egrave; qui che entra in gioco questa macro.
</p><p><span id="How_to_use_(experienced_users)"></span>
</p>
<h2><span id="Come_usarla_.28utenti_esperti.29"></span><span class="mw-headline" id="Come_usarla_(utenti_esperti)">Come usarla (utenti esperti)</span></h2>
<p>Eseguire la macro su un progetto FreeCAD che include diversi oggetti risultato FEM da un'analisi transitoria. Oltre al file .FCStd, verr&agrave; creata una nuova cartella 'vtk-export', contenente i singoli risultati (file .vtu) e un file .pvu che pu&ograve; essere aperto da ParaView.
</p><p><span id="How_to_use_(step-by-step_with_example)"></span>
</p>
<h2><span id="Come_usarla_.28passo_dopo_passo_con_esempio.29"></span><span class="mw-headline" id="Come_usarla_(passo_dopo_passo_con_esempio)">Come usarla (passo dopo passo con esempio)</span></h2>
<p>Come esempio, viene utilizzata la piegatura di una striscia bimetallica in alluminio/acciaio. Una guida passo passo per creare il file di esempio &egrave; disponibile <a href="../it/Transient_FEM_analysis.html" title="Transient FEM analysis/it">qui</a>, oppure &egrave; possibile scaricare il file dalla <a href="#Downloads">sezione download</a> di questa pagina. Salvare il file FCMacro nella cartella delle macro di FreeCAD, raggiungibile tramite Modifica &rarr; Preferenze &rarr; Python &rarr; Macro.
</p><p>Con il file di esempio aperto, andare su Macro &rarr; Macro..., selezionare "ExportTransientResults_190830.FCMacro" (o qualsiasi nome con cui &egrave; stato salvato) ed eseguirlo. La macro creer&agrave; ora una sottocartella "vtk-export" accanto al file .FCStd. A seconda del numero e delle dimensioni degli oggetti risultato, l'operazione potrebbe richiedere del tempo. Nella Vista Report (Visualizza &rarr; Vista Report), si dovrebbe vedere "Macro completata", se tutto &egrave; andato bene, oppure alcuni messaggi di errore. (Nota: a volte compaiono messaggi come "PropertyFloatList NON esportato in vtk", ma si riesce comunque a lavorare con i file VTK...) Nella sottocartella "vtk-export", si trovano i file .vtu, uno per ogni set di risultati per ogni timestamp. Inoltre, viene creato un file .pvd, che indica a ParaView quale set di risultati appartiene a quale timestamp. 
</p><p>Ora aprire ParaView e andare su File &rarr; Apri... e aprire il file .pvd. Nella scheda "Properties", cliccare su "Apply" per caricare i risultati. Nella scheda "Information" si vedr&agrave; un elenco di "Index" e "Value", corrispondenti ai timestamp dei risultati appena importati. (Naturalmente, &egrave; sempre opportuno verificare se i timestamp indicati qui sono corretti o se si &egrave; verificato qualcosa di anomalo durante l'esportazione.) Da qui, si pu&ograve; usare ParaView per sperimentare con i risultati. Poich&eacute; ParaView offre numerose possibilit&agrave;, si prega di fare riferimento alla documentazione appropriata disponibile online. 
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>For demonstrating purposes, let us now visualise the temperature of the bent bimetal strip: In the 'properties' tab on the left, under 'coloring' we select temperature, and the image gets color-mapped according to the local temperature. Via the little icon with a heart, we select the color scale 'cool to warm'. With the recorder-like icons on the top, we can move through all the individual results that were created during the analysis. The 'play' button will display the individual images in their sequence. However, the individual results are not separated by a constant time interval, so the animation is not proportional in time.
</p>
</div> 
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>What we need is an interpolation of the results in between the time steps, which is available via Filters &rarr; Temporal &rarr; Temporal Interpolator. Here we choose again the temperature for coloring. In the 'animation view' (View &rarr; Animation View), we can now switch from 'sequence' mode to 'real time' mode. We can also set the start time (default is 0.01 s), the end time, and the duration. While start and end time refer to simulation time, the duration is the actual real time that the animation takes to play completely. With 10 s duration, our 60 s simulation time will be squeezed into 10 s real time.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>We go one step further and want to visualise the actual bending of the strip. With the Temporal Interpolator selected, we add Filters &rarr; Common &rarr; Warp by Vector. Under 'vectors' we choose 'DisplacementVectors' and set the 'scale factor' to 10. When we play the animation now, we can actually see the color-mapped strip bending (exaggerated by a factor of 10).
</p>
</div>
<p><span typeof="mw:File"><a href="../index.php?title=Transient_FEM_Bimetal_ParaView_(1).JPG&amp;filetimestamp=20190830121504&amp;.html" class="mw-file-description"><img src="../File/Transient_FEM_Bimetal_ParaView_%281%29.JPG" decoding="async" width="700" height="543" class="mw-file-element" data-file-width="1280" data-file-height="993"></a></span>
</p>
<div style="clear:both"></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>The post-processing we have just done can be saved as a 'state' in ParaView, which can be opened any time again and even be applied to a different set of results.
</p>
</div>
<p><span id="Downloads"></span>
</p>
<h2><span class="mw-headline" id="Download">Download</span></h2>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing">Macro file (3 kB)</a></li>
<li><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing">Example file without results (200 kB)</a></li>
<li><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing">Example file with results (10 MB)</a></li>
<li><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing">All example files, including the vtk-export folder (21 MB)</a></li></ul>
</div>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<p><b>Macro_export_transient_FEM_results.FCMacro</b>
</p>
<pre>#!/usr/bin/python
# -*- coding: utf-8 -*-

#
# Macro to export multiple FEM results objects from a transient analysis for
# post-processing in ParaView.
#
# Created by &lt;Luftschraube&gt; under the GNU Lesser General Public License (LGPL)
#
# Version 0.1 (30.08.2019)
#

import FreeCAD
import Fem
import feminout.importVTKResults
import os
from sys import exit

FreeCAD.Console.PrintMessage("&gt;&gt;&gt;---------Macro started\n")

#Get the file path and name of the active document 
p = FreeCAD.ActiveDocument.FileName
FilePath = "/".join(p.split("/")[:-1])
FileName = p.split("/")[-1].split(".")[0]
FreeCAD.Console.PrintMessage("File path:" + FilePath + "\n")
FreeCAD.Console.PrintMessage("File name:" + FileName + "\n")
FreeCAD.Console.PrintMessage("\n&lt;&lt;&lt;----------Macro finished with errors\n")

#Get FEM result objects into a list
FreeCAD.Console.PrintMessage("Looking for result objects...")
FEMResultObjects = []

for obj in App.ActiveDocument.Objects:
	if obj.TypeId == "Fem::FemResultObjectPython":	
		FEMResultObjects.append(obj.Label)
		#FreeCAD.Console.PrintMessage(obj.Label + '\n')

NumberOfResultObjects = len(FEMResultObjects)
FreeCAD.Console.PrintMessage(str(NumberOfResultObjects) + " found\n")

if NumberOfResultObjects &gt; 0:
	
	#Export result objects as .vtu file and generate .pvu file
	ExportFolderName = "vtk-export"
	ExportOutputPath = FilePath + "/" + ExportFolderName
	if not os.path.exists(ExportOutputPath):
		os.makedirs(ExportOutputPath)
		FreeCAD.Console.PrintMessage(ExportOutputPath + " has been created\n")
	else:
		FreeCAD.Console.PrintMessage(ExportOutputPath + " already exists\n")
	
	PVUFile = open(ExportOutputPath + "/" + FileName + ".pvd","w")
	PVUFile.write("&lt;VTKFile type=\"Collection\" version=\"1.0\" byte_order=\"LittleEndian\" header_type=\"UInt64\"&gt;\n\t&lt;Collection&gt;\n")
	
	n = 0
	for ExportObject in sorted(FEMResultObjects):
		n = n + 1
		
		#Read and format time stamp (e.g., 12.37 s = 0001237)
		FreeCADResultLabelParts = ExportObject.split("_")
		PreDecimal = FreeCADResultLabelParts[-3]
		PostDecimal = FreeCADResultLabelParts[-2]

		if len(PostDecimal) == 1:
			PostDecimal = PostDecimal + str(0)
		TimeValue = float(PreDecimal) + float(PostDecimal)/100
		TimeString = str(int(round(TimeValue*100,0))).zfill(7)
	
		#For some reason, the VTK exporter expects a list (although only one object is processed at once...) - so build a list with the current object
		ExportObjectList = []
		ExportObjectList.append(FreeCAD.ActiveDocument.getObject(ExportObject))
		FileNameOUT = FileName + "_" + TimeString + ".vtu"
		FilePath = ExportOutputPath + "/" + FileNameOUT
		FreeCAD.Console.PrintMessage(FilePath + " is to be created\n")
		feminout.importVTKResults.export(ExportObjectList,FilePath)
	
		PVUFile.write("\t\t&lt;DataSet timestep=\"" + str(TimeValue) + "\" file=\"" + FileNameOUT + "\"/&gt;\n")
	
	#Close the .pvu file
	PVUFile.write("\t&lt;/Collection&gt;\n&lt;/VTKFile&gt;")
	PVUFile.close()
else:
	FreeCAD.Console.PrintMessage("Nothing to export!")

FreeCAD.Console.PrintMessage('\n&lt;&lt;&lt;----------Macro finished\n')</pre>
<p><br>
<span id="Links"></span>
</p>
<div class="mw-translate-fuzzy">
<h2><span class="mw-headline" id="Link">Link</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Example <a href="../Transient_FEM_analysis.html" title="Transient FEM analysis">Transient FEM analysis</a>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>The Forum discussion <a rel="nofollow" class="external text" href="https://forum.freecad.org/viewtopic.php?f=22&amp;t=37650">Export transient FEM results to vtk/vtu for ParaView</a>
</p>
</div>
<!-- 
NewPP limit report
Cached time: 20260223123252
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.036 seconds
Real time usage: 0.049 seconds
Preprocessor visited node count: 123/1000000
Post&#8208;expand include size: 3808/2097152 bytes
Template argument size: 4807/2097152 bytes
Highest expansion depth: 7/100
Expensive parser function count: 2/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 4479/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    6.181      1 -total
 57.55%    3.557      1 Template:Macro/it
 20.42%    1.262      1 Template:MacroCode
 17.99%    1.112      1 Template:Clear
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:172667-0!canonical and timestamp 20260223123252 and revision id 1759057. Rendering was triggered because: edit-page
 -->
</div>
</div><script src="../site.js"></script>