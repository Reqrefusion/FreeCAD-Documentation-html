<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro clone explicit/it</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="it" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Macro+clone+explicit&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><a href="../de/Macro_clone_explicit.html" class="mw-pt-progress mw-pt-progress--complete" title="Makro Expliziter Klon (100% translated)" lang="de" dir="ltr">Deutsch</a></li>
<li><a href="../Macro_clone_explicit.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro clone explicit (100% translated)" lang="en" dir="ltr">English</a></li>
<li><a href="../fr/Macro_clone_explicit.html" class="mw-pt-progress mw-pt-progress--complete" title="Macro clone explicit (100% translated)" lang="fr" dir="ltr">fran&ccedil;ais</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--med" lang="it" dir="ltr">italiano</span></li>
<li><a href="../pl/Macro_clone_explicit.html" class="mw-pt-progress mw-pt-progress--low" title="Makrodefinicja: Jawny klon (5% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../index.php?title=Macro_clone_explicit.png&amp;filetimestamp=20190614140456&amp;.html" class="mw-file-description"><img src="../File/Macro_clone_explicit.png" decoding="async" width="32" height="32" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span><span> </span>
Macro Clone explicit
</p>
</td></tr>
<tr>
<th class="ctOdd">Descrizione
</th></tr>
<tr>
<td class="ctEven left macro-description">Crea una copia di ciascun oggetto selezionato e imposta le sue propriet&agrave; su un'espressione collegata all'oggetto originale, rendendolo un clone esplicito e modificabile.<br><br>Versione macro: 0.1<br>Ultima modifica: 15-12-2018<br>Versione FreeCAD: 18 e successive<br>Download: <a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/a/ab/Macro_clone_explicit.png">ToolBar Icon</a><br>Autore: Raph82<br>
</td></tr>
<tr>
<th class="ctOdd">Autore
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../index.php?title=User;Raph82&amp;action=edit&amp;redlink=1.html" class="new" title="User:Raph82 (page does not exist)">Raph82</a>
</td></tr>
<tr>
<th class="ctOdd">Download
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/a/ab/Macro_clone_explicit.png">ToolBar Icon</a>
</td></tr>
<tr>
<th class="ctOdd">Link
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../it/Macros_recipes.html" title="Macros recipes/it">Raccolta di macro</a><br><a href="../it/How_to_install_macros.html" title="How to install macros/it">Come installare le macro</a><br><a href="../it/Customize_Toolbars.html" title="Customize Toolbars/it">Personalizzare la  toolbar</a>
</td></tr>
<tr>
<th class="ctOdd">Versione macro
</th></tr>
<tr>
<td class="ctEven macro-version">0.1
</td></tr>
<tr>
<th class="ctOdd">Data ultima modifica
</th></tr>
<tr>
<td class="ctEven macro-date">15-12-2018
</td></tr>
<tr>
<th class="ctOdd">Versioni di FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">18 e successive
</td></tr>
<tr>
<th class="ctOdd">Scorciatoia
</th></tr>
<tr>
<td class="ctEven"><i>Nessuna</i>
</td></tr>
<tr>
<th class="ctOdd">Vedere anche
</th></tr>
<tr>
<td class="ctEven"><a href="../it/Expressions.html" title="Expressions/it">Espressioni</a>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<p><span id="Description"></span>
</p>
<h2><span class="mw-headline" id="Descrizione">Descrizione</span></h2>
<p>Questa macro crea una copia di ciascun oggetto selezionato e imposta le sue propriet&agrave; su un'<a href="../it/Expressions.html" title="Expressions/it">espressione</a> collegata all'oggetto originale, rendendolo un clone esplicito e modificabile.
</p><p>Questo clone &egrave; una copia dell'oggetto originale, come nel comando <b>Modifica &rarr; Duplica selezione</b>, ma le sue propriet&agrave; sono definite da espressioni.
</p><p><span id="How_does_this_'explicit_and_editable_clone'_differ_from_a_Clone_object?"></span>
</p>
<h3><span id="In_che_modo_questo_.27clone_esplicito_e_modificabile.27_differisce_da_un_oggetto_Clone.3F"></span><span class="mw-headline" id="In_che_modo_questo_'clone_esplicito_e_modificabile'_differisce_da_un_oggetto_Clone?">In che modo questo 'clone esplicito e modificabile' differisce da un oggetto Clone?</span></h3>
<p>"Esplicito" perch&eacute; tutte le propriet&agrave; dell'oggetto originale sono visibili. In un oggetto Clone di un Cubo, &egrave; possibile vedere la sua Altezza, ad esempio? Quando si utilizza un'espressione per un oggetto Clone, &egrave; possibile accedere facilmente alle sue propriet&agrave; padre?
</p><p>"Modificabile" perch&eacute;, a differenza di un oggetto Clone, &egrave; possibile modificare l'espressione di qualsiasi propriet&agrave;. Quindi &egrave; possibile che l'oggetto cloni solo alcune propriet&agrave; del suo genitore, modificando le altre.
</p><p><span id="Usage"></span>
</p>
<h2><span class="mw-headline" id="Utilizzo">Utilizzo</span></h2>
<ol><li>Selezionare almeno un oggetto.</li>
<li><b>Macro &rarr; Macro...</b></li>
<li>Selezionare <b>clone_explicit.FCMacro</b> dall'elenco.</li>
<li>Premere il pulsante <span class="ButtonTemplate" style="background: #f5f5f5; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); border: 2px solid #989898; border-radius: 0.3em; padding: 0px 8px 1px 8px; font-weight:normal;color: #202122;">Execute</span>.</li></ol>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>ToolBar Icon <span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=Macro_clone_explicit.png&amp;filetimestamp=20190614140456&amp;.html" class="mw-file-description"><img src="../File/Macro_clone_explicit.png" decoding="async" width="64" height="64" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span>
</p>
</div>
<p><b>Macro_clone_explicit.FCMacro</b>
</p>
<pre>__Title__ = "clone_explicit"
__Author__ = "Raph82"
__URL__     = "https://freecad.org/index-fr.html"
__Version__ = "0.1"
__Date__    = "2018-12-15" #YYYY-MM-DD
__Comment__ = "This macro creates a copy of the selected objects and sets their properties to an expression linking to the original object, making it an explicit and editable clone"
__Web__ = "https://freecad.org/"
__Wiki__ = "https://wiki.freecad.org/index.php?title=Macro_clone_explicit"
__Icon__  = "https://wiki.freecad.org/images/a/ab/Macro_clone_explicit.png"
__IconW__  = "C:/Users/User Name/AppData/Roaming/FreeCAD/Macro_clone_explicit.png"
__Help__ = "Select at least one object and run the macro to make explicit and editable clone(s)"
__Status__ = "dev"
__Requires__ = "All FreeCAD"
__Communication__ = "https://wiki.freecad.org/index.php?title=User:raph82"

#IMPORTS:
import sys

##################################################
def set_expression(obj, property_to_set, expression):
    """"""
    try:
        print type(obj)
        obj.setExpression(property_to_set, expression)
#    except 'Base.FreeCADError':
    except Exception as detail:
        print detail
        print type(detail)
        if detail['swhat'] == 'Property not found':
            App.Console.PrintMessage('Object "{obj}" has no property "{prop}"\r\n'.format(obj=obj.Name, prop=property_to_set))
        else:
            raise

##################################################
def clone_explicit(mode):
    """Copy the selected objects and sets their properties to an expression, making it an explicit and editable clone.

     This clone is called "explicit and editable" because the link with its parent is visible and can be changed in the object properties.

     The link to the original object can be either "direct" or "transient", depending on the mode argument:
     - a direct clone has expressions pointing to its parent: clone.Length = parent.Length
     - a transient clone has expressions pointing to its ancestor. Say parent.Length = Box001.Length. With a transient clone, clone.Length = Box001.Length, whereas with a direct clone, clone.Length = parent.Length.
       This indirect link to Box001 (via the parent object) could be severed, accidentally or not, depending on what relationship you're looking for.

     If you're lost, try with a direct clone first."""

    App.Console.PrintMessage("Start of clone_explicit macro"+"\r\n")

    #Current selection check:
    sel = FreeCADGui.Selection.getSelection()

    App.Console.PrintMessage(str(len(sel))+" object(s) selected\r\n")
    if len(sel)&nbsp;!= 0:
        for i in range(len(sel)):
            obj=sel[i]

            #copying current object:
            App.Console.PrintMessage('Copying "'+obj.Label+'" ('+obj.Name+')\r\n')
            obj_copy=App.ActiveDocument.copyObject(obj, False) #https://freecad.org/api/d8/d3e/classApp_1_1Document.html#a08f1d7d90f4a7276a02918fb6445a04a
            App.Console.PrintMessage('"'+obj_copy.Label+'" ('+obj_copy.Name+') created\r\n')

            if mode == 'direct':
                #defining expressions pointing to the original object:
                set_expression(obj_copy, 'Placement.Base.x',          obj.Name+u'.Placement.Base.x')
                set_expression(obj_copy, 'Placement.Base.y',          obj.Name+u'.Placement.Base.y')
                set_expression(obj_copy, 'Placement.Base.z',          obj.Name+u'.Placement.Base.z')
                set_expression(obj_copy, 'Placement.Rotation.Angle',  obj.Name+u'.Placement.Rotation.Angle')
                set_expression(obj_copy, 'Placement.Rotation.Axis.x', obj.Name+u'.Placement.Rotation.Axis.x')
                set_expression(obj_copy, 'Placement.Rotation.Axis.y', obj.Name+u'.Placement.Rotation.Axis.y')
                set_expression(obj_copy, 'Placement.Rotation.Axis.z', obj.Name+u'.Placement.Rotation.Axis.z')
                set_expression(obj_copy, 'Length',                    obj.Name+u'.Length')
                set_expression(obj_copy, 'Width',                     obj.Name+u'.Width')
                set_expression(obj_copy, 'Height',                    obj.Name+u'.Height')

            elif mode == 'transient':
                #defining expressions pointing to the utmost original object:
                define_transient_expression(obj, obj_copy, 'Placement.Base.x')
                define_transient_expression(obj, obj_copy, 'Placement.Base.y')
                define_transient_expression(obj, obj_copy, 'Placement.Base.z')
                define_transient_expression(obj, obj_copy, 'Placement.Rotation.Angle')
                define_transient_expression(obj, obj_copy, 'Placement.Rotation.Axis.x')
                define_transient_expression(obj, obj_copy, 'Placement.Rotation.Axis.y')
                define_transient_expression(obj, obj_copy, 'Placement.Rotation.Axis.z')
                define_transient_expression(obj, obj_copy, 'Length')
                define_transient_expression(obj, obj_copy, 'Width')
                define_transient_expression(obj, obj_copy, 'Height')
            else:
                App.Console.PrintError('Programming error: mode value not recognized.\r\n')

            App.Console.PrintMessage('('+obj_copy.Label+'" ('+obj_copy.Name+') expressions set\r\n')

        FreeCAD.ActiveDocument.recompute()
        App.Console.PrintMessage('End of clone_explicit macro\r\n')

    else:
        App.Console.PrintError('Select at least one object first\r\n')

    sel = ""
    obj = ""
    obj_copy = ""

##################################################
def find_expression(source_object, property_to_define):
    """"""

    for var_tuple in source_object.ExpressionEngine: #https://forum.freecad.org/viewtopic.php?f=22&amp;t=21950
        # .ExpressionEngine returns tuple like [('Placement.Base.z', 'Length')], see https://docs.python.org/2.7/tutorial/datastructures.html#tuples-and-sequences
        App.Console.PrintMessage('var_tuple[0]='+var_tuple[0]+'\r\n')
        if var_tuple[0] == property_to_define:
           return var_tuple[1]

##################################################
def define_transient_expression(source_object, target_object, property_to_define):
    """"""
    expressions = source_object.ExpressionEngine #https://forum.freecad.org/viewtopic.php?f=22&amp;t=21950
    # returns tuple like [('Placement.Base.z', 'Length')], see https://docs.python.org/2.7/tutorial/datastructures.html#tuples-and-sequences

    expression = find_expression(source_object, property_to_define)
    if expression&nbsp;!= None:
#        App.Console.PrintMessage("target_object.Name="+target_object.Name+"\r\n")
#        App.Console.PrintMessage("property_to_define="+property_to_define+"\r\n")
#        App.Console.PrintMessage("expressions[property_to_define]="+expressions[property_to_define]+"\r\n")

        set_expression(target_object, property_to_define, expression)
    else:
        set_expression(target_object, property_to_define, source_object.Name+'.'+property_to_define)

    expressions = ""

##################################################
clone_explicit('direct')
#clone_explicit('transient')</pre>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Options">Options</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>A <code>mode</code> option was planned. It's not yet implemented. It now seems much more complex than initially thought, maybe too complex for me to implement.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>The idea is that one might prefer one of two behaviors:
</p>
<ul><li>the clone keeps mimicking its parent even if the parent properties <i>expressions</i> change. It's the <code>direct</code> mode,</li>
<li>the clone keeps the properties <i>expressions</i> the parent had when the clone was created. It's the <code>transient</code> mode.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Note the emphasis on the word "expressions". An expression is one abstraction layer over a value.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Here's an example. Imagine the parent object (the one you select before running the macro), has its <code>Height</code> property set to the expression <code>Object<b>3</b>.Height * 2</code>.
</p>
<ul><li>When run in <code>direct</code> mode:
<ul><li><code>Clone.Height = Parent.Height</code>,</li>
<li>changes in <code>Object<b>3</b>.Height</code> value would affect both the parent and the clone objects,</li>
<li>changes in <code>Parent.Height</code> <i>expression</i> would <b>also</b> affect both objects:
<ul><li><code>Parent.Height = Object<b>4</b>.Height * 2</code> and</li>
<li><code>Clone.Height = Parent.Height</code> still.</li></ul></li></ul></li>
<li>When run in <code>transient</code> mode:
<ul><li><code>Clone.Height = Object<b>3</b>.Height * 2</code>,</li>
<li>changes in <code>Object<b>3</b>.Height</code> value would affect both the parent and the clone objects,</li>
<li>changes in <code>Parent.Height</code> <i>expression</i> would <b>only</b> affect the parent object:
<ul><li><code>Parent.Height = Object<b>4</b>.Height * 2</code> and</li>
<li><code>Clone.Height = Object<b>3</b>.Height * 2</code> still.</li></ul></li></ul></li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>For now, the macro is run with the mode parameter set to <code>direct</code> and no choice is proposed to the user.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Limitations">Limitations</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li>Works well only with Cubes at the moment. To expand to many types I need to:
<ul><li>find how to identify an object type to deal with its different properties accordingly;</li>
<li>find how to catch the <code>Property not found</code> error.</li></ul></li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Version_history">Version history</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li>0.1: first public release</li></ul>
</div>
<!-- 
NewPP limit report
Cached time: 20260206105906
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.038 seconds
Real time usage: 0.164 seconds
Preprocessor visited node count: 140/1000000
Post&#8208;expand include size: 2549/2097152 bytes
Template argument size: 7774/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 8304/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   39.332      1 -total
 50.30%   19.785      1 Template:Macro/it
 37.09%   14.589      1 Template:MacroCode
  7.19%    2.826      3 Template:MenuCommand
  4.54%    1.786      1 Template:Button
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:414091-0!canonical and timestamp 20260206105906 and revision id 1748180. Rendering was triggered because: edit-page
 -->
</div>
</div><script src="../site.js"></script>