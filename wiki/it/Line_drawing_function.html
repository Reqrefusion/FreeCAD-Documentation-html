<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Line drawing function/it</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="it" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Line+drawing+function&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><a href="../id/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--low" title="Line drawing function (3% translated)" lang="id" dir="ltr">Bahasa Indonesia</a></li>
<li><a href="../de/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--complete" title="Linienzeichnungsfunktion (100% translated)" lang="de" dir="ltr">Deutsch</a></li>
<li><a href="../Line_drawing_function.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Line drawing function (100% translated)" lang="en" dir="ltr">English</a></li>
<li><a href="../tr/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--low" title="Line drawing function (3% translated)" lang="tr" dir="ltr">T&uuml;rk&ccedil;e</a></li>
<li><a href="../es/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--low" title="Line drawing function (12% translated)" lang="es" dir="ltr">espa&ntilde;ol</a></li>
<li><a href="../fr/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--complete" title="Fonction - tracer une ligne (100% translated)" lang="fr" dir="ltr">fran&ccedil;ais</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--med" lang="it" dir="ltr">italiano</span></li>
<li><a href="../pl/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--complete" title="Funkcja rysowania linii (100% translated)" lang="pl" dir="ltr">polski</a></li>
<li><a href="../ro/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--med" title="Func&#539;ia de Desenare a liniei (15% translated)" lang="ro" dir="ltr">rom&acirc;n&#259;</a></li>
<li><a href="../sv/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--med" title="Line drawing function (15% translated)" lang="sv" dir="ltr">svenska</a></li>
<li><a href="../cs/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--low" title="Line drawing function (3% translated)" lang="cs" dir="ltr">&#269;e&scaron;tina</a></li>
<li><a href="../ru/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--complete" title="&#1060;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; &#1088;&#1080;&#1089;&#1086;&#1074;&#1072;&#1085;&#1080;&#1103; &#1083;&#1080;&#1085;&#1080;&#1080; (100% translated)" lang="ru" dir="ltr">&#1088;&#1091;&#1089;&#1089;&#1082;&#1080;&#1081;</a></li></ul></div>
<div style="clear:right; margin-bottom: .5em; float: right; padding: .5em 0 .8em 1.4em; background: none;"><meta property="mw:PageProp/toc"></div>
<p><span id="Introduction"></span>
</p>
<h2><span class="mw-headline" id="Introduzione">Introduzione</span></h2>
<p>Questa pagina mostra come si possono facilmente creare delle funzionalit&agrave; avanzate con Python.
</p><p>In questo esercizio, andremo a creare un nuovo strumento che disegna una linea partendo da due punti cliccati nella vista 3D.
</p><p>Questo strumento pu&ograve; essere collegato a un comando di FreeCAD, e tale comando pu&ograve; essere chiamato da un qualsiasi elemento dell'interfaccia, ad esempio da una voce di menu o da un pulsante in una barra degli strumenti.
</p><p><span id="The_main_script"></span>
</p>
<h2><span class="mw-headline" id="Lo_script_principale">Lo script principale</span></h2>
<p>Per prima cosa scriviamo uno script che contenga tutta la nostra funzionalit&agrave;. Dopo, salviamo questo script in un file e lo importiamo in FreeCAD, in modo che tutte le classi e le funzioni che scriviamo diventino disponibili in FreeCAD. Lanciamo perci&ograve; il nostro editor di testo preferito, e digitiamo le seguenti righe:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">FreeCADGui</span><span class="o">,</span> <span class="nn">Part</span>
<span class="kn">from</span> <span class="nn">pivy.coin</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">line</span><span class="p">:</span>

<span class="w">    </span><span class="sd">"""This class will create a line after the user clicked 2 points on the screen"""</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">FreeCADGui</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">ActiveView</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getpoint</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_cb</span><span class="p">):</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">event_cb</span><span class="o">.</span><span class="n">getEvent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span> <span class="o">==</span> <span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">DOWN</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">getPosition</span><span class="p">()</span>
            <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">getPoint</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">Part</span><span class="o">.</span><span class="n">LineSegment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">toShape</span><span class="p">()</span>
                <span class="n">Part</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">removeEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
</pre></div>
<p><a href="#top">Inizio</a></p>
<p><span id="Detailed_explanation"></span>
</p>
<h3><span class="mw-headline" id="Spiegazione_dettagliata">Spiegazione dettagliata</span></h3>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">Part</span><span class="o">,</span> <span class="nn">FreeCADGui</span>
<span class="kn">from</span> <span class="nn">pivy.coin</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
<p>In Python, quando si desidera utilizzare le funzioni di un altro modulo &egrave; necessario importarlo. Nel nostro caso, abbiamo bisogno delle funzioni del <a href="../it/Part_Workbench.html" title="Part Workbench/it">Ambiente Parte</a> per creare la linea, e del modulo Gui <code>FreeCADGui</code> per accedere alla <a href="../it/3D_view.html" class="mw-redirect" title="3D view/it">Vista 3D</a>. Inoltre, abbiamo anche bisogno del contenuto completo della libreria di Coin, in modo da poter utilizzare direttamente tutti gli oggetti Coin, come, ad esempio, <code>SoMouseButtonEvent</code>, ecc ..
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">line</span><span class="p">:</span>
</pre></div>
<p>Qui definiamo la nostra classe principale.
</p><p>Perch&eacute; utilizzare una classe e non una funzione? Il motivo &egrave; che abbiamo bisogno che il nostro strumento rimanga "vivo" mentre aspettiamo che l'utente clicchi sullo schermo.
</p><p>Una funzione termina quando il suo compito &egrave; stato svolto, invece un oggetto (una classe definisce un oggetto) rimane attivo finch&eacute; non viene distrutto.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="sd">"""This class will create a line after the user clicked 2 points on the screen"""</span>
</pre></div>
<p>In Python, ogni classe o funzione pu&ograve; avere una stringa di documentazione (docstring). In FreeCAD, questo &egrave; particolarmente utile perch&eacute; quando chiameremo la classe nell'interprete, la stringa di descrizione verr&agrave; visualizzata come tooltip (nota di descrizione o aiuto).
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<p>Le classi di Python possono sempre contenere una funzione <code>__init__</code>, che viene eseguita quando la classe viene chiamata per creare un oggetto. Qui metteremo tutto quello che vogliamo che accada quando il nostro strumento line inizia.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">FreeCADGui</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">ActiveView</span>
</pre></div>
<p>In una classe, di solito si aggiunge <code>self.</code> prima di un nome di variabile, in modo che sia facilmente accessibile a tutte le funzioni dentro e fuori la classe. In questo script, usiamo <code>self.view</code> per accedere e manipolare la vista 3D attiva.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
<p>Qui creiamo una lista vuota per archiviare i punti 3D inviati dalla funzione <code>getpoint()</code>.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getpoint</span><span class="p">)</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Questa &egrave; la parte importante.
</p><p>Dato che in realt&agrave; si tratta una scena <a rel="nofollow" class="external text" href="http://www.coin3d.org/">Coin3d</a>, FreeCAD utilizza il meccanismo di callback (richiamo) di Coin, il quale permette di chiamare una funzione ogni volta che nella scena accade un determinato evento.
</p><p>Nel nostro caso, stiamo creando un callback per gli eventi <a rel="nofollow" class="external text" href="http://doc.coin3d.org/Coin/group__events.html">SoMouseButtonEvent</a> e li colleghiamo alla funzione getpoint. Adesso, ogni volta che un pulsante del mouse viene premuto o rilasciato, viene eseguita la funzione getpoint.
</p>
</div>
<div class="mw-translate-fuzzy">
<p>Notare che alla addEventCallbackPivy() esiste anche un'alternativa, chiamata addEventCallback() la quale dispensa dall'uso di pivy. Ma, dal momento che pivy &egrave; un modo molto efficace e naturale per accedere a ogni parte di una scena di Coin, &egrave; meglio utilizzarlo il pi&ugrave; possibile!
</p>
</div>
<p><a href="#top">Inizio</a></p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">def</span> <span class="nf">getpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_cb</span><span class="p">):</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Ora definiamo la funzione getpoint, che sar&agrave; eseguita quando un pulsante del mouse verr&agrave; premuto in una vista 3D. Questa funzione ricever&agrave; un argomento, che chiamiamo event_cb.
</p><p>Da questo evento callback possiamo accedere all'oggetto event, che contiene diverse parti di informazioni
</p><p>Per maggiori informazioni sugli eventi controllabili consultate <a href="../it/Code_snippets.html#Observing_mouse_events_in_the_3D_viewer_via_Python" title="Code snippets/it">questa pagina</a>.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span> <span class="o">==</span> <span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">DOWN</span><span class="p">:</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>La funzione getpoint viene chiamata ogni volta che un pulsante del mouse viene premuto o rilasciato. Invece, noi vogliamo definire un punto 3D solo quando viene premuto (altrimenti otteniamo due punti 3D molto vicini l'uno all'altro). Pertanto qu&igrave; dobbiamo verificare e stabilire questo.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">pos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">getPosition</span><span class="p">()</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Qui otteniamo le coordinate dello schermo nella posizione del cursore del mouse
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">getPoint</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Questa funzione ci fornisce un vettore di FreeCAD (x, y, z) contenente il punto 3D che giace sul piano focale, esattamente sotto il cursore del mouse. Se siamo in vista camera, immaginiamo un raggio proveniente dalla fotocamera, passante per il cursore del mouse, che colpisce il piano focale. Questo &egrave; il nostro punto 3D. Se siamo in vista ortogonale, il raggio &egrave; parallelo alla direzione di visualizzazione.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Aggiungiamo il nostro nuovo punto nella pila (stack)
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</pre></div>
<p>Abbiamo gi&agrave; abbastanza punti? Se s&igrave;, allora disegnamo la linea!
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="n">Part</span><span class="o">.</span><span class="n">LineSegment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Qui usiamo la funzione Line() del <a href="../it/Part_Workbench.html" title="Part Workbench/it">Modulo Parte</a> che crea una linea da due vettori di FreeCAD.
</p><p>Tutto quanto che si crea e si modifica all'interno del modulo Parte, rimane nel modulo Parte. Quindi, fino ad ora, abbiamo creato una linea Parte. Essa non &egrave; legata ad alcun oggetto del nostro documento attivo, perci&ograve; sullo schermo non viene ancora visualizzato nulla.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">shape</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">toShape</span><span class="p">()</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Il documento di FreeCAD pu&ograve; accettare solo shape (forme) dal modulo Parte. Le shape sono il tipo pi&ugrave; generico di forme del modulo Part. Dobbiamo quindi convertire la nostra linea in una shape prima di poterla aggiunge al documento.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">Part</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Il modulo Parte ha una funzione molto utile, show(), che crea un nuovo oggetto nel documento e collega ad esso una shape (forma).
</p><p>Possiamo anche creare prima un nuovo oggetto nel documento, poi associare manualmente ad esso la shape.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">removeEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Siccome con la nostra linea abbiamo finito, terminiamo il meccanismo di callback, che consuma preziosi cicli di CPU.
</p>
</div>
<p><a href="#top">Inizio</a></p>
<p><span id="Testing_the_script"></span>
</p>
<div class="mw-translate-fuzzy">
<h3><span class="mw-headline" id="Test_e_Utilizzo_dello_script">Test e Utilizzo dello script</span></h3>
<p>Ora, salviamo il nostro script in qualche posizione in cui l'interprete Python di FreeCAD possa trovarlo.
</p><p>Durante l'importazione dei moduli, l'interprete punta nei seguenti luoghi: i percorsi di installazione di Python, la directory bin di FreeCAD, e tutte le directory dei moduli FreeCAD. Quindi, la soluzione migliore &egrave; quella di creare una nuova directory in una delle FreeCAD <a href="../it/Installing_more_workbenches.html" title="Installing more workbenches/it">Mod directories</a>, e salvare in essa il nostro script. Per esempio, creiamo una directory "MyScripts", e salviamo il nostro script come "exercise.py".
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Now let's save our script in a folder where the FreeCAD Python interpreter can find it. When importing modules, the interpreter will look in the following places: the Python installation paths, the FreeCAD <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">bin</span> folder, and all FreeCAD <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">Mod</span> (module) folders. So the best solution is to create a new folder in one of the <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">Mod</span> folders. Let's create a <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">MyScripts</span> folder there and save our script in it as <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">exercise.py</span>.
</p>
</div>
<div class="mw-translate-fuzzy">
<p>Adesso che tutto &egrave; pronto, basta avviare FreeCAD, creare un nuovo documento, e, nell'interprete Python, eseguire:
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">exercise</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Se non viene visualizzato nessun messaggio di errore, significa che il nostro script "exercise" &egrave; stato caricato.
</p><p>Ora possiamo controllare il suo contenuto con:
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="nb">dir</span><span class="p">(</span><span class="n">exercise</span><span class="p">)</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Il comando dir() &egrave; un comando integrato di Python che elenca il contenuto di un modulo. Possiamo vedere che la nostra classe line() &egrave; l&igrave;, in attesa.
</p><p>Non rimane che provarla scrivendo:
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="s1">'line'</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">exercise</span><span class="p">)</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Now let's test it:
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">exercise</span><span class="o">.</span><span class="n">line</span><span class="p">()</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Poi, clicchiamo due volte nella vista 3D, e bingo, ecco la nostra linea! Per farne una nuova, basta riscrivere ancora exercise.line(), e ancora, e ancora ... Siete contenti, no?
</p>
</div>
<p><a href="#top">Inizio</a></p>
<p><span id="Registering_the_script"></span>
</p>
<div class="mw-translate-fuzzy">
<h3><span id="Includere_lo_script_nell.27interfaccia_di_FreeCAD"></span><span class="mw-headline" id="Includere_lo_script_nell'interfaccia_di_FreeCAD">Includere lo script nell'interfaccia di FreeCAD</span></h3>
<p>Per essere davvero efficace il nostro nuovo strumento linea (line) dovrebbe avere un suo pulsante sull'interfaccia, in modo da non dover  digitare ogni volta tutte queste cose.
</p><p>Il modo pi&ugrave; semplice &egrave; quello di trasformare la nostra nuova directory MyScripts in un ambiente di lavoro completo di FreeCAD.
</p><p>&Egrave; facile. Basta solo inserire un file chiamato <b>InitGui.py</b> nella directory MyScripts. Il file InitGui.py conterr&agrave; le istruzioni per creare un nuovo ambiente di lavoro (workbench), poi aggiungere ad esso il nostro nuovo strumento.
</p><p>Oltre a questo dobbiamo anche modificare un po' il nostro codice di exercise, in modo che lo strumento line() sia riconosciuto come un comando ufficiale di FreeCAD.
</p><p>Cominciamo creando un file InitGui.py, e scriviamo in esso il seguente codice:
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>For our new line tool to be really useful, and to avoid having to type all that stuff, it should have a button in the interface. One way to do this is to transform our new <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">MyScripts</span> folder into a full FreeCAD workbench. This is easy, all that is needed is to put a file called <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">InitGui.py</span> inside the <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">MyScripts</span> folder. <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">InitGui.py</span> will contain the instructions to create a new workbench, and add our new tool to it. Besides that we will also need to change our exercise code a bit, so the <code>line()</code> tool is recognized as an official FreeCAD command. Let's start by creating an <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">InitGui.py</span> file, and writing the following code in it:
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">MyWorkbench</span> <span class="p">(</span><span class="n">Workbench</span><span class="p">):</span>

    <span class="n">MenuText</span> <span class="o">=</span> <span class="s2">"MyScripts"</span>

    <span class="k">def</span> <span class="nf">Initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">exercise</span>
        <span class="n">commandslist</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"line"</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appendToolbar</span><span class="p">(</span><span class="s2">"My Scripts"</span><span class="p">,</span> <span class="n">commandslist</span><span class="p">)</span>

<span class="n">Gui</span><span class="o">.</span><span class="n">addWorkbench</span><span class="p">(</span><span class="n">MyWorkbench</span><span class="p">())</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>A questo punto, penso che dovreste gi&agrave; capire da soli lo script precedente.
</p><p>Creiamo una nuova classe che chiamiamo MyWorkbench, le diamo un titolo (MenuText), e definiamo una funzione Initialize() che verr&agrave; eseguita quando l'ambiente di lavoro verr&agrave; caricato in FreeCAD. In tale funzione, si carica il contenuto del nostro file exercise, e si aggiungono i comandi di FreeCAD contenuti in una lista di comandi.
</p><p>Dopo, costruiamo una barra degli strumenti denominata "My Scripts" a cui assegniamo la nostra lista comandi. Al momento, ovviamente, disponiamo di un solo strumento, quindi la nostra lista dei comandi contiene un solo elemento.
</p><p>Quando il nostro ambiente di lavoro &egrave; pronto, lo aggiungiamo all'interfaccia principale.
</p>
</div>
<div class="mw-translate-fuzzy">
<p>Questo non basta ancora perch&eacute; un comando di FreeCAD deve essere formattato in un certo modo per poter funzionare. Quindi &egrave; necessario modificare un po' il nostro strumento line().
</p><p>Ora il nostro nuovo script exercise.py deve essere come questo:
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">FreeCADGui</span><span class="o">,</span> <span class="nn">Part</span>
<span class="kn">from</span> <span class="nn">pivy.coin</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">line</span><span class="p">:</span>

<span class="w">    </span><span class="sd">"""This class will create a line after the user clicked 2 points on the screen"""</span>

    <span class="k">def</span> <span class="nf">Activated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">FreeCADGui</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">ActiveView</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getpoint</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_cb</span><span class="p">):</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">event_cb</span><span class="o">.</span><span class="n">getEvent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span> <span class="o">==</span> <span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">DOWN</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">getPosition</span><span class="p">()</span>
            <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">getPoint</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">Part</span><span class="o">.</span><span class="n">LineSegment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">toShape</span><span class="p">()</span>
                <span class="n">Part</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">removeEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GetResources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">'Pixmap'</span><span class="p">:</span> <span class="s1">'path_to_an_icon/line_icon.png'</span><span class="p">,</span> <span class="s1">'MenuText'</span><span class="p">:</span> <span class="s1">'Line'</span><span class="p">,</span> <span class="s1">'ToolTip'</span><span class="p">:</span> <span class="s1">'Creates a line by clicking 2 points on the screen'</span><span class="p">}</span>

<span class="n">FreeCADGui</span><span class="o">.</span><span class="n">addCommand</span><span class="p">(</span><span class="s1">'line'</span><span class="p">,</span> <span class="n">line</span><span class="p">())</span>
</pre></div>
<div class="mw-translate-fuzzy">
<p>Qu&igrave; abbiamo trasformato la nostra funzione __init__() in una funzione Activated(), perch&egrave;, quando i comandi di FreeCAD vengono eseguiti, essi eseguono automaticamente la funzione Activated().
</p><p>Inoltre, abbiamo aggiunto una funzione GetResources(), che fornisce a FreeCAD le informazioni per trovare l'icona dello strumento, il nome e la descrizione (tooltip) del nostro strumento.
</p><p>Qualunque immagine jpg, png o svg pu&ograve; fungere da icona, essa pu&ograve; essere di qualsiasi dimensione, ma &egrave; meglio usare una dimensione vicina all'aspetto finale, come, ad esempio, 16x16, 24x24 o 32x32.
</p><p>Poi, abbiamo aggiunto la classe line() come un comando ufficiale di FreeCAD con il metodo AddCommand().
</p>
</div>
<div class="mw-translate-fuzzy">
<p>Questo &egrave; tutto, ora basta riavviare FreeCAD e avremo un bell'ambiente di lavoro con il nostro nuovo strumento line()!
</p>
</div>
<p><a href="#top">Inizio</a></p>
<p><span id="So_you_want_more?"></span>
</p>
<h3><span id="Cosa_si_pu.C3.B2_aggiungere.3F"></span><span class="mw-headline" id="Cosa_si_pu&ograve;_aggiungere?">Cosa si pu&ograve; aggiungere?</span></h3>
<p>Se questo esercizio vi &egrave; piaciuto, perch&eacute; non cercare di migliorare questo piccolo strumento? Si possono fare molte cose, come ad esempio:
</p>
<ul><li>Aggiungere assistenza per gli utenti: fino ad ora abbiamo fatto uno strumento molto spoglio, l'utente potrebbe essere un po' disorientato quando lo utilizza. Perci&ograve; si potrebbe aggiungere qualche informazione, che suggerisca come procedere. Ad esempio, si potrebbero mostrare dei messaggi nella console di FreeCAD. In merito, visita il modulo FreeCAD.Console</li>
<li>Aggiungere la possibilit&agrave; di digitare manualmente le coordinate dei punti 3D. Guarda la funzione input() di Python, per esempio</li>
<li>Aggiungere la possibilit&agrave; di definire pi&ugrave; di 2 punti</li>
<li>Aggiungere controlli per altri eventi. Al momento verifichiamo solo gli eventi del pulsante del mouse, ma se &#8203;&#8203;vogliamo anche fare qualcosa quando il mouse viene spostato oppure visualizzare le coordinate attuali?</li>
<li>Assegnare un nome all'oggetto creato</li></ul>
<p>Non esitate a scrivere le vostre domande o idee nel  <a rel="nofollow" class="external text" href="http://forum.freecad.org/">forum</a>!
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Don't hesitate to ask questions or share ideas on the <a rel="nofollow" class="external text" href="https://forum.freecad.org">forum</a>!
</p>
</div>
<p><a href="#top">Inizio</a></p>
<div class="NavFrame" style="margin: 0px; text-align: center; border-collapse: collapse; font-size: 100%; border-top-style: double; border-top-style: 1px; clear:both;">
    <div class="NavHead mw-collapsible mw-collapsed" style="margin: 1px; font-weight: normal; background-color: var(--background-color-neutral-subtle, #fefefe);"><span typeof="mw:File"><a href="../index.php?title=Power_user_hub.png&amp;filetimestamp=20200511213015&amp;.html" class="mw-file-description"><img src="../File/Power_user_hub.png" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="128" data-file-height="128"></a></span> <a href="../it/Power_users_hub.html" title="Power users hub/it">Power user documentation</a>
        <div class="NavContent mw-collapsible-content" style="margin: 10px; border: 1px solid var(--border-color-base, #aaaaaa); text-align: left; border-collapse: collapse; font-weight: normal; font-size: 100%; clear:both; margin-top: 1px; background-color: var(--background-color-neutral-subtle, #fefefe);">
<ul><li><b>FreeCAD scripting:</b> <a href="../it/Python.html" title="Python/it">Python</a>, <a href="../it/Introduction_to_Python.html" title="Introduction to Python/it">Introduction to Python</a>, <a href="../it/Python_scripting_tutorial.html" title="Python scripting tutorial/it">Python scripting tutorial</a>, <a href="../it/FreeCAD_Scripting_Basics.html" title="FreeCAD Scripting Basics/it">FreeCAD Scripting Basics</a></li></ul>
<hr>
<ul><li><b>Modules:</b> <a href="../it/Builtin_modules.html" title="Builtin modules/it">Builtin modules</a>, <a href="../it/Units.html" title="Units/it">Units</a>, <a href="../it/Quantity.html" title="Quantity/it">Quantity</a></li>
<li><b>Workbenches:</b> <a href="../it/Workbench_creation.html" title="Workbench creation/it">Workbench creation</a>, <a href="../it/Gui_Command.html" title="Gui Command/it">Gui Commands</a>, <a href="../it/Command.html" title="Command/it">Commands</a>, <a href="../it/Installing_more_workbenches.html" title="Installing more workbenches/it">Installing more workbenches</a></li>
<li><b>Meshes and Parts:</b> <a href="../it/Mesh_Scripting.html" title="Mesh Scripting/it">Mesh Scripting</a>, <a href="../it/Topological_data_scripting.html" title="Topological data scripting/it">Topological data scripting</a>, <a href="../it/Mesh_to_Part.html" title="Mesh to Part/it">Mesh to Part</a>, <a href="../it/PythonOCC.html" title="PythonOCC/it">PythonOCC</a></li></ul>
<hr>
<ul><li><b>Parametric objects:</b> <a href="../it/Scripted_objects.html" title="Scripted objects/it">Scripted objects</a>, <a href="../it/Viewprovider.html" title="Viewprovider/it">Viewproviders</a> <small>(<a href="../it/Custom_icon_in_tree_view.html" title="Custom icon in tree view/it">Custom icon in tree view</a>)</small></li>
<li><b>Scenegraph:</b> <a href="../it/Scenegraph.html" title="Scenegraph/it">Coin (Inventor) scenegraph</a>, <a href="../it/Pivy.html" title="Pivy/it">Pivy</a></li>
<li><b>Graphical interface:</b> <a href="../it/Interface_creation.html" title="Interface creation/it">Interface creation</a>, <a href="../it/Dialog_creation.html" title="Dialog creation/it">Interface creation completely in Python</a> <small>(<a href="../it/Dialog_creation_with_various_widgets.html" title="Dialog creation with various widgets/it">1</a>, <a href="../it/Dialog_creation_reading_and_writing_files.html" title="Dialog creation reading and writing files/it">2</a>, <a href="../it/Dialog_creation_setting_colors.html" title="Dialog creation setting colors/it">3</a>, <a href="../it/Dialog_creation_image_and_animated_GIF.html" title="Dialog creation image and animated GIF/it">4</a>, <a href="../it/PySide_usage_snippets.html" title="PySide usage snippets/it">5</a>)</small>, <a href="../it/PySide.html" title="PySide/it">PySide</a>, PySide examples <a href="../it/PySide_Beginner_Examples.html" title="PySide Beginner Examples/it">beginner</a>, <a href="../it/PySide_Intermediate_Examples.html" title="PySide Intermediate Examples/it">intermediate</a>, <a href="../it/PySide_Advanced_Examples.html" title="PySide Advanced Examples/it">advanced</a></li>
<li><b>Macros:</b> <a href="../it/Macros.html" title="Macros/it">Macros</a>, <a href="../it/How_to_install_macros.html" title="How to install macros/it">How to install macros</a></li>
<li><b>Embedding:</b> <a href="../it/Embedding_FreeCAD.html" title="Embedding FreeCAD/it">Embedding FreeCAD</a>, <a href="../it/Embedding_FreeCADGui.html" title="Embedding FreeCADGui/it">Embedding FreeCADGui</a></li></ul>
<hr>
<ul><li><b>Other:</b> <a href="../it/Expressions.html" title="Expressions/it">Expressions</a>, <a href="../it/Code_snippets.html" title="Code snippets/it">Code snippets</a>, <a class="mw-selflink selflink">Line drawing function</a>, <a href="../it/FreeCAD_vector_math_library.html" title="FreeCAD vector math library/it">FreeCAD vector math library</a> <small>(deprecated)</small></li></ul>
<hr>
<ul><li><b>Hubs:</b> <a href="../it/User_hub.html" title="User hub/it">User hub</a>, <a href="../it/Power_users_hub.html" title="Power users hub/it">Power users hub</a>, <a href="../it/Developer_hub.html" title="Developer hub/it">Developer hub</a></li></ul></div>
    </div></div>
<div style="clear:both"></div>
<!-- 
NewPP limit report
Cached time: 20251009171959
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.129 seconds
Real time usage: 0.206 seconds
Preprocessor visited node count: 580/1000000
Post&#8208;expand include size: 9669/2097152 bytes
Template argument size: 5269/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 24/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 21876/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   60.598      1 -total
 54.81%   33.211     24 Template:Code
  9.72%    5.891      1 Template:Powerdocnavi/it
  9.33%    5.654      7 Template:Incode
  7.91%    4.792      1 Template:TOCright
  4.46%    2.705      6 Template:Top
  4.43%    2.682      1 Template:Navigation_menu_2
  2.82%    1.709     10 Template:FileName
  1.94%    1.175      1 Template:Clear
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:2387-0!canonical and timestamp 20251009171959 and revision id 1659697. Rendering was triggered because: api-parse
 -->
</div>
</div><script src="../site.js"></script>