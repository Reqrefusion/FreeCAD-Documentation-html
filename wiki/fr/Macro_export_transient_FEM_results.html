<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro export transient FEM results/fr</span></h1><?xml encoding="UTF-8"><div class="mw-parser-output"><div class="mw-pt-languages noprint" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../Macro_export_transient_FEM_results.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro export transient FEM results (100% translated)" lang="en" dir="ltr">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" lang="fr" dir="ltr">fran&ccedil;ais</span></li>
<li><a href="../it/Macro_export_transient_FEM_results.html" class="mw-pt-progress mw-pt-progress--stub" title="Macro export transient FEM results/it (18% translated)" lang="it" dir="ltr">italiano</a></li>
<li><a href="../pl/Macro_export_transient_FEM_results.html" class="mw-pt-progress mw-pt-progress--stub" title="Makrodefinicja: Eksport przej&#347;ciowych wynik&oacute;w MES (5% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../index.php?title=Text-x-python.png&amp;filetimestamp=20121224162851&amp;.html" class="mw-file-description" title="Generic macro icon. Create your personal icon with the same name of the macro"><img alt="Generic macro icon. Create your personal icon with the same name of the macro" src="../File/Text-x-python.png" decoding="async" width="32" height="32"></a></span><span> </span>
export transient FEM results
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Exporte plusieurs r&eacute;sultats FEM &agrave; partir d'une analyse transitoire pour le post-traitement dans ParaView.<br><br>Macro version: 0.1<br>Last modified: 2019-08-30<br>FreeCAD version: All<br>Download: <a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing">Macro file (3 kB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing">Example file without results (200 kB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing">Example file with results (10 MB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing">All example files, including the vtk-export folder (21 MB)</a><br>Author: Luftschraube<br>
</td></tr>
<tr>
<th class="ctOdd">Author
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../index.php?title=User;Luftschraube&amp;action=edit&amp;redlink=1.html" class="new" title="User:Luftschraube (page does not exist)">Luftschraube</a>
</td></tr>
<tr>
<th class="ctOdd">Download
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing">Macro file (3 kB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing">Example file without results (200 kB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing">Example file with results (10 MB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing">All example files, including the vtk-export folder (21 MB)</a>
</td></tr>
<tr>
<th class="ctOdd">Links
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../Macros_recipes.html" title="Macros recipes">Macros recipes</a><br><a href="../How_to_install_macros.html" title="How to install macros">How to install macros</a><br><a href="../Customize_Toolbars.html" title="Customize Toolbars">How to customize toolbars</a>
</td></tr>
<tr>
<th class="ctOdd">Macro Version
</th></tr>
<tr>
<td class="ctEven macro-version">0.1
</td></tr>
<tr>
<th class="ctOdd">Date last modified
</th></tr>
<tr>
<td class="ctEven macro-date">2019-08-30
</td></tr>
<tr>
<th class="ctOdd">FreeCAD Version(s)
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">All
</td></tr>
<tr>
<th class="ctOdd">Default shortcut
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">See also
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p>Cette macro exporte plusieurs objets de r&eacute;sultats FEM d'une analyse transitoire au format VTK et g&eacute;n&egrave;re un fichier PVU qui peut &ecirc;tre utilis&eacute; pour charger les r&eacute;sultats directement dans ParaView pour le post-traitement.
</p><p><span id="Background"></span>
</p>
<h2><span class="mw-headline" id="Contexte">Contexte</span></h2>
<p>Une analyse transitoire dans FreeCAD se termine par un tas d'objets r&eacute;sultats FEM, un pour chaque horodatage. Les r&eacute;sultats individuels peuvent &ecirc;tre analys&eacute;s directement dans FreeCAD et &ecirc;tre post-trait&eacute;s en utilisant <a href="../fr/FEM_PostPipelineFromResult.html" title="FEM PostPipelineFromResult/fr">pipelines</a>. Cependant, les possibilit&eacute;s dans FreeCAD sont encore limit&eacute;es, en particulier pour les analyses transitoires. Un meilleur outil pour le post-traitement et la visualisation est ParaView. Vous pouvez exporter des objets individuels de r&eacute;sultats FEM depuis FreeCAD sous forme de fichier .vtk ou .vtu, qui peuvent ensuite &ecirc;tre ouverts avec ParaView. Malheureusement, le Workbench FEM ne supporte pas (encore) l'exportation de plusieurs fichiers .vtk en m&ecirc;me temps. C'est l&agrave; que cette macro entre en jeu.
</p><p><span id="How_to_use_(experienced_users)"></span>
</p>
<h2><span id="Utilisation_.28pour_utilisateurs_exp.C3.A9riment.C3.A9s.29"></span><span class="mw-headline" id="Utilisation_(pour_utilisateurs_exp&eacute;riment&eacute;s)">Utilisation (pour utilisateurs exp&eacute;riment&eacute;s)</span></h2>
<p>Ex&eacute;cutez la macro sur un projet FreeCAD qui inclut plusieurs objets de r&eacute;sultat FEM &agrave; partir d'une analyse transitoire. Outre le fichier .FCStd, un nouveau dossier 'vtk-export' sera cr&eacute;&eacute;, contenant les r&eacute;sultats individuels (fichiers .vtu) et un fichier .pvu pouvant &ecirc;tre ouvert &agrave; partir de ParaView.
</p><p><span id="How_to_use_(step-by-step_with_example)"></span>
</p>
<h2><span id="Utilisation_.28pas-.C3.A0-pas_avec_exemple.29"></span><span class="mw-headline" id="Utilisation_(pas-&agrave;-pas_avec_exemple)">Utilisation (pas-&agrave;-pas avec exemple)</span></h2>
<p>A titre d'exemple, le pliage d'une bande bim&eacute;tal aluminium/acier est utilis&eacute;. Un pas &agrave; pas pour cr&eacute;er l'exemple de fichier est fourni <a href="../fr/Transient_FEM_analysis.html" title="Transient FEM analysis/fr">ici</a>, ou vous pouvez t&eacute;l&eacute;charger le fichier &agrave; partir de la <a href="#T%C3%A9l%C3%A9chargements">section t&eacute;l&eacute;chargements</a> de cette page. Enregistrez le fichier FCMacro dans le dossier de macros FreeCAD, qui peut &ecirc;tre trouv&eacute; via Edition &rarr; Pr&eacute;f&eacute;rences &rarr; Python &rarr; Macro.
</p><p>Avec l'exemple de fichier ouvert, nous allons dans Macro &rarr; Macros ..., s&eacute;lectionnez "ExportTransientResults_190830.FCMacro" (ou le nom sous lequel vous l'avez enregistr&eacute;) et ex&eacute;cutons la. La macro va maintenant cr&eacute;er un sous-dossier 'vtk-export' en plus du fichier .FCStd. Selon le nombre et la taille des objets de r&eacute;sultat, cela peut prendre un certain temps. Dans la vue Rapport (Vue &rarr; Vue Rapport), nous devrions voir 'Macro finished' si tout s'est bien pass&eacute; - ou quelques messages d'erreur. (Remarque: Parfois, des messages comme 'PropertyFloatList NOT exported to vtk' apparaissent mais j'ai quand m&ecirc;me pu travailler avec les fichiers VTK ...) Dans le sous-dossier 'vtk-export', nous trouverons des fichiers .vtu, un pour chaque r&eacute;sultat d&eacute;fini pour chaque horodatage. De plus, un fichier .pvd est cr&eacute;&eacute;, qui indique &agrave; ParaView quel jeu de r&eacute;sultats appartient &agrave; quel horodatage. 
</p><p>Maintenant, nous ouvrons ParaView et allons dans Fichier &rarr; Ouvrir ... et ouvrons le fichier .pvd. Dans l'onglet 'Properties', nous cliquons sur 'Apply' pour charger les r&eacute;sultats. Dans l'onglet 'Information', nous verrons une liste <i>Index</i> et <i>Value</i>, correspondant aux horodatages des r&eacute;sultats que nous venons d'importer. (Bien s&ucirc;r, il est toujours judicieux de v&eacute;rifier si les heures indiqu&eacute;es ici sont correctes ou si quelque chose d'&eacute;trange s'est produit pendant l'exportation.) &Agrave; partir de l&agrave;, nous pouvons utiliser ParaView pour jouer avec les r&eacute;sultats. &Eacute;tant donn&eacute; que ParaView offre de nombreuses possibilit&eacute;s, veuillez vous r&eacute;f&eacute;rer aux documentations appropri&eacute;es sur Internet. 
</p><p>&Agrave; des fins de d&eacute;monstration, visualisons maintenant la temp&eacute;rature de la bande bim&eacute;tallique pli&eacute;e: dans l'onglet 'properties' &agrave; gauche, sous 'coloring', nous s&eacute;lectionnons la temp&eacute;rature, et l'image est mapp&eacute;e en fonction de la temp&eacute;rature locale. Via la petite ic&ocirc;ne avec un coeur, nous s&eacute;lectionnons l'&eacute;chelle de couleur 'cool to warm'. Avec les ic&ocirc;nes de type enregistreur sur le dessus, nous pouvons parcourir tous les r&eacute;sultats individuels qui ont &eacute;t&eacute; cr&eacute;&eacute;s pendant l'analyse. Le bouton 'play' affichera les images individuelles dans leur s&eacute;quence. Cependant, les r&eacute;sultats individuels ne sont pas s&eacute;par&eacute;s par un intervalle de temps constant, de sorte que l'animation n'est pas proportionnelle dans le temps. 
</p><p>Ce dont nous avons besoin, c'est d'une interpolation des r&eacute;sultats entre les pas de temps, qui est disponible via Filters &rarr; Temporal &rarr; Temporal Interpolator. Ici, nous choisissons &agrave; nouveau la temp&eacute;rature de coloration. Dans 'animation view' (View &rarr; Animation View), nous pouvons maintenant passer du mode &laquo;s&eacute;quence&raquo; au mode &laquo;temps r&eacute;el&raquo;. Nous pouvons &eacute;galement d&eacute;finir l'heure de d&eacute;but (la valeur par d&eacute;faut est 0,01 s), l'heure de fin et la dur&eacute;e. Alors que les heures de d&eacute;but et de fin se r&eacute;f&egrave;rent au temps de simulation, la dur&eacute;e est le temps r&eacute;el r&eacute;el que l'animation prend pour jouer compl&egrave;tement. Avec une dur&eacute;e de 10 s, notre temps de simulation de 60 s sera compress&eacute; en 10 s en temps r&eacute;el.
</p><p>Nous allons plus loin et souhaitons visualiser le pliage r&eacute;el de la bande. Avec l'interpolateur temporel s&eacute;lectionn&eacute;, nous ajoutons Filters &rarr; Common &rarr; Warp by Vector. Sous 'vectors', nous choisissons 'DisplacementVectors' et d&eacute;finissons le 'scale factor' &agrave; 10. Lorsque nous jouons l'animation maintenant, nous pouvons r&eacute;ellement voir la flexion de la bande mapp&eacute;e en couleur (exag&eacute;r&eacute;e par un facteur 10).
</p><p><span typeof="mw:File"><a href="../index.php?title=Transient_FEM_Bimetal_ParaView_(1).JPG&amp;filetimestamp=20190830121504&amp;.html" class="mw-file-description"><img src="../File/Transient_FEM_Bimetal_ParaView_%281%29.JPG" decoding="async" width="700" height="543"></a></span>
</p>
<div style="clear:both"></div>
<p>Le post-traitement que nous venons de faire peut &ecirc;tre enregistr&eacute; comme un 'state' dans ParaView, qui peut &ecirc;tre ouvert &agrave; tout moment et m&ecirc;me appliqu&eacute; &agrave; un ensemble de r&eacute;sultats diff&eacute;rent.
</p><p><span id="Downloads"></span>
</p>
<h2><span id="T.C3.A9l.C3.A9chargements"></span><span class="mw-headline" id="T&eacute;l&eacute;chargements">T&eacute;l&eacute;chargements</span></h2>
<ul><li><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing">Macro file (3 kB)</a></li>
<li><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing">Exemple de fichier sans r&eacute;sultats (200 kB)</a></li>
<li><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing">Exemple de fichier avec r&eacute;sultats (10 MB)</a></li>
<li><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing">Tous les fichiers d'exemple y compris le dossier vtk-export (21 MB)</a></li></ul>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<p>The ToolBar Icon 
</p><p><b>Macro_export_transient_FEM_results.FCMacro</b>
</p>
<pre>#!/usr/bin/python
# -*- coding: utf-8 -*-

#
# Macro to export multiple FEM results objects from a transient analysis for
# post-processing in ParaView.
#
# Created by &lt;Luftschraube&gt; under the GNU Lesser General Public License (LGPL)
#
# Version 0.1 (30.08.2019)
#

import FreeCAD
import Fem
import feminout.importVTKResults
import os
from sys import exit

FreeCAD.Console.PrintMessage("&gt;&gt;&gt;---------Macro started\n")

#Get the file path and name of the active document 
p = FreeCAD.ActiveDocument.FileName
FilePath = "/".join(p.split("/")[:-1])
FileName = p.split("/")[-1].split(".")[0]
FreeCAD.Console.PrintMessage("File path:" + FilePath + "\n")
FreeCAD.Console.PrintMessage("File name:" + FileName + "\n")
FreeCAD.Console.PrintMessage("\n&lt;&lt;&lt;----------Macro finished with errors\n")

#Get FEM result objects into a list
FreeCAD.Console.PrintMessage("Looking for result objects...")
FEMResultObjects = []

for obj in App.ActiveDocument.Objects:
	if obj.TypeId == "Fem::FemResultObjectPython":	
		FEMResultObjects.append(obj.Label)
		#FreeCAD.Console.PrintMessage(obj.Label + '\n')

NumberOfResultObjects = len(FEMResultObjects)
FreeCAD.Console.PrintMessage(str(NumberOfResultObjects) + " found\n")

if NumberOfResultObjects &gt; 0:
	
	#Export result objects as .vtu file and generate .pvu file
	ExportFolderName = "vtk-export"
	ExportOutputPath = FilePath + "/" + ExportFolderName
	if not os.path.exists(ExportOutputPath):
		os.makedirs(ExportOutputPath)
		FreeCAD.Console.PrintMessage(ExportOutputPath + " has been created\n")
	else:
		FreeCAD.Console.PrintMessage(ExportOutputPath + " already exists\n")
	
	PVUFile = open(ExportOutputPath + "/" + FileName + ".pvd","w")
	PVUFile.write("&lt;VTKFile type=\"Collection\" version=\"1.0\" byte_order=\"LittleEndian\" header_type=\"UInt64\"&gt;\n\t&lt;Collection&gt;\n")
	
	n = 0
	for ExportObject in sorted(FEMResultObjects):
		n = n + 1
		
		#Read and format time stamp (e.g., 12.37 s = 0001237)
		FreeCADResultLabelParts = ExportObject.split("_")
		PreDecimal = FreeCADResultLabelParts[-3]
		PostDecimal = FreeCADResultLabelParts[-2]

		if len(PostDecimal) == 1:
			PostDecimal = PostDecimal + str(0)
		TimeValue = float(PreDecimal) + float(PostDecimal)/100
		TimeString = str(int(round(TimeValue*100,0))).zfill(7)
	
		#For some reason, the VTK exporter expects a list (although only one object is processed at once...) - so build a list with the current object
		ExportObjectList = []
		ExportObjectList.append(FreeCAD.ActiveDocument.getObject(ExportObject))
		FileNameOUT = FileName + "_" + TimeString + ".vtu"
		FilePath = ExportOutputPath + "/" + FileNameOUT
		FreeCAD.Console.PrintMessage(FilePath + " is to be created\n")
		feminout.importVTKResults.export(ExportObjectList,FilePath)
	
		PVUFile.write("\t\t&lt;DataSet timestep=\"" + str(TimeValue) + "\" file=\"" + FileNameOUT + "\"/&gt;\n")
	
	#Close the .pvu file
	PVUFile.write("\t&lt;/Collection&gt;\n&lt;/VTKFile&gt;")
	PVUFile.close()
else:
	FreeCAD.Console.PrintMessage("Nothing to export!")

FreeCAD.Console.PrintMessage('\n&lt;&lt;&lt;----------Macro finished\n')</pre>
<p><br>
<span id="Link"></span>
</p>
<h2><span class="mw-headline" id="Liens">Liens</span></h2>
<div class="mw-translate-fuzzy">
<p>Exemple <a rel="nofollow" class="external text" href="https://www.freecadweb.org/wiki/Transient_FEM_analysis/fr">Analyse FEM transitoire</a>.
</p>
</div>
<div class="mw-translate-fuzzy">
<p>Discussion sur le forum <a rel="nofollow" class="external text" href="https://forum.freecadweb.org/viewtopic.php?f=22&amp;t=37650">Export transient FEM results to vtk/vtu for ParaView</a>
</p>
</div>
<!-- 
NewPP limit report
Cached time: 20250705180421
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc, no&#8208;toc&#8208;conversion]
CPU time usage: 0.036 seconds
Real time usage: 0.051 seconds
Preprocessor visited node count: 118/1000000
Post&#8208;expand include size: 3784/2097152 bytes
Template argument size: 4824/2097152 bytes
Highest expansion depth: 7/100
Expensive parser function count: 2/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 4018/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    7.899      1 -total
 66.76%    5.273      1 Template:Macro
 16.10%    1.272      1 Template:MacroCode
 14.70%    1.161      1 Template:Clear
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:175449-0!canonical and timestamp 20250705180421 and revision id 1604340. Rendering was triggered because: edit-page
 -->
</div>
</div><script src="../site.js"></script>