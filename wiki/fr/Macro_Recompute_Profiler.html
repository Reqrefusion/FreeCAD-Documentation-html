<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro Recompute Profiler/fr</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="fr" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Macro+Recompute+Profiler&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><a href="../Macro_Recompute_Profiler.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro Recompute Profiler (100% translated)" lang="en" dir="ltr">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" lang="fr" dir="ltr">fran&ccedil;ais</span></li>
<li><a href="../it/Macro_Recompute_Profiler.html" class="mw-pt-progress mw-pt-progress--high" title="Macro Recompute Profiler (95% translated)" lang="it" dir="ltr">italiano</a></li>
<li><a href="../pl/Macro_Recompute_Profiler.html" class="mw-pt-progress mw-pt-progress--low" title="Makrodefinicja: Recompute Profiler (5% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../index.php?title=Macro_Recompute_Profiler.png&amp;filetimestamp=20190712160159&amp;.html" class="mw-file-description"><img src="../File/Macro_Recompute_Profiler.png" decoding="async" width="32" height="32" class="mw-file-element"></a></span><span> </span>
Macro Recompute Profiler
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Cette macro a pour but de vous aider &agrave; trouver les fonctions qui causent de longs retards dans les mises &agrave; jour du projet. Elle effectue un recalcul, en mesurant le temps qu'il faut pour recalculer chaque fonction.<br><br>Version macro&nbsp;: 0.1<br>Date derni&egrave;re modification&nbsp;: 2017-04-03<br>Version FreeCAD&nbsp;: 0.17.10644 et plus<br>T&eacute;l&eacute;chargement&nbsp;: <a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/c/ca/Macro_Recompute_Profiler.png">Ic&ocirc;ne de la barre d'outils</a><br>Auteur: DeepSOIC<br>
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../User;DeepSOIC.html" title="User:DeepSOIC">DeepSOIC</a>
</td></tr>
<tr>
<th class="ctOdd">T&eacute;l&eacute;chargement
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/c/ca/Macro_Recompute_Profiler.png">Ic&ocirc;ne de la barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../fr/Macros_recipes.html" title="Macros recipes/fr">Page des macros</a><br><a href="../fr/How_to_install_macros.html" title="How to install macros/fr">Comment installer une macro</a><br><a href="../fr/Customize_Toolbars.html" title="Customize Toolbars/fr">Comment cr&eacute;er une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version Macro
</th></tr>
<tr>
<td class="ctEven macro-version">0.1
</td></tr>
<tr>
<th class="ctOdd">Derni&egrave;re modification
</th></tr>
<tr>
<td class="ctEven macro-date">2017-04-03
</td></tr>
<tr>
<th class="ctOdd">Version(s) FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">0.17.10644 et plus
</td></tr>
<tr>
<th class="ctOdd">Raccourci clavier
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p>Cette macro a pour but de vous aider &agrave; trouver les caract&eacute;ristiques qui causent de longs retards dans les mises &agrave; jour du projet. Elle effectue un recalcul, en mesurant le temps qu'il faut pour recalculer chaque fonction.
</p><p><span id="Usage"></span>
</p>
<h2><span class="mw-headline" id="Utilisation">Utilisation</span></h2>
<p>Cette macro requiers FreeCAD 0.17.10644 ou plus
</p><p>Sauvegardez la macro dans un fichier.
</p><p>1. Ouvrez votre projet
</p><p>2. Faites clic droit sur votre objet dans la vue 3D, et cliquez sur "Mark to recompute"
</p><p>3. Lancez cette macro
</p><p>Une barre de progression apparait. Votre objet est recalcul&eacute;, une ligne est affich&eacute;e dans la vue rapport contenant le temps et le label de l'objet. Si le recalcul de l'objet n'est pas possible, la macro affiche une erreur et termine le processus.
</p>
<h2><span class="mw-headline" id="Macro">Macro</span></h2>
<p>Ic&ocirc;ne de la barre d'outils
<span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=Macro_Recompute_Profiler.png&amp;filetimestamp=20190712160159&amp;.html" class="mw-file-description"><img src="../File/Macro_Recompute_Profiler.png" decoding="async" width="64" height="64" class="mw-file-element"></a></span>
</p><p><b>RecomputeProfiler.FCMacro</b>
</p>
<pre>__Title__="Macro Recompute Profiler"
__Author__ = "DeepSOIC"
__Version__ = "0.1"
__Date__    = "03.04.2017"

__Comment__ = "Measures time it takes to recmpute features in a project"
__Wiki__ = "https://wiki.freecad.org/index.php?title=Macro_Recompute_Profiler"
__Help__ = "Right-click an object, and pick 'Mark to recompute', then run this macro. This will only profile recomputing the subgraph. To profile the whole project, right-click the project in tree view, and pick 'Mark to recompute', then run this macro. Results will be printed to report view."
__Status__ = "experimental"
__Requires__ = "freecad 0.17.10644"
__Communication__ = "https://forum.freecad.org/memberlist.php?mode=viewprofile&amp;u=3888" 

import FreeCAD as App

import FreeCADGui as Gui

class ExecutionError(Exception):
    pass

class CancelError(Exception):
    pass

def execute(feature):
    feature.recompute()
    if 'Invalid' in feature.State:
        raise ExecutionError("Feature '{label}' failed to recompute".format(label= feature.Label))

def msgbox(title, text):
    from PySide import QtGui
    mb = QtGui.QMessageBox()
    mb.setIcon(mb.Icon.Information)
    mb.setText(text)
    mb.setWindowTitle(title)
    mb.exec_()

def log(string):
    App.Console.PrintWarning(string+"\n")

def getAllDependent(feat_list):
    '''getAllDependent(feat_list): gets all features that depend on features in feat_list, directly or indirectly.
    Returns a set. Features from feat_list are not included, unless there are interdependencies between them.'''

    list_traversing_now = feat_list
    set_of_deps = set()
    list_of_deps = []

    while len(list_traversing_now) &gt; 0:
        list_to_be_traversed_next = []
        for feat in list_traversing_now:
            for dep in feat.InList:
                if not (dep in set_of_deps):
                    set_of_deps.add(dep)
                    list_of_deps.append(dep)
                    list_to_be_traversed_next.append(dep)

        list_traversing_now = list_to_be_traversed_next

    return set_of_deps


def run():
    touched = [obj for obj in App.ActiveDocument.Objects if 'Touched' in obj.State]

    if len(touched) == 0:
        App.ActiveDocument.RecomputesFrozen = True
        msgbox("Macro Recompute Profiler", "Project was switched to suspend recomputes. Please modify an object that triggers a recompute, and run this macro again. The macro will perform a step-by-step recompute, and measure the time it takes to recompute features.")
        return

    log("{n} features are touched".format(n= len(touched)))

    log("Generating execution order...")

    to_be_executed = set.union(getAllDependent(touched), set(touched))
    log("Number of features to execute: {n}".format(n= len(to_be_executed)))

    exec_list = []
    for obj in App.ActiveDocument.TopologicalSortedObjects[::-1]:
        if obj in to_be_executed:
            exec_list.append(obj)
    assert(len(exec_list) == len(to_be_executed))
    n = len(exec_list)

    log("Execution order:")
    for obj in exec_list:
        log("    "+obj.Label)


    import PySide
    progress = PySide.QtGui.QProgressDialog(u"Preparing to recompute....", u"Abort", 0, n+1)
    progress.setModal(True)
    progress.show()
    
    try:
        log("Recomputing... (time in seconds, label)")
        import time
        for obj in exec_list:
            progress.setValue(progress.value()+1)
            progress.setLabelText("Recomputing {feature}...".format(feature= obj.Label))
            if progress.wasCanceled():
                raise CancelError()

            time_start = time.time()
            try:
                execute(obj)
            finally:
                exec_time = time.time()-time_start
                log("\t{time}\t{label}".format(time= exec_time, label= obj.Label))

        progress.setValue(n+1)
        msgbox("Macro Recompute Profiler", "Recompute completed. Results are in report view.")

        for obj in exec_list:
            obj.purgeTouched()

    except Exception as err:
        msgbox("Macro Recompute Profiler", "An error occured: {err}".format(err= str(err)))
    finally:
        progress.hide()
        App.ActiveDocument.RecomputesFrozen = False

run()</pre>
<p><span id="Post-processing_results"></span>
</p>
<h2><span id="R.C3.A9sultats_du_post-traitement"></span><span class="mw-headline" id="R&eacute;sultats_du_post-traitement">R&eacute;sultats du post-traitement</span></h2>
<p>Le r&eacute;sultat de la macro sera entrecoup&eacute;e de messages g&eacute;n&eacute;raux produits par le recalcul des fonctions. Cela ressemble g&eacute;n&eacute;ralement &agrave; ceci&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">Recomputing</span><span class="o">...</span> <span class="p">(</span><span class="n">time</span> <span class="ow">in</span> <span class="n">seconds</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
<span class="n">Sketcher</span><span class="p">::</span><span class="n">setUpSketch</span><span class="p">()</span><span class="o">-</span><span class="n">T</span><span class="p">:</span><span class="mi">0</span>
<span class="n">Sketcher</span><span class="p">::</span><span class="n">Solve</span><span class="p">()</span><span class="o">-</span><span class="n">DogLeg</span><span class="o">-</span><span class="n">T</span><span class="p">:</span><span class="mi">0</span>
	<span class="mf">0.00999999046326</span>	<span class="n">Sketch</span> <span class="o">-</span> <span class="n">master</span> <span class="n">section</span>
	<span class="mf">0.0199999809265</span>	<span class="n">Clone</span> <span class="n">of</span> <span class="n">Sketch</span> <span class="o">-</span> <span class="n">master</span> <span class="n">section</span> <span class="p">(</span><span class="mi">2</span><span class="n">D</span><span class="p">)</span><span class="mi">001</span>
<span class="n">Sketcher</span><span class="p">::</span><span class="n">setUpSketch</span><span class="p">()</span><span class="o">-</span><span class="n">T</span><span class="p">:</span><span class="mi">0</span>
<span class="n">Sketcher</span><span class="p">::</span><span class="n">Solve</span><span class="p">()</span><span class="o">-</span><span class="n">DogLeg</span><span class="o">-</span><span class="n">T</span><span class="p">:</span><span class="mi">0</span>
	<span class="mf">0.00999999046326</span>	<span class="n">Sketch013</span>
<span class="n">Sketcher</span><span class="p">::</span><span class="n">setUpSketch</span><span class="p">()</span><span class="o">-</span><span class="n">T</span><span class="p">:</span><span class="mi">0</span>
<span class="n">Sketcher</span><span class="p">::</span><span class="n">Solve</span><span class="p">()</span><span class="o">-</span><span class="n">DogLeg</span><span class="o">-</span><span class="n">T</span><span class="p">:</span><span class="mi">0</span>
	<span class="mf">0.00999999046326</span>	<span class="n">Sketch011</span>
	<span class="mf">0.0</span>	<span class="n">Clone</span> <span class="n">of</span> <span class="n">Sketch</span> <span class="o">-</span> <span class="n">master</span> <span class="n">section</span> <span class="p">(</span><span class="mi">2</span><span class="n">D</span><span class="p">)</span>
<span class="n">Sketcher</span><span class="p">::</span><span class="n">setUpSketch</span><span class="p">()</span><span class="o">-</span><span class="n">T</span><span class="p">:</span><span class="mi">0</span>
<span class="n">Sketcher</span><span class="p">::</span><span class="n">Solve</span><span class="p">()</span><span class="o">-</span><span class="n">DogLeg</span><span class="o">-</span><span class="n">T</span><span class="p">:</span><span class="mi">0</span>
	<span class="mf">0.0</span>	<span class="n">Sketch008</span>
	<span class="mf">0.130000114441</span>	<span class="n">LinearArray</span>
<span class="n">Sketcher</span><span class="p">::</span><span class="n">setUpSketch</span><span class="p">()</span><span class="o">-</span><span class="n">T</span><span class="p">:</span><span class="mi">0</span>
<span class="n">Sketcher</span><span class="p">::</span><span class="n">Solve</span><span class="p">()</span><span class="o">-</span><span class="n">DogLeg</span><span class="o">-</span><span class="n">T</span><span class="p">:</span><span class="mi">0</span>
<span class="o">...</span>
</pre></div>
<p>Le r&eacute;sultat des lignes ont une signature facilement s&eacute;parable: elles commencent par un onglet. Donc, si vous copiez-copiez l'int&eacute;gralit&eacute; du bloc dans un tableur, les messages g&eacute;n&eacute;riques se retrouveront dans la colonne 1, tandis que les r&eacute;sultats se trouvent dans les colonnes 2 et 3. Vous pouvez donc trier selon la colonne 2 pour obtenir une belle table&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="mf">0.59100008</span>	<span class="n">Slice</span>
<span class="mf">0.352999926</span>	<span class="n">Populate</span> <span class="n">LinearArray</span> <span class="k">with</span> <span class="n">Compound</span>
<span class="mf">0.160000086</span>	<span class="n">CompoundFilter</span>
<span class="mf">0.138999939</span>	<span class="n">Cut</span>
<span class="mf">0.130000114</span>	<span class="n">LinearArray</span>
<span class="mf">0.108999968</span>	<span class="n">Fusion</span>
<span class="mf">0.069999933</span>	<span class="n">Moved</span> <span class="n">CompoundFilter</span>
<span class="mf">0.067000151</span>	<span class="n">Module</span> <span class="o">-</span> <span class="n">spokes</span>
<span class="mf">0.029999971</span>	<span class="n">Sweep</span>
<span class="mf">0.019999981</span>	<span class="n">Clone</span> <span class="n">of</span> <span class="n">Sketch</span> <span class="o">-</span> <span class="n">master</span> <span class="n">section</span> <span class="p">(</span><span class="mi">2</span><span class="n">D</span><span class="p">)</span><span class="mi">001</span>
<span class="mf">0.010999918</span>	<span class="n">ArrayFilter003</span>
<span class="o">...</span>
</pre></div>
<p>(Pour MS-Excel, coller juste apr&egrave;s avoir copi&eacute; le texte de la vue du rapport ne le divise pas en colonnes, je ne sais pas pourquoi... coller le texte dans Notepad et le recopier de Notepad et le coller dans Excel aide).
</p><p><span id="FreeCAD_version"></span>
</p>
<h2><span class="mw-headline" id="Version_de_FreeCAD">Version de FreeCAD</span></h2>
<p>Cette macro n&eacute;cessite FreeCAD 0.17.10644 ou plus, qui sont les versions o&ugrave; App.ActiveDocument.RecomputesFrozen est devenu disponible. Elle peut &ecirc;tre fonctionnelle avec un FreeCAD un peu plus ancien, mais ne fonctionnera certainement pas avec la version 0.16.
</p><p>Cette macro a &eacute;t&eacute; cr&eacute;&eacute;e avec cette version de FreeCAD&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">OS</span><span class="p">:</span> <span class="n">Windows</span> <span class="mi">10</span>
<span class="n">Word</span> <span class="n">size</span> <span class="n">of</span> <span class="n">OS</span><span class="p">:</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
<span class="n">Word</span> <span class="n">size</span> <span class="n">of</span> <span class="n">FreeCAD</span><span class="p">:</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
<span class="n">Version</span><span class="p">:</span> <span class="mf">0.17.10665</span> <span class="p">(</span><span class="n">Git</span><span class="p">)</span>
<span class="n">Build</span> <span class="nb">type</span><span class="p">:</span> <span class="n">Release</span>
<span class="n">Branch</span><span class="p">:</span> <span class="n">master</span>
<span class="n">Hash</span><span class="p">:</span> <span class="mi">47847513</span><span class="n">a85ff6615774ef628230f79e37471daf</span>
<span class="n">Python</span> <span class="n">version</span><span class="p">:</span> <span class="mf">2.7.8</span>
<span class="n">Qt</span> <span class="n">version</span><span class="p">:</span> <span class="mf">4.8.7</span>
<span class="n">Coin</span> <span class="n">version</span><span class="p">:</span> <span class="mf">4.0.0</span><span class="n">a</span>
<span class="n">OCC</span> <span class="n">version</span><span class="p">:</span> <span class="mf">7.0.0</span>
</pre></div>
<!-- 
NewPP limit report
Cached time: 20250713083739
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.029 seconds
Real time usage: 0.037 seconds
Preprocessor visited node count: 137/1000000
Post&#8208;expand include size: 2677/2097152 bytes
Template argument size: 6058/2097152 bytes
Highest expansion depth: 7/100
Expensive parser function count: 5/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 12186/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    6.267      1 -total
 38.22%    2.395      1 Template:Macro/fr
 29.60%    1.855      3 Template:Code
 28.38%    1.779      1 Template:MacroCode
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:79665-0!canonical and timestamp 20250713083739 and revision id 1611495. Rendering was triggered because: edit-page
 -->
</div>
</div><script src="../site.js"></script>