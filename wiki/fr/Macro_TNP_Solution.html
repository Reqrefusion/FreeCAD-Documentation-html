<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro TNP Solution/fr</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="fr" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Macro+TNP+Solution&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><a href="../de/Macro_TNP_Solution.html" class="mw-pt-progress mw-pt-progress--complete" title="Makro TNP-L&ouml;sung (100% translated)" lang="de" dir="ltr">Deutsch</a></li>
<li><a href="../Macro_TNP_Solution.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro TNP Solution (100% translated)" lang="en" dir="ltr">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" lang="fr" dir="ltr">fran&ccedil;ais</span></li>
<li><a href="../pl/Macro_TNP_Solution.html" class="mw-pt-progress mw-pt-progress--low" title="Makrodefinicja: Rozwi&#261;zanie TNP (4% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../index.php?title=TNP_solution.png&amp;filetimestamp=20220816091251&amp;.html" class="mw-file-description"><img src="../File/TNP_solution.png" decoding="async" width="32" height="26" class="mw-file-element" data-file-width="500" data-file-height="406"></a></span><span> </span>
Macro TNP solution
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Il s'agit d'une solution pour le probl&egrave;me de d&eacute;nomination topologique<br><br>Version macro&nbsp;: 1.0<br>Date derni&egrave;re modification&nbsp;: 2022-08-16<br>T&eacute;l&eacute;chargement&nbsp;: <a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/e/e4/TNP_solution.png">Ic&ocirc;ne de la barre d'outils</a><br>Auteur: Dprojects<br>
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../User;Dprojects.html" title="User:Dprojects">Dprojects</a>
</td></tr>
<tr>
<th class="ctOdd">T&eacute;l&eacute;chargement
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/e/e4/TNP_solution.png">Ic&ocirc;ne de la barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../fr/Macros_recipes.html" title="Macros recipes/fr">Page des macros</a><br><a href="../fr/How_to_install_macros.html" title="How to install macros/fr">Comment installer une macro</a><br><a href="../fr/Customize_Toolbars.html" title="Customize Toolbars/fr">Comment cr&eacute;er une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version Macro
</th></tr>
<tr>
<td class="ctEven macro-version">1.0
</td></tr>
<tr>
<th class="ctOdd">Derni&egrave;re modification
</th></tr>
<tr>
<td class="ctEven macro-date">2022-08-16
</td></tr>
<tr>
<th class="ctOdd">Version(s) FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Raccourci clavier
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=TNP_solution.gif&amp;filetimestamp=20220816091158&amp;.html" class="mw-file-description"><img src="../File/TNP_solution.gif" decoding="async" width="1362" height="694" class="mw-file-element" data-file-width="1362" data-file-height="694"></a></span>
</p><p>Il s'agit d'une solution au probl&egrave;me de nommage topologique, d&eacute;crite de mani&egrave;re exemplaire &agrave; la page&nbsp;: <a href="../fr/Topological_naming_problem.html" title="Topological naming problem/fr">Probl&egrave;me de d&eacute;nomination topologique</a>.
</p><p>Si vous construisez un objet sur un autre objet, ainsi qu'une esquisse, il est simple &agrave; r&eacute;soudre, car vous savez deux choses&nbsp;:
</p>
<ol><li>Les points de l'esquisse font toujours partie de la face inf&eacute;rieure.</li>
<li>L'esquisse et la face inf&eacute;rieure sont dans le m&ecirc;me plan.</li></ol>
<p>Pour r&eacute;soudre le probl&egrave;me du probl&egrave;me de d&eacute;nomination topologique, vous pouvez&nbsp;:
</p><p><b>Sauvegardez la cl&eacute; avant toute op&eacute;ration&nbsp;:</b>
</p><p>Vous devez uniquement enregistrer la cl&eacute; avant toute op&eacute;ration. Pour cet exemple d&eacute;crit &agrave; la page <a href="../fr/Topological_naming_problem.html" title="Topological naming problem/fr">Probl&egrave;me de d&eacute;nomination topologique</a>, l'objet se trouve sur le plan XY. J'utilise donc la valeur de l'axe Z &agrave; partir du centre du cadre de s&eacute;lection de l'esquisse&nbsp;:
</p>
<pre>ad = FreeCAD.ActiveDocument
p2 = ad.Pad002
s2 = p2.Profile[0]
key = round(s2.Shape.BoundBox.Center[2], precision)</pre>
<p><b>Ensuite, recherchez la cl&eacute; stock&eacute;e sur toutes les faces&nbsp;:</b>
</p><p>Apr&egrave;s le redimensionnement, je recherche la cl&eacute; stock&eacute;e sur toutes les faces. Parce que si l'esquisse et la face &eacute;taient sur le m&ecirc;me plan XY, la valeur de l'axe Z &eacute;tait la m&ecirc;me pour les deux. Dans l'<a href="../fr/PartDesign_Workbench.html" title="PartDesign Workbench/fr">atelier PartDesign</a>, vous ne pouvez pas d&eacute;placer le troisi&egrave;me bloc au-dessus du deuxi&egrave;me bloc, pour avoir un espace entre les deux, c'est un objet unique, le bloc suivant avec l'esquisse touchera toujours la face. Sur la nouvelle face, la valeur de l'axe Z sera toujours la m&ecirc;me que la cl&eacute; stock&eacute;e. Donc, il faut retourner l'index de la face. Il n'y a rien de plus &agrave; faire. 
</p>
<pre>def getFaceIndex(iObj, iBB):
	
	index = 0	

	for f in iObj.Shape.Faces:

		index += 1
		bb = round(f.BoundBox.Center[2], precision)
		if bb == iBB:
			return index

	return -1</pre>
<p><b>Derni&egrave;res &eacute;tapes</b>
</p><p>&Agrave; la fin, j'assigne la nouvelle face &agrave; l'esquisse et je recalcule. Pour &ecirc;tre honn&ecirc;te, la partie la plus difficile a &eacute;t&eacute; d'assigner la face &agrave; Sketch.Support, pour moi la syntaxe est &eacute;poustouflante&nbsp;;-)
</p><p><span id="Code_for_the_example"></span>
</p>
<h2><span id="Code_pour_l.27exemple"></span><span class="mw-headline" id="Code_pour_l'exemple">Code pour l'exemple</span></h2>
<p>Le fichier de test a &eacute;t&eacute; t&eacute;l&eacute;charg&eacute; sur le forum FreeCAD&nbsp;: <a rel="nofollow" class="external text" href="https://forum.freecad.org/download/file.php?id=198537">TNP.FCStd</a>. 
</p>
<pre>__Title__="TNP_solution"
__Author__ = "Dprojects"
__Version__ = "1.0"
__Date__    = "2022-08-16"
__Comment__ = ""
__Web__ = "https://github.com/dprojects/Woodworking"
__Wiki__ = "https://wiki.freecad.org/TNP_solution"
__Icon__  = "https://wiki.freecad.org/images/e/e4/TNP_solution.png"
__IconW__  = "https://wiki.freecad.org/images/e/e4/TNP_solution.png"
__Help__ = "solution for Topological Naming Problem"
__Status__ = "stable"
__Requires__ = ""
__Communication__ = "https://wiki.freecad.org/index.php?title=User:Dprojects"

# ####################################################################
#
# This is solution for Topological Naming Problem described at 
# https://wiki.freecad.org/Topological_naming_problem
#
# MIT License
# 
# Copyright (c) 2022 Darek L github.com/dprojects
# 
# Permission is hereby granted, free of charge, to any 
# person obtaining a copy of this software and associated 
# documentation files (the "Software"), to deal in the 
# Software without restriction, including without limitation 
# the rights to use, copy, modify, merge, publish, distribute, 
# sublicense, and/or sell copies of the Software, and to permit 
# persons to whom the Software is furnished to do so, subject 
# to the following conditions:
# 
# The above copyright notice and this permission notice shall 
# be included in all copies or substantial portions of the Software.
# 
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, 
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES 
# OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND 
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT 
# HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, 
# WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, 
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
# DEALINGS IN THE SOFTWARE.
# 
# ####################################################################

import FreeCAD

# this should be set according 
# FreeCAD user GUI precision settings
precision = 5

# global settings
ad = FreeCAD.ActiveDocument

# middle object to be resized
p1 = ad.Pad001
s1 = p1.Profile[0]

# top object bottom to store key
p2 = ad.Pad002
s2 = p2.Profile[0]

# ####################################################################
def getFaceIndex(iObj, iBB):
	
	index = 0	

	for f in iObj.Shape.Faces:

		index += 1
		bb = round(f.BoundBox.Center[2], precision)
		
		FreeCAD.Console.PrintMessage("\n")
		FreeCAD.Console.PrintMessage(index)
		FreeCAD.Console.PrintMessage(" ")
		FreeCAD.Console.PrintMessage(bb)

		if bb == iBB:
			FreeCAD.Console.PrintMessage(" &lt;=== found")
			return index

	return -1

# ####################################################################
def makeTNP():

	# set key
	key = round(s2.Shape.BoundBox.Center[2], precision)

	# resize and cause TNP
	s1.setDatum(9, FreeCAD.Units.Quantity('350'))

	# recompute
	s1.recompute()
	p1.recompute()
	ad.recompute()

	FreeCAD.Console.PrintMessage("\n\n")
	FreeCAD.Console.PrintMessage("Stored key:"+str(key))
	FreeCAD.Console.PrintMessage("\n")

	# search all faces for solution
	solutionIndex = getFaceIndex(p1, key)
	solution = "Face"+str(solutionIndex)
	
	FreeCAD.Console.PrintMessage("\n\n")
	FreeCAD.Console.PrintMessage("Solution: "+solution)
	
	# set exact face to Sketch
	s2.Support = (p1, (solution,))
	ad.recompute()

# ####################################################################
def moveBack():

	s1.setDatum(9, FreeCAD.Units.Quantity('250'))
	s2.Support = (p1, ('Face13',))
	ad.recompute()

# ####################################################################
# main
# ####################################################################

# uncomment what you want
makeTNP()
#moveBack()

# ####################################################################</pre>
<p><span id="THE_Solution"></span>
</p>
<h2><span class="mw-headline" id="LA_solution">LA solution</span></h2>
<p>Le code ci-dessus montre comment r&eacute;soudre l'exemple du probl&egrave;me de d&eacute;nomination topologique d&eacute;crit &agrave; la page&nbsp;: <a href="../fr/Topological_naming_problem.html" title="Topological naming problem/fr">Probl&egrave;me de d&eacute;nomination topologique</a> mais exactement les m&ecirc;mes r&egrave;gles que vous pouvez utiliser pour r&eacute;soudre d'autres probl&egrave;mes. L'approche est simple&nbsp;:
</p>
<ol><li>M&eacute;morisation de la cl&eacute; avant toute op&eacute;ration</li>
<li>Recherche de la cl&eacute; apr&egrave;s l'op&eacute;ration</li></ol>
<p>L'impl&eacute;mentation particuli&egrave;re peut &ecirc;tre diff&eacute;rente. Dans cet exemple, le plan est XY, mais vous pouvez faire exactement la m&ecirc;me chose pour d'autres axes. Vous pouvez &eacute;galement choisir d'autres cl&eacute;s. Dans le cadre du projet <a rel="nofollow" class="external text" href="https://github.com/dprojects/Woodworking">Woodworking</a>, j'effectue de nombreuses op&eacute;rations sur des objets inexistants, ce qui m'a oblig&eacute; &agrave; r&eacute;soudre le probl&egrave;me du nom topologique &agrave; plusieurs reprises. 
</p><p>Ici, je change les objets Cube en objets Epaisseur de PartDesign&nbsp;:
</p><p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=TNP_solution_1.gif&amp;filetimestamp=20220817105054&amp;.html" class="mw-file-description"><img src="../File/TNP_solution_1.gif" decoding="async" width="1362" height="694" class="mw-file-element" data-file-width="1362" data-file-height="694"></a></span>
</p><p>Dans l'exemple ci-dessous, je change les cubes en chanfreins de PartDesign, j'ai donc d&ucirc; stocker la cl&eacute; pour les ar&ecirc;tes&nbsp;: 
</p><p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=TNP_solution_2.gif&amp;filetimestamp=20220817105128&amp;.html" class="mw-file-description"><img src="../File/TNP_solution_2.gif" decoding="async" width="1362" height="694" class="mw-file-element" data-file-width="1362" data-file-height="694"></a></span>
</p><p>L'exemple ci-dessous est un peu plus compliqu&eacute; car comme vous le voyez &agrave; l'&eacute;cran, les r&eacute;f&eacute;rences &agrave; l'objet et &agrave; la face changent automatiquement. Mais aussi pour faire un trou j'appelle une fonction d&eacute;finie dans ma biblioth&egrave;que et non directement dans l'outil. Donc, j'ai d&ucirc; utiliser une petite astuce avec la s&eacute;lection et la d&eacute;s&eacute;lection, pour obtenir une nouvelle r&eacute;f&eacute;rence&nbsp;:
</p><p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=TNP_solution_3.gif&amp;filetimestamp=20220817105206&amp;.html" class="mw-file-description"><img src="../File/TNP_solution_3.gif" decoding="async" width="1362" height="694" class="mw-file-element" data-file-width="1362" data-file-height="694"></a></span>
</p><p><br>
Il existe de nombreux probl&egrave;mes de ce type lors de la programmation dans FreeCAD, mais ils peuvent tous &ecirc;tre r&eacute;solus de la m&ecirc;me mani&egrave;re. J'esp&egrave;re que cela vous aidera.
</p><p><br>
</p>
<div style="clear:both"></div>
<!-- 
NewPP limit report
Cached time: 20251114100044
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.062 seconds
Real time usage: 0.091 seconds
Preprocessor visited node count: 110/1000000
Post&#8208;expand include size: 2142/2097152 bytes
Template argument size: 4552/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 5168/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    7.063      1 -total
 40.69%    2.874      3 Template:MacroCode
 38.71%    2.734      1 Template:Macro/fr
 14.58%    1.030      1 Template:Clear
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:296770-0!canonical and timestamp 20251114100044 and revision id 1689752. Rendering was triggered because: api-parse
 -->
</div>
</div><script src="../site.js"></script>