<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro PCBWay/fr</span></h1><?xml encoding="UTF-8"><div class="mw-parser-output"><div class="mw-pt-languages noprint" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../Macro_PCBWay.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro PCBWay (100% translated)" lang="en" dir="ltr">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" lang="fr" dir="ltr">fran&ccedil;ais</span></li>
<li><a href="../pl/Macro_PCBWay.html" class="mw-pt-progress mw-pt-progress--stub" title="Makrodefinicja: PCBWay (11% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../File/Pcbway.png" class="mw-file-description"><img src="../File/Pcbway.png" decoding="async" width="32" height="32"></a></span><span> </span>
Macro PCBWay
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Envoie un objet s&eacute;lectionn&eacute; &agrave; PCBWay pour la fabrication par fraisage CNC, d&eacute;coupe laser ou impression 3D.<br><br>Version macro&nbsp;: 1.0<br>Date derni&egrave;re modification&nbsp;: 2022-07-22<br>Version FreeCAD&nbsp;: All<br>T&eacute;l&eacute;chargement&nbsp;: <a rel="nofollow" class="external text" href="https://wiki.freecadweb.org/images/7/7b/Pcbway.png">Ic&ocirc;ne de la barre d'outils</a><br>Auteur: Yorik van Havre<br>
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../index.php?title=User;Yorik_van_Havre&amp;action=edit&amp;redlink=1.html" class="new" title="User:Yorik van Havre (page does not exist)">Yorik van Havre</a>
</td></tr>
<tr>
<th class="ctOdd">T&eacute;l&eacute;chargement
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://wiki.freecadweb.org/images/7/7b/Pcbway.png">Ic&ocirc;ne de la barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../fr/Macros_recipes.html" title="Macros recipes/fr">Page des macros</a><br><a href="../fr/How_to_install_macros.html" title="How to install macros/fr">Comment installer une macro</a><br><a href="../fr/Customize_Toolbars.html" title="Customize Toolbars/fr">Comment cr&eacute;er une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version Macro
</th></tr>
<tr>
<td class="ctEven macro-version">1.0
</td></tr>
<tr>
<th class="ctOdd">Derni&egrave;re modification
</th></tr>
<tr>
<td class="ctEven macro-date">2022-07-22
</td></tr>
<tr>
<th class="ctOdd">Version(s) FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">All
</td></tr>
<tr>
<th class="ctOdd">Raccourci clavier
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Description"><span class="tocnumber">1</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Utilisation"><span class="tocnumber">2</span> <span class="toctext">Utilisation</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Code"><span class="tocnumber">3</span> <span class="toctext">Code</span></a></li>
</ul>
</div>

</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p>Cette macro envoie l'objet s&eacute;lectionn&eacute; (maillage, forme ou corps) au <a rel="nofollow" class="external text" href="https://pcbway.com">site Web de PCBWay</a> pour obtenir un devis instantan&eacute; de fabrication par fraisage CNC, d&eacute;coupe laser ou impression 3D. Une fois l'objet envoy&eacute;, une page s'ouvre sur le site Web de PCBWay pour permettre &agrave; l'utilisateur de r&eacute;gler les d&eacute;tails et les options.
</p><p><b>Remarque</b>&nbsp;: les objets &agrave; base de maillage ne peuvent &ecirc;tre fabriqu&eacute;s que par impression 3D. Pour le fraisage CNC ou la d&eacute;coupe laser, vous devez utiliser des objets bas&eacute;s sur la forme.
</p>
<div class="toccolours mw-collapsible mw-collapsed" style="cursor:not-allowed">
<p>Temporary code for external macro link. Do not use this code. This code is used exclusively by <a href="../Std_AddonMgr.html" title="Std AddonMgr">Addon Manager</a>. <i>Link for optional manual installation: <a rel="nofollow" class="external text" href="https://raw.githubusercontent.com/FreeCAD/FreeCAD-macros/master/Utility/pcbway.FCMacro">Macro</a></i>
</p>
<div class="mw-collapsible-content">
<pre>

# This code is copied instead of the original macro code
# to guide the user to the online download page.
# Use it if the code of the macro is larger than 64 KB and cannot be included in the wiki
# or if the RAW code URL is somewhere else in the wiki.

from PySide import QtGui, QtCore

diag = QtGui.QMessageBox(QtGui.QMessageBox.Information,
    "Information",
    "This macro must be downloaded from this link\n"
    "\n"
    "https://raw.githubusercontent.com/FreeCAD/FreeCAD-macros/master/Utility/pcbway.FCMacro" + "\n"
    "\n"
    "Quit this window to access the download page")

diag.setWindowFlags(QtCore.Qt.WindowStaysOnTopHint)
diag.setWindowModality(QtCore.Qt.ApplicationModal)
diag.exec_()

import webbrowser 
webbrowser.open("https://raw.githubusercontent.com/FreeCAD/FreeCAD-macros/master/Utility/pcbway.FCMacro")
</pre>
</div>
</div>
<div style="display:none;">&lt;class="rawcodeurl"&gt;&lt;a href="<a rel="nofollow" class="external free" href="https://raw.githubusercontent.com/FreeCAD/FreeCAD-macros/master/Utility/pcbway.FCMacro">https://raw.githubusercontent.com/FreeCAD/FreeCAD-macros/master/Utility/pcbway.FCMacro</a>"&gt;raw code&lt;/a&gt;</div>
<p><br>
<span id="Usage"></span>
</p>
<h2><span class="mw-headline" id="Utilisation">Utilisation</span></h2>
<ol><li>Ouvrez ou cr&eacute;ez un document FreeCAD contenant un objet que vous souhaitez fabriquer avec PCBWay.</li>
<li>S&eacute;lectionnez l'objet que vous souhaitez fabriquer. Si aucun objet n'est s&eacute;lectionn&eacute; mais qu'il y a un seul objet visible &agrave; l'&eacute;cran, cet objet sera envoy&eacute;.</li>
<li>Ouvrez le <a href="../fr/Std_DlgMacroExecute.html" title="Std DlgMacroExecute/fr">gestionnaire de macros</a> depuis le menu <b>Macro &rarr; G&eacute;rer les macros...</b>.</li>
<li>S&eacute;lectionnez la macro PCBWay dans la liste.</li>
<li>Cliquez sur <span style="background: #f5f5f5; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); border: 2px solid #989898; border-radius: 0.4em; padding: 0px 10px 1px 10px; font-weight:normal;">Ex&eacute;cuter</span>.</li>
<li>Les fois suivantes, la macro PCBWay se trouvera dans le menu <b>Macro &rarr; Macros r&eacute;centes</b>.</li>
<li>Votre objet sera mis au format STEP pour les formes ou au format OBJ pour les maillages, et envoy&eacute; &agrave; PCBWay. Une fen&ecirc;tre de navigateur s'ouvrira pour que vous puissiez remplir des d&eacute;tails suppl&eacute;mentaires et passer une commande pour votre produit.</li></ol>
<h2><span class="mw-headline" id="Code">Code</span></h2>
<p>La derni&egrave;re version de la macro se trouve &agrave; l'adresse <a rel="nofollow" class="external free" href="https://github.com/FreeCAD/FreeCAD-macros/blob/master/Utility/pcbway.FCMacro">https://github.com/FreeCAD/FreeCAD-macros/blob/master/Utility/pcbway.FCMacro</a>.
</p><p><b>Macro_PCBWay.FCMacro</b>
</p>
<pre>#***************************************************************************
#*                                                                         *
#*   Copyright (c) 2022 Yorik van Havre &lt;yorik@uncreated.net&gt;              *
#*                                                                         *
#*   This program is free software; you can redistribute it and/or modify  *
#*   it under the terms of the GNU Lesser General Public License (LGPL)    *
#*   as published by the Free Software Foundation; either version 2 of     *
#*   the License, or (at your option) any later version.                   *
#*   for detail see the LICENCE text file.                                 *
#*                                                                         *
#*   This program is distributed in the hope that it will be useful,       *
#*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
#*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
#*   GNU Library General Public License for more details.                  *
#*                                                                         *
#*   You should have received a copy of the GNU Library General Public     *
#*   License along with this program; if not, write to the Free Software   *
#*   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  *
#*   USA                                                                   *
#*                                                                         *
#***************************************************************************

"""
PCBWay Macro for FreeCAD

https://pcbway.com

This macro sends the currently selected object to the PCBWay website
to get an instant quote for manufacturing. After the object is sent,
a page will be opened on the PCBWay website to allow the user to adjust
details and options.
"""

# code inspired / borrowed from:
# KiCAD PcbWay plugin: https://github.com/pcbway/PCBWay-Plug-in-for-Kicad/blob/main/plugins/thread.py
# urllib-based upload: http://pymotw.com/2/urllib2/#uploading-files
# mime stuff: https://stackoverflow.com/questions/27099290/where-is-mimetools-choose-boundary-function-in-python3#27174474

# version history:
# version 1.0 - 2022.07.22

__title__   = "Macro_PCBWay"
__author__  = "Yorik van Havre"
__wiki__    = "https://www.freecad.org/wiki/Macro_PCBWay"
__url__     = "https://www.pcbway.com"
__version__ = "1.0"
__date__    = "22/07/2022"


import tempfile
import os
import FreeCAD
import FreeCADGui
import json
import webbrowser
import urllib.request
import urllib.parse
import email.generator
import itertools


pcb_url = "https://www.pcbway.com/common/freecadupfile"


def msg(message):

    """prints a message where appropriate"""

    FreeCAD.Console.PrintError(message+"\n")
    if FreeCAD.GuiUp:
        from PySide import QtGui
        reply = QtGui.QMessageBox.critical(None,"PCBWay export",message)


class MultiPartData(object):

    """Gathers data and files to be sent via HTTP POST"""

    def __init__(self):
        self.form_fields = []
        self.files = []
        self.boundary = email.generator._make_boundary()
        self.add_field("Unit","Millimeter") #FreeCAD's boundboxes are always in mm
        return

    def get_content_type(self):
        return 'multipart/form-data; boundary=%s'&nbsp;% self.boundary

    def add_field(self, name, value):
        """Add a simple field to the form data."""
        self.form_fields.append((name, str(value)))
        return

    def add_file(self, fieldname, filename, fileHandle, mime):
        """Add a file to be uploaded."""
        body = fileHandle.read()
        self.files.append((fieldname, filename, mime, body))
        return

    def get_bytes(self):
        """Return a string representing the form data, including attached files."""
        parts = []
        part_boundary = '--' + self.boundary
        parts.extend([part_boundary,'Content-Disposition: form-data; name="%s"'&nbsp;% name,'',value] for name, value in self.form_fields)
        parts.extend([part_boundary,'Content-Disposition: file; name="%s"; filename="%s"'&nbsp;% (field_name, filename),
                                    'Content-Type: %s'&nbsp;% content_type,'',body] for field_name, filename, content_type, body in self.files)
        flattened = list(itertools.chain(*parts))
        flattened.append('--' + self.boundary + '--')
        flattened.append('')
        return bytes('\r\n'.join(flattened),'utf8')


def main():

    # validity tests
    mesh = None
    shape = None
    if not FreeCAD.GuiUp:
        return
    if not FreeCAD.ActiveDocument:
        msg("There is no opened document. Please open or create a document containing objects before running this macro.")
        return
    # get the selected object, or the only visible body or object if nothing is selected
    selection = FreeCADGui.Selection.getSelection()
    if not selection:
        visibles = [obj for obj in FreeCAD.ActiveDocument.Objects if obj.ViewObject.Visibility]
        if len(visibles) == 1:
            obj = visibles[0]
            if hasattr(obj,"Shape"):
                shape = obj.Shape
            elif hasattr(obj,"Mesh"):
                mesh = obj.Mesh
        elif len(visibles) &gt; 1:
            bodies = [obj for obj in visibles if obj.isDerivedFrom("PartDesign::Body")]
            if len(bodies) == 1:
                shape = bodies[0].Shape
            else:
                msg("No object is selected. Please select one object or body before running this macro.")
                return
    elif len(selection) &gt; 1:
        msg("More than one object is selected. Please select only one object or body before running this macro.")
        return
    else:
        obj = selection[0]
        if hasattr(obj,"Shape"):
            shape = obj.Shape
            if (not shape) or (not hasattr(shape,"isNull")) or shape.isNull():
                msg("The selected object has no shape. Please select an object with a shape before running this macro.")
                return
        elif hasattr(obj,"Mesh"):
            mesh = obj.Mesh
    if (not shape) and (not mesh):
        msg("Unable to find a suitable shape in the selection or in the visible objects. Please select an object before running this macro.")
        return

    # offer to add the macro as a button on first run
    # not working yet!
    # prefs = FreeCAD.ParamGet("User parameter:Plugins/PCBWay")
    # if prefs.GetBool("FirstTime",True):
    #    prefs.SetBool("FirstTime",False)
    #    from PySide import QtGui
    #    reply = QtGui.QMessageBox.question(None, "Install macro?",
    #        "This is the first time you are launching the PCBWay macro. Do you wish to add a toolbar button for it?",
    #        QtGui.QMessageBox.Yes</pre>
<!-- 
NewPP limit report
Cached time: 20250119110636
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc, no&#8208;toc&#8208;conversion]
CPU time usage: 0.058 seconds
Real time usage: 0.080 seconds
Preprocessor visited node count: 119/1000000
Post&#8208;expand include size: 3051/2097152 bytes
Template argument size: 7695/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 8272/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    9.594      1 -total
 36.70%    3.521      1 Template:Macro/fr
 19.15%    1.837      1 Template:Codeextralink
 18.19%    1.745      1 Template:MacroCode
 10.48%    1.006      2 Template:MenuCommand
  9.82%    0.942      1 Template:Button
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:293036-0!canonical and timestamp 20250119110636 and revision id 1533535. Rendering was triggered because: api-parse
 -->
</div>
</div><script src="../site.js"></script>