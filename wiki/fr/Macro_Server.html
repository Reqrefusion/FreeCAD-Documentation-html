<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro Server/fr</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="fr" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Macro+Server&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><a href="../Macro_Server.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro Server (100% translated)" lang="en" dir="ltr">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--med" lang="fr" dir="ltr">fran&ccedil;ais</span></li>
<li><a href="../cs/Macro_Server.html" class="mw-pt-progress mw-pt-progress--low" title="Macro Server/cs (9% translated)" lang="cs" dir="ltr">&#269;e&scaron;tina</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../File/Macro_server.svg" class="mw-file-description"><img src="../File/Macro_server.svg" decoding="async" width="32" height="32" class="mw-file-element" data-file-width="1935" data-file-height="1935"></a></span><span> </span>
Macro Server
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Permet le contr&ocirc;le externe de FreeCAD &agrave; des fins d'automatisation.<br><br>Version macro&nbsp;: 1.0<br>Date derni&egrave;re modification&nbsp;: 2026-01-30<br>Version FreeCAD&nbsp;: Toutes<br>T&eacute;l&eacute;chargement&nbsp;: <a href="../images/d/d5/Macro_server.svg.html" class="internal" title="Macro server.svg">Media:Macro_server.svg</a><br>Auteur: Jjustra<br>
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../index.php?title=User;Jjustra&amp;action=edit&amp;redlink=1.html" class="new" title="User:Jjustra (page does not exist)">Jjustra</a>
</td></tr>
<tr>
<th class="ctOdd">T&eacute;l&eacute;chargement
</th></tr>
<tr>
<td class="ctEven macro-download"><a href="../images/d/d5/Macro_server.svg.html" class="internal" title="Macro server.svg">Media:Macro_server.svg</a>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../fr/Macros_recipes.html" title="Macros recipes/fr">Page des macros</a><br><a href="../fr/How_to_install_macros.html" title="How to install macros/fr">Comment installer une macro</a><br><a href="../fr/Customize_Toolbars.html" title="Customize Toolbars/fr">Comment cr&eacute;er une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version Macro
</th></tr>
<tr>
<td class="ctEven macro-version">1.0
</td></tr>
<tr>
<th class="ctOdd">Derni&egrave;re modification
</th></tr>
<tr>
<td class="ctEven macro-date">2026-01-30
</td></tr>
<tr>
<th class="ctOdd">Version(s) FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">Toutes
</td></tr>
<tr>
<th class="ctOdd">Raccourci clavier
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<p><span id="Description"></span>
</p>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p>Outil utile pour l'automatisation de FreeCAD. L'objectif est de cr&eacute;er un programme compact, polyvalent et fonctionnant uniquement au &laquo;&nbsp;niveau sup&eacute;rieur&nbsp;&raquo;.
</p><p>Gestion &agrave; distance de FreeCAD, sans modification r&eacute;elle du mod&egrave;le (pour cela, voir Extensions).
</p><p>Vous avez besoin d'un client pour envoyer des commandes &agrave; ce serveur. Un utilitaire simple en ligne de commande Python est inclus &agrave; titre d'impl&eacute;mentation de r&eacute;f&eacute;rence.
</p><p>Cela vous permet de s&eacute;lectionner globalement (mais toujours dans l'espace du serveur et non dans FreeCAD lui-m&ecirc;me)&nbsp;:
</p>
<ul><li>document</li>
<li>objet</li>
<li>feuille de calcul</li>
<li>chemin d'acc&egrave;s (principalement pour l'exportation)</li></ul>
<p>Les op&eacute;rations suivantes peuvent n&eacute;cessiter un document/objet/tableur/chemin d'acc&egrave;s.
</p><p>(la plupart de ces arguments sont facultatifs)
</p>
<ul><li>la valeur donn&eacute;e est utilis&eacute;e en premier</li>
<li>puis la valeur globale</li>
<li>et enfin la s&eacute;lection active/par d&eacute;faut dans FreeCAD lui-m&ecirc;me</li></ul>
<p>par exemple&nbsp;:
</p>
<ul><li>Vous pouvez obtenir la liste des objets dans le document actif &agrave; l'aide de la commande &laquo;&nbsp;O&nbsp;&raquo;.</li>
<li>Vous pouvez &eacute;galement obtenir la liste des objets dans un document concret &agrave; l'aide de la commande &laquo;&nbsp;Oconcrete_document&nbsp;&raquo;.</li></ul>
<p>(la liste de tous les documents est renvoy&eacute;e par la commande &laquo;&nbsp;D&nbsp;&raquo;)
</p><p>Cela vous permet &eacute;galement d'obtenir la liste des&nbsp;:
</p>
<ul><li>documents ouverts</li>
<li>objets avec leur nom et leur &eacute;tiquette</li>
<li>cellules dans une feuille de calcul avec leurs valeurs</li></ul>
<p>Et vous pouvez m&ecirc;me&nbsp;:
</p>
<ul><li>obtenir la valeur d'une cellule</li>
<li>d&eacute;finir la valeur d'une cellule</li>
<li>recalculer (n&eacute;cessaire apr&egrave;s avoir d&eacute;fini les cellules)</li>
<li>exporter</li></ul>
<p><span id="Usage"></span>
</p>
<h2><span class="mw-headline" id="Utilisation">Utilisation</span></h2>
<p><span id="Server"></span>
</p>
<h3><span class="mw-headline" id="Serveur">Serveur</span></h3>
<p>Vous d&eacute;marrez le serveur en ex&eacute;cutant la macro. Vous pouvez l'arr&ecirc;ter de la m&ecirc;me mani&egrave;re. La macro agit donc comme un simple bouton d'activation, et la v&eacute;ritable magie op&egrave;re ailleurs.
</p>
<h3><span class="mw-headline" id="Client">Client</span></h3>
<p>Le script client inclus accepte les commandes sous forme d'arguments de ligne de commande. Chaque argument correspond &agrave; une commande.
</p><p>par exemple&nbsp;: ./freecad-ctl.py 'dMy_document_1' C '!B1 123' C
</p><p>Cela s&eacute;lectionne &laquo;&nbsp;My_document_1&nbsp;&raquo;, renvoie toutes les valeurs des cellules dans la feuille de calcul par d&eacute;faut, d&eacute;finit la cellule B1 sur 123 et renvoie &agrave; nouveau toutes les valeurs.
</p><p><span id="Note"></span>
</p>
<h3><span class="mw-headline" id="Remarque">Remarque</span></h3>
<p>N'oubliez pas de d&eacute;finir le chemin d'acc&egrave;s ROOT vers les fichiers stdin/stdout du serveur, &agrave; la fois dans le client ET dans le serveur, avant de l'ex&eacute;cuter (variable ROOT au d&eacute;but des deux codes source). Les fichiers stdin/stdout seront cr&eacute;&eacute;s automatiquement.
</p><p><span id="Communication_protocol"></span>
</p>
<h3><span class="mw-headline" id="Protocole_de_communication">Protocole de communication</span></h3>
<p>Les informations sont &eacute;chang&eacute;es via deux fichiers. Du point de vue du serveur, l'un est une entr&eacute;e, l'autre une sortie. Du point de vue du client, l'entr&eacute;e du serveur est sa sortie et vice versa.
</p><p>Chaque commande renvoie une r&eacute;ponse.
</p><p><span id="Command_format"></span>
</p>
<h4><span class="mw-headline" id="Format_des_commandes">Format des commandes</span></h4>
<div class="mw-highlight mw-highlight-lang-text mw-content-ltr" dir="ltr"><pre><span></span>&lt;one-letter-mod&gt;&lt;name&gt; &lt;data string&gt;
</pre></div>
<p>par exemple&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-text mw-content-ltr" dir="ltr"><pre><span></span>!B1 123
</pre></div>
<p>o&ugrave;&nbsp;:
</p>
<ul><li><b>!</b> est mod/commande</li>
<li><b>B1</b> est le nom</li>
<li><b>123</b> est la valeur de la cha&icirc;ne de caract&egrave;re (peut &ecirc;tre un autre nom ou simplement une valeur, selon la situation)</li></ul>
<p>Cela d&eacute;finit la cellule B1 (dans le document global ou actif et dans la feuille de calcul) sur la valeur 123.
</p><p><span id="Commands"></span>
</p>
<h4><span class="mw-headline" id="Commandes">Commandes</span></h4>
<p><i>I</i>&nbsp;: pour obtenir l'identifiant du serveur
</p><p><i>D</i>&nbsp;: pour obtenir la liste des documents ouverts sous la forme&nbsp;: d&lt;document&gt;
</p><p><i>O[&lt;document&gt;]</i>&nbsp;: pour obtenir la liste des objets sous la forme&nbsp;: o&lt;object&gt; &lt;label&gt;
</p><p><i>C[&lt;document&gt;] [&lt;spreadsheet&gt;]</i>&nbsp;: pour obtenir la liste des cellules sous la forme&nbsp;: c&lt;cell-id&gt; &lt;value&gt;
</p><p><i>d&lt;document&gt;</i>&nbsp;: pour s&eacute;lectionner un document
</p><p><i>s[&lt;document&gt;] &lt;spreadsheet&gt;</i>&nbsp;: pour s&eacute;lectionner une feuille de calcul
</p><p><i>o[&lt;document&gt;] &lt;object-name&gt;</i>&nbsp;: pour s&eacute;lectionner un objet
</p><p><i>p &lt;file-path&gt;</i>&nbsp;: pour  s&eacute;lectionner/d&eacute;finir un chemin d'acc&egrave;s
</p><p><i>@&lt;cell-id&gt; [&lt;spreadsheet&gt;]</i>&nbsp;: pour obtenir la valeur d'une cellule sous la forme&nbsp;: c&lt;cell-id&gt; &lt;value&gt;
</p><p><i>!&lt;cell-id&gt; &lt;value&gt;</i>&nbsp;: pour d&eacute;finir la valeur d'une cellule
</p><p><i>r[&lt;document&gt;]</i>&nbsp;: pour recalculer un document
</p><p><i>e[&lt;object&gt;] [&lt;file-path&gt;]</i>&nbsp;: pour exporter un objet s&eacute;lectionn&eacute;
</p><p><span id="Examples"></span>
</p>
<h4><span class="mw-headline" id="Exemples">Exemples</span></h4>
<p>S&eacute;lectionnez le document <b>My_document_0</b>.
</p>
<div class="mw-highlight mw-highlight-lang-text mw-content-ltr" dir="ltr"><pre><span></span>dMy_document_0
</pre></div>
<p>R&eacute;cup&eacute;rez la liste des objets &agrave; partir de <b>My_document_1</b>.
</p>
<div class="mw-highlight mw-highlight-lang-text mw-content-ltr" dir="ltr"><pre><span></span>OMy_document_1
</pre></div>
<p>R&eacute;cup&eacute;rez la liste des objets &agrave; partir de <b>My_document_0</b>.
</p>
<div class="mw-highlight mw-highlight-lang-text mw-content-ltr" dir="ltr"><pre><span></span>O
</pre></div>
<p>D&eacute;s&eacute;lectionnez le document.
</p>
<div class="mw-highlight mw-highlight-lang-text mw-content-ltr" dir="ltr"><pre><span></span>d
</pre></div>
<p>R&eacute;cup&eacute;rez la liste des objets du document actif de FreeCAD
</p>
<div class="mw-highlight mw-highlight-lang-text mw-content-ltr" dir="ltr"><pre><span></span>O
</pre></div>
<p>R&eacute;cup&eacute;rez la liste des cellules de la feuille de calcul par d&eacute;faut dans <b>My_document_0</b>
</p>
<div class="mw-highlight mw-highlight-lang-text mw-content-ltr" dir="ltr"><pre><span></span>CMy_document_0
</pre></div>
<p>R&eacute;cup&eacute;rez la liste des cellules de <b>My_spreadsheet</b> dans <b>My_document_0</b>
</p>
<div class="mw-highlight mw-highlight-lang-text mw-content-ltr" dir="ltr"><pre><span></span>CMy_document_0 My_spreadsheet
</pre></div>
<p>D&eacute;finissez un chemin d'acc&egrave;s
</p>
<div class="mw-highlight mw-highlight-lang-python3 mw-content-ltr" dir="ltr"><pre><span></span><span class="n">p</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">exported</span><span class="o">-</span><span class="n">part</span><span class="o">.</span><span class="n">stl</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Export <b>Object_0</b> to selected path
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<div class="mw-highlight mw-highlight-lang-python3 mw-content-ltr" dir="ltr"><pre><span></span><span class="n">eObject_0</span>
</pre></div>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Extensions">Extensions</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>In case more functionality is required, beyond scope of this server, additions can be easily made.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Every command must return some response.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Script">Script</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h3><span class="mw-headline" id="server_macro">server macro</span></h3>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>server.FCMacro
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<pre>## created on ##
# OS: Windows 10 build 19045
# Architecture: x86_64
# Version: 1.0.2.39319 (Git) Conda
# Build type: Release
# Branch: (HEAD detached at 1.0.2)
# Hash: 256fc7eff3379911ab5daf88e10182c509aa8052
# Python 3.11.13, Qt 5.15.15, Coin 4.0.3, Vtk 9.3.0, OCC 7.8.1
# Locale: Czech/Czech Republic (cs_CZ)
# Stylesheet/Theme/QtStyle: FreeCAD Dark.qss/FreeCAD Dark/Fusion
# Installed mods: 
#   * freecad.gears 1.3.0
#   * sheetmetal 0.7.58
&lt;/div&gt;

&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
__Title__="server"
__Author__ = "Jjustra"
__Version__ = "1.0"
__Date__    = "2026-01-30"
__Comment__ = "This is the comment of the macro"
__Web__ = "https://forum.freecad.org"
__Wiki__ = "https://wiki.freecad.org/index.php?title=Macro_server"
__Icon__  = "/usr/lib/freecad/Mod/plugins/icons/server"
__IconW__  = "C:/Users/YourUserName/AppData/Roaming/FreeCAD"
__Help__ = "start the macro and run client"
__Status__ = "stable"
__Requires__ = "freecad all"
__Communication__ = "https://wiki.freecad.org/index.php?title=User:Jjustra"
&lt;/div&gt;


&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
import FreeCAD
&lt;/div&gt;

&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
# Location of the input/output files
ROOT = 'c:/tmp'
&lt;/div&gt;


&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if 'server' not in dir(FreeCAD):
	# Server not running - we will start it then
	
	import os
	from threading import Event,Thread
	import Mesh
	import time
&lt;/div&gt;

&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
## --- brcko lib start --- ##
	import sys,os
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
stdin = []
	stdinpos = []
	stdout = []
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def addstdin(path):
		global stdin,stdinpos
		if os.path.exists(path):
			pos = os.path.getsize(path)
		else:
			pos = 0
		stdin.append(path)
		stdinpos.append(pos)
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def addstdout(path):
		global stdout
		stdout.append(path)
&lt;/div&gt;


	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def getstdin():
		global stdin,stdinpos
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
data = []
		for i,path in enumerate(stdin):
&lt;/div&gt;

			&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if not os.path.exists(path): continue
&lt;/div&gt;

			&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
f = open(path)
			f.seek(stdinpos[i])
			_data = f.read()
			f.close()
&lt;/div&gt;

			&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
# Line-buffered
			_i = _data.rfind('\n') + 1
			_data = _data[:_i]
&lt;/div&gt;

			&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
data.append(_data)
			stdinpos[i] += _i
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
return data
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def putstdout(data,i=0):
		global stdout
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if i &gt;= len(stdout): return
		path = stdout[i]
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if path == '-':
			sys.stdout.write(data)
		else:
			f = open(path,'a', encoding="utf-8", newline='\n')
			f.write(data)
			f.close()
&lt;/div&gt;

&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
## --- brcko lib end --- ##
&lt;/div&gt;


	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
_cb_d = {}
	id = 0
	path = ''
	_id = 0
	_doc = 0
	_ss = 0
	_obj = 0
	_path = 0
&lt;/div&gt;


&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
## --- utils start --- ##
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def getDoc(n=0):
		'''Get document'''
		global _doc
		
		if n:
			try:
				doc = App.getDocument(n)
			except NameError:
				return 0
		elif _doc:
			doc = _doc
		else:
			doc = App.ActiveDocument
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
return doc
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def getSS(s=0,n=0):
		'''Get spreadsheet'''
		global _ss
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
doc = getDoc(n)
		if not doc: return 0
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if s:
			ss = doc.getObject(s)
		elif _ss:
			ss = _ss
		else:
			ss = doc.getObject('Spreadsheet')
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
return ss
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def getObj(s=0,n=0):
		'''Get object'''
		global _obj
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
doc = getDoc(n)
		if not doc: return 0
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if s:
			obj = doc.getObject(s)
		elif _obj:
			obj = _obj
		else:
			obj = doc.ActiveObject
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
return obj
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def getPath(s=0, default_fn=0):
		'''Get file path (for export mainly)'''
		global _path,ROOT
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
path = ''
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if not default_fn:
			default_fn='file'
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if s:
			path = s
		elif _path:
			path = _path
		else:
			path = ROOT
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
path = path.replace('\\','/')# make it objectively right&nbsp;;)
		
		if os.path.isdir(path):
			path = path + '/' + default_fn
		if '.' not in path.split('/')[-1]:
			path += '.stl'
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
return path
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def dlgln(ln):
		m = ''
		n = ''
		s = ''
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
m = ln[0]
		ln = ln[1:]
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if ln:
&lt;/div&gt;

			&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if ln[0] == ' ':
				s = ln[1:]
			else:
				if ' ' in ln:
					n,s = ln.split(' ',1)
				else:
					n = ln
		
		return m,n,s
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def register(m, fc):
		'''Register command function with respective m-code'''
		global _cb_d
		_cb_d[m] = fc
&lt;/div&gt;

&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
## --- utils end --- ##
&lt;/div&gt;


&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
## --- thread function start --- ##
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def _th(qe,id):
		global _cb_d,_id
		
		while not qe.is_set():
			for data in getstdin():
				for ln in data.split('\n'):
					if not ln: continue
					print('#D&nbsp;: server&nbsp;: got input&nbsp;:',ln)
					m,n,s = dlgln(ln)
					if m in _cb_d:
						if not _id or _id == id or _cb_d[m] == fc_selectId:
							# Only process commands if&nbsp;:
							#  id is empty
							#  id equals this instance's id
							#  we are about to execute selectId command
							_cb_d[m](m,n,s)
					else:
						print('#E&nbsp;: server&nbsp;: unknown command&nbsp;:',m)
			time.sleep(1)
&lt;/div&gt;

&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
## --- thread function end --- ##
&lt;/div&gt;


&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
## --- stdlib start --- ##
	
	def fc_getId(m,n,s):
		resp = 'i%s\n'&nbsp;% FreeCAD.server[0]
		#resp += '#I&nbsp;: server&nbsp;: fc_getId&nbsp;: done\n'
		putstdout(resp)
	
	def fc_docList(m,n,s):
		resp = ''
		
		for k,_ in App.listDocuments().items():
			resp += 'd%s\n'&nbsp;% k
		
		if not resp:
			resp += '#I&nbsp;: server&nbsp;: fc_docList&nbsp;: empty\n'
		
		putstdout(resp)
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def fc_objList(m,n,s):
		resp = ''
		doc = getDoc(n)
		
		if not doc:
			resp += '#E&nbsp;: server&nbsp;: fc_objList&nbsp;: no doc\n'
		else:
		
			for obj in doc.Objects:
				resp += 'o%s %s\n'&nbsp;% (obj.Name, obj.Label)
			
			if not resp:
				resp += '#I&nbsp;: server&nbsp;: fc_objList&nbsp;: empty\n'
		
		putstdout(resp)
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def fc_cellsList(m,n,s):
		resp = ''
		ss = getSS(s,n)
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if not ss:
			resp += '#E&nbsp;: server&nbsp;: fc_cellsList&nbsp;: no sheet\n'
		else:
&lt;/div&gt;

			&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
# Build list of non-empty cells
			for k in ss.getNonEmptyCells():
				v = ss.get(k)
				resp += 'c%s %s\n'&nbsp;% (k,v)
			
			if not resp:
				resp += '#I&nbsp;: server&nbsp;: fc_cellsList&nbsp;: empty\n'
		
		# Sends it
		putstdout(resp)
&lt;/div&gt;
	

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def fc_selectId(m,n,s):
		global _id
		
		_id = n
		
		putstdout('#I&nbsp;: server&nbsp;: fc_selectId&nbsp;: done\n')
		
	def fc_selectDoc(m,n,s):
		global _doc
		
		resp = ''
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if n:
			try:
				_doc = App.getDocument(n)
			except NameError:
				resp = '#E&nbsp;: server&nbsp;: fc_selectDoc&nbsp;: no doc\n'
		else:
			_doc = 0
		
		if not resp:
			resp = '#I&nbsp;: server&nbsp;: fc_selectDoc&nbsp;: done\n'
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
putstdout(resp)
	
	def fc_selectSpreadsheet(m,n,s):
		global _ss
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
resp = ''
		doc = getDoc(n)
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if not doc:
			resp += '#E&nbsp;: server&nbsp;: fc_selectSpreadsheet&nbsp;: no doc\n'
		else:
		
			if s:
				_ss = doc.getObject(s)
			else:
				_ss = 0
			
			resp = '#I&nbsp;: server&nbsp;: fc_selectSpreadsheet&nbsp;: done\n'
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
putstdout(resp)
	
	def fc_selectObj(m,n,s):
		global _obj
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
resp = ''
		doc = getDoc(n)
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if not doc:
			resp += '#E&nbsp;: server&nbsp;: fc_selectObj&nbsp;: no doc\n'
		else:
&lt;/div&gt;

			&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if s:
				_obj = doc.getObject(s)
			else:
				_obj = 0
			
			if not resp:
				resp = '#I&nbsp;: server&nbsp;: fc_selectObj&nbsp;: done\n'
	
		putstdout(resp)
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def fc_selectPath(m,n,s):
		global _path
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if s:
			_path = s
		else:
			_path = 0
	
		putstdout('#I&nbsp;: server&nbsp;: fc_selectPath&nbsp;: done\n')
&lt;/div&gt;

	
	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def fc_getCell(m,n,s):
		resp = ''
		ss = getSS(s)
		if not ss:
			resp = '#E&nbsp;: server&nbsp;: fc_getCell&nbsp;: no sheet\n'
		else:
		
			try:
				v = ss.get(n)
				resp = 'c%s %d\n'&nbsp;% (n, v)
			except ValueError:
				resp = '#E&nbsp;: server&nbsp;: fc_getCell&nbsp;: no cell\n'
				
		#resp += '#I&nbsp;: server&nbsp;: fc_getCell&nbsp;: done\n'
		putstdout(resp)
	
	def fc_setCell(m,n,s):
		resp = ''
		ss = getSS()
		if not ss:
			resp = '#E&nbsp;: server&nbsp;: fc_setCell&nbsp;: no sheet\n'
		else:
			v = ss.set(n,s)
			resp = '#I&nbsp;: server&nbsp;: fc_setCell&nbsp;: done\n'
	
		putstdout(resp)
&lt;/div&gt;

	
	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def fc_recompute(m,n,s):
		getDoc(n).recompute()
		
		putstdout('#I&nbsp;: server&nbsp;: fc_recompute&nbsp;: done\n')
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def fc_export(m,n,s):
		resp = ''
		obj = getObj(n)
		path = getPath(s, obj.Label)
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
if not obj:
			resp = '#E&nbsp;: server&nbsp;: fc_export&nbsp;: no object\n'
		else:
			
			if not path:
				resp = '#E&nbsp;: server&nbsp;: fc_export&nbsp;: no path\n'
			else:
			
				if hasattr(Mesh, "exportOptions"):
					options = Mesh.exportOptions(path)
					Mesh.export([obj], path, options)
				else:
					Mesh.export([obj], path)
				
				resp += '#I&nbsp;: server&nbsp;: fc_export&nbsp;: done&nbsp;: %s\n'&nbsp;% path
&lt;/div&gt;

		&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
putstdout(resp)
&lt;/div&gt;


	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def fc_(m,n,s):
		resp = ''
		putstdout(resp)
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def fc_(m,n,s):
		resp = ''
		putstdout(resp)
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
def fc_(m,n,s):
		resp = ''
		putstdout(resp)
&lt;/div&gt;

&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
## --- stdlib end --- ##
&lt;/div&gt;


&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
## --- Extensions start --- ##
## --- Extensions end --- ##
&lt;/div&gt;


	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
# Register all command functions with their codes
	
	register('I', fc_getId)
	register('D', fc_docList)
	register('O', fc_objList)
	register('C', fc_cellsList)
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
register('i', fc_selectId)
	register('d', fc_selectDoc)
	register('s', fc_selectSpreadsheet)
	register('o', fc_selectObj)
	register('p', fc_selectPath)
	
	register('@', fc_getCell)
	register('!', fc_setCell)
	
	register('r', fc_recompute)
	register('e', fc_export)
	
	#register('', fc_)
&lt;/div&gt;


&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
## --- Extensions registration start --- ##
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
#register('', fc_)
&lt;/div&gt;

&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
## --- Extensions registration end --- ##
&lt;/div&gt;


	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
# Setup brcko lib
	path = os.path.abspath(ROOT)
	# in &lt;-&gt; in
	# out &lt;-&gt; out
	addstdin('%s/server.stdin' %path)
	addstdout('%s/server.stdout' %path)
&lt;/div&gt;


	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
# Little bit of flexing O:)
	genid = lambda seed,lvl: 'QWERTYUIOPASDFGHJKLZXCVBNM'[seed%26]+genid((seed*12345)%56789,lvl-1) if lvl&gt;0 else ''
	id = genid(int(time.time()*1000),8)
	
	qe = Event()
	th = Thread(target=_th,args=(qe,id))
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
FreeCAD.server = (id,qe,th)
	th.start()
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
print('#I&nbsp;: server&nbsp;: started&nbsp;:',id)
&lt;/div&gt;

&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
else:
	# Server is running - let's stop it now
	
	(id,qe,th) = FreeCAD.server
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
qe.set()
	del(FreeCAD.server)
&lt;/div&gt;

	&lt;div lang="en" dir="ltr" class="mw-content-ltr"&gt;
print('#I&nbsp;: server&nbsp;: stopped')</pre>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h3><span class="mw-headline" id="client_script">client script</span></h3>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>freecad-ctl.py
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<div class="mw-highlight mw-highlight-lang-python3 mw-content-ltr mw-highlight-lines" dir="ltr"><pre><span></span><span class="linenos" data-line="1"></span><span class="ch">#!/usr/bin/python3</span>
<span class="linenos" data-line="2"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="3"></span>
<span class="linenos" data-line="4"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="5"></span><span class="kn">import</span> <span class="nn">os</span>
<span class="linenos" data-line="6"></span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos" data-line="7"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="8"></span>
<span class="linenos" data-line="9"></span>
<span class="linenos" data-line="10"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="11"></span><span class="c1"># Location of the input/output files</span>
<span class="linenos" data-line="12"></span><span class="n">ROOT</span> <span class="o">=</span> <span class="s1">'c:/tmp'</span>
<span class="linenos" data-line="13"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="14"></span>
<span class="linenos" data-line="15"></span>
<span class="linenos" data-line="16"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="17"></span><span class="c1">## --- brcko lib start --- ##</span>
<span class="linenos" data-line="18"></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">os</span>
<span class="linenos" data-line="19"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="20"></span>
<span class="linenos" data-line="21"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="22"></span><span class="n">stdin</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos" data-line="23"></span><span class="n">stdinpos</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos" data-line="24"></span><span class="n">stdout</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos" data-line="25"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="26"></span>
<span class="linenos" data-line="27"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="28"></span><span class="k">def</span> <span class="nf">addstdin</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="linenos" data-line="29"></span>	<span class="k">global</span> <span class="n">stdin</span><span class="p">,</span><span class="n">stdinpos</span>
<span class="linenos" data-line="30"></span>	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="linenos" data-line="31"></span>		<span class="n">pos</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="linenos" data-line="32"></span>	<span class="k">else</span><span class="p">:</span>
<span class="linenos" data-line="33"></span>		<span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos" data-line="34"></span>	<span class="n">stdin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="linenos" data-line="35"></span>	<span class="n">stdinpos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
<span class="linenos" data-line="36"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="37"></span>
<span class="linenos" data-line="38"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="39"></span><span class="k">def</span> <span class="nf">addstdout</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="linenos" data-line="40"></span>	<span class="k">global</span> <span class="n">stdout</span>
<span class="linenos" data-line="41"></span>	<span class="n">stdout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="linenos" data-line="42"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="43"></span>
<span class="linenos" data-line="44"></span>
<span class="linenos" data-line="45"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="46"></span><span class="k">def</span> <span class="nf">getstdin</span><span class="p">():</span>
<span class="linenos" data-line="47"></span>	<span class="k">global</span> <span class="n">stdin</span><span class="p">,</span><span class="n">stdinpos</span>
<span class="linenos" data-line="48"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="49"></span>
<span class="linenos" data-line="50"></span>	<span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="51"></span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos" data-line="52"></span>	<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stdin</span><span class="p">):</span>
<span class="linenos" data-line="53"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="54"></span>
<span class="linenos" data-line="55"></span>		<span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="56"></span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span> <span class="k">continue</span>
<span class="linenos" data-line="57"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="58"></span>
<span class="linenos" data-line="59"></span>		<span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="60"></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="linenos" data-line="61"></span>		<span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">stdinpos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="linenos" data-line="62"></span>		<span class="n">_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="linenos" data-line="63"></span>		<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos" data-line="64"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="65"></span>
<span class="linenos" data-line="66"></span>		<span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="67"></span><span class="c1"># Line-buffered</span>
<span class="linenos" data-line="68"></span>		<span class="n">_i</span> <span class="o">=</span> <span class="n">_data</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="linenos" data-line="69"></span>		<span class="n">_data</span> <span class="o">=</span> <span class="n">_data</span><span class="p">[:</span><span class="n">_i</span><span class="p">]</span>
<span class="linenos" data-line="70"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="71"></span>
<span class="linenos" data-line="72"></span>		<span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="73"></span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span>
<span class="linenos" data-line="74"></span>		<span class="n">stdinpos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_i</span>
<span class="linenos" data-line="75"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="76"></span>
<span class="linenos" data-line="77"></span>	<span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="78"></span><span class="k">return</span> <span class="n">data</span>
<span class="linenos" data-line="79"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="80"></span>
<span class="linenos" data-line="81"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="82"></span><span class="k">def</span> <span class="nf">putstdout</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="linenos" data-line="83"></span>	<span class="k">global</span> <span class="n">stdout</span>
<span class="linenos" data-line="84"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="85"></span>
<span class="linenos" data-line="86"></span>	<span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="87"></span><span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stdout</span><span class="p">):</span> <span class="k">return</span>
<span class="linenos" data-line="88"></span>	<span class="n">path</span> <span class="o">=</span> <span class="n">stdout</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="linenos" data-line="89"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="90"></span>
<span class="linenos" data-line="91"></span>	<span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="92"></span><span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s1">'-'</span><span class="p">:</span>
<span class="linenos" data-line="93"></span>		<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="linenos" data-line="94"></span>	<span class="k">else</span><span class="p">:</span>
<span class="linenos" data-line="95"></span>		<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">'a'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
<span class="linenos" data-line="96"></span>		<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="linenos" data-line="97"></span>		<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos" data-line="98"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="99"></span>
<span class="linenos" data-line="100"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="101"></span><span class="c1">## --- brcko lib end --- ##</span>
<span class="linenos" data-line="102"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="103"></span>
<span class="linenos" data-line="104"></span>
<span class="linenos" data-line="105"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="106"></span><span class="c1"># Process command line arguments</span>
<span class="linenos" data-line="107"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="108"></span>
<span class="linenos" data-line="109"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="110"></span><span class="n">cmd</span> <span class="o">=</span> <span class="s1">''</span>
<span class="linenos" data-line="111"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="112"></span>
<span class="linenos" data-line="113"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="114"></span><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos" data-line="115"></span>	<span class="c1"># Use command line arguments to build command script</span>
<span class="linenos" data-line="116"></span>	
<span class="linenos" data-line="117"></span>	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
<span class="linenos" data-line="118"></span>		<span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">'-'</span><span class="p">:</span>
<span class="linenos" data-line="119"></span>			<span class="c1"># Read list of commands from (real) stdin</span>
<span class="linenos" data-line="120"></span>			<span class="n">cmd</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'</span><span class="se">\r</span><span class="s1">'</span><span class="p">,</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
<span class="linenos" data-line="121"></span>		<span class="k">else</span><span class="p">:</span>
<span class="linenos" data-line="122"></span>			<span class="n">cmd</span> <span class="o">+=</span> <span class="n">a</span>
<span class="linenos" data-line="123"></span>		<span class="n">cmd</span> <span class="o">+=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span>
<span class="linenos" data-line="124"></span><span class="c1">#else:</span>
<span class="linenos" data-line="125"></span>	<span class="c1"># Default&nbsp;: get document list</span>
<span class="linenos" data-line="126"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="127"></span>
<span class="linenos" data-line="128"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="129"></span><span class="c1">#	cmd = 'D\n'</span>
<span class="linenos" data-line="130"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="131"></span>
<span class="linenos" data-line="132"></span>
<span class="linenos" data-line="133"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="134"></span><span class="c1"># Setup brcko lib</span>
<span class="linenos" data-line="135"></span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">ROOT</span><span class="p">)</span>
<span class="linenos" data-line="136"></span><span class="c1"># in &lt;-&gt; out</span>
<span class="linenos" data-line="137"></span><span class="c1"># out &lt;-&gt; in</span>
<span class="linenos" data-line="138"></span><span class="n">addstdin</span><span class="p">(</span><span class="s1">'</span><span class="si">%s</span><span class="s1">/server.stdout'</span> <span class="o">%</span><span class="n">path</span><span class="p">)</span>
<span class="linenos" data-line="139"></span><span class="n">addstdout</span><span class="p">(</span><span class="s1">'</span><span class="si">%s</span><span class="s1">/server.stdin'</span> <span class="o">%</span><span class="n">path</span><span class="p">)</span>
<span class="linenos" data-line="140"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="141"></span>
<span class="linenos" data-line="142"></span>
<span class="linenos" data-line="143"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="144"></span><span class="c1"># Send command script</span>
<span class="linenos" data-line="145"></span><span class="k">if</span> <span class="n">cmd</span><span class="p">:</span>
<span class="linenos" data-line="146"></span>	<span class="n">putstdout</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
<span class="linenos" data-line="147"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="148"></span>
<span class="linenos" data-line="149"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="150"></span><span class="k">try</span><span class="p">:</span>
<span class="linenos" data-line="151"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="152"></span>
<span class="linenos" data-line="153"></span>	<span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="154"></span><span class="c1"># Wait for response (indicated by file size change / file creation)</span>
<span class="linenos" data-line="155"></span>	<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">stdin</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<span class="linenos" data-line="156"></span>		<span class="k">while</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">stdin</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<span class="linenos" data-line="157"></span>			<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.1</span><span class="p">)</span>
<span class="linenos" data-line="158"></span>	<span class="k">else</span><span class="p">:</span>
<span class="linenos" data-line="159"></span>		<span class="n">sz</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">stdin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="linenos" data-line="160"></span>		<span class="k">while</span> <span class="n">sz</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">stdin</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<span class="linenos" data-line="161"></span>			<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.1</span><span class="p">)</span>
<span class="linenos" data-line="162"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="163"></span>
<span class="linenos" data-line="164"></span>	<span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="165"></span><span class="c1"># Just to be sure write ended</span>
<span class="linenos" data-line="166"></span>	<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.5</span><span class="p">)</span>
<span class="linenos" data-line="167"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="168"></span>
<span class="linenos" data-line="169"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="170"></span><span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<span class="linenos" data-line="171"></span>	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<span class="linenos" data-line="172"></span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="linenos" data-line="173"></span>
<span class="linenos" data-line="174"></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">"ltr"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"mw-content-ltr"</span><span class="o">&gt;</span>
<span class="linenos" data-line="175"></span><span class="c1"># Print response</span>
<span class="linenos" data-line="176"></span><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">getstdin</span><span class="p">():</span>
<span class="linenos" data-line="177"></span>	<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<!-- 
NewPP limit report
Cached time: 20260204102733
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.060 seconds
Real time usage: 0.069 seconds
Preprocessor visited node count: 199/1000000
Post&#8208;expand include size: 1850/2097152 bytes
Template argument size: 13881/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 12/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 50049/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    7.425      1 -total
 41.06%    3.049      1 Template:Macro/fr
 38.70%    2.873      1 Template:MacroCode
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:413776-0!canonical and timestamp 20260204102733 and revision id 1747572. Rendering was triggered because: edit-page
 -->
</div>
</div><script src="../site.js"></script>