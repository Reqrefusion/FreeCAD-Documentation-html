<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro Snip/fr</span></h1><?xml encoding="UTF-8"><div class="mw-parser-output"><div class="mw-pt-languages noprint" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../de/Macro_Snip.html" class="mw-pt-progress mw-pt-progress--complete" title="Makro Snip (100% translated)" lang="de" dir="ltr">Deutsch</a></li>
<li><a href="../Macro_Snip.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro Snip (100% translated)" lang="en" dir="ltr">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" lang="fr" dir="ltr">fran&ccedil;ais</span></li>
<li><a href="../it/Macro_Snip.html" class="mw-pt-progress mw-pt-progress--low" title="Macro Snip (31% translated)" lang="it" dir="ltr">italiano</a></li>
<li><a href="../pl/Macro_Snip.html" class="mw-pt-progress mw-pt-progress--stub" title="Makrodefinicja: Wycinek (4% translated)" lang="pl" dir="ltr">polski</a></li>
<li><a href="../pt-br/Macro_Snip.html" class="mw-pt-progress mw-pt-progress--stub" title="Macro de Corte (8% translated)" lang="pt-BR" dir="ltr">portugu&ecirc;s do Brasil</a></li>
<li><a href="../ru/Macro_Snip.html" class="mw-pt-progress mw-pt-progress--complete" title="&#1052;&#1072;&#1082;&#1088;&#1086;&#1089; Snip (&#1054;&#1073;&#1088;&#1077;&#1079;&#1072;&#1090;&#1100;) (88% translated)" lang="ru" dir="ltr">&#1088;&#1091;&#1089;&#1089;&#1082;&#1080;&#1081;</a></li></ul></div>
<div class="mw-translate-fuzzy">
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../index.php?title=Snip.png&amp;filetimestamp=20190803232007&amp;.html" class="mw-file-description"><img src="../File/Snip.png" decoding="async" width="32" height="31"></a></span><span> </span>
Macro Snip
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Utilisez cette macro pour poster facilement des captures d&rsquo;&eacute;cran sur le forum FreeCAD.<br>Il est pr&eacute;f&eacute;rable d&rsquo;ajouter cette macro &agrave; votre barre d&rsquo;outils de macros personnalis&eacute;es globales pour un acc&egrave;s rapide et facile.<br>Lors de la publication sur le forum FreeCAD, il est souvent utile d'&ecirc;tre en mesure d'inclure des captures d'&eacute;cran. Le probl&egrave;me est que c'est une t&acirc;che un peu fastidieuse. Cette macro facilite un peu la t&acirc;che.<br>La macro peut prendre des captures d&rsquo;&eacute;cran ou utiliser des captures d&rsquo;&eacute;cran existantes d&eacute;j&agrave; copi&eacute;es dans le Presse-papiers du syst&egrave;me. Pour ignorer l'image d&eacute;j&agrave; dans le presse-papiers, appuyez sur la touche Maj tout en appelant la macro. Pour utiliser la macro afin de prendre la capture d'&eacute;cran, ajustez la taille et l'emplacement de la bo&icirc;te de dialogue qui appara&icirc;t, puis cliquez sur OK. En cliquant sur OK, la macro tentera de prendre une capture d'&eacute;cran de la zone de l'&eacute;cran couverte par la bo&icirc;te de dialogue. La bo&icirc;te de dialogue elle-m&ecirc;me est semi-transparente, vous pouvez donc voir le contenu ci-dessous.<br><br>Version macro&nbsp;: 1.3<br>Date derni&egrave;re modification&nbsp;: 2024.07.23<br>Version FreeCAD&nbsp;: Toutes<br>T&eacute;l&eacute;chargement&nbsp;: <a rel="nofollow" class="external text" href="https://wiki.freecadweb.org/images/a/a0/Snip.png">Ic&ocirc;ne de la barre d'outils</a><br>Auteur: TheMarkster<br>
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../index.php?title=User;TheMarkster&amp;action=edit&amp;redlink=1.html" class="new" title="User:TheMarkster (page does not exist)">TheMarkster</a>
</td></tr>
<tr>
<th class="ctOdd">T&eacute;l&eacute;chargement
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://wiki.freecadweb.org/images/a/a0/Snip.png">Ic&ocirc;ne de la barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../fr/Macros_recipes.html" title="Macros recipes/fr">Page des macros</a><br><a href="../fr/How_to_install_macros.html" title="How to install macros/fr">Comment installer une macro</a><br><a href="../fr/Customize_Toolbars.html" title="Customize Toolbars/fr">Comment cr&eacute;er une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version Macro
</th></tr>
<tr>
<td class="ctEven macro-version">1.3
</td></tr>
<tr>
<th class="ctOdd">Derni&egrave;re modification
</th></tr>
<tr>
<td class="ctEven macro-date">2024.07.23
</td></tr>
<tr>
<th class="ctOdd">Version(s) FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">Toutes
</td></tr>
<tr>
<th class="ctOdd">Raccourci clavier
</th></tr>
<tr>
<td class="ctEven">Windows&nbsp;: touche Windows + Shift + S<br>
<p>Mac&nbsp;: Command + Shift + 4<br>
Linux&nbsp;: utilitaire gnome-screenshot<br>
</p>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><a href="../fr/Macro_Copy3DViewToClipboard.html" title="Macro Copy3DViewToClipboard/fr">Macro Copy3DViewToClipboard</a>, <a href="../fr/Macro_Screen_Wiki.html" title="Macro Screen Wiki/fr">Macro Screen Wiki</a>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
</div>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<div class="mw-translate-fuzzy">
<p>Utilisez cette macro pour poster facilement des captures d&rsquo;&eacute;cran sur le <a rel="nofollow" class="external text" href="https://forum.freecadweb.org">forum FreeCAD</a>.
</p>
</div>
<p>Il est pr&eacute;f&eacute;rable d&rsquo;ajouter cette macro &agrave; votre barre d&rsquo;outils de macros personnalis&eacute;es globales pour un acc&egrave;s rapide et facile.
</p><p>Lorsque vous postez un message sur le forum FreeCAD, il est souvent utile de pouvoir inclure des captures d'&eacute;cran. Le probl&egrave;me est que cette t&acirc;che est quelque peu fastidieuse. Cette macro vise donc &agrave; rendre cette t&acirc;che un peu plus facile.
</p><p><span id="Usage"></span>
</p>
<h2><span class="mw-headline" id="Utilisation">Utilisation</span></h2>
<p>La macro peut prendre des captures d&rsquo;&eacute;cran ou utiliser des captures d&rsquo;&eacute;cran existantes d&eacute;j&agrave; copi&eacute;es dans le Presse-papiers du syst&egrave;me. Pour ignorer l'image d&eacute;j&agrave; dans le presse-papiers, appuyez sur la touche <span style="background: #f9f9f9; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); border: 1px solid #888888; border-radius: 0.3em; padding: 0px 5px 1px 5px;">Maj</span> tout en appelant la macro. Pour utiliser la macro afin de prendre la capture d'&eacute;cran, ajustez la taille et l'emplacement de la bo&icirc;te de dialogue qui appara&icirc;t, puis cliquez sur <span style="background: #f5f5f5; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); border: 2px solid #989898; border-radius: 0.4em; padding: 0px 10px 1px 10px; font-weight:normal;">OK</span>. En cliquant sur <span style="background: #f5f5f5; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); border: 2px solid #989898; border-radius: 0.4em; padding: 0px 10px 1px 10px; font-weight:normal;">OK</span>, la macro tentera de prendre une capture d'&eacute;cran de la zone de l'&eacute;cran couverte par la bo&icirc;te de dialogue. La bo&icirc;te de dialogue elle-m&ecirc;me est semi-transparente, vous pouvez donc voir le contenu ci-dessous.
</p><p><span typeof="mw:File"><a href="../index.php?title=Snip-Screenshot1.png&amp;filetimestamp=20190804000200&amp;.html" class="mw-file-description"><img src="../File/Snip-Screenshot1.png" decoding="async" width="600" height="331"></a></span>
</p>
<p style="text-align:left; font-style:italic; width:800px; margin-left:1em; margin-right:1em;">Remarquez comment le dialogue est semi-transparent. Seul le contenu de l'&eacute;cran situ&eacute; sous la bo&icirc;te de dialogue sera captur&eacute;.</p>
<p>Apr&egrave;s avoir cliqu&eacute; sur <span style="background: #f5f5f5; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); border: 2px solid #989898; border-radius: 0.4em; padding: 0px 10px 1px 10px; font-weight:normal;">OK</span>, la macro prend ensuite la capture d'&eacute;cran et l'enregistre dans un fichier temporaire. Une bo&icirc;te de dialogue d&rsquo;ouverture de fichier s&rsquo;ouvre alors &agrave; l&rsquo;emplacement du fichier. Vous pouvez glisser-d&eacute;poser le fichier de l&agrave; vers le forum dans la zone de texte o&ugrave; vous tapez le texte de votre message. Lors de l'annulation de la bo&icirc;te de dialogue, le fichier de capture d'&eacute;cran temporaire est automatiquement supprim&eacute;. Vous pouvez &eacute;galement ouvrir le fichier de capture d'&eacute;cran dans votre application par d&eacute;faut install&eacute;e pour ouvrir les fichiers <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">.png</span> (sous Windows, il s&rsquo;agit g&eacute;n&eacute;ralement de Paint). Cela peut &ecirc;tre utile si vous souhaitez ajouter des annotations &agrave; la capture d'&eacute;cran ou &eacute;ventuellement des modifications suppl&eacute;mentaires, telles que le rognage.
</p><p><span typeof="mw:File"><a href="../index.php?title=Snip-Screenshot2.png&amp;filetimestamp=20190804000814&amp;.html" class="mw-file-description"><img src="../File/Snip-Screenshot2.png" decoding="async" width="600" height="389"></a></span>
</p>
<p style="text-align:left; font-style:italic; width:800px; margin-left:1em; margin-right:1em;">Ceci est la bo&icirc;te de dialogue d'ouverture de fichier qui appara&icirc;t automatiquement apr&egrave;s la capture d'&eacute;cran. L'image peut &ecirc;tre gliss&eacute;e et d&eacute;pos&eacute;e sur le forum ou elle peut &ecirc;tre ouverte pour un traitement ult&eacute;rieur dans votre application syst&egrave;me par d&eacute;faut pour l'ouverture de fichiers png. Vous pouvez &eacute;galement cliquer sur l'image avec le bouton droit de la souris et l'ouvrir <span style="background: #f9f9f9; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); border: 1px solid #888888; border-radius: 0.3em; padding: 0px 5px 1px 5px;">Open with..</span> avec une autre application de votre choix.</p>
<p>Si la macro ne fonctionne pas sur votre syst&egrave;me pour capturer des captures d'&eacute;cran, elle peut n&eacute;anmoins &ecirc;tre utile pour les captures d'&eacute;cran que vous avez r&eacute;alis&eacute;es &agrave; l'aide d'autres outils. Il suffit de copier la capture d'&eacute;cran dans le presse-papiers, puis d'ex&eacute;cuter la macro. Elle cr&eacute;era le fichier temporaire et ouvrira le r&eacute;pertoire du fichier dans une bo&icirc;te de dialogue d'ouverture de fichier pour vous. Quelques autres outils pour r&eacute;aliser des captures d'&eacute;cran&nbsp;:
</p>
<dl><dd>Sur Windows&nbsp;: touche Windows + <span style="background: #f9f9f9; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); border: 1px solid #888888; border-radius: 0.3em; padding: 0px 5px 1px 5px;">Shift</span> + <span style="background: #f9f9f9; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); border: 1px solid #888888; border-radius: 0.3em; padding: 0px 5px 1px 5px;">S</span></dd>
<dd>Sur Mac&nbsp;: <span style="background: #f9f9f9; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); border: 1px solid #888888; border-radius: 0.3em; padding: 0px 5px 1px 5px;">Command</span> + <span style="background: #f9f9f9; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); border: 1px solid #888888; border-radius: 0.3em; padding: 0px 5px 1px 5px;">Shift</span> + <span style="background: #f9f9f9; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); border: 1px solid #888888; border-radius: 0.3em; padding: 0px 5px 1px 5px;">4</span></dd>
<dd>Sur Linux&nbsp;: utilitaire gnome-screenshot</dd></dl>
<p><span id="Parameters"></span>
</p>
<h2><span id="Param.C3.A8tres"></span><span class="mw-headline" id="Param&egrave;tres">Param&egrave;tres</span></h2>
<p>La macro prend en charge les param&egrave;tres utilisateur qui peuvent &ecirc;tre d&eacute;finis &agrave; l'aide de <b>Outils &rarr; Editer param&egrave;tres... &rarr; Plugins &rarr; Snip_Macro</b>
</p>
<dl><dd><code>LastX</code>, <code>LastY</code>, <code>LastWidth</code>, <code>LastHeight</code>&nbsp;: emplacement et taille de la derni&egrave;re utilisation de la zone de capture</dd>
<dd><code>WindowOpacity</code> (0.85): une valeur entre 0,0 (moins opaque) et 1,0 (plus opaque)</dd>
<dd><code>SnipDelay</code> (0.5)&nbsp;: d&eacute;lai (en secondes) entre la fermeture de la zone de capture et la capture</dd>
<dd><code>DesiredWidth</code> (0)&nbsp;: largeur souhait&eacute;e (en pixels), ignor&eacute;e si 0 -- redimensionne l'image &agrave; votre convenance en conservant le rapport hauteur/largeur actuel</dd>
<dd><code>ScaleFactor</code> (1.0)&nbsp;: facteur d'&eacute;chelle souhait&eacute;, (remplace DesiredWidth si ScaleFactor n'est pas 1.0) -- met l'image &agrave; l'&eacute;chelle au facteur d'&eacute;chelle</dd></dl>
<p>Les param&egrave;tres <code>Last</code> sont r&eacute;initialis&eacute;s par la macro &agrave; chaque fois qu'elle est ex&eacute;cut&eacute;e. C'est ainsi qu'elle garde la trace de l'endroit o&ugrave; placer la bo&icirc;te de s&eacute;lection, &agrave; la derni&egrave;re position qu'elle avait quand l'utilisateur a pris une capture d'&eacute;cran.
</p><p>Le param&egrave;tre <code>WindowOpacity</code> est l'opacit&eacute; de la zone de capture.
</p><p>Le param&egrave;tre <code>SnipDelay</code> peut &ecirc;tre ajust&eacute; pour acc&eacute;l&eacute;rer un peu les choses mais si la valeur est trop petite, la capture d'&eacute;cran prise peut inclure la bo&icirc;te snip elle-m&ecirc;me. Il faut un certain temps pour fermer la fen&ecirc;tre de dialogue avant de prendre le capture d'&eacute;cran.
</p><p>Le param&egrave;tre <code>DesiredWidth</code> met l'image &agrave; l'&eacute;chelle &agrave; la largeur souhait&eacute;e, sauf s'il est &eacute;gal &agrave; 0 (valeur par d&eacute;faut), auquel cas aucune mise &agrave; l'&eacute;chelle n'est effectu&eacute;e. Par exemple, si vous d&eacute;finissez la largeur souhait&eacute;e sur 800, vous obtiendrez des images d'une largeur de 800 pixels. La hauteur sera automatiquement mise &agrave; l'&eacute;chelle pour conserver le rapport hauteur/largeur actuel. Si l'image d'origine &eacute;tait de 1600x1200 et que la largeur d&eacute;sir&eacute;e est de 800, l'image r&eacute;sultante sera de 800x600.
</p><p>Le param&egrave;tre <code>ScaleFactor</code> met l'image &agrave; l'&eacute;chelle selon le rapport souhait&eacute;, par ex. 0.5. La valeur par d&eacute;faut est 1.0, auquel cas aucune mise &agrave; l'&eacute;chelle n'est effectu&eacute;e. Cela remplace le param&egrave;tre DesiredWidth si ScaleFactor n'est pas 1.0.
</p><p>Vous pouvez contourner toute mise &agrave; l'&eacute;chelle en maintenant la touche Ctrl enfonc&eacute;e tout en cliquant sur le bouton OK pour prendre la capture d'&eacute;cran.
</p>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<p>Ic&ocirc;ne de la barre d'outils <span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=Snip.png&amp;filetimestamp=20190803232007&amp;.html" class="mw-file-description"><img src="../File/Snip.png" decoding="async" width="44" height="42"></a></span>
</p><p><b>Macro_Snip.FCMacro</b>
</p>
<pre># -*- coding: utf-8 -*-
"""
***************************************************************************
*   Copyright (c) 2019 &lt;TheMarkster&gt;                                      *
*                                                                         *
*   This file is a supplement to the FreeCAD CAx development system.      *
*                                                                         *
*   This program is free software; you can redistribute it and/or modify  *
*   it under the terms of the GNU Lesser General Public License (LGPL)    *
*   as published by the Free Software Foundation; either version 2 of     *
*   the License, or (at your option) any later version.                   *
*                                                                         *
*   This software is distributed in the hope that it will be useful,      *
*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the          *
*   GNU Library General Public License at http://www.gnu.org/licenses     *
*   for more details.                                                     *
*                                                                         *
*   For more information about the GNU Library General Public License     *
*   write to the Free Software Foundation, Inc., 59 Temple Place,         *
*   Suite 330, Boston, MA  02111-1307 USA                                 *
*                                                                         *
***************************************************************************
"""



"""
Snip Macro

This is a macro to make it easier to post screenshots to the FreeCAD forum.

The forum supports a drag and drop interface -- just drag and drop an image to the
textarea where you type in your post. But it still requires many
tedious steps. This macro is to reduce some of those steps.

You should add the macro to your custom macro toolbar to save as many clicks as possible.

The first thing the macro does is to check if there is an image already saved to the
system clipboard, and if so, it uses that one. To bypass the clipboard, press Shift
while invoking the macro.

"""

__title__ = "Snip"
__author__ = "TheMarkster"
__url__ = ""
__Wiki__ = ""
__date__ = "2024.07.23"
__version__ = 1.3
import FreeCAD
from PySide import QtGui,QtCore
import uuid
import time
import tempfile, os, shutil

# class SnipBox(QtGui.QDialog):
#     def __init__(self, scale, desired_width):
#         QtGui.QDialog.__init__(self)
#         self.scale = scale
#         self.desired_width = desired_width
#
#         self.detailsTextEdit = QtGui.QTextEdit("Details")
#         self.Details = QtGui.QPushButton("Details")
#         self.Scaling = QtGui.QPushButton("Scaling")
#         self.Details.clicked.connect(self.onDetailsClicked)
#         self.Scaling.clicked.connect(self.onScalingClicked)
#         layout = QtGui.QVBoxLayout()
#         layout.addWidget(self.detailsTextEdit)
#         layout.addStretch()
#         buttons = QtGui.QDialogButtonBox(
#             QtGui.QDialogButtonBox.Ok,
#             QtCore.Qt.Horizontal, self)
#         buttons.accepted.connect(self.accept)
#         buttons.rejected.connect(self.reject)
#         buttons.addButton(self.Details, QtGui.QDialogButtonBox.ActionRole)
#         buttons.addButton(self.Scaling, QtGui.QDialogButtonBox.ActionRole)
#         buttons.setCenterButtons(True)
#         layout.addWidget(buttons)
#         self.setLayout(layout)
#         self.detailsTextEdit.setVisible(False)
#
#     def setDetailedText(self, txt):
#         self.detailsTextEdit.setText(txt)
#
#     def setTitle(self, rectwidth, rectheight):
#         if self.scale&nbsp;!= 1.0:
#            out_width = rect.width()*scale_factor
#         elif self.desired_width&nbsp;!= 0:
#             out_width = desired_width
#         self.setWindowTitle(f"Snip macro v{__version__} {rectwidth} x {rectheight} output width {out_width}")
#
#
#     def onDetailsClicked(self):
#         self.detailsTextEdit.setVisible(not self.detailsTextEdit.isVisible())
#
#     def onScalingClicked(self):
#         pass
#
#     def event(self, e): #credit serge_gubenko of stackoverflow for this
#         result = QtGui.QDialog.event(self, e)
#         self.setMinimumHeight(0)
#         self.setMaximumHeight(16777215)
#         self.setMinimumWidth(0)
#         self.setMaximumWidth(16777215)
#         self.setSizePolicy(QtGui.QSizePolicy.Expanding, QtGui.QSizePolicy.Expanding)
#         textEdit = self.findChild(QtGui.QTextEdit)
#         if textEdit&nbsp;!= None&nbsp;:
#             textEdit.setMinimumHeight(0)
#             textEdit.setMaximumHeight(16777215)
#             textEdit.setMinimumWidth(0)
#             textEdit.setMaximumWidth(16777215)
#             textEdit.setSizePolicy(QtGui.QSizePolicy.Expanding, QtGui.QSizePolicy.Expanding)
# #thanks to mario52 for this
#         if result == True:
#             try:
#                 rect = mb.frameGeometry()
#                 rectwidth  = rect.width()
#                 rectheight = rect.height()
#                 mb.setTitle(rectwidth,rectheight)
#
#             except Exception:
#                 None
# ##############
#         return result
class SnipBox(QtGui.QDialog):
    def __init__(self, scale, desired_width):
        QtGui.QDialog.__init__(self)
        self.pg = FreeCAD.ParamGet("User parameter:Plugins/Snip_Macro")
        self.scale = scale
        self.desired_width = desired_width

        self.detailsTextEdit = QtGui.QTextEdit("Details")
        self.Details = QtGui.QPushButton("Details")
        self.Scaling = QtGui.QPushButton("Scaling")
        self.Details.clicked.connect(self.onDetailsClicked)
        self.Scaling.clicked.connect(self.onScalingClicked)

        layout = QtGui.QVBoxLayout()
        layout.addWidget(self.detailsTextEdit)
        layout.addStretch()

        # Scaling widgets
        self.scaleLabel = QtGui.QLabel("Scale:")
        self.scaleSpinBox = QtGui.QDoubleSpinBox()
        self.scaleSpinBox.setDecimals(2)
        self.scaleSpinBox.setSingleStep(0.1)
        self.scaleSpinBox.setValue(self.scale)
        self.scaleSpinBox.valueChanged.connect(self.updateScale)

        self.fixedWidthLabel = QtGui.QLabel("Fixed Width:")
        self.fixedWidthSpinBox = QtGui.QSpinBox()
        self.fixedWidthSpinBox.setRange(0, 10000)
        self.fixedWidthSpinBox.setValue(self.desired_width)
        self.fixedWidthSpinBox.valueChanged.connect(self.updateDesiredWidth)

        self.scaleLayout = QtGui.QVBoxLayout()
        self.scaleText = QtGui.QLabel("Scale values other than 1.0 will override fixed width setting")
        self.scaleLayout.addWidget(self.scaleText)
        scaleHBox1 = QtGui.QHBoxLayout()
        scaleHBox1.addWidget(self.scaleLabel)
        scaleHBox1.addWidget(self.scaleSpinBox)

        scaleHBox2 = QtGui.QHBoxLayout()
        scaleHBox2.addWidget(self.fixedWidthLabel)
        scaleHBox2.addWidget(self.fixedWidthSpinBox)

        self.scaleLayout.addLayout(scaleHBox1)
        self.scaleLayout.addLayout(scaleHBox2)

        self.scaleWidget = QtGui.QWidget()
        self.scaleWidget.setLayout(self.scaleLayout)
        self.scaleWidget.setVisible(False)

        layout.addWidget(self.scaleWidget)

        buttons = QtGui.QDialogButtonBox(
            QtGui.QDialogButtonBox.Ok,
            QtCore.Qt.Horizontal, self)
        buttons.accepted.connect(self.accept)
        buttons.rejected.connect(self.reject)
        buttons.addButton(self.Details, QtGui.QDialogButtonBox.ActionRole)
        buttons.addButton(self.Scaling, QtGui.QDialogButtonBox.ActionRole)
        buttons.setCenterButtons(True)
        layout.addWidget(buttons)
        self.setLayout(layout)
        self.detailsTextEdit.setVisible(False)

    def setDetailedText(self, txt):
        self.detailsTextEdit.setText(txt)

    def setTitle(self, rectwidth, rectheight):
        if self.scale&nbsp;!= 1.0:
            out_width = rectwidth * self.scale
        elif self.desired_width&nbsp;!= 0:
            out_width = self.desired_width
        self.setWindowTitle(f"Snip macro v{__version__} {rectwidth} x {rectheight} output width {out_width}")

    def onDetailsClicked(self):
        if self.scaleWidget.isVisible():
            self.scaleWidget.setVisible(False)
        self.detailsTextEdit.setVisible(not self.detailsTextEdit.isVisible())

    def onScalingClicked(self):
        if self.detailsTextEdit.isVisible():
            self.detailsTextEdit.setVisible(False)
        self.scaleWidget.setVisible(not self.scaleWidget.isVisible())

    def updateScale(self, value):
        self.scale = value
        self.pg.SetFloat("ScaleFactor", self.scale)

    def updateDesiredWidth(self, value):
        self.desired_width = value
        self.pg.SetInt("DesiredWidth", self.desired_width)

    def event(self, e): #credit serge_gubenko of stackoverflow for this
        result = QtGui.QDialog.event(self, e)
        self.setMinimumHeight(0)
        self.setMaximumHeight(16777215)
        self.setMinimumWidth(0)
        self.setMaximumWidth(16777215)
        self.setSizePolicy(QtGui.QSizePolicy.Expanding, QtGui.QSizePolicy.Expanding)
        textEdit = self.findChild(QtGui.QTextEdit)
        if textEdit&nbsp;!= None&nbsp;:
            textEdit.setMinimumHeight(0)
            textEdit.setMaximumHeight(16777215)
            textEdit.setMinimumWidth(0)
            textEdit.setMaximumWidth(16777215)
            textEdit.setSizePolicy(QtGui.QSizePolicy.Expanding, QtGui.QSizePolicy.Expanding)
#thanks to mario52 for this
        if result == True:
            try:
                rect = mb.frameGeometry()
                rectwidth  = rect.width()
                rectheight = rect.height()
                mb.setTitle(rectwidth,rectheight)
            except Exception:
                None
##############
        return result

def get_screen_for_widget(widget):
    screen_geometry = widget.geometry()
    for screen in QtGui.QApplication.screens():
        if screen.geometry().contains(screen_geometry.center()):
            return screen
def get_widget_screen_coordinates(widget):
    screen = get_screen_for_widget(widget)
    widget_geometry = widget.geometry()
    screen_geometry = screen.geometry()
    return QtCore.QRect(widget_geometry.x() - screen_geometry.x(),
                        widget_geometry.y() - screen_geometry.y(),
                        widget_geometry.width(),
                        widget_geometry.height())


pg = FreeCAD.ParamGet("User parameter:Plugins/Snip_Macro")
#parameters were originally in BaseApp, but should be in Plugins, so relocate if necessary
if FreeCAD.ParamGet("User parameter:BaseApp/Preferences").HasGroup("Snip_Macro"):
    deprecated = FreeCAD.ParamGet("User parameter:BaseApp/Preferences/Snip_Macro")
    pg.SetInt("LastX",deprecated.GetInt("LastX",0))
    pg.SetInt("LastY",deprecated.GetInt("LastY",0))
    pg.SetInt("LastWidth",deprecated.GetInt("LastWidth",0))
    pg.SetInt("LastHeight",deprecated.GetInt("LastHeight",0))
    pg.SetFloat("WindowOpacity",deprecated.GetFloat("WindowOpacity",0.85))
    pg.SetFloat("SnipDelay",deprecated.GetFloat("SnipDelay",0.5))
    FreeCAD.ParamGet("User parameter:BaseApp/Preferences").RemGroup("Snip_Macro")

desired_width = pg.GetInt("DesiredWidth",0) #used for scaling to desired width, maintaining aspect ratio
pg.SetInt("DesiredWidth", desired_width)
scale_factor = pg.GetFloat("ScaleFactor", 1.0) #scale by scale factor instead of desired width
pg.SetFloat("ScaleFactor", scale_factor)

skipClipboard = False
modifiers = QtGui.QApplication.keyboardModifiers()
if modifiers == QtCore.Qt.ShiftModifier:
    skipClipboard = True

userCanceled = False
fname = "Snip macro screenshot-"+str(uuid.uuid4())[:6]+".png"
image = None
if not skipClipboard:
    clip = QtGui.QClipboard()
    image = clip.image(QtGui.QClipboard.Clipboard)
if not image:

    #use our own screen grabber
    mb = SnipBox(scale_factor, desired_width)
    details = """
Move and resize this box to cover the part of the screen you wish to grab.
If it succeeds an open file dialog will appear. Drag and drop the file
from the open file dialog to the forum. The file will be deleted after
you close the dialog.

If this fails you can still use this macro to handle screenshots you
copied to the clipboard using other tools:

Windows snip tool: Window Key + Shift + S
Mac snip tool: Command + Shift + 4
Linux: gnome-screenshot utility

If the macro finds there is already an image copied to the clipboard
it uses that image instead of bringing up this dialog. Press Shift
while invoking this macro to bypass the clipboard. Alternatively,
you can clear the image from the clipboard by copying some text to it.

The Open button will open the file in the system
default application for handling png files, e.g. Paint in windows. This
can be useful if you wish to annotate the screenshot. But most of the
time you will simply want to drag and drop the file to the forum, then
Cancel to close the open file dialog afterwards.

If you wish to open the screenshot file with another application, right-click
the file and select open with... option or drag/drop to that other application.

User Parameters: These can be accessed via Tools menu -&gt; Edit Parameters in
Plugins -&gt; Snip_Macro:

LastX, LastY, LastWidth, LastHeight -- location and size of snip box last use
WindowOpacity (0.85) -- value between 0.0 (less opaque) and 1.0 (more opaque)
SnipDelay (0.5) -- time (in seconds) delay between snip box close and snip
DesiredWidth -- image will be scaled to this width (unless it is 0) maintaining
current aspect ratio.
ScaleFactor -- float value, e.g. 0.5 -- image will be scaled to that scale factor.
Note: ScaleFactor (if not 1.0) will take precedence over DesiredWidth
Hold down Ctrl key to ignore scaling.

The SnipDelay parameter can be adjusted to speed things up a bit, but if it
is too small the screenshot taken might include the snip box itself because
we need to wait for it to close before taking the screenshot.

"""
   # mb.setWindowTitle("Snip macro v"+str(__version__))
    mb.setDetailedText(details)
    if pg.GetFloat("WindowOpacity",0.85) == 0.85:
        pg.SetFloat("WindowOpacity",0.85)
    mb.setWindowOpacity(pg.GetFloat("WindowOpacity",0.85))
    lastX = pg.GetInt("LastX",0)
    lastY = pg.GetInt("LastY",0)
    lastWidth = pg.GetInt("LastWidth",100)
    lastHeight = pg.GetInt("LastHeight",100)
    mb.setGeometry(lastX, lastY, lastWidth, lastHeight)
    mb.resize(lastWidth, lastHeight)
    mb.setWindowFlags(QtCore.Qt.Tool)
    result = mb.exec_()
    if not result:
        userCanceled = True
    if not userCanceled:
        clientRect = mb.geometry()
        scale_factor = mb.scale
        desired_width = mb.desired_width
        rect = get_widget_screen_coordinates(mb)
        diff = rect.height()-clientRect.height()
        pg.SetInt("LastX", rect.x())
        pg.SetInt("LastY", rect.y())
        pg.SetInt("LastWidth", rect.width())
        pg.SetInt("LastHeight", rect.height()-diff)
        QtGui.QApplication.processEvents()
        snipDelay = pg.GetFloat("SnipDelay", 0.5)
        if snipDelay == 0.5:
            pg.SetFloat("SnipDelay", 0.5)
        time.sleep(snipDelay) #give time for dialog to close before taking screenshot
        QtGui.QApplication.processEvents()
        if hasattr(QtGui.QApplication,"primaryScreen"):
            #screen = QtGui.QApplication.primaryScreen()
            screen = get_screen_for_widget(mb)
            image = screen.grabWindow(0,rect.x(),rect.y(),rect.width(),rect.height()).toImage()
        else:
            long_qdesktop_id = QtGui.QApplication.desktop().winId()
            image = QtGui.QPixmap.grabWindow(long_qdesktop_id, rect.x(), rect.y(), rect.width(), rect.height()).toImage()
        if not image:
            raise Exception("Snip Macro Error: Unable to grab screen image\n")
        modifiers = QtGui.QApplication.keyboardModifiers()
        skipScaling = False
        if modifiers == QtCore.Qt.ControlModifier:
            skipScaling = True
        if not skipScaling:
            if scale_factor&nbsp;!= 1.0:
                image = image.smoothScaled(rect.width()*scale_factor, rect.height()*scale_factor)
            elif desired_width&nbsp;!= 0:
                image = image.smoothScaled(desired_width, rect.height()*float(desired_width)/float(rect.width()))

if not userCanceled:
    dirPath = tempfile.mkdtemp()
    filePath = dirPath + os.path.sep + fname
    image.save(filePath)
    fileName = QtGui.QFileDialog.getOpenFileName(QtGui.QApplication.activeWindow(),
    "Drag the image to the forum, then Cancel will delete the temporary file", dirPath, "PNG (*.png)")
    if fileName[0]:  #user selected Open or double-clicked file
        import subprocess, os, platform
        if platform.system() == 'Darwin':       # macOS
            subprocess.call(('open', fileName[0]))
        elif platform.system() == 'Windows':    # Windows
            os.startfile(fileName[0])
        else:                                   # linux variants
            subprocess.call(('xdg-open', fileName[0]))
        QtGui.QApplication.processEvents() #allow some time for file to open before deleting temp folder and contents
        time.sleep(1)
        QtGui.QApplication.processEvents()
    shutil.rmtree(dirPath)</pre>
<p><span id="Link"></span>
</p>
<h2><span class="mw-headline" id="Lien">Lien</span></h2>
<div class="mw-translate-fuzzy">
<p>La discussion sur le forum <a rel="nofollow" class="external text" href="https://forum.freecadweb.org/viewtopic.php?f=9&amp;t=38328&amp;sid=385bf3174dcae7fb8bdf529f4e76dfed">Snip macro</a>
</p>
</div>
<!-- 
NewPP limit report
Cached time: 20250705230135
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc, no&#8208;toc&#8208;conversion]
CPU time usage: 0.062 seconds
Real time usage: 0.098 seconds
Preprocessor visited node count: 283/1000000
Post&#8208;expand include size: 8569/2097152 bytes
Template argument size: 20060/2097152 bytes
Highest expansion depth: 6/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 18601/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   20.271      1 -total
 20.80%    4.216      1 Template:Macro/fr
 16.28%    3.300      1 Template:FileName
 10.08%    2.043      7 Template:KEY
  9.83%    1.992      3 Template:Button
  9.69%    1.964      2 Template:Caption
  8.80%    1.785      1 Template:MacroCode
  8.56%    1.734     13 Template:Incode
  7.61%    1.543      1 Template:MenuCommand
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:156063-0!canonical and timestamp 20250705230135 and revision id 1604790. Rendering was triggered because: edit-page
 -->
</div>
</div><script src="../site.js"></script>