<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro StraightenObject/fr</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="fr" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Macro+StraightenObject&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><a href="../Macro_StraightenObject.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro StraightenObject (100% translated)" lang="en" dir="ltr">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--high" lang="fr" dir="ltr">fran&ccedil;ais</span></li>
<li><a href="../it/Macro_StraightenObject.html" class="mw-pt-progress mw-pt-progress--med" title="Macro StraightenObject (68% translated)" lang="it" dir="ltr">italiano</a></li>
<li><a href="../pl/Macro_StraightenObject.html" class="mw-pt-progress mw-pt-progress--low" title="Makrodefinicja: Wyprostuj obiekt (5% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<div class="mw-translate-fuzzy">
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../index.php?title=Macro_StraightenObject.png&amp;filetimestamp=20190713152556&amp;.html" class="mw-file-description"><img src="../File/Macro_StraightenObject.png" decoding="async" width="32" height="32" class="mw-file-element"></a></span><span> </span>
StraightenObject
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Cette macro aligne un objet avec le syst&egrave;me de coordonn&eacute;es FC en fonction des &eacute;l&eacute;ments de r&eacute;f&eacute;rence (face/ar&ecirc;te)<br>Cette macro a &eacute;t&eacute; &eacute;crite principalement pour r&eacute;aligner les objets import&eacute;s (par exemple, STEP) avec les principaux plans / axes de FreeCAD.<br>utilisez la macro, s&eacute;lectionnez le ou les &eacute;l&eacute;ments de r&eacute;f&eacute;rence, &eacute;ventuellement d'autres objets, puis ex&eacute;cutez la macro. Si vous souhaitez aligner votre objet avec un autre plan/axe, utilisez la macro puis la fonction Transformer de FreeCAD.
<p>Voir le chapitre "D&eacute;tails" pour la s&eacute;lection multi-objets.<br><br>Version macro&nbsp;: 0.8<br>Date derni&egrave;re modification&nbsp;: 2019-06-10<br>Version FreeCAD&nbsp;: 0.17+<br>T&eacute;l&eacute;chargement&nbsp;: <a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/c/c9/Macro_StraightenObject.png">Ic&ocirc;ne de la barre d'outils</a><br>Auteur: OpenBrain<br>
</p>
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../index.php?title=User;OpenBrain&amp;action=edit&amp;redlink=1.html" class="new" title="User:OpenBrain (page does not exist)">OpenBrain</a>
</td></tr>
<tr>
<th class="ctOdd">T&eacute;l&eacute;chargement
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/c/c9/Macro_StraightenObject.png">Ic&ocirc;ne de la barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../fr/Macros_recipes.html" title="Macros recipes/fr">Page des macros</a><br><a href="../fr/How_to_install_macros.html" title="How to install macros/fr">Comment installer une macro</a><br><a href="../fr/Customize_Toolbars.html" title="Customize Toolbars/fr">Comment cr&eacute;er une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version Macro
</th></tr>
<tr>
<td class="ctEven macro-version">0.8
</td></tr>
<tr>
<th class="ctOdd">Derni&egrave;re modification
</th></tr>
<tr>
<td class="ctEven macro-date">2019-06-10
</td></tr>
<tr>
<th class="ctOdd">Version(s) FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">0.17+
</td></tr>
<tr>
<th class="ctOdd">Raccourci clavier
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><a href="../fr/Macro_PlacementAbsolufy.html" title="Macro PlacementAbsolufy/fr">Macro PlacementAbsolufy</a> <span typeof="mw:File"><a href="../index.php?title=Macro_PlacementAbsolufy.png&amp;filetimestamp=20190713150005&amp;.html" class="mw-file-description"><img src="../File/Macro_PlacementAbsolufy.png" decoding="async" width="24" height="24" class="mw-file-element"></a></span>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
</div>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p><span id="Context"></span>
</p>
<h3><span class="mw-headline" id="Contexte">Contexte</span></h3>
<p>Cette macro a &eacute;t&eacute; &eacute;crite principalement pour r&eacute;aligner les objets import&eacute;s (par exemple STEP) avec les principaux plans/axes de FreeCAD.
</p><p><span id="Usage"></span>
</p>
<h2><span class="mw-headline" id="Utilisation">Utilisation</span></h2>
<p>Fonctionnellement, la macro utilisera un ou les deux &eacute;l&eacute;ments de r&eacute;f&eacute;rence suivants pour redresser (faire pivoter et d&eacute;placer) le ou les objets:
</p>
<ul><li>Face: la face s&eacute;lectionn&eacute;e sera d&eacute;finie coplanaire avec le plan XY, sa masse centrale &eacute;tant d&eacute;finie &agrave; l'origine</li>
<li>Ar&ecirc;te (ou 2 sommets): l'ar&ecirc;te s&eacute;lectionn&eacute;e sera align&eacute;e avec l'axe Y</li></ul>
<div class="mw-translate-fuzzy">
<p>Pour utiliser la macro, s&eacute;lectionnez le ou les &eacute;l&eacute;ments de r&eacute;f&eacute;rence, &eacute;ventuellement d'autres objets, puis ex&eacute;cutez la macro.
Si vous souhaitez aligner votre objet avec un autre plan/axe, utilisez la macro puis la fonction Transformer de FreeCAD.
Voir le chapitre "D&eacute;tails" pour la s&eacute;lection multi-objets.
</p>
</div>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<div class="mw-translate-fuzzy">
<p>La macro est disponible via le <a href="../fr/Std_AddonMgr.html" title="Std AddonMgr/fr">gestionnaire des extensions</a>. Le code est fourni sur cette page pour plus de commodit&eacute; au cas o&ugrave; le syst&egrave;me utilisateur n'aurait pas git-python. Bien qu'elle soit &agrave; jour, la derni&egrave;re version est toujours disponible sur <a rel="nofollow" class="external text" href="https://github.com/FreeCAD/FreeCAD-macros/blob/master/Utility/StraightenObject.FCMacro">FreeCAD-macro repository</a>
</p>
</div>
<div class="mw-translate-fuzzy">
<p>Pour des explications plus d&eacute;taill&eacute;es, consultez la page <a href="../fr/How_to_install_macros.html" title="How to install macros/fr">Comment installer les macros</a>.
</p>
</div>
<p><span id="Details"></span>
</p>
<h2><span id="D.C3.A9tails"></span><span class="mw-headline" id="D&eacute;tails">D&eacute;tails</span></h2>
<p>Ci-dessous un tableau pr&eacute;sentant les diff&eacute;rents cas trait&eacute;s par la macro:
</p>
<table class="wikitable">
<tbody><tr>
<th>Premier(s) objet(s) s&eacute;lectionn&eacute;(s)</th>
<th>Objet(s) s&eacute;lectionn&eacute;(s) ult&eacute;rieurement Comportement des macros
</th></tr>
<tr>
<td>Une face de r&eacute;f&eacute;rence</td>
<td>Tout (facultatif)</td>
<td>Le premier objet est tourn&eacute;/d&eacute;plac&eacute; de sorte que la face de r&eacute;f&eacute;rence se trouve sur le plan XY, son centre de masse &eacute;tant &agrave; l'origine. Les autres objets s&eacute;lectionn&eacute;s subissent le m&ecirc;me mouvement que le premier objet
</td></tr>
<tr>
<td>Une ar&ecirc;te de r&eacute;f&eacute;rence (ou 2 sommets de r&eacute;f&eacute;rence)</td>
<td>Tout (facultatif)</td>
<td>Le premier objet est tourn&eacute; autour de son centre de masse de sorte que le bord de r&eacute;f&eacute;rence soit parall&egrave;le &agrave; l'axe Y (aucun d&eacute;calage n'est appliqu&eacute;). Les autres objets s&eacute;lectionn&eacute;s subissent le m&ecirc;me mouvement que le premier objet
</td></tr>
<tr>
<td>Une face de r&eacute;f&eacute;rence + une ar&ecirc;te de r&eacute;f&eacute;rence (ou 2 sommets de r&eacute;f&eacute;rence)</td>
<td>Tout (facultatif)</td>
<td>Le premier objet est tourn&eacute; / d&eacute;plac&eacute; de sorte que la face de r&eacute;f&eacute;rence se trouve sur le plan XY (son centre de masse &eacute;tant &agrave; l'origine) et le bord de r&eacute;f&eacute;rence est parall&egrave;le &agrave; l'axe Y. Les autres objets s&eacute;lectionn&eacute;s subissent le m&ecirc;me mouvement que le premier objet
</td></tr>
<tr>
<td>2+ visages + tout</td>
<td>Tout (facultatif)</td>
<td>La macro &eacute;choue
</td></tr>
<tr>
<td>2+ ar&ecirc;tes (ou 3+ sommets) + tout</td>
<td>Tout (facultatif)</td>
<td>La macro &eacute;choue
</td></tr>
<tr>
<td>Toute autre combinaison</td>
<td>Tout (facultatif)</td>
<td>La macro &eacute;choue
</td></tr></tbody></table>
<p>La macro effectuera les v&eacute;rifications suivantes:
</p>
<ul><li>Si la face de r&eacute;f&eacute;rence est perpendiculaire au bord de r&eacute;f&eacute;rence, ce dernier sera ignor&eacute; (notification d'avertissement dans la barre d'&eacute;tat)</li>
<li>Si le visage de r&eacute;f&eacute;rence n'est pas plat, un r&eacute;sultat &eacute;trange peut se produire (notification d'avertissement dans la barre d'&eacute;tat)</li></ul>
<p>Lorsque vous s&eacute;lectionnez plusieurs objets, la macro proposera 2 options pour appliquer le redressement:
</p>
<ul><li>Parent: la macro essaiera de trouver un parent commun &agrave; tous les objets s&eacute;lectionn&eacute;s:
<ul><li>Si personne n'est trouv&eacute;, la macro &eacute;choue avec une notification d'erreur dans la barre d'&eacute;tat</li>
<li>Si un ou plusieurs sont trouv&eacute;s, la transformation est appliqu&eacute;e sur la hi&eacute;rarchiquement inf&eacute;rieure</li></ul></li>
<li>Multiple: la transformation est appliqu&eacute;e s&eacute;par&eacute;ment sur chaque objet s&eacute;lectionn&eacute;</li></ul>
<p>&Agrave; compl&eacute;ter avec un exemple d'image
</p>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<h3><span class="mw-headline" id="Limitations">Limitations</span></h3>
<div class="mw-translate-fuzzy">
<ul><li>Les &eacute;l&eacute;ments de r&eacute;f&eacute;rence doivent tous appartenir au premier objet s&eacute;lectionn&eacute;. Les &eacute;l&eacute;ments de r&eacute;f&eacute;rence parmi plusieurs objets ne sont pas pris en charge pour le moment</li>
<li>Les objets redress&eacute;s doivent &ecirc;tre dans un syst&egrave;me de coordonn&eacute;es correspondant &agrave; celui global. Si vous avez utilis&eacute; des conteneurs de pi&egrave;ces pour localiser vos objets, vous devez d'abord utiliser <a href="../fr/Macro_PlacementAbsolufy.html" title="Macro PlacementAbsolufy/fr">Macro PlacementAbsolufy</a> <span typeof="mw:File"><a href="../index.php?title=Macro_PlacementAbsolufy.png&amp;filetimestamp=20190713150005&amp;.html" class="mw-file-description"><img src="../File/Macro_PlacementAbsolufy.png" decoding="async" width="24" height="24" class="mw-file-element"></a></span> sur votre mod&egrave;le. Si cette condition n'est pas remplie, des choses &eacute;tranges peuvent se produire.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>ToolBar Icon <span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=Macro_StraightenObject.png&amp;filetimestamp=20190713152556&amp;.html" class="mw-file-description"><img src="../File/Macro_StraightenObject.png" decoding="async" width="64" height="64" class="mw-file-element"></a></span>
</p>
</div>
<p><b>Macro_StraightenObject.FCMacro</b>
</p>
<pre>#!/usr/bin/python
#####################################
# Copyright (c) openBrain 2019
# Licensed under LGPL v2
#
# This FreeCAD macro will straighten an object vs. root origin based on a selected face or/and a selected edge (or 2 selected vertices)
# * If only a face is selected -&gt; Center of mass of the face is set at origin, and normal to face at this same point is aligned with Z axis
# * If only an edge is selected (or 2 vertices) -&gt; Object is rotated around Z axis (centered at the bounding box center) so that the virtual line between the 2 edge endpoints (or between the 2 vertices) is aligned with X axis
# * If both a face and an edge (or 2 vertices) are selected, both previous effects are applied (at the difference that the Z rotation in centered on the face center of mass)
#
# Selected reference items shall belong to the same object
#
# Main use of the macro is to re-align imported objects with the FreeCAD origin
#
# Version history&nbsp;:
# *0.8&nbsp;: some typo improvement + commenting for official PR
# *0.75&nbsp;: adding transaction for correct undo management
# *0.7&nbsp;: multiple objects support (LIMITATION&nbsp;: reference items shall all belong to first object)(LIMITATION&nbsp;: unexpected results may happen if selected objects are in different coordinate systems)
# *0.6&nbsp;: change way of reaching PartDesign Body, older has trouble with objects contained in a part
# *0.51&nbsp;: change reference face alignment so it is considered a bottom face rather than a top one
# *0.5&nbsp;: beta release
#
#####################################

__Name__ = 'StraigthenObject'
__Comment__ = 'Straighten an object by a face and/or an edge (or 2 vertices)'
__Author__ = 'openBrain'
__Version__ = '0.8'
__Date__ = '2019-06-10'
__License__ = 'LGPL v2'
__Web__ = 'https://wiki.freecad.org/Macro_StraightenObject'
__Wiki__ = 'https://wiki.freecad.org/Macro_StraightenObject'
__Icon__ = ''
__Help__ = 'Select face and/or edge to guide object straightening then run the macro'
__Status__ = 'Beta'
__Requires__ = 'FreeCAD &gt;= 0.17'
__Communication__ = 'https://forum.freecad.org/viewtopic.php?f=22&amp;t=35191'

__dbg__ = False #True for debugging

from PySide import QtGui

def cslM(msg):
    FreeCAD.Console.PrintMessage('\n')
    FreeCAD.Console.PrintMessage(msg)

def cslW(msg):
    FreeCAD.Console.PrintMessage('\n')
    FreeCAD.Console.PrintWarning(msg)

def cslE(msg):
    FreeCAD.Console.PrintMessage('\n')
    FreeCAD.Console.PrintError(msg)

def cslD(msg):
    if __dbg__:
        FreeCAD.Console.PrintMessage('\n')
        FreeCAD.Console.PrintMessage("Debug&nbsp;: " + str(msg))

_0Vec_ = FreeCAD.Vector(0, 0, 0)
_XVec_ = FreeCAD.Vector(1, 0, 0)
_YVec_ = FreeCAD.Vector(0, 1, 0)
_ZVec_ = FreeCAD.Vector(0, 0, 1)

if __dbg__:  ##Clear report view in debug mode
    FreeCADGui.getMainWindow().findChild(QtGui.QTextEdit, "Report view").clear()

cslM("Starting Straighten Object macro")
cslD("Getting selected objects to define targets")

selError = False #true if incorrect selection made
cancelOp = False #true if operation canceled by user

if len(FreeCADGui.Selection.getSelection()) &gt; 1: #if several objet selected
    cslD("Multiple objects selected, asking user what to do")
    msgb = QtGui.QMessageBox() ##create a message box to ask for user choice &amp; populate it
    msgb.setWindowTitle("Multiple objects selected")
    msgb.setText("""You have selected multiple objects
        This is experimental feature, unexpected results may happen if objects are in different coordinate systems
        Click 'Parent' to try to find a common parent and apply transformation to it
        Click 'Multiple' to apply transformation on all objects individually
        Click 'Cancel' to cancel operation""")
    msgb.setInformativeText("!!! Reference face and/or line shall belong to the 1st selected object&nbsp;!!!")
    msgb.setIcon(QtGui.QMessageBox.Question)
    pbut = msgb.addButton("Parent", QtGui.QMessageBox.AcceptRole) #button for 'Parent' mode
    mbut = msgb.addButton("Multiple", QtGui.QMessageBox.AcceptRole) #button for "Multiple' mode
    cbut = msgb.addButton("Cancel", QtGui.QMessageBox.RejectRole) #button to cancel operation
    msgb.exec_() #display message box
    if msgb.clickedButton() == pbut: #if 'Parent' mode selected
        cslD("Parent mode selected, will search for a common one")
        plist = FreeCADGui.Selection.getSelection()[0].InListRecursive #initialize the parent list
        for obj in FreeCADGui.Selection.getSelection(): #for each object in selection
            plist = list(set(plist).intersection(obj.InListRecursive)) #search common parent with previous objects
        cslD("Found common parent(s)&nbsp;: " + str([str(p.Label) for p in plist]) + " / if several, choose the first one")
        if len(plist) == 0: #if no common parent found
            selError = True
            cslE("No common parent found")
        else: #if common parent found
            target = [plist[0]] #take the lowest level one as target
            cslD("Selected parent as target&nbsp;: " + str(target[0].Label))
    elif msgb.clickedButton() == mbut: #if 'Multiple' mode selected
        cslD("Multiple mode selected, will apply on all objects")
        target = FreeCADGui.Selection.getSelection() #take all selection as target
    else: #if operation canceled
        cancelOp = True
        cslD("Operation canceled by user")
elif len(FreeCADGui.Selection.getSelection()) == 1: #if only one object selected
    target = FreeCADGui.Selection.getSelection() #take it as target
else: #no object selected
    selError = True
    cslE("No object selected")

if not(selError or cancelOp): #if a valid selection is available
    cslD("Target(s) after mode application&nbsp;: " + str(target[0].Label))
    cslD("Checking if PartDesign feature selected")
    for cnt, t in enumerate(target): #going through the targets
        try:
            while str(t.TypeId)[:10] == 'PartDesign' and str(t.TypeId)&nbsp;!= 'PartDesign::Body': #while object is in a PartDesign and is not the Body
                t = t.getParentGeoFeatureGroup() #try its parent as new target
        except: #if a PartDesign object has no containing Body
            selError = True
            cslE("Found a PartDesign object not in a Body")
            break
        target[cnt] = t #update target

    target = list(set(target).intersection(target)) #remove duplicates to prevent applying 2 times transformation on same object
    cslD("Final target(s)&nbsp;: " + str([str(t.Label) for t in target]))

    cslD("Getting reference items")

    refFaceDef = False #true if a reference face is selected
    refPt1Def = False #true if one reference point is found selected
    refPt2Def = False #true if another reference point is found selected

    cslD("Subobjects&nbsp;: " +str(FreeCADGui.Selection.getSelectionEx()[0].SubElementNames))
    for selItem in FreeCADGui.Selection.getSelectionEx()[0].SubObjects: #going through selected items of first object
        if isinstance(selItem, Part.Face): #if it's a face
            if not refFaceDef: #if reference face not yet defined
                refFace = selItem #define it
                refFaceDef = True #and remember
            else:
                selError = True #too much faces selected
                cslE("Too much reference faces selected")
        elif isinstance(selItem, Part.Edge): #if it's an edge
            if not refPt1Def and not refPt2Def: #if reference points not yet defined
                refPt1 = selItem.Vertexes[0] #define 1st reference point as first edge point
                refPt1Def = True #and remember
                refPt2 = selItem.Vertexes[len(selItem.Vertexes)-1] #define 2nd reference point as last edge point
                refPt2Def = True #and remember
            else:
                selError = True #too much points selected
                cslE("Too much reference points selected (vertices or edges)")
        elif isinstance(selItem, Part.Vertex): #if it's a vertex
            if not refPt1Def: #if 1st reference point not yet defined
                refPt1 = selItem #define it
                refPt1Def = True #and remember
            elif not refPt2Def: #if 2nd reference point not yet defined
                refPt2 = selItem #define it
                refPt2Def = True #and remember
            else:
                selError = True #too much points selected
                cslE("Too much reference points selected (vertices or edges)")
        else:
            selError = True #incorrect type of item selected
            cslE("Incorrect type of item selected")

if cancelOp:
    cslM("Operation canceled by user ... exiting")
elif selError or (bool(refPt1Def)&nbsp;!= bool(refPt2Def)) or (not (refPt1Def or refPt2Def or refFaceDef)): #if selection error or only one reference point defined or no reference face/point defined
    cslE("Selection error&nbsp;: see report view &amp; documentation for more details ... Exiting")
else:
    FreeCAD.ActiveDocument.openTransaction("Straighten objects") #open new transaction for undo management
    cslD("Starting Transformation")
    obj = FreeCADGui.Selection.getSelection()[0] # take as reference the first object selected for transformation
    shiftVec = _0Vec_ #no shift move by defaut
    faceRot = FreeCAD.Rotation(_ZVec_, _ZVec_) #no reference rotation by default
    lineRot = FreeCAD.Rotation(_ZVec_, _ZVec_) #no reference line by default
    normVec = _ZVec_ #normal is the Z axis by default
    rotCenter = obj.Shape.BoundBox.Center #center of rotation at object bounding box center by default
    warning = False #True if a warning appears

    if refFaceDef: #if a reference face has been defined
        cslD("A reference face is available")
        faceCurv = refFace.curvatureAt(refFace.Surface.parameter(refFace.CenterOfMass)[0], refFace.Surface.parameter(refFace.CenterOfMass)[1]) #calculating face curvature at center of mass
        cslD("Curvature&nbsp;: " + str(faceCurv))
        if faceCurv&nbsp;!= (0, 0): #if reference face is not flat at its center of mass
            warning = True
            cslW("Reference face is not flat at its center of mass, unexpected results may happen") #warn user about it
        rotCenter = refFace.CenterOfMass #changing center of rotation to center of mass of reference face
        shiftVec -= refFace.CenterOfMass #the reference face will be centered
        normVec = refFace.normalAt(refFace.Surface.parameter(refFace.CenterOfMass)[0], refFace.Surface.parameter(refFace.CenterOfMass)[1]) #getting normal vector at face center of mass
        faceRot = FreeCAD.Rotation(normVec, -_ZVec_) #calculate needed rotation to align the reference face with Z axis
        for t in target:
            t.Placement = FreeCAD.Placement(_0Vec_, faceRot, rotCenter).multiply(t.Placement) #rotate targets to align reference face normal with Z axis
        cslD("Targets rotated to match reference face normal with Z axis")
    if refPt1Def: #if reference points have been defined
        cslD("Reference points are available")
        lineVec = refPt2.Point - refPt1.Point #calculate vector (reference line) defined by reference points
        lineVecMod = faceRot.multVec(lineVec) #reference line has maybe been modified by previous object rotation
        lineNorm = lineVecMod.projectToPlane(_0Vec_, _ZVec_) #calculate line projection on XY plane
        cslD("Normality&nbsp;: " + str(lineNorm))
        if lineNorm == _0Vec_: #if reference line is perpendicular to rotating plane
            warning = True
            cslW("Line reference is aligned with normal, line alignment will be ignored") #warn user about it
        else:
            lineRot = FreeCAD.Rotation(lineNorm, _XVec_) #calculate needed rotation to align with X axis
            for t in target:
                t.Placement = FreeCAD.Placement(_0Vec_, lineRot, rotCenter).multiply(t.Placement) #rotate targets to align reference line with X axis
            cslD("Targets rotated to match reference line with X axis")

    for t in target:
        t.Placement.move(shiftVec) #finally shift targets if needed
    cslD("Targets shift")
    FreeCAD.ActiveDocument.commitTransaction() #commit transaction
    if warning:
        cslW("Macro terminated with warning(s), see report view &amp; documentation for more details")
    else&nbsp;:
        cslM("Macro terminated correctly")</pre>
<h2><span class="mw-headline" id="Forum_discussion">Forum discussion</span></h2>
<p>Pour tout commentaire (bug, demande de fonctionnalit&eacute;, commentaires, ...), merci d'utiliser ce fil de discussion&nbsp;: <a rel="nofollow" class="external text" href="https://forum.freecad.org/viewtopic.php?f=22&amp;t=35191">(Macro) Straighten objects</a>
</p>
<!-- 
NewPP limit report
Cached time: 20250713110010
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.025 seconds
Real time usage: 0.030 seconds
Preprocessor visited node count: 117/1000000
Post&#8208;expand include size: 2697/2097152 bytes
Template argument size: 13384/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 13332/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    3.181      1 -total
 62.03%    1.973      1 Template:Macro/fr
 35.02%    1.114      1 Template:MacroCode
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:176819-0!canonical and timestamp 20250713110010 and revision id 1611798. Rendering was triggered because: edit-page
 -->
</div>
</div><script src="../site.js"></script>