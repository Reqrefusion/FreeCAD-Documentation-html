<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro SketchUnmap/fr</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="fr" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Macro+SketchUnmap&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><a href="../Macro_SketchUnmap.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro SketchUnmap (100% translated)" lang="en" dir="ltr">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" lang="fr" dir="ltr">fran&ccedil;ais</span></li>
<li><a href="../it/Macro_SketchUnmap.html" class="mw-pt-progress mw-pt-progress--low" title="Macro SketchUnmap (4% translated)" lang="it" dir="ltr">italiano</a></li>
<li><a href="../pl/Macro_SketchUnmap.html" class="mw-pt-progress mw-pt-progress--low" title="Makrodefinicja: SketchUnmap (4% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../index.php?title=SketchUnmap.svg&amp;filetimestamp=20190614162801&amp;.html" class="mw-file-description"><img src="../File/SketchUnmap.svg" decoding="async" width="32" height="32" class="mw-file-element"></a></span><span> </span>
SketchUnmap
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Cette macro r&eacute;initialise un emplacement absolu de l&rsquo;esquisse et cr&eacute;e &eacute;ventuellement un plan de r&eacute;f&eacute;rence.<br>Cette macro a &eacute;t&eacute; &eacute;crite principalement pour contourner le probl&egrave;me de d&eacute;nomination topologique qui peut casser un mod&egrave;le lorsqu'une esquisse a &eacute;t&eacute; directement ou indirectement attach&eacute;e &agrave; une face ou &agrave; tout autre &eacute;l&eacute;ment topologique.<br>
<p>Pour &eacute;viter les ruptures, une macro doit &ecirc;tre appliqu&eacute;e lorsque le mod&egrave;le est toujours correct. Elle ne peut pas "r&eacute;parer" un mod&egrave;le cass&eacute;. Si vous venez de casser votre mod&egrave;le, annulez les derni&egrave;res modifications dans une bonne situation, appliquez la macro aux esquisses instables, puis recommencez l'op&eacute;ration pr&eacute;c&eacute;dente.<br><br>Version macro&nbsp;: 0.6.2<br>Date derni&egrave;re modification&nbsp;: 2019-06-14<br>Version FreeCAD&nbsp;: 0.17 et au dessus<br>T&eacute;l&eacute;chargement&nbsp;: <a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/3/34/SketchUnmap.svg">Ic&ocirc;ne de la barre d'outils</a><br>Auteur: OpenBrain<br>
</p>
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../index.php?title=User;OpenBrain&amp;action=edit&amp;redlink=1.html" class="new" title="User:OpenBrain (page does not exist)">OpenBrain</a>
</td></tr>
<tr>
<th class="ctOdd">T&eacute;l&eacute;chargement
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/3/34/SketchUnmap.svg">Ic&ocirc;ne de la barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../fr/Macros_recipes.html" title="Macros recipes/fr">Page des macros</a><br><a href="../fr/How_to_install_macros.html" title="How to install macros/fr">Comment installer une macro</a><br><a href="../fr/Customize_Toolbars.html" title="Customize Toolbars/fr">Comment cr&eacute;er une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version Macro
</th></tr>
<tr>
<td class="ctEven macro-version">0.6.2
</td></tr>
<tr>
<th class="ctOdd">Derni&egrave;re modification
</th></tr>
<tr>
<td class="ctEven macro-date">2019-06-14
</td></tr>
<tr>
<th class="ctOdd">Version(s) FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">0.17 et au dessus
</td></tr>
<tr>
<th class="ctOdd">Raccourci clavier
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p><span id="Context"></span>
</p>
<h3><span class="mw-headline" id="Contexte">Contexte</span></h3>
<p>Cette macro a &eacute;t&eacute; &eacute;crite principalement pour contourner le probl&egrave;me de d&eacute;nomination topologique susceptible de casser un mod&egrave;le lorsqu'une esquisse a &eacute;t&eacute; directement ou indirectement attach&eacute;e &agrave; une face ou &agrave; tout autre &eacute;l&eacute;ment topologique.
Pour &eacute;viter les ruptures, une macro doit &ecirc;tre appliqu&eacute;e lorsque le mod&egrave;le est toujours correct. Il ne peut pas "r&eacute;parer" un mod&egrave;le cass&eacute;. Si vous venez de casser votre mod&egrave;le, annulez les derni&egrave;res modifications dans une bonne situation, appliquez la macro aux esquisses instables, puis recommencez l'op&eacute;ration pr&eacute;c&eacute;dente.
</p><p><span id="Usage"></span>
</p>
<h3><span class="mw-headline" id="Utilisation">Utilisation</span></h3>
<p>Sur le plan fonctionnel, la macro supprimera le mappage actuel de l'esquisse sur laquelle elle est appliqu&eacute;e, puis lui appliquera un placement absolu afin de l'immuniser contre les modifications de support de mappage.
</p><p>Pour ce faire, la macro proposera essentiellement 3 options (si votre esquisse n'est pas dans un corps PartDesign, seule la premi&egrave;re option est disponible et sera appliqu&eacute;e automatiquement):
</p>
<ul><li>Mode "Raw" =&gt; le placement de l'esquisse est rendu absolu dans le r&eacute;f&eacute;rentiel de corps, rien de plus</li>
<li>"Mode DP@Face" =&gt; un plan de r&eacute;f&eacute;rence est cr&eacute;&eacute; &agrave; l'emplacement de la face de mappage, puis l'esquisse y est attach&eacute;e en respectant son d&eacute;calage d'attache</li>
<li>Mode "DP@Sketch" =&gt; un lieu de r&eacute;f&eacute;rence est cr&eacute;&eacute; &agrave; l'emplacement de l'esquisse (y compris le d&eacute;calage de la pi&egrave;ce jointe), puis l'esquisse est attach&eacute;e &agrave; son origine</li></ul>
<p>Pour utiliser la macro, s&eacute;lectionnez simplement l'esquisse cible (par exemple, dans l'arborescence), puis ex&eacute;cutez la macro. C'est tout&nbsp;!
</p>
<h3><span class="mw-headline" id="Installation">Installation</span></h3>
<p>La macro est disponible via le <a href="../fr/Std_AddonMgr.html" title="Std AddonMgr/fr">gestionnaire d'extensions</a>.
Le code est fourni sur cette page pour plus de commodit&eacute; au cas o&ugrave; votre syst&egrave;me n'ait pas git-python. Bien qu'elle devrait &ecirc;tre &agrave; jour, la derni&egrave;re version de la macro est toujours disponible sur <a rel="nofollow" class="external text" href="https://github.com/FreeCAD/FreeCAD-macros/blob/master/Information/SimpleProperties.FCMacro">FreeCAD-macro repository</a>
</p><p>Pour des explications plus d&eacute;taill&eacute;es, voir la page <a href="../fr/How_to_install_macros.html" title="How to install macros/fr"> Comment installer des macros</a>.
</p><p><span id="Details"></span>
</p>
<h3><span id="D.C3.A9tails"></span><span class="mw-headline" id="D&eacute;tails">D&eacute;tails</span></h3>
<p>Pour une meilleure compr&eacute;hension, voici un exemple:
Supposons un simple cube dont la face sup&eacute;rieure (jaune) a &eacute;t&eacute; dessin&eacute;e. Un cylindre est cr&eacute;&eacute; avec un cercle matelass&eacute; dont l'esquisse a &eacute;t&eacute; mapp&eacute;e (face plate) &agrave; la face pr&eacute;par&eacute;e et d&eacute;cal&eacute;e pour r&eacute;pondre aux besoins (offset de pi&egrave;ce jointe):
</p><p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=Unmap_ex1.png&amp;filetimestamp=20190610103430&amp;.html" class="mw-file-description"><img src="../File/Unmap_ex1.png" decoding="async" width="936" height="361" class="mw-file-element"></a></span>
</p><p>Maintenant, pour une raison quelconque, vous devez inverser la direction de tirage du tirage (bien s&ucirc;r, sans que le cylindre se d&eacute;place). Voici ce qui se passe fondamentalement:
</p><p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=Unmap_ex2.png&amp;filetimestamp=20190610103518&amp;.html" class="mw-file-description"><img src="../File/Unmap_ex2.png" decoding="async" width="1024" height="366" class="mw-file-element"></a></span>
</p><p>L'arborescence indique une erreur, la vue 3D n'est pas mise &agrave; jour et l'esquisse du cercle flotte au milieu de nulle part ...
</p><p>Vient maintenant le travail de la macro (que vous devez ex&eacute;cuter avant de changer la face de r&eacute;f&eacute;rence, lorsque l'esquisse est toujours &agrave; la bonne place). S&eacute;lectionnez l'esquisse et ex&eacute;cutez-le. Si votre esquisse est dans un corps, une bo&icirc;te de message vous demandera de choisir parmi les 3 options diff&eacute;rentes (si votre esquisse sort d&rsquo;un corps, elle appliquera automatiquement la premi&egrave;re):
</p>
<ul><li>"Raw" mode</li>
<li>"DP@Face mode"</li>
<li>"DP@Sketch" mode</li></ul>
<p>Ce qui en terme d'image donne ce qui suit:
</p><p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=Unmap_macro.png&amp;filetimestamp=20190610103544&amp;.html" class="mw-file-description"><img src="../File/Unmap_macro.png" decoding="async" width="669" height="782" class="mw-file-element"></a></span>
</p>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<p>Ic&ocirc;ne de la barre d'outils <span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=SketchUnmap.svg&amp;filetimestamp=20190614162801&amp;.html" class="mw-file-description"><img src="../File/SketchUnmap.svg" decoding="async" width="64" height="64" class="mw-file-element"></a></span>
</p><p><b>Macro_SketchUnmap.FCMacro</b>
</p>
<pre>#!/usr/bin/python
#####################################
# Copyright (c) openBrain 2019
# Licensed under LGPL v2
#
# This FreeCAD macro will unmap a sketch from eg. a face and make its placement absolute in the body. It proposes 3 options (forcely the first if sketch not in a body)&nbsp;:
# * "Raw" mode =&gt; the sketch placement is made absolute in the body referential, nothing more
# * "DP@Face mode" =&gt; a datum plane is created where the mapping face is, then the sketch is attached to it respecting its attachment offset
# * "DP@Sketch" mode =&gt; a datum place is created where the sketch is (including attachment offset), then the sketch is attached to its origin
#
# Main use of the macro is to make design more robust to topological naming issue
#
# Version history&nbsp;:
# *0.6.2&nbsp;: add icon (metadata)
# *0.6.1&nbsp;: minor changes after PR review
# *0.6&nbsp;: some typo improvement + commenting for official PR
# *0.5&nbsp;: beta release
#
#####################################

__Name__ = 'SketchUnmap'
__Comment__ = 'Unmap a sketch &amp; makes its placement absolute"'
__Author__ = 'openBrain'
__Version__ = '0.6.2'
__Date__ = '2019-06-14'
__License__ = 'LGPL v2'
__Web__ = 'https://wiki.freecad.org/Macro_SketchUnmap'
__Wiki__ = 'https://wiki.freecad.org/Macro_SketchUnmap'
__Icon__ = 'https://wiki.freecad.org/images/3/34/SketchUnmap.svg'
__Help__ = 'Select the sketch to unmap (eg. in the tree view) then run the macro'
__Status__ = 'Beta'
__Requires__ = 'FreeCAD &gt;= 0.17'
__Communication__ = 'https://forum.freecad.org/viewtopic.php?f=22&amp;t=36078'
#    __Files__ = ''

__dbg__ = False  #True for debugging

from PySide import QtGui

def cslM(msg): #Print message in console
    FreeCAD.Console.PrintMessage('\n')
    FreeCAD.Console.PrintMessage(msg)

def cslW(msg): #Print warning in console
    FreeCAD.Console.PrintMessage('\n')
    FreeCAD.Console.PrintWarning(msg)

def cslE(msg): #Print error in console
    FreeCAD.Console.PrintMessage('\n')
    FreeCAD.Console.PrintError(msg)

def cslD(msg): #Print debug message in console
    if __dbg__:
        FreeCAD.Console.PrintMessage('\n')
        FreeCAD.Console.PrintMessage("Debug&nbsp;: " + str(msg))

_0Vec_ = FreeCAD.Vector(0, 0, 0) #Shortener for null vector
_ZVec_ = FreeCAD.Vector(0, 0, 1) #Shortener for Z axis

if __dbg__:  ##Clear report view in debug mode
    FreeCADGui.getMainWindow().findChild(QtGui.QTextEdit, "Report view").clear()

cslM("Starting SketchUnmap macro")
cslD("Checking selection")

##If selection is wrong, print error message and exit
if (len(Gui.Selection.getSelection())&nbsp;!= 1 or str(Gui.Selection.getSelection()[0])&nbsp;!= '&lt;Sketcher::SketchObject&gt;'):
    cslE("You must select a sketch that you want to unmap (and only one) ... Exiting")
else:
    cslD("Selection OK")
    App.ActiveDocument.openTransaction("SketchUnmap") #Open transaction for undo management
    sk = Gui.Selection.getSelection()[0] #Get target sketch
    skNatPl = sk.Placement #Store placement
    skNatAO = sk.AttachmentOffset #Store attachment offset
    skInBody = False
    for obj in sk.InList: ##Check if sketch is inside a Body
        if obj.TypeId == 'PartDesign::Body':
            skInBody = True
            skBody = obj
    cslD("Sketch in a body&nbsp;: " + str(skInBody))
    msgb = QtGui.QMessageBox() ##Prepare the message box to choose option
    msgb.setWindowTitle("Unmap Sketch&nbsp;: Mode selection")
    msgb.setText("""Choose which unmapping mode you want to apply&nbsp;:
    Raw =&gt; the sketch placement is made absolute in the body referential, nothing more
    DP@Face =&gt; a datum plane is created where the mapping face is, then the sketch is attached to it respecting its attachment offset
    DP@Sketch =&gt; a datum place is created where the sketch is (including attachment offset), then the sketch is attached to its origin
        Click 'Cancel' to cancel operation""")
    msgb.setIcon(QtGui.QMessageBox.Question)
    rbut = msgb.addButton("Raw", QtGui.QMessageBox.AcceptRole)
    fbut = msgb.addButton("DP@Face", QtGui.QMessageBox.AcceptRole)
    sbut = msgb.addButton("DP@Sketch", QtGui.QMessageBox.AcceptRole)
    cbut = msgb.addButton("Cancel", QtGui.QMessageBox.RejectRole)
    if skInBody: #If sketch in a Body
        msgb.exec_() ##Show message box and get user choice
        msgbRep = msgb.clickedButton()
    else:
        msgbRep = rbut #Else apply raw mode automatically
    if msgbRep == rbut: #If raw mode
        sk.Support = None ##Just unmap the sketch so its placement is absolute
        sk.MapMode = 'Deactivated'
    elif msgbRep == fbut: #If DP@Face mode
        newDP = skBody.newObject('PartDesign::Plane','DP' + sk.Name) #Create a datum plane
        if sk.Label&nbsp;!= sk.Name: ##Eventually clarify its label
            newDP.Label = 'DP' + sk.Label
        newDP.Support = None ##Plane is placed absolute
        newDP.MapMode = 'Deactivated'
        newDP.Placement = skNatPl.multiply(skNatAO.inverse()) #Plane placement is set to former face one
        sk.Support = [(newDP,'')] #Sketch is mapped to plane keeping its attachment offset
    elif  msgbRep == sbut: #If DP@Sketch mode
        newDP = skBody.newObject('PartDesign::Plane','DP' + sk.Name) #Create a datum plane
        if sk.Label&nbsp;!= sk.Name: ##Eventually clarify its label
            newDP.Label = 'DP' + sk.Label
        newDP.Support = None ##Plane is placed absolute
        newDP.MapMode = 'Deactivated'
        newDP.Placement = skNatPl #Plane placement is set to former sketch one
        sk.Support = [(newDP,'')] ##Sketch is mapped to plane resetting its attachment offset
        sk.AttachmentOffset = App.Placement(_0Vec_, App.Rotation(_ZVec_, 0))
    App.ActiveDocument.commitTransaction() #Commit transaction for undo management
    cslM("SketchUnmap Macro ended correctly")</pre>
<h3><span class="mw-headline" id="Limitations">Limitations</span></h3>
<ul><li>Ne traitez qu'un croquis &agrave; la fois</li>
<li>Travaillez uniquement sur des objets d'esquisse</li></ul>
<p><span id="Forum_discussion"></span>
</p>
<h3><span class="mw-headline" id="Discussion_sur_le_forum">Discussion sur le forum</span></h3>
<p>Pour tout commentaire (bug, demande de fonctionnalit&eacute;, commentaires, ...), veuillez utiliser ce fil de discussion&nbsp;: <a rel="nofollow" class="external text" href="https://forum.freecad.org/viewtopic.php?f=22&amp;t=36078">(FR) macro to remap sketch to different reference</a>
</p>
<!-- 
NewPP limit report
Cached time: 20250713091456
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.026 seconds
Real time usage: 0.043 seconds
Preprocessor visited node count: 111/1000000
Post&#8208;expand include size: 2697/2097152 bytes
Template argument size: 6850/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 6773/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    4.659      1 -total
 56.81%    2.647      1 Template:Macro/fr
 41.34%    1.926      1 Template:MacroCode
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:154546-0!canonical and timestamp 20250713091456 and revision id 1611542. Rendering was triggered because: edit-page
 -->
</div>
</div><script src="../site.js"></script>