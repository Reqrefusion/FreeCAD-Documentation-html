<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro clone explicit/fr</span></h1><?xml encoding="UTF-8"><div class="mw-parser-output"><div class="mw-pt-languages noprint" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../Macro_clone_explicit.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro clone explicit (100% translated)" lang="en" dir="ltr">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" lang="fr" dir="ltr">fran&ccedil;ais</span></li>
<li><a href="../pl/Macro_clone_explicit.html" class="mw-pt-progress mw-pt-progress--stub" title="Makrodefinicja: Jawny klon (5% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../index.php?title=Macro_clone_explicit.png&amp;filetimestamp=20190614140456&amp;.html" class="mw-file-description"><img src="../File/Macro_clone_explicit.png" decoding="async" width="32" height="32"></a></span><span> </span>
Macro Clone explicit
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Cr&eacute;e une copie de chaque objet s&eacute;lectionn&eacute; et d&eacute;finit ses propri&eacute;t&eacute;s en fonction d'une expression li&eacute;e &agrave; l'objet original, ce qui en fait un clone explicite et modifiable.<br><br>Version macro&nbsp;: 0.1<br>Date derni&egrave;re modification&nbsp;: 2018-12-15<br>Version FreeCAD&nbsp;: 18 et plus<br>T&eacute;l&eacute;chargement&nbsp;: <a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/a/ab/Macro_clone_explicit.png">Ic&ocirc;ne de la barre d'outils</a><br>Auteur: Raph82<br>
</td></tr>
<tr>
<th class="ctOdd">Auteur
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../index.php?title=User;Raph82&amp;action=edit&amp;redlink=1.html" class="new" title="User:Raph82 (page does not exist)">Raph82</a>
</td></tr>
<tr>
<th class="ctOdd">T&eacute;l&eacute;chargement
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/a/ab/Macro_clone_explicit.png">Ic&ocirc;ne de la barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Liens
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../fr/Macros_recipes.html" title="Macros recipes/fr">Page des macros</a><br><a href="../fr/How_to_install_macros.html" title="How to install macros/fr">Comment installer une macro</a><br><a href="../fr/Customize_Toolbars.html" title="Customize Toolbars/fr">Comment cr&eacute;er une barre d'outils</a>
</td></tr>
<tr>
<th class="ctOdd">Version Macro
</th></tr>
<tr>
<td class="ctEven macro-version">0.1
</td></tr>
<tr>
<th class="ctOdd">Derni&egrave;re modification
</th></tr>
<tr>
<td class="ctEven macro-date">2018-12-15
</td></tr>
<tr>
<th class="ctOdd">Version(s) FreeCAD
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">18 et plus
</td></tr>
<tr>
<th class="ctOdd">Raccourci clavier
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><a href="../fr/Expressions.html" title="Expressions/fr">Expressions</a>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p>Cette macro cr&eacute;e une copie de chaque objet s&eacute;lectionn&eacute; et fixe ses propri&eacute;t&eacute;s &agrave; une <a href="../fr/Expressions.html" title="Expressions/fr">expression</a> li&eacute;e &agrave; l'objet original, ce qui en fait un clone explicite et modifiable.
</p><p>Ce clone est une copie de l'objet original, comme dans la commande <b>Edition &rarr; Dupliquer la s&eacute;lection</b>, mais ses propri&eacute;t&eacute;s sont d&eacute;finies par des expressions.
</p><p><span id="How_does_this_'explicit_and_editable_clone'_differ_from_a_Clone_object?"></span>
</p>
<h3><span id="Comment_ce_.22clone_explicite_et_modifiable.22_diff.C3.A8re-t-il_d.27un_objet_Clone_.3F"></span><span class="mw-headline" id="Comment_ce_&quot;clone_explicite_et_modifiable&quot;_diff&egrave;re-t-il_d'un_objet_Clone_?">Comment ce "clone explicite et modifiable" diff&egrave;re-t-il d'un objet Clone&nbsp;?</span></h3>
<p>"Explicite" parce que toutes les propri&eacute;t&eacute;s de l'objet original sont visibles. Dans un objet Clone d'un Cube, pouvez-vous voir sa hauteur par exemple&nbsp;? Lorsque vous utilisez une expression pour un objet Clone, pouvez-vous acc&eacute;der facilement aux propri&eacute;t&eacute;s de son parent&nbsp;?
</p><p>"Editable" parce que, contrairement &agrave; un objet Clone, vous pouvez modifier l'expression de n'importe quelle propri&eacute;t&eacute;. Il est donc possible de faire en sorte que l'objet ne clone que certaines propri&eacute;t&eacute;s de son parent, tandis que vous modifiez les autres.
</p><p><span id="Usage"></span>
</p>
<h2><span class="mw-headline" id="Utilisation">Utilisation</span></h2>
<ol><li>S&eacute;lectionnez au moins un objet.</li>
<li><b>Macro &rarr; Macros...</b></li>
<li>S&eacute;lectionnez la <b>clone_explicit.FCMacro</b> dans la liste.</li>
<li>Appuyez sur le bouton <span style="background: #f5f5f5; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); border: 2px solid #989898; border-radius: 0.4em; padding: 0px 10px 1px 10px; font-weight:normal;">Ex&eacute;cuter</span>.</li></ol>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<p>Ic&ocirc;ne de la barre d'outils <span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=Macro_clone_explicit.png&amp;filetimestamp=20190614140456&amp;.html" class="mw-file-description"><img src="../File/Macro_clone_explicit.png" decoding="async" width="64" height="64"></a></span>
</p><p><b>Macro_clone_explicit.FCMacro</b>
</p>
<pre>__Title__ = "clone_explicit"
__Author__ = "Raph82"
__URL__     = "http://www.freecadweb.org/index-fr.html"
__Version__ = "0.1"
__Date__    = "2018-12-15" #YYYY-MM-DD
__Comment__ = "This macro creates a copy of the selected objects and sets their properties to an expression linking to the original object, making it an explicit and editable clone"
__Web__ = "http://www.freecadweb.org/"
__Wiki__ = "https://wiki.freecad.org/index.php?title=Macro_clone_explicit"
__Icon__  = "https://wiki.freecad.org/images/a/ab/Macro_clone_explicit.png"
__IconW__  = "C:/Users/User Name/AppData/Roaming/FreeCAD/Macro_clone_explicit.png"
__Help__ = "Select at least one object and run the macro to make explicit and editable clone(s)"
__Status__ = "dev"
__Requires__ = "All FreeCAD"
__Communication__ = "https://wiki.freecad.org/index.php?title=User:raph82"

#IMPORTS:
import sys

##################################################
def set_expression(obj, property_to_set, expression):
    """"""
    try:
        print type(obj)
        obj.setExpression(property_to_set, expression)
#    except 'Base.FreeCADError':
    except Exception as detail:
        print detail
        print type(detail)
        if detail['swhat'] == 'Property not found':
            App.Console.PrintMessage('Object "{obj}" has no property "{prop}"\r\n'.format(obj=obj.Name, prop=property_to_set))
        else:
            raise

##################################################
def clone_explicit(mode):
    """Copy the selected objects and sets their properties to an expression, making it an explicit and editable clone.

     This clone is called "explicit and editable" because the link with its parent is visible and can be changed in the object properties.

     The link to the original object can be either "direct" or "transient", depending on the mode argument:
     - a direct clone has expressions pointing to its parent: clone.Length = parent.Length
     - a transient clone has expressions pointing to its ancestor. Say parent.Length = Box001.Length. With a transient clone, clone.Length = Box001.Length, whereas with a direct clone, clone.Length = parent.Length.
       This indirect link to Box001 (via the parent object) could be severed, accidentally or not, depending on what relationship you're looking for.

     If you're lost, try with a direct clone first."""

    App.Console.PrintMessage("Start of clone_explicit macro"+"\r\n")

    #Current selection check:
    sel = FreeCADGui.Selection.getSelection()

    App.Console.PrintMessage(str(len(sel))+" object(s) selected\r\n")
    if len(sel)&nbsp;!= 0:
        for i in range(len(sel)):
            obj=sel[i]

            #copying current object:
            App.Console.PrintMessage('Copying "'+obj.Label+'" ('+obj.Name+')\r\n')
            obj_copy=App.ActiveDocument.copyObject(obj, False) #https://www.freecadweb.org/api/d8/d3e/classApp_1_1Document.html#a08f1d7d90f4a7276a02918fb6445a04a
            App.Console.PrintMessage('"'+obj_copy.Label+'" ('+obj_copy.Name+') created\r\n')

            if mode == 'direct':
                #defining expressions pointing to the original object:
                set_expression(obj_copy, 'Placement.Base.x',          obj.Name+u'.Placement.Base.x')
                set_expression(obj_copy, 'Placement.Base.y',          obj.Name+u'.Placement.Base.y')
                set_expression(obj_copy, 'Placement.Base.z',          obj.Name+u'.Placement.Base.z')
                set_expression(obj_copy, 'Placement.Rotation.Angle',  obj.Name+u'.Placement.Rotation.Angle')
                set_expression(obj_copy, 'Placement.Rotation.Axis.x', obj.Name+u'.Placement.Rotation.Axis.x')
                set_expression(obj_copy, 'Placement.Rotation.Axis.y', obj.Name+u'.Placement.Rotation.Axis.y')
                set_expression(obj_copy, 'Placement.Rotation.Axis.z', obj.Name+u'.Placement.Rotation.Axis.z')
                set_expression(obj_copy, 'Length',                    obj.Name+u'.Length')
                set_expression(obj_copy, 'Width',                     obj.Name+u'.Width')
                set_expression(obj_copy, 'Height',                    obj.Name+u'.Height')

            elif mode == 'transient':
                #defining expressions pointing to the utmost original object:
                define_transient_expression(obj, obj_copy, 'Placement.Base.x')
                define_transient_expression(obj, obj_copy, 'Placement.Base.y')
                define_transient_expression(obj, obj_copy, 'Placement.Base.z')
                define_transient_expression(obj, obj_copy, 'Placement.Rotation.Angle')
                define_transient_expression(obj, obj_copy, 'Placement.Rotation.Axis.x')
                define_transient_expression(obj, obj_copy, 'Placement.Rotation.Axis.y')
                define_transient_expression(obj, obj_copy, 'Placement.Rotation.Axis.z')
                define_transient_expression(obj, obj_copy, 'Length')
                define_transient_expression(obj, obj_copy, 'Width')
                define_transient_expression(obj, obj_copy, 'Height')
            else:
                App.Console.PrintError('Programming error: mode value not recognized.\r\n')

            App.Console.PrintMessage('('+obj_copy.Label+'" ('+obj_copy.Name+') expressions set\r\n')

        FreeCAD.ActiveDocument.recompute()
        App.Console.PrintMessage('End of clone_explicit macro\r\n')

    else:
        App.Console.PrintError('Select at least one object first\r\n')

    sel = ""
    obj = ""
    obj_copy = ""

##################################################
def find_expression(source_object, property_to_define):
    """"""

    for var_tuple in source_object.ExpressionEngine: #https://forum.freecad.org/viewtopic.php?f=22&amp;t=21950
        # .ExpressionEngine returns tuple like [('Placement.Base.z', 'Length')], see https://docs.python.org/2.7/tutorial/datastructures.html#tuples-and-sequences
        App.Console.PrintMessage('var_tuple[0]='+var_tuple[0]+'\r\n')
        if var_tuple[0] == property_to_define:
           return var_tuple[1]

##################################################
def define_transient_expression(source_object, target_object, property_to_define):
    """"""
    expressions = source_object.ExpressionEngine #https://forum.freecad.org/viewtopic.php?f=22&amp;t=21950
    # returns tuple like [('Placement.Base.z', 'Length')], see https://docs.python.org/2.7/tutorial/datastructures.html#tuples-and-sequences

    expression = find_expression(source_object, property_to_define)
    if expression&nbsp;!= None:
#        App.Console.PrintMessage("target_object.Name="+target_object.Name+"\r\n")
#        App.Console.PrintMessage("property_to_define="+property_to_define+"\r\n")
#        App.Console.PrintMessage("expressions[property_to_define]="+expressions[property_to_define]+"\r\n")

        set_expression(target_object, property_to_define, expression)
    else:
        set_expression(target_object, property_to_define, source_object.Name+'.'+property_to_define)

    expressions = ""

##################################################
clone_explicit('direct')
#clone_explicit('transient')</pre>
<h2><span class="mw-headline" id="Options">Options</span></h2>
<p>Une option <code>mode</code> &eacute;tait pr&eacute;vue. Elle n'a pas encore &eacute;t&eacute; mise en &oelig;uvre. Elle semble maintenant beaucoup plus complexe qu'initialement pr&eacute;vu, peut-&ecirc;tre trop complexe pour moi &agrave; mettre en &oelig;uvre.
</p><p>L'id&eacute;e est que l'on peut pr&eacute;f&eacute;rer l'un ou l'autre comportement&nbsp;:
</p>
<ul><li>le clone continue &agrave; imiter son parent m&ecirc;me si les propri&eacute;t&eacute;s <i>expressions</i> du parent changent. C'est le mode <code>direct</code>,</li>
<li>le clone conserve les propri&eacute;t&eacute;s <i>expressions</i> que le parent avait au moment de la cr&eacute;ation du clone. C'est le mode <code>transitoire</code>.</li></ul>
<p>Remarquez l'accent mis sur le mot "expressions". Une expression est une couche d'abstraction au-dessus d'une valeur.
</p><p>Voici un exemple. Imaginons que l'objet parent (celui que vous s&eacute;lectionnez avant d'ex&eacute;cuter la macro) ait sa propri&eacute;t&eacute; <code>Height</code> d&eacute;finie par l'expression <code>Object<b>3</b>.Height * 2</code>.
</p>
<ul><li>Lorsque vous &ecirc;tes en mode <code>direct</code>&nbsp;:
<ul><li><code>Clone.Height = Parent.Height</code>,</li>
<li>devient une valeur <code>Object<b>3</b>.Height</code> qui affecterait &agrave; la fois l'objet parent et les objets clones,</li>
<li>devient une <i>expression</i> <code>Parent.Height</code> qui affecterait <b>aussi</b> les deux objets&nbsp;:
<ul><li><code>Parent.Height = Object<b>4</b>.Height * 2</code> et</li>
<li><code>Clone.Height = Parent.Height</code> encore.</li></ul></li></ul></li>
<li>Lorsque vous &ecirc;tes en mode <code>transient</code>&nbsp;:
<ul><li><code>Clone.Height = Object<b>3</b>.Height * 2</code>,</li>
<li>devient une valeur <code>Object<b>3</b>.Height</code> qui affecterait &agrave; la fois l'objet parent et les objets clones,</li>
<li>devient une <i>expression</i> <code>Parent.Height</code> qui affecterait <b>seulement</b> l'objet parent&nbsp;:
<ul><li><code>Parent.Height = Object<b>4</b>.Height * 2</code> et</li>
<li><code>Clone.Height = Object<b>3</b>.Height * 2</code> encore.</li></ul></li></ul></li></ul>
<p>Pour l'instant, la macro est ex&eacute;cut&eacute;e avec le param&egrave;tre mode r&eacute;gl&eacute; sur <code>direct</code> et aucun choix n'est propos&eacute; &agrave; l'utilisateur.
</p>
<h2><span class="mw-headline" id="Limitations">Limitations</span></h2>
<ul><li>Ne fonctionne bien qu'avec les cubes pour le moment. Pour &eacute;tendre &agrave; de nombreux types, je dois&nbsp;:
<ul><li>trouver comment identifier un type d'objet pour traiter ses diff&eacute;rentes propri&eacute;t&eacute;s en cons&eacute;quence&nbsp;;</li>
<li>trouver comment attraper l'erreur <code>Property not found</code>.</li></ul></li></ul>
<p><span id="Version_history"></span>
</p>
<h2><span class="mw-headline" id="Historique_des_versions">Historique des versions</span></h2>
<ul><li>0.1&nbsp;: premi&egrave;re version publique</li></ul>
<!-- 
NewPP limit report
Cached time: 20250705180316
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc, no&#8208;toc&#8208;conversion]
CPU time usage: 0.034 seconds
Real time usage: 0.071 seconds
Preprocessor visited node count: 130/1000000
Post&#8208;expand include size: 2622/2097152 bytes
Template argument size: 7840/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 7762/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   17.508      1 -total
 40.30%    7.056      3 Template:MenuCommand
 26.02%    4.556      1 Template:Macro/fr
 18.81%    3.293      1 Template:Button
 12.02%    2.104      1 Template:MacroCode
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:293046-0!canonical and timestamp 20250705180316 and revision id 1604324. Rendering was triggered because: edit-page
 -->
</div>
</div><script src="../site.js"></script>