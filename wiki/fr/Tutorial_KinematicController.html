<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Tutorial KinematicController/fr</span></h1><?xml encoding="UTF-8"><div class="mw-parser-output"><div class="mw-pt-languages noprint" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../de/Tutorial_KinematicController.html" class="mw-pt-progress mw-pt-progress--complete" title="Anleitung Kinematiksteuerung (100% translated)" lang="de" dir="ltr">Deutsch</a></li>
<li><a href="../Tutorial_KinematicController.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Tutorial KinematicController (100% translated)" lang="en" dir="ltr">English</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" lang="fr" dir="ltr">fran&ccedil;ais</span></li>
<li><a href="../pl/Tutorial_KinematicController.html" class="mw-pt-progress mw-pt-progress--complete" title="Poradnik: Sterownik kinematyczny (100% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" style="width: 230px; float: right; margin-left: 1em">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;"><span typeof="mw:File"><span><img src="../File/Freecad.svg" decoding="async" width="32" height="32"></span></span> Tutoriel
</td></tr>
<tr>
<th class="ctOdd">Th&egrave;me
</th></tr>
<tr>
<td class="ctEven">Contr&ocirc;leur cin&eacute;matique cr&eacute;&eacute; avec Python
</td></tr>
<tr>
<th class="ctOdd">Niveau
</th></tr>
<tr>
<td class="ctEven">Des connaissances de base en Python sont utiles
</td></tr>
<tr>
<th class="ctOdd">Temps d'ex&eacute;cution estim&eacute;
</th></tr>
<tr>
<td class="ctEven">1 heure
</td></tr>
<tr>
<th class="ctOdd">Auteurs
</th></tr>
<tr>
<td class="ctEven"><a href="../User;FBXL5.html" title="User:FBXL5">FBXL5</a>
</td></tr>
<tr>
<th class="ctOdd">Version de FreeCAD
</th></tr>
<tr>
<td class="ctEven">0.20 et ult&eacute;rieur
</td></tr>
<tr>
<th class="ctOdd">Fichiers exemples
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Voir aussi
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr></tbody></table>
<h2><span class="mw-headline" id="Introduction">Introduction</span></h2>
<p>Ce tutoriel d&eacute;crit comment g&eacute;n&eacute;rer un contr&ocirc;leur cin&eacute;matique simple &agrave; utiliser avec les assemblages cr&eacute;&eacute;s avec l'<a href="../fr/Assembly3_Workbench.html" title="Assembly3 Workbench/fr">atelier Assembly3</a> &agrave; partir de quelques lignes de code Python.
</p><p>N'importe quel &eacute;diteur de texte peut &ecirc;tre utilis&eacute; pour coder. Mon choix se porte sur Atom, mais l'&eacute;diteur int&eacute;gr&eacute; de FreeCAD fonctionne bien aussi.
</p><p>Les exemples de code suivants peuvent &ecirc;tre copi&eacute;s et coll&eacute;s dans un fichier texte vide, puis enregistr&eacute;s sous le nom de votre choix comme fichier <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">*.py</span> ou <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">*.FCMacro</span>.
</p><p><span id="Macro_sections"></span>
</p>
<h2><span class="mw-headline" id="Sections_macro">Sections macro</span></h2>
<p><span id="Basic_structure"></span>
</p>
<h3><span class="mw-headline" id="Structure_de_base">Structure de base</span></h3>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#! python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># (c) 2022 Your name LGPL</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># This will be true only if the file is "executed"</span>
    <span class="c1"># but not if imported as a module</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
<p>La structure de base consiste en une fonction <code>main()</code> et un commutateur pour v&eacute;rifier si la macro est utilis&eacute;e comme un conteneur pour les classes, les m&eacute;thodes, etc. ou si elle est ex&eacute;cut&eacute;e seule. Seule la deuxi&egrave;me option lancera la fonction <code>main()</code>. Cette fonction est vide pour le moment.
</p><p><span id="Find_driving_constraints"></span>
</p>
<h3><span class="mw-headline" id="Trouver_les_contraintes_pilotes">Trouver les contraintes pilotes</span></h3>
<p>Les contraintes pilotes sont des objets dans un document FreeCAD. Elles doivent &ecirc;tre marqu&eacute;es pour pouvoir &ecirc;tre trouv&eacute;es.
</p><p>Pour ce contr&ocirc;leur, le suffixe <code>"Driver"</code> doit &ecirc;tre attach&eacute; au label d'une contrainte pilote. Il peut &ecirc;tre s&eacute;par&eacute; par un <code>"."</code> ou <code>"-"</code> pour plus de clart&eacute;, car nous ne v&eacute;rifierons que si le label se termine par <code>"Driver"</code>.
</p><p>Une fonction qui re&ccedil;oit un objet document et renvoie une liste de contraintes pilotes (les noms dans ce cas) fera l'affaire.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">def</span> <span class="nf">findTheDrivingConstraints</span><span class="p">(</span><span class="n">document_object</span><span class="p">):</span>
    <span class="c1"># search through the Objects and find the driving constraint</span>
    <span class="n">driver_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">document_object</span><span class="o">.</span><span class="n">Objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Driver"</span><span class="p">):</span>
            <span class="n">driving_constraint</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">driver_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driving_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">driver_list</span>
</pre></div>
<p>La fonction <code>main()</code> charge le document actif dans la variable <code>kin_doc</code>, puis appelle la fonction <code>findTheDrivingConstraints()</code> et lui transmet le contenu de <code>kin_doc</code>. La liste retourn&eacute;e est charg&eacute;e dans <code>drivers</code> qui est ensuite v&eacute;rifi&eacute;e pour contenir au moins un &eacute;l&eacute;ment. Si c'est le cas, la liste est finalement imprim&eacute;e dans la <a href="../fr/Report_view.html" title="Report view/fr">Vue rapport</a>.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">kin_doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span> <span class="c1"># Kinematic Document</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="n">findTheDrivingConstraints</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No driver found!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span>
</pre></div>
<div class="mw-collapsible mw-collapsed">
<p><b>La macro jusqu'&agrave; pr&eacute;sent...</b>
</p>
<div class="mw-collapsible-content">
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#! python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># (c) 2021 Your name LGPL</span>

<span class="k">def</span> <span class="nf">findTheDrivingConstraints</span><span class="p">(</span><span class="n">document_object</span><span class="p">):</span>
    <span class="c1"># search through the Objects and find the driving constraint</span>
    <span class="n">driver_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">document_object</span><span class="o">.</span><span class="n">Objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Driver"</span><span class="p">):</span>
            <span class="n">driving_constraint</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">driver_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driving_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">driver_list</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">kin_doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span> <span class="c1"># Kinematic Document</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="n">findTheDrivingConstraints</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No driver found!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># This will be true only if the file is "executed"</span>
    <span class="c1"># but not if imported as a module</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div> 
</div> 
<p><a href="#top">En haut</a></p>
<p><span id="Control_panel"></span>
</p>
<h3><span id="Panneau_de_contr.C3.B4le"></span><span class="mw-headline" id="Panneau_de_contr&ocirc;le">Panneau de contr&ocirc;le</span></h3>
<p>Le panneau de contr&ocirc;le est construit &agrave; partir de widgets Qt, une fen&ecirc;tre principale contenant plusieurs widgets d'entr&eacute;e/sortie.
</p><p>Chaque widget doit &ecirc;tre import&eacute; avant de pouvoir &ecirc;tre utilis&eacute;, mais ils peuvent &ecirc;tre import&eacute;s en un seul ensemble. La ligne d'importation est plac&eacute;e en haut du fichier.
</p><p><span id="Main_window"></span>
</p>
<h4><span id="Fen.C3.AAtre_principale"></span><span class="mw-headline" id="Fen&ecirc;tre_principale">Fen&ecirc;tre principale</span></h4>
<p>Pour la fen&ecirc;tre principale, la ligne d'importation ressemble &agrave; ceci&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">)</span>
</pre></div>
<p>La fen&ecirc;tre principale appel&eacute;e <code>ControlPanel</code> est un objet de classe instanci&eacute; &agrave; partir du widget <code>QDialog</code>.
</p><p>Elle poss&egrave;de deux m&eacute;thodes init. <code>__init__()</code> initialise le nouvel objet de la classe, g&egrave;re les arguments entrants et lance <code>initUI()</code> qui g&egrave;re tous les widgets de la fen&ecirc;tre principale.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">ControlPanel</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    docstring for ControlPanel.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ControlPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="c1"># Setting up class parameters</span>
        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1"># now make the window visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
<p>Pour lancer un seul panneau de commande, une instance, appel&eacute;e <code>panel</code>, de cette classe sera cr&eacute;&eacute;e avec <code>kin_doc</code> (l'objet document) et <code>drivers[0]</code> (le premier de la liste des contraintes de conduite) transf&eacute;r&eacute;s &agrave; cette instance. Enfin, la m&eacute;thode <code>exec_()</code> de la classe ouvre la fen&ecirc;tre de dialogue.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">panel</span> <span class="o">=</span> <span class="n">ControlPanel</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">,</span> <span class="n">drivers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">panel</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
</pre></div>
<p>Pour g&eacute;rer plus d'un contr&ocirc;leur (driver), nous devons v&eacute;rifier la liste des contr&ocirc;leurs et cr&eacute;er une instance pour chaque &eacute;l&eacute;ment de la liste et transf&eacute;rer l'&eacute;l&eacute;ment en cours.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">panel_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">each_driver</span> <span class="ow">in</span> <span class="n">drivers</span><span class="p">:</span>
    <span class="n">panel</span> <span class="o">=</span> <span class="n">ControlPanel</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">,</span> <span class="n">each_driver</span><span class="p">)</span>
    <span class="n">panel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
<span class="n">panel</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
</pre></div>
<p>Ces lignes remplacent la commande <code>print()</code> dans la branche else de la fonction <code>main()</code>.
</p><p>Remarque&nbsp;: La collecte d'une <code>panel_list</code> nous permet de lancer tous les panneaux en m&ecirc;me temps. (Je ne peux pas encore expliquer ce comportement...)
</p><p>L'ex&eacute;cution de la macro affichera une fen&ecirc;tre de dialogue vide et propre, en attente de widgets&nbsp;:
</p><p><span typeof="mw:File"><a href="../index.php?title=Tutorial_KinCon-01.png&amp;filetimestamp=20220422085424&amp;.html" class="mw-file-description" title="Une fen&ecirc;tre de dialogue vide"><img alt="Une fen&ecirc;tre de dialogue vide" src="../File/Tutorial_KinCon-01.png" decoding="async" width="300" height="225"></a></span>
</p>
<div class="mw-collapsible mw-collapsed">
<p><b>La macro jusqu'&agrave; pr&eacute;sent...</b>
</p>
<div class="mw-collapsible-content">
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#! python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># (c) 2021 Your name LGPL</span>

<span class="c1"># imports and constants</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ControlPanel</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    docstring for ControlPanel.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ControlPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="c1"># Setting up class parameters</span>
        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1"># now make the window visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">findTheDrivingConstraints</span><span class="p">(</span><span class="n">document_object</span><span class="p">):</span>
    <span class="c1"># search through the Objects and find the driving constraint</span>
    <span class="n">driver_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">document_object</span><span class="o">.</span><span class="n">Objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Driver"</span><span class="p">):</span>
            <span class="n">driving_constraint</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">driver_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driving_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">driver_list</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">kin_doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span> <span class="c1"># Kinematic Document</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="n">findTheDrivingConstraints</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No driver found!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">panel_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">each_driver</span> <span class="ow">in</span> <span class="n">drivers</span><span class="p">:</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">ControlPanel</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">,</span> <span class="n">each_driver</span><span class="p">)</span>
            <span class="n">panel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># This will be true only if the file is "executed"</span>
    <span class="c1"># but not if imported as a module</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div> 
</div> 
<p><a href="#top">En haut</a></p>
<p><span id="Setting_parameters"></span>
</p>
<h4><span id="Param.C3.A8tres_de_r.C3.A9glage"></span><span class="mw-headline" id="Param&egrave;tres_de_r&eacute;glage">Param&egrave;tres de r&eacute;glage</span></h4>
<p>Il est maintenant temps de remplir la m&eacute;thode <code>initUI()</code>&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="c1"># Setting up class parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="p">)</span>
        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1"># now make the window visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="o">...</span>
</pre></div>
<p><code>self.actuator</code> repr&eacute;sente la contrainte pilote et <code>self.driver_type</code> stocke un mot cl&eacute; pour son type. Ce dernier est utilis&eacute; pour choisir la propri&eacute;t&eacute; correcte avec chaque contrainte.
</p><p><span id="Method_getDriverType()"></span>
</p>
<h5><span id="M.C3.A9thode_getDriverType.28.29"></span><span class="mw-headline" id="M&eacute;thode_getDriverType()">M&eacute;thode getDriverType()</span></h5>
<p>Pour une utilisation future, nous avons besoin du type de pilote (Angle, Distance, Longueur) et donc une m&eacute;thode <code>getDriverType()</code> doit &ecirc;tre d&eacute;finie&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
        <span class="n">ANGLE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PlaneCoincident"</span><span class="p">,</span>
            <span class="s2">"AxialAlignment"</span><span class="p">,</span>
            <span class="s2">"PlaneAlignment"</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use negative values, too</span>
        <span class="n">ANGLE_DEG_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"Angle"</span><span class="p">,</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use positive values only</span>
        <span class="n">DISTANCE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PointDistance"</span><span class="p">,</span>
            <span class="s2">"PointsDistance"</span>
            <span class="p">]</span> <span class="c1"># Lenght constraints that use positive values only</span>
        <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Angle"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_DEG_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"AnglePos"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">DISTANCE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Distance"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Length"</span>
<span class="o">...</span>
</pre></div>
<p>Cette m&eacute;thode v&eacute;rifie si le type de la contrainte donn&eacute;e peut &ecirc;tre trouv&eacute; dans l'une des listes, et renvoie le type de dimension qui doit &ecirc;tre contr&ocirc;l&eacute;.
</p><p>On suppose que dans le document cin&eacute;matique, le pilote est marqu&eacute; correctement et fonctionne s'il &eacute;tait &eacute;dit&eacute; manuellement. Dans ce cas, il n'est pas n&eacute;cessaire de filtrer les contraintes g&eacute;om&eacute;triques telles que Colinear ou PointsCoincidence (mais ce serait l'endroit pour le faire...).
</p><p><span id="Window_properties"></span>
</p>
<h5><span id="Propri.C3.A9t.C3.A9s_de_la_fen.C3.AAtre"></span><span class="mw-headline" id="Propri&eacute;t&eacute;s_de_la_fen&ecirc;tre">Propri&eacute;t&eacute;s de la fen&ecirc;tre</span></h5>
<p>La taille de la fen&ecirc;tre est d&eacute;finie par ses dimensions minimale et maximale. En utilisant les m&ecirc;mes valeurs, on obtient une taille fixe.
</p><p>Le titre indique le nom du pilote et pr&eacute;cise s'il s'agit d'un angle, d'une distance ou d'une longueur. Enfin, on demande &agrave; la fen&ecirc;tre de rester au dessus de toutes les fen&ecirc;tres.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1">#- set window dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Label</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowStaysOnTopHint</span><span class="p">)</span>
        <span class="c1"># now make the window visible</span>
<span class="o">...</span>
</pre></div>
<p><a href="#top">En haut</a></p>
<p><span id="Setting_more_parameters"></span>
</p>
<h4><span id="Param.C3.A8tres_de_r.C3.A9glage_suppl.C3.A9mentaires"></span><span class="mw-headline" id="Param&egrave;tres_de_r&eacute;glage_suppl&eacute;mentaires">Param&egrave;tres de r&eacute;glage suppl&eacute;mentaires</span></h4>
<p>L'&eacute;tape suivante consiste &agrave; extraire la valeur actuelle du pilote et &agrave; d&eacute;finir les valeurs de d&eacute;but et de fin par d&eacute;faut en fonction du type de pilote.
</p><p>Une distance ne peut pas &ecirc;tre n&eacute;gative et exactement nulle, ce qui rend le solveur perplexe. La valeur de d&eacute;part est donc fix&eacute;e &agrave; 0,001. Les angles acceptent des valeurs n&eacute;gatives et obtiennent des valeurs sym&eacute;triques. (Si les longueurs acceptent des valeurs n&eacute;gatives reste &agrave; prouver finalement...)
</p><p>Le suffixe de l'unit&eacute; doit &ecirc;tre conserv&eacute; pour renvoyer la valeur &agrave; la propri&eacute;t&eacute; de la contrainte &agrave; la fin. Les distances et les longueurs n&eacute;cessitent des valeurs avec des unit&eacute;s.
</p><p>Le traitement des unit&eacute;s et l'affichage des valeurs sous forme de cha&icirc;nes de caract&egrave;res dans plusieurs widgets n&eacute;cessitent de convertir assez souvent les chiffres en cha&icirc;nes de caract&egrave;res et inversement.
</p><p>Pour compl&eacute;ter les param&egrave;tres, nous d&eacute;finissons un nombre de pas par d&eacute;faut qui doivent &ecirc;tre calcul&eacute;s lorsque le mouvement est automatis&eacute; et si le commutateur <code>self.sequence</code> est r&eacute;gl&eacute; sur <code>True</code>, une photo sera prise &agrave; chaque pas du mouvement.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" &deg;"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Angle must not be &lt;= 0 and &gt;=180</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="mf">179.999</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" &deg;"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Distance must not be &lt;= 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p><a href="#top">En haut</a></p>
<p><span id="Labels"></span>
</p>
<h3><span class="mw-headline" id="Labels">Labels</span></h3>
<p>Maintenant, trois labels sont ajout&eacute;s pour afficher le d&eacute;but, la fin et la valeur en cours.
</p><p>Tout d'abord, la classe <code>QLabel</code> doit &ecirc;tre import&eacute;e, c'est-&agrave;-dire que la liste d'importation doit &ecirc;tre &eacute;tendue comme ceci&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">)</span>
</pre></div>
<p>Dans la m&eacute;thode <code>initUI()</code>, nous ins&eacute;rons&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="c1"># create some labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span> <span class="c1"># set to a non-proportional font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
<span class="o">...</span>
</pre></div>
<p>Le placement est fait avec la m&eacute;thode h&eacute;rit&eacute;e <code>setGeometry()</code>. Dans ce cas, la description d'un rectangle est utilis&eacute;e (position X, position Y, largeur, hauteur).
</p><p>Les premi&egrave;re et troisi&egrave;me lignes pourraient &ecirc;tre combin&eacute;es, mais cela n'est pas recommand&eacute; pour des raisons de clart&eacute;&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">label_end</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>
</pre></div>
<p>L'ex&eacute;cution de la macro avec un document d'assemblage cin&eacute;matique cr&eacute;erait une fen&ecirc;tre de dialogue comme celle-ci&nbsp;:
</p><p><span typeof="mw:File"><a href="../index.php?title=Tutorial_KinCon-02.png&amp;filetimestamp=20220426092511&amp;.html" class="mw-file-description" title="Une fen&ecirc;tre de dialogue affichant la valeur de d&eacute;part, la valeur en vigueur et la valeur finale."><img alt="Une fen&ecirc;tre de dialogue affichant la valeur de d&eacute;part, la valeur en vigueur et la valeur finale." src="../File/Tutorial_KinCon-02.png" decoding="async" width="300" height="225"></a></span>
</p>
<p style="text-align:left; font-style:italic; width:800px; margin-left:1em; margin-right:1em;">La fen&ecirc;tre de dialogue affiche le libell&eacute; de la contrainte et le type de pilote dans le titre, ainsi que la valeur de d&eacute;part, la valeur en cours et la valeur finale sur la premi&egrave;re ligne de la zone principale.</p>
<div class="mw-collapsible mw-collapsed">
<p><b>La macro jusqu'&agrave; pr&eacute;sent...</b>
</p>
<div class="mw-collapsible-content">
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#! python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># (c) 2021 Your name LGPL</span>

<span class="c1"># imports and constants</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ControlPanel</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    docstring for ControlPanel.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ControlPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="c1"># Setting up class parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" &deg;"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Angle must not be &lt;= 0 and &gt;=180</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="mf">179.999</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" &deg;"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Distance must not be &lt;= 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>

        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1">#- set window dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Label</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowStaysOnTopHint</span><span class="p">)</span>

        <span class="c1"># create some labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span> <span class="c1"># set to a non-proportional font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="c1"># now make the window visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
        <span class="n">ANGLE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PlaneCoincident"</span><span class="p">,</span>
            <span class="s2">"AxialAlignment"</span><span class="p">,</span>
            <span class="s2">"PlaneAlignment"</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use negative values, too</span>
        <span class="n">ANGLE_DEG_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"Angle"</span><span class="p">,</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use positive values only</span>
        <span class="n">DISTANCE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PointDistance"</span><span class="p">,</span>
            <span class="s2">"PointsDistance"</span>
            <span class="p">]</span>
        <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Angle"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_DEG_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"AnglePos"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">DISTANCE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Distance"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Length"</span>

<span class="c1"># End of ControlPanel()</span>
<span class="c1"># Main section below:</span>

<span class="k">def</span> <span class="nf">findTheDrivingConstraints</span><span class="p">(</span><span class="n">document_object</span><span class="p">):</span>
    <span class="c1"># search through the Objects and find the driving constraint</span>
    <span class="n">driver_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">document_object</span><span class="o">.</span><span class="n">Objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Driver"</span><span class="p">):</span>
            <span class="n">driving_constraint</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">driver_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driving_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">driver_list</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">kin_doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span> <span class="c1"># Kinematic Document</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="n">findTheDrivingConstraints</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No driver found!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">panel_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">each_driver</span> <span class="ow">in</span> <span class="n">drivers</span><span class="p">:</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">ControlPanel</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">,</span> <span class="n">each_driver</span><span class="p">)</span>
            <span class="n">panel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># This will be true only if the file is "executed"</span>
    <span class="c1"># but not if imported as a module</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div> 
</div> 
<p><a href="#top">En haut</a></p>
<p><span id="Slider"></span>
</p>
<h4><span class="mw-headline" id="Curseur">Curseur</span></h4>
<p>Pour changer la valeur courante &agrave; n'importe quel nombre entre la valeur de d&eacute;but et la valeur de fin, un widget de curseur conviendrait.
</p><p>Tout d'abord, la classe <code>QSlider</code> doit &ecirc;tre import&eacute;e, c'est-&agrave;-dire que la liste d'importation doit &ecirc;tre &eacute;tendue comme ceci&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">)</span>
</pre></div>
<p>De retour dans la m&eacute;thode <code>initUI()</code> et juste apr&egrave;s la section des labels, nous ins&eacute;rons&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="c1"># Horizontal slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                             <span class="c1"># create horizontalSlider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setOrientation</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>        <span class="c1"># orientation horizontal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>  <span class="c1"># position coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">"horizontalSlider"</span><span class="p">)</span>           <span class="c1"># object name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setInvertedAppearance</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>                <span class="c1"># default: right to left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>                            <span class="c1"># default: (0, 99)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActuatorSlider</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>Le bouton du curseur est plac&eacute; avec la m&eacute;thode <code>setValue()</code>. Sa valeur doit &ecirc;tre calcul&eacute;e &agrave; partir de la valeur actuelle et d'un rapport de progression. Le rapport doit &ecirc;tre calcul&eacute; &agrave; chaque fois qu'une valeur de d&eacute;but ou de fin est modifi&eacute;e. Nous ins&eacute;rons donc une autre m&eacute;thode apr&egrave;s la m&eacute;thode <code>getDriverType()</code>.
</p><p>Travailler avec un ratio au lieu de modifier les valeurs min et max du curseur pr&eacute;sente l'avantage d'une r&eacute;solution plus fine pour les petites valeurs.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">stepRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="k">return</span> <span class="n">ratio</span>
<span class="o">...</span>
</pre></div>
<p>Et apr&egrave;s celle-ci, vient une autre m&eacute;thode d&eacute;finissant ce qu'il faut faire lorsque la position du curseur ou la valeur du curseur change. La m&eacute;thode <code>onActuatorSlider()</code> est appel&eacute;e par la m&eacute;thode <code>connect()</code> qui fournit &eacute;galement la valeur du curseur comme argument.
</p><p>Il recalcule la valeur courante &agrave; partir de la position du curseur, r&eacute;&eacute;crit le texte du label <code>self.label_current</code> et modifie la propri&eacute;t&eacute; de la contrainte en fonction du type de curseur.
</p><p>L'ex&eacute;cution de la commande <code>"asm3CmdQuickSolve"</code> lance le solveur pour r&eacute;organiser les pi&egrave;ces de l'assemblage avec la valeur modifi&eacute;e.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">onActuatorSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slider_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="n">slider_value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="n">Gui</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="s2">"asm3CmdQuickSolve"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>La fen&ecirc;tre de dialogue avec le curseur doit ressembler &agrave; ceci et est pr&ecirc;te &agrave; contr&ocirc;ler un mouvement&nbsp;:
</p><p><span typeof="mw:File"><a href="../index.php?title=Tutorial_KinCon-03.png&amp;filetimestamp=20220430124115&amp;.html" class="mw-file-description" title="Deux fen&ecirc;tres de dialogue avec un curseur"><img alt="Deux fen&ecirc;tres de dialogue avec un curseur" src="../File/Tutorial_KinCon-03.png" decoding="async" width="300" height="225"></a></span>
</p>
<p style="text-align:left; font-style:italic; width:800px; margin-left:1em; margin-right:1em;">Fen&ecirc;tres de dialogue avec le curseur ajout&eacute;, une pour un pilote d'angle et une pour un pilote de distance</p>
<p>Nous pouvons lancer une fen&ecirc;tre de dialogue pour n'importe quel document ouvert, elles n'interf&eacute;reront pas entre elles.
</p>
<p><a href="#top">En haut</a></p>
<p><span id="Text_entry_fields"></span>
</p>
<h4><span class="mw-headline" id="Champs_de_saisie_de_texte">Champs de saisie de texte</span></h4>
<p>Pour d&eacute;finir les valeurs de d&eacute;but et de fin, nous utilisons un widget d'&eacute;dition de ligne.
</p><p>Tout d'abord, la classe <code>QLineEdit</code> doit &ecirc;tre import&eacute;e, c'est-&agrave;-dire que la liste d'importation doit &ecirc;tre &eacute;tendue comme ceci&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">)</span>
</pre></div>
<p>De retour dans la m&eacute;thode <code>initUI()</code> et entre les labels et les sections du curseur, nous ins&eacute;rons&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="c1"># text input field - Start value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryStart</span><span class="p">)</span>

        <span class="c1"># text input field - End value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryEnd</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>Les champs de saisie affichent les valeurs de d&eacute;but et de fin par d&eacute;faut. Ils ne sont pas complets tant que nous n'avons pas ajout&eacute; les m&eacute;thodes permettant de traiter les entr&eacute;es modifi&eacute;es. Ceci sera fait par les m&eacute;thodes <code>self.onEntryStart()</code> et <code>self.onEntryEnd()</code> qui sont ins&eacute;r&eacute;es entre les m&eacute;thodes <code>self.stepRatio()</code> et <code>self.onActuatorSlider()</code>.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">onEntryStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_start</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onEntryEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_end</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_end</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>Les deux convertissent la valeur de la cha&icirc;ne re&ccedil;ue en un nombre &agrave; virgule flottante et modifient soit <code>self.start_value</code> soit <code>self.end_value</code> et l'intitul&eacute; correspondant en cons&eacute;quence. Ensuite, la valeur du curseur est mise &agrave; jour.
</p><p>La fen&ecirc;tre de dialogue avec les champs de saisie de texte doit ressembler &agrave; ceci et est pr&ecirc;te &agrave; modifier la port&eacute;e d'un mouvement&nbsp;:
</p><p><span typeof="mw:File"><a href="../index.php?title=Tutorial_KinCon-04.png&amp;filetimestamp=20220502070952&amp;.html" class="mw-file-description" title="Deux fen&ecirc;tres de dialogue avec champs d'&eacute;dition de ligne"><img alt="Deux fen&ecirc;tres de dialogue avec champs d'&eacute;dition de ligne" src="../File/Tutorial_KinCon-04.png" decoding="async" width="300" height="225"></a></span>
</p>
<p style="text-align:left; font-style:italic; width:800px; margin-left:1em; margin-right:1em;">Fen&ecirc;tres de dialogue avec champs d'&eacute;dition de ligne, &agrave; nouveau pour un pilote d'angle et de distance</p><p>.
</p><div class="mw-collapsible mw-collapsed">
<p><b>La macro jusqu'&agrave; pr&eacute;sent...</b>
</p>
<div class="mw-collapsible-content">
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#! python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># (c) 2021 Your name LGPL</span>

<span class="c1"># imports and constants</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ControlPanel</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    docstring for ControlPanel.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ControlPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="c1"># Setting up class parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" &deg;"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Angle must not be &lt;= 0 and &gt;=180</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="mf">179.999</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" &deg;"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Distance must not be &lt;= 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>

        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1">#- set window dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Label</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowStaysOnTopHint</span><span class="p">)</span>

        <span class="c1"># create some labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span> <span class="c1"># set to a non-proportional font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="c1"># create some input elements</span>

        <span class="c1"># text input field - Start value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryStart</span><span class="p">)</span>

        <span class="c1"># text input field - End value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryEnd</span><span class="p">)</span>

        <span class="c1"># Horizontal slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                             <span class="c1"># create horizontalSlider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setOrientation</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>        <span class="c1"># orientation horizontal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>  <span class="c1"># position coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">"horizontalSlider"</span><span class="p">)</span>           <span class="c1"># object name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setInvertedAppearance</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>                <span class="c1"># default: right to left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>                            <span class="c1"># default: (0, 99)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActuatorSlider</span><span class="p">)</span>

        <span class="c1"># now make the window visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
        <span class="n">ANGLE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PlaneCoincident"</span><span class="p">,</span>
            <span class="s2">"AxialAlignment"</span><span class="p">,</span>
            <span class="s2">"PlaneAlignment"</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use negative values, too</span>
        <span class="n">ANGLE_DEG_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"Angle"</span><span class="p">,</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use positive values only</span>
        <span class="n">DISTANCE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PointDistance"</span><span class="p">,</span>
            <span class="s2">"PointsDistance"</span>
            <span class="p">]</span> <span class="c1"># Lenght constraints that use positive values only</span>
        <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Angle"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_DEG_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"AnglePos"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">DISTANCE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Distance"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Length"</span>

    <span class="k">def</span> <span class="nf">stepRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="k">return</span> <span class="n">ratio</span>

    <span class="k">def</span> <span class="nf">onEntryStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_start</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onEntryEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_end</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_end</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onActuatorSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slider_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="n">slider_value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="n">Gui</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="s2">"asm3CmdQuickSolve"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">slider_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">)</span>

<span class="c1"># End of ControlPanel()</span>
<span class="c1"># Main section below:</span>

<span class="k">def</span> <span class="nf">findTheDrivingConstraints</span><span class="p">(</span><span class="n">document_object</span><span class="p">):</span>
    <span class="c1"># search through the Objects and find the driving constraint</span>
    <span class="n">driver_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">document_object</span><span class="o">.</span><span class="n">Objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Driver"</span><span class="p">):</span>
            <span class="n">driving_constraint</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">driver_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driving_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">driver_list</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">kin_doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span> <span class="c1"># Kinematic Document</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="n">findTheDrivingConstraints</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No driver found!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">panel_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">each_driver</span> <span class="ow">in</span> <span class="n">drivers</span><span class="p">:</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">ControlPanel</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">,</span> <span class="n">each_driver</span><span class="p">)</span>
            <span class="n">panel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># This will be true only if the file is "executed"</span>
    <span class="c1"># but not if imported as a module</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div> 
</div> 
<p><a href="#top">En haut</a></p>
<p><span id="Motion"></span>
</p>
<h3><span class="mw-headline" id="Mouvement">Mouvement</span></h3>
<p>Pour mettre l'assemblage en mouvement, nous avons besoin&nbsp;:
</p>
<ul><li>Des boutons pour d&eacute;clencher le mouvement dans la direction souhait&eacute;e.</li>
<li>Un champ de saisie pour modifier le nombre de pas pour des mouvements plus rapides ou plus doux.</li>
<li>Une case &agrave; cocher pour indiquer si nous voulons prendre une s&eacute;quence d'images.</li></ul>
<p><span id="Forward_and_Backward_buttons"></span>
</p>
<h4><span id="Boutons_avant_et_arri.C3.A8re"></span><span class="mw-headline" id="Boutons_avant_et_arri&egrave;re">Boutons avant et arri&egrave;re</span></h4>
<p>Pour d&eacute;placer automatiquement les pi&egrave;ces de l'assemblage, nous avons besoin de deux boutons pour d&eacute;clencher les mouvements, un vers la position de d&eacute;part et un vers la position d'arriv&eacute;e. Ces deux boutons et un bouton de fermeture utiliseront un widget <code>QPushButton</code>.
</p><p>Les petits assemblages calculent un peu trop vite et montrent des sauts au lieu d'un mouvement r&eacute;gulier. Pour le ralentir, nous utilisons la m&eacute;thode <code>sleep()</code> du module <code>time</code> qui doit &ecirc;tre import&eacute; en premier.
</p><p>Another import and another widget:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">)</span>
</pre></div>
<p>Dans la m&eacute;thode <code>initUI()</code>, nous ins&eacute;rons les boutons apr&egrave;s la section du curseur&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="c1"># forward button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"&gt;-&gt;"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onForward</span><span class="p">)</span>
        <span class="c1"># backward button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"&lt;-&lt;"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onBackward</span><span class="p">)</span>
        <span class="c1"># close button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"Close window"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onClose</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>Les m&eacute;thodes traitant des boutons enfonc&eacute;s sont <code>self.onForward()</code>, <code>self.onBackward()</code>, et <code>self.onClose()</code>. Ils sont ins&eacute;r&eacute;s apr&egrave;s la m&eacute;thode <code>onActuatorSlider()</code>.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">onForward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">steps_left</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">steps_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+=</span> <span class="n">step</span>
            <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onBackward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">steps_left</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">steps_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-=</span> <span class="n">step</span>
            <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onClose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="s2">"Closed"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="o">...</span>
</pre></div>
<p>La m&eacute;thode <code>self.onClose()</code> fait appel &agrave; la m&eacute;thode h&eacute;rit&eacute;e <code>self.close()</code> qui ferme simplement la fen&ecirc;tre de dialogue et cl&ocirc;t ainsi la macro.
</p><p>Les deux <code>self.onForward()</code> et <code>self.onBackward()</code> comptent les pas qu'il reste &agrave; faire pour atteindre la position voulue et calculent la longueur d'un pas en fonction du nombre de pas. Pour l'instant, nous utilisons le nombre par d&eacute;faut de 10 pas.
</p><p>Chaque tour de la boucle while augmente/diminue la valeur en cours et met &agrave; jour les valeurs du curseur qui d&eacute;clenche <code>onActuatorSlider()</code> en arri&egrave;re-plan (voir <a href="#Curseur">Paragraphe curseur</a>). Apr&egrave;s une pause pour laisser l'ordinateur fournir une autre vue 3D actualis&eacute;e, le d&eacute;compte des &eacute;tapes restantes termine la boucle.
</p><p>S'il n'y a plus de pas, le curseur est plac&eacute; sur la premi&egrave;re/derni&egrave;re position du curseur, juste au cas o&ugrave; une erreur d'arrondi se serait produite.
</p><p>La fen&ecirc;tre de dialogue avec les boutons doit ressembler &agrave; ceci et vous pouvez maintenant d&eacute;placer l'assemblage de 10 pas vers la position de d&eacute;but/fin souhait&eacute;e&nbsp;:
</p><p><span typeof="mw:File"><a href="../index.php?title=Tutorial_KinCon-05.png&amp;filetimestamp=20220503151644&amp;.html" class="mw-file-description" title="Fen&ecirc;tre de dialogue avec boutons"><img alt="Fen&ecirc;tre de dialogue avec boutons" src="../File/Tutorial_KinCon-05.png" decoding="async" width="300" height="225"></a></span>
</p>
<p style="text-align:left; font-style:italic; width:800px; margin-left:1em; margin-right:1em;">Fen&ecirc;tre de dialogue avec boutons</p>
<div class="mw-collapsible mw-collapsed">
<p><b>La macro jusqu'&agrave; pr&eacute;sent...</b>
</p>
<div class="mw-collapsible-content">
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#! python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># (c) 2021 Your name LGPL</span>

<span class="c1"># imports and constants</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ControlPanel</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    docstring for ControlPanel.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ControlPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="c1"># Setting up class parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" &deg;"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Angle must not be &lt;= 0 and &gt;=180</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="mf">179.999</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" &deg;"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Distance must not be &lt;= 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>

        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1">#- set window dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Label</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowStaysOnTopHint</span><span class="p">)</span>

        <span class="c1"># create some labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span> <span class="c1"># set to a non-proportional font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="c1"># create some input elements</span>

        <span class="c1"># text input field - Start value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryStart</span><span class="p">)</span>

        <span class="c1"># text input field - End value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryEnd</span><span class="p">)</span>

        <span class="c1"># Horizontal slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                             <span class="c1"># create horizontalSlider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setOrientation</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>        <span class="c1"># orientation horizontal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>  <span class="c1"># position coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">"horizontalSlider"</span><span class="p">)</span>           <span class="c1"># object name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setInvertedAppearance</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>                <span class="c1"># default: right to left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>                            <span class="c1"># default: (0, 99)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActuatorSlider</span><span class="p">)</span>

        <span class="c1"># forward button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"&gt;-&gt;"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onForward</span><span class="p">)</span>
        <span class="c1"># backward button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"&lt;-&lt;"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onBackward</span><span class="p">)</span>
        <span class="c1"># close button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"Close window"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onClose</span><span class="p">)</span>

        <span class="c1"># now make the window visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
        <span class="n">ANGLE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PlaneCoincident"</span><span class="p">,</span>
            <span class="s2">"AxialAlignment"</span><span class="p">,</span>
            <span class="s2">"PlaneAlignment"</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use negative values, too</span>
        <span class="n">ANGLE_DEG_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"Angle"</span><span class="p">,</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use positive values only</span>
        <span class="n">DISTANCE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PointDistance"</span><span class="p">,</span>
            <span class="s2">"PointsDistance"</span>
            <span class="p">]</span> <span class="c1"># Lenght constraints that use positive values only</span>
        <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Angle"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_DEG_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"AnglePos"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">DISTANCE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Distance"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Length"</span>

    <span class="k">def</span> <span class="nf">stepRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="k">return</span> <span class="n">ratio</span>

    <span class="k">def</span> <span class="nf">onEntryStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_start</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onEntryEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_end</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_end</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onActuatorSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slider_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="n">slider_value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="n">FreeCADGui</span><span class="o">.</span><span class="n">updateGui</span><span class="p">()</span> <span class="c1"># screen update between steps</span>
        <span class="n">Gui</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="s2">"asm3CmdQuickSolve"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onForward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">steps_left</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">steps_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+=</span> <span class="n">step</span>
            <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onBackward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">steps_left</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">steps_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-=</span> <span class="n">step</span>
            <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onClose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="s2">"Closed"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># End of ControlPanel()</span>
<span class="c1"># Main section below:</span>

<span class="k">def</span> <span class="nf">findTheDrivingConstraints</span><span class="p">(</span><span class="n">document_object</span><span class="p">):</span>
    <span class="c1"># search through the Objects and find the driving constraint</span>
    <span class="n">driver_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">document_object</span><span class="o">.</span><span class="n">Objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Driver"</span><span class="p">):</span>
            <span class="n">driving_constraint</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">driver_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driving_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">driver_list</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">kin_doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span> <span class="c1"># Kinematic Document</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="n">findTheDrivingConstraints</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No driver found!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">panel_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">each_driver</span> <span class="ow">in</span> <span class="n">drivers</span><span class="p">:</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">ControlPanel</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">,</span> <span class="n">each_driver</span><span class="p">)</span>
            <span class="n">panel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># This will be true only if the file is "executed"</span>
    <span class="c1"># but not if imported as a module</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div> 
</div> 
<p><a href="#top">En haut</a></p>
<p><span id="Number_of_steps"></span>
</p>
<h4><span id="Nombre_d.27.C3.A9tapes"></span><span class="mw-headline" id="Nombre_d'&eacute;tapes">Nombre d'&eacute;tapes</span></h4>
<p>Le param&egrave;tre par d&eacute;faut est d'obtenir une impression rapide si l'assemblage se d&eacute;roule comme pr&eacute;vu sans perdre trop de temps de calcul.
</p><p>Si les pi&egrave;ces sautent au lieu de se d&eacute;placer en douceur, ou si les pilotes bas&eacute;s sur les angles ont tendance &agrave; poser des probl&egrave;mes lorsque la diff&eacute;rence entre deux angles est trop importante, ces deux probl&egrave;mes peuvent &ecirc;tre r&eacute;solus en augmentant le nombre d'&eacute;tapes.
</p><p>Un autre widget d'&eacute;dition de ligne est donc utilis&eacute; pour modifier le nombre d'&eacute;tapes (plac&eacute; apr&egrave;s les widgets d'&eacute;dition de ligne existants)&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="c1"># text input field - number of steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntrySteps</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>La m&eacute;thode connexe <code>self.onEntrySteps()</code> remplit simplement le param&egrave;tre <code>self.step_value</code> avec la valeur saisie. Elle est ins&eacute;r&eacute;e apr&egrave;s la m&eacute;thode <code>onEntryEnd()</code>.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">onEntrySteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_steps</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_steps</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>La fen&ecirc;tre de dialogue permettant de modifier le nombre d'&eacute;tapes doit ressembler &agrave; ceci&nbsp;:
</p><p><span typeof="mw:File"><a href="../index.php?title=Tutorial_KinCon-06.png&amp;filetimestamp=20220509085800&amp;.html" class="mw-file-description" title="Fen&ecirc;tre de dialogue avec un autre champ de saisie de texte"><img alt="Fen&ecirc;tre de dialogue avec un autre champ de saisie de texte" src="../File/Tutorial_KinCon-06.png" decoding="async" width="300" height="225"></a></span>
</p>
<p style="text-align:left; font-style:italic; width:800px; margin-left:1em; margin-right:1em;">Fen&ecirc;tre de dialogue avec un autre champ de saisie de texte</p>
<p><a href="#top">En haut</a></p>
<p><span id="Image_sequence"></span>
</p>
<h4><span id="S.C3.A9quence_d.27images"></span><span class="mw-headline" id="S&eacute;quence_d'images">S&eacute;quence d'images</span></h4>
<p>Lorsque le mouvement de notre assemblage r&eacute;pond &agrave; nos attentes, nous pouvons prendre une photo de chaque &eacute;tape. La s&eacute;quence d'images qui en r&eacute;sulte peut &ecirc;tre utilis&eacute;e pour cr&eacute;er une courte animation gif.
</p><p>Pour mettre en &oelig;uvre cette fonctionnalit&eacute;, nous avons besoin d'un widget <code>QCheckBox</code>, et d'un r&eacute;pertoire pour stocker les images.
</p><p>Une importation et un widget de plus&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QCheckBox</span><span class="p">)</span>
</pre></div>
<p>Dans la m&eacute;thode <code>initUI()</code>, nous ins&eacute;rons la case &agrave; cocher apr&egrave;s la section du curseur&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
        <span class="c1"># output check box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Check to record an image sequence"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">"checkBoxOutput"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onOutputClicked</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>La m&eacute;thode <code>onOutputClicked()</code> synchronise le param&egrave;tre <code>self.sequence</code> et l'affichage de la coche.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">onOutputClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>Pour d&eacute;finir les param&egrave;tres de sortie, nous utilisons la m&eacute;thode <code>output()</code>&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counter</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">image_path</span> <span class="o">=</span> <span class="s2">".../FreeCAD/ScreenShots/Sequence"</span>
            <span class="n">file_tag</span> <span class="o">=</span> <span class="s2">".png"</span>
            <span class="n">height</span> <span class="o">=</span> <span class="mi">640</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">480</span>
            <span class="n">background</span> <span class="o">=</span> <span class="s2">"Transparent"</span>
            <span class="c1"># dealing with leading zeros</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">999</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"Out of Range"</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">):</span>
                <span class="n">number</span> <span class="o">=</span> <span class="s2">"00"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">):</span>
                <span class="n">number</span> <span class="o">=</span> <span class="s2">"0"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="c1"># Screen shot</span>
            <span class="n">Gui</span><span class="o">.</span><span class="n">activeDocument</span><span class="p">()</span><span class="o">.</span><span class="n">activeView</span><span class="p">()</span><span class="o">.</span><span class="n">saveImage</span><span class="p">(</span><span class="n">image_path</span> <span class="o">+</span> <span class="n">number</span> <span class="o">+</span> <span class="n">file_tag</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">background</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>Tout d'abord, le chemin de l'image doit &ecirc;tre adapt&eacute; &agrave; votre syst&egrave;me d'exploitation&nbsp;; la derni&egrave;re partie est le nom de l'image sans le num&eacute;ro du moment et la balise du fichier. Ceci doit &ecirc;tre fait manuellement pour le moment.
</p><p>Ensuite, suivent la balise du fichier pour terminer le nom de l'image, la hauteur et la largeur de l'image, et la fa&ccedil;on dont le fond doit &ecirc;tre rempli (<code>"Current"</code> (fond de la vue 3D), <code>"White"</code>, <code>"Black"</code>, ou <code>"Transparent"</code>).
</p><p>Pour avoir toujours un nombre &agrave; 3 chiffres, des z&eacute;ros de t&ecirc;te doivent &ecirc;tre pr&eacute;fix&eacute;s au param&egrave;tre du compteur.
</p><p>Enfin, la version script&eacute;e de la commande <span typeof="mw:File"><a href="../index.php?title=Std_ViewScreenShot.svg&amp;filetimestamp=20240704220016&amp;.html" class="mw-file-description"><img src="../File/Std_ViewScreenShot.svg" decoding="async" width="24" height="24"></a></span> <a href="../fr/Std_ViewScreenShot.html" title="Std ViewScreenShot/fr">Std Capture d'&eacute;cran</a> est utilis&eacute;e pour prendre une photo en fonction des param&egrave;tres mentionn&eacute;s.
</p><p>Toujours pas de photos prises&nbsp;!?! Pas de probl&egrave;me, car cette m&eacute;thode n'est pas encore appel&eacute;e, et nous devons donc ins&eacute;rer un appel dans la boucle while de <code>onForward()</code> et <code>onBackward()</code>. Juste apr&egrave;s <code>time.sleep(0.2)</code>, nous ins&eacute;rons cette ligne&nbsp;:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">steps_left</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
<p>Maintenant, la macro devrait &ecirc;tre pr&ecirc;te &agrave; contr&ocirc;ler un assemblage et &agrave; prendre des photos pour un gif anim&eacute;.
</p><p>La version finale de la fen&ecirc;tre de dialogue&nbsp;:
</p><p><span typeof="mw:File"><a href="../index.php?title=Tutorial_KinCon-07.png&amp;filetimestamp=20220509122059&amp;.html" class="mw-file-description" title="Fen&ecirc;tre de dialogue termin&eacute;e"><img alt="Fen&ecirc;tre de dialogue termin&eacute;e" src="../File/Tutorial_KinCon-07.png" decoding="async" width="300" height="225"></a></span>
</p>
<p style="text-align:left; font-style:italic; width:800px; margin-left:1em; margin-right:1em;">Fen&ecirc;tre de dialogue termin&eacute;e</p>
<div class="mw-collapsible mw-collapsed">
<p><b>Et finalement, la macro enti&egrave;re</b>
</p>
<div class="mw-collapsible-content">
<p><b>N'oubliez pas de d&eacute;finir le chemin dans la m&eacute;thode output()&nbsp;!</b>
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#! python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># (c) 2021 Your name LGPL</span>

<span class="c1"># imports and constants</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QSlider</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QCheckBox</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ControlPanel</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    docstring for ControlPanel.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ControlPanel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">actuator</span><span class="p">):</span>
        <span class="c1"># Setting up class parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" &deg;"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Angle must not be &lt;= 0 and &gt;=180</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="mf">179.999</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" &deg;"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Distance must not be &lt;= 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span> <span class="o">=</span> <span class="p">(</span><span class="s2">" mm"</span><span class="p">)</span>

        <span class="c1"># the window has 640 x 480 pixels and is centered by default</span>
        <span class="c1">#- set window dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Label</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowStaysOnTopHint</span><span class="p">)</span>

        <span class="c1"># create some labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span> <span class="c1"># set to a non-proportional font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"osifont"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>

        <span class="c1"># create some input elements</span>

        <span class="c1"># text input field - Start value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_start</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryStart</span><span class="p">)</span>

        <span class="c1"># text input field - End value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_end</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntryEnd</span><span class="p">)</span>

        <span class="c1"># text input field - number of steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_steps</span><span class="o">.</span><span class="n">textChanged</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onEntrySteps</span><span class="p">)</span>

        <span class="c1"># Horizontal slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                             <span class="c1"># create horizontalSlider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setOrientation</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>        <span class="c1"># orientation horizontal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>  <span class="c1"># position coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">"horizontalSlider"</span><span class="p">)</span>           <span class="c1"># object name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setInvertedAppearance</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>                <span class="c1"># default: right to left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>                            <span class="c1"># default: (0, 99)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActuatorSlider</span><span class="p">)</span>

        <span class="c1"># output check box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Check to record an image sequence"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">"checkBoxOutput"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onOutputClicked</span><span class="p">)</span>

        <span class="c1"># forward button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"&gt;-&gt;"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onForward</span><span class="p">)</span>
        <span class="c1"># backward button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"&lt;-&lt;"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backward_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onBackward</span><span class="p">)</span>
        <span class="c1"># close button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">"Close window"</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onClose</span><span class="p">)</span>

        <span class="c1"># now make the window visible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getDriverType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
        <span class="n">ANGLE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PlaneCoincident"</span><span class="p">,</span>
            <span class="s2">"AxialAlignment"</span><span class="p">,</span>
            <span class="s2">"PlaneAlignment"</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use negative values, too</span>
        <span class="n">ANGLE_DEG_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"Angle"</span><span class="p">,</span>
            <span class="p">]</span> <span class="c1"># Angel constraints that use positive values only</span>
        <span class="n">DISTANCE_CONSTRAINTS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"PointDistance"</span><span class="p">,</span>
            <span class="s2">"PointsDistance"</span>
            <span class="p">]</span> <span class="c1"># Lenght constraints that use positive values only</span>
        <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Angle"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">ANGLE_DEG_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"AnglePos"</span>
        <span class="k">elif</span> <span class="n">constraint</span><span class="o">.</span><span class="n">ConstraintType</span> <span class="ow">in</span> <span class="n">DISTANCE_CONSTRAINTS</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Distance"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"Length"</span>

    <span class="k">def</span> <span class="nf">stepRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="k">return</span> <span class="n">ratio</span>

    <span class="k">def</span> <span class="nf">onEntryStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_start</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onEntryEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_end</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_end</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_end</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="c1"># Update the slider</span>
        <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onEntrySteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_steps</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_steps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onActuatorSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slider_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">=</span> <span class="n">slider_value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Angle"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"AnglePos"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver_type</span> <span class="o">==</span> <span class="s2">"Distance"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator</span><span class="o">.</span><span class="n">Offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_current</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">"Current value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_suffix</span><span class="p">)</span>
        <span class="n">FreeCADGui</span><span class="o">.</span><span class="n">updateGui</span><span class="p">()</span> <span class="c1"># screen update between steps</span>
        <span class="n">Gui</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="s2">"asm3CmdQuickSolve"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onForward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">end_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">steps_left</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">steps_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">+=</span> <span class="n">step</span>
            <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">steps_left</span><span class="p">)</span>
            <span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onBackward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_value</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="n">steps_left</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">steps_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-=</span> <span class="n">step</span>
            <span class="n">slider_value</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_value</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepRatio</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">slider_value</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">steps_left</span><span class="p">)</span>
            <span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actuator_slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onClose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="s2">"Closed"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">onOutputClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_check</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counter</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">image_path</span> <span class="o">=</span> <span class="s2">".../FreeCAD/ScreenShots/Sequence"</span>
            <span class="n">file_tag</span> <span class="o">=</span> <span class="s2">".png"</span>
            <span class="n">height</span> <span class="o">=</span> <span class="mi">640</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">480</span>
            <span class="n">background</span> <span class="o">=</span> <span class="s2">"Transparent"</span>
            <span class="c1"># dealing with leading zeros</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">999</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"Out of Range"</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">):</span>
                <span class="n">number</span> <span class="o">=</span> <span class="s2">"00"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">):</span>
                <span class="n">number</span> <span class="o">=</span> <span class="s2">"0"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="c1"># Screen shot</span>
            <span class="n">Gui</span><span class="o">.</span><span class="n">activeDocument</span><span class="p">()</span><span class="o">.</span><span class="n">activeView</span><span class="p">()</span><span class="o">.</span><span class="n">saveImage</span><span class="p">(</span><span class="n">image_path</span> <span class="o">+</span> <span class="n">number</span> <span class="o">+</span> <span class="n">file_tag</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">background</span><span class="p">)</span>

<span class="c1"># End of ControlPanel()</span>
<span class="c1"># Main section below:</span>

<span class="k">def</span> <span class="nf">findTheDrivingConstraints</span><span class="p">(</span><span class="n">document_object</span><span class="p">):</span>
    <span class="c1"># search through the Objects and find the driving constraint</span>
    <span class="n">driver_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">document_object</span><span class="o">.</span><span class="n">Objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">each</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"Driver"</span><span class="p">):</span>
            <span class="n">driving_constraint</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">driver_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">driving_constraint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">driver_list</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">kin_doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span> <span class="c1"># Kinematic Document</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="n">findTheDrivingConstraints</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">drivers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No driver found!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">panel_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">each_driver</span> <span class="ow">in</span> <span class="n">drivers</span><span class="p">:</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">ControlPanel</span><span class="p">(</span><span class="n">kin_doc</span><span class="p">,</span> <span class="n">each_driver</span><span class="p">)</span>
            <span class="n">panel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># This will be true only if the file is "executed"</span>
    <span class="c1"># but not if imported as a module</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div> 
</div> 
<p><a href="#top">En haut</a></p>
<p><span id="Some_imperfections"></span>
</p>
<h2><span class="mw-headline" id="Quelques_imperfections">Quelques imperfections</span></h2>
<ul><li>L'ordre de la s&eacute;quence d'images est invers&eacute; car nous utilisons la variable steps_left qui est d&eacute;compt&eacute;e.</li>
<li>Le r&eacute;pertoire et le nom de l'image sont cod&eacute;s en dur.</li>
<li>Les contr&ocirc;leurs multiples ne sont pas synchronis&eacute;s.</li></ul>
<!-- 
NewPP limit report
Cached time: 20250616183222
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc, no&#8208;toc&#8208;conversion]
CPU time usage: 0.402 seconds
Real time usage: 0.415 seconds
Preprocessor visited node count: 1190/1000000
Post&#8208;expand include size: 8579/2097152 bytes
Template argument size: 47323/2097152 bytes
Highest expansion depth: 4/100
Expensive parser function count: 37/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 221963/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   34.902      1 -total
 38.89%   13.574     37 Template:Code
 11.96%    4.174     75 Template:Incode
  7.74%    2.702      1 Template:TutorialInfo/fr
  7.26%    2.534      6 Template:Caption
  7.14%    2.493     10 Template:Top
  4.48%    1.565      2 Template:FileName
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:288093-0!canonical and timestamp 20250616183222 and revision id 1396653. Rendering was triggered because: api-parse
 -->
</div>
</div><script src="../site.js"></script>