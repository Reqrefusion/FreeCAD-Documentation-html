<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Scripted objects migration/de</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="de" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Scripted+objects+migration&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--high" lang="de" dir="ltr">Deutsch</span></li>
<li><a href="../Scripted_objects_migration.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Scripted objects migration (100% translated)" lang="en" dir="ltr">English</a></li>
<li><a href="../fr/Scripted_objects_migration.html" class="mw-pt-progress mw-pt-progress--complete" title="Migration d'objets cr&eacute;&eacute;s par script (100% translated)" lang="fr" dir="ltr">fran&ccedil;ais</a></li>
<li><a href="../it/Scripted_objects_migration.html" class="mw-pt-progress mw-pt-progress--low" title="Migrazione di oggetti creati con script (3% translated)" lang="it" dir="ltr">italiano</a></li>
<li><a href="../pl/Scripted_objects_migration.html" class="mw-pt-progress mw-pt-progress--complete" title="Obiekty tworzone skryptami, migracja (100% translated)" lang="pl" dir="ltr">polski</a></li>
<li><a href="../ru/Scripted_objects_migration.html" class="mw-pt-progress mw-pt-progress--low" title="Scripted objects migration/ru (0% translated)" lang="ru" dir="ltr">&#1088;&#1091;&#1089;&#1089;&#1082;&#1080;&#1081;</a></li></ul></div>
<p><span id="Introduction"></span>
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Einleitung">Einleitung</span></h2>
<p><a href="../de/Scripted_objects.html" title="Scripted objects/de">Geskriptete Objekte</a> werden jedes Mal neu aufgebaut, wenn ein <a href="../de/File_Format_FCStd.html" title="File Format FCStd/de">FCStd Dokument</a> ge&ouml;ffnet wird. Zu diesem Zweck beh&auml;lt das Dokument eine Referenz auf das Modul und die Python Klasse, die zur Erstellung des Objekts verwendet wurden, zusammen mit seinen Eigenschaften.
</p>
<div class="mw-highlight mw-highlight-lang-xml mw-content-ltr" dir="ltr"><pre><span></span><span class="nt">&lt;Document</span><span class="w"> </span><span class="na">SchemaVersion=</span><span class="s">"4"</span><span class="w"> </span><span class="na">ProgramVersion=</span><span class="s">"0.19R20959 (Git)"</span><span class="w"> </span><span class="na">FileVersion=</span><span class="s">"1"</span><span class="nt">&gt;</span>
<span class="w">    </span>...
<span class="w">    </span><span class="nt">&lt;Properties</span><span class="w"> </span><span class="na">Count=</span><span class="s">"15"</span><span class="w"> </span><span class="na">TransientCount=</span><span class="s">"3"</span><span class="nt">&gt;</span>
<span class="w">    </span>...
<span class="w">    </span><span class="nt">&lt;/Properties&gt;</span>
<span class="w">    </span><span class="nt">&lt;Objects</span><span class="w"> </span><span class="na">Count=</span><span class="s">"1"</span><span class="w"> </span><span class="na">Dependencies=</span><span class="s">"1"</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ObjectDeps</span><span class="w"> </span><span class="na">Name=</span><span class="s">"Custom"</span><span class="w"> </span><span class="na">Count=</span><span class="s">"0"</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;Object</span><span class="w"> </span><span class="na">type=</span><span class="s">"Part::FeaturePython"</span><span class="w"> </span><span class="na">name=</span><span class="s">"Custom"</span><span class="w"> </span><span class="na">id=</span><span class="s">"2715"</span><span class="w"> </span><span class="na">Touched=</span><span class="s">"1"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/Objects&gt;</span>
<span class="w">    </span><span class="nt">&lt;ObjectData</span><span class="w"> </span><span class="na">Count=</span><span class="s">"1"</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Object</span><span class="w"> </span><span class="na">name=</span><span class="s">"Custom"</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;Properties</span><span class="w"> </span><span class="na">Count=</span><span class="s">"9"</span><span class="w"> </span><span class="na">TransientCount=</span><span class="s">"0"</span><span class="nt">&gt;</span>
<span class="w">                </span>...
<span class="w">                </span><span class="nt">&lt;Property</span><span class="w"> </span><span class="na">name=</span><span class="s">"Proxy"</span><span class="w"> </span><span class="na">type=</span><span class="s">"App::PropertyPythonObject"</span><span class="w"> </span><span class="na">status=</span><span class="s">"1"</span><span class="nt">&gt;</span>
<span class="w">                    </span><span class="nt">&lt;Python</span><span class="w"> </span><span class="na">value=</span><span class="s">"eyJUeXBlIjogIkN1c3RvbSJ9"</span><span class="w"> </span><span class="na">encoded=</span><span class="s">"yes"</span><span class="w"> </span><span class="na">module=</span><span class="s">"old_module"</span><span class="w"> </span><span class="na">class=</span><span class="s">"OldObject"</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/Property&gt;</span>
<span class="w">                </span>...
<span class="w">            </span><span class="nt">&lt;/Properties&gt;</span>
<span class="w">        </span><span class="nt">&lt;/Object&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ObjectData&gt;</span>
<span class="nt">&lt;/Document&gt;</span>
</pre></div>
<p>Konzentriere dich besonders auf diesen Teil:
</p>
<div class="mw-highlight mw-highlight-lang-xml mw-content-ltr" dir="ltr"><pre><span></span>...
<span class="w">                </span><span class="nt">&lt;Property</span><span class="w"> </span><span class="na">name=</span><span class="s">"Proxy"</span><span class="w"> </span><span class="na">type=</span><span class="s">"App::PropertyPythonObject"</span><span class="w"> </span><span class="na">status=</span><span class="s">"1"</span><span class="nt">&gt;</span>
<span class="w">                    </span><span class="nt">&lt;Python</span><span class="w"> </span><span class="na">value=</span><span class="s">"eyJUeXBlIjogIkN1c3RvbSJ9"</span><span class="w"> </span><span class="na">encoded=</span><span class="s">"yes"</span><span class="w"> </span><span class="na">module=</span><span class="s">"old_module"</span><span class="w"> </span><span class="na">class=</span><span class="s">"OldObject"</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/Property&gt;</span>
<span class="w">                </span>...
</pre></div>
<p>Wenn der Wert von <code>module=</code> oder <code>class=</code> auf dem installierten System nicht gefunden wird, kann das Objekt nicht korrekt geladen werden. Das bedeutet, dass, sobald ein Objekt mit einer bestimmten Klasse erstellt wurde, das Modul nicht mehr verschoben oder umbenannt werden sollte, da zuvor gespeicherte Objekte sonst kaputt gehen.
</p><p>Ein triftiger Grund f&uuml;r die Verschiebung oder Umbenennung des Moduls oder der Klasse ist jedoch die Verbesserung der Struktur und Wartbarkeit des urspr&uuml;nglichen Codes, z.B. bei der Umstrukturierung einer ganzen Werkbank. In diesem Fall gibt es verschiedene Strategien, um alte Objekte auf die Verwendung einer neuen Klasse zu migrieren. Dies geschieht aus Gr&uuml;nden der Abw&auml;rtskompatibilit&auml;t, wenn ein v&ouml;lliges Aufbrechen alter Dokumente vermieden werden muss.
</p><p><span id="Old_object_and_new_object"></span>
</p>
<h2><span class="mw-headline" id="Altes_Objekt_und_neues_Objekt">Altes Objekt und neues Objekt</span></h2>
<p><span id="Old_object"></span>
</p>
<h3><span class="mw-headline" id="Altes_Objekt">Altes Objekt</span></h3>
<p>Ein altes Objekt wird in einem Baustein definiert, der sich an der Wurzel der Arbeitsbereichs befindet.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyLength"</span><span class="p">,</span> <span class="s2">"Length"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyArea"</span><span class="p">,</span> <span class="s2">"Area"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Area</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="s2">"Custom"</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
<p>Mit dieser Klasse kann ein Objekt erstellt und unter <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">mein_Dokument.FCstd</span> gespeichert werden. Wenn dem neuen Objekt kein bestimmter <a href="../de/Viewprovider.html" title="Viewprovider/de">Ansichtsanbieter</a> zugewiesen ist, wird seine Proxy Klasse einfach auf einen anderen Wert als <code>None</code> gesetzt, in diesem Fall auf <code>1</code>.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">FreeCAD</span> <span class="k">as</span> <span class="nn">App</span>
<span class="kn">import</span> <span class="nn">old_module</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">newDocument</span><span class="p">()</span>
<span class="n">doc</span><span class="o">.</span><span class="n">FileName</span> <span class="o">=</span> <span class="s2">"my_document.FCStd"</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="s2">"Part::FeaturePython"</span><span class="p">,</span> <span class="s2">"Custom"</span><span class="p">)</span>
<span class="n">old_module</span><span class="o">.</span><span class="n">OldObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="k">if</span> <span class="n">App</span><span class="o">.</span><span class="n">GuiUp</span><span class="p">:</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">ViewObject</span><span class="o">.</span><span class="n">Proxy</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">doc</span><span class="o">.</span><span class="n">recompute</span><span class="p">()</span>
<span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
<p><a href="../de/Python_console.html" class="mw-redirect" title="Python console/de">Python Konsole</a> Sitzung, bei der die grundlegenden Eigenschaften weggelassen wurden.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">Custom</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PropertiesList</span><span class="p">)</span>
<span class="p">[</span><span class="s1">'Area'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'Length'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">old_module</span><span class="o">.</span><span class="n">OldObject</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7efc3c51c390</span><span class="o">&gt;</span>
</pre></div>
<p><span id="New_object"></span>
</p>
<h3><span class="mw-headline" id="Neues_Objekt">Neues Objekt</span></h3>
<p>Nun betrachten wir, dass der Arbeitsbereich umstrukturiert wird, so dass sich die Klassen nicht nur im Stammverzeichnis, sondern stattdessen in einem <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">objects</span> Verzeichnis befinden. Komplexe Arbeitsbereiche, die viele verschiedene Arten von Objekten haben, sollten in Verzeichnissen strukturiert werden, die Objekte, <a href="../de/Viewprovider.html" title="Viewprovider/de">AnsichtBereitsteller</a>, <a href="../de/Command.html" title="Command/de">Gui Befehle</a>, <a href="../de/Task_panel.html" class="mw-redirect" title="Task panel/de">Aufgabenpaneel</a> Schnittstellen usw. enthalten.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># objects/new_module.py</span>
<span class="k">class</span> <span class="nc">NewObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyLength"</span><span class="p">,</span> <span class="s2">"Length"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyArea"</span><span class="p">,</span> <span class="s2">"GeneralArea"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyInteger"</span><span class="p">,</span> <span class="s2">"Divisions"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">GeneralArea</span> <span class="o">=</span> <span class="mi">600</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Divisions</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="s2">"Custom"</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
<p>Diese neue Klasse wird sich auf den gleichen Objekttyp beziehen, aber sowohl der Modulname als auch der Klassenname wurden umbenannt. Dar&uuml;ber hinaus haben sich auch die Eigenschaften ge&auml;ndert; eine Eigenschaft wurde umbenannt, und eine v&ouml;llig neue Eigenschaft wurde hinzugef&uuml;gt.
</p><p>Wenn wir ein neues Objekt mit diesem neuen Modul erstellen, haben wir die folgende Konsolensitzung.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj2</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">Custom2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj2</span><span class="o">.</span><span class="n">PropertiesList</span><span class="p">)</span>
<span class="p">[</span><span class="s1">'Divisions'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'GeneralArea'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'Length'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj2</span><span class="o">.</span><span class="n">Proxy</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">objects</span><span class="o">.</span><span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7efc1cf68c50</span><span class="o">&gt;</span>
</pre></div>
<p><span id="Method_1._Migration_by_redirecting_the_class"></span>
</p>
<h2><span class="mw-headline" id="Methode_1._Migration_durch_Umleitung_der_Klasse">Methode 1. Migration durch Umleitung der Klasse</span></h2>
<p>Wir werden das &auml;ltere Objekt migrieren, indem wir die alte Klasse umleiten. Die urspr&uuml;ngliche Klasse wird gel&ouml;scht, und der Name der Klasse wird einfach umgeleitet, um auf die neue Klasse zu verweisen.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="kn">import</span> <span class="nn">objects.new_module</span> <span class="k">as</span> <span class="nn">new_module</span>

<span class="n">OldObject</span> <span class="o">=</span> <span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span>
</pre></div>
<p>Jedes Dokument, das versucht, <code>old_module.OldObject</code> zu laden, wird stattdessen zum Laden von <code>objects.new_module.NewObject</code> umgeleitet.
</p><p>Wenn wir das Dokument &ouml;ffnen und die Eigenschaften des Objekts in der <a href="../de/Python_console.html" class="mw-redirect" title="Python console/de">Python Konsole</a> &uuml;berpr&uuml;fen, werden wir sehen, dass die &auml;lteren Eigenschaften erhalten bleiben, das Objekt aber eine neue Proxy Klasse hat.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">Custom</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PropertiesList</span><span class="p">)</span>
<span class="p">[</span><span class="s1">'Area'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'Length'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">objects</span><span class="o">.</span><span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7f099700b2b0</span><span class="o">&gt;</span>
</pre></div>
<p>In diesem Fall sehen wir jedoch nicht die neuen Eigenschaften der neuen Klasse. Der Grund daf&uuml;r ist einfach, dass das &auml;ltere Objekt diese Eigenschaften nicht hatte. Wenn <code>old_module.OldObject</code> zu <code>objects.new_module.NewObject</code> umgeleitet wurde, &auml;nderte sich nur die Proxy Klasse, aber die vorherigen Informationen wurden beibehalten.
</p><p>Wenn das Dokument nun gespeichert und wieder ge&ouml;ffnet wird, sucht es automatisch nach <code>objects.new_module.NewObject</code>, und es ben&ouml;tigt nicht mehr <code>old_module.OldObject</code>. Die Datei <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">old_module.py</span> kann dauerhaft aus dem System entfernt werden, solange alle &auml;lteren Objekte in das neue Modul migriert worden sind. Wenn das alte Modul entfernt wird, aber ein Objekt nicht migriert wurde, zeigt die <a href="../de/Report_view.html" class="mw-redirect" title="Report view/de">Berichtsansicht</a> beim &Ouml;ffnen eines Dokuments, das ein solches Objekt enth&auml;lt, eine Meldung wie diese an.
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>&lt;class<span class="w"> </span><span class="s1">'ModuleNotFoundError'</span>&gt;:<span class="w"> </span>No<span class="w"> </span>module<span class="w"> </span>named<span class="w"> </span><span class="s1">'old_module'</span>
</pre></div>
<p>Wenn es realistischerweise nicht m&ouml;glich ist, alle &auml;lteren Objekte zu migrieren, z.B. weil das alte Modul viele Jahre lang in einem Arbeitsbereich verwendet wurde, muss <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">old_module.py</span> so lange beibehalten werden, wie es f&uuml;r notwendig erachtet wird, um den Benutzern die M&ouml;glichkeit zu geben, ihre Objekte zu migrieren.
</p><p><span id="Advantages_and_disadvantages"></span>
</p>
<h3><span class="mw-headline" id="Vor-_und_Nachteile">Vor- und Nachteile</span></h3>
<p><b>Vorteile</b>
</p>
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> Dies ist die einfachste Methode, bei der lediglich eine alte Klasse in eine neue Klasse umgeleitet werden muss.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span>  Alte Eigenschaften bleiben erhalten, solange die neue Klasse sie nicht au&szlig;er Kraft setzt.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span>  Dies ist gut, wenn die alte Klasse und die neue Klasse die gleichen Eigenschaften haben (die gleiche Art von Daten verarbeiten), aber nur ihr Modul- oder Klassenname unterschiedlich ist.</li></ul>
<p><b>Nachteile</b>
</p>
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> Die neue Klasse beh&auml;lt die alten Eigenschaften des Objekts bei, was nicht immer erw&uuml;nscht ist.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> Neue Eigenschaften oder umbenannte Eigenschaften werden nicht behandelt, so dass das Objekt zwar geladen wird, aber m&ouml;glicherweise nicht das korrekte Verhalten der neuen Klasse zeigt.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> Das alte Modul muss m&ouml;glicherweise auf unbestimmte Zeit aufbewahrt werden, um alle alten, in der Vergangenheit erstellten Objekte zu migrieren.</li></ul>
<p><span id="Method_2._Migration_when_restoring_the_document"></span>
</p>
<h2><span class="mw-headline" id="Methode_2._Migration_beim_Wiederherstellen_des_Dokuments">Methode 2. Migration beim Wiederherstellen des Dokuments</span></h2>
<p>Wir werden das &auml;ltere Objekt migrieren, indem wir die alte Klasse modifizieren. Der Gro&szlig;teil der urspr&uuml;nglichen Klasse wird gel&ouml;scht, und stattdessen wird die Methode <code>onDocumentRestored</code> implementiert. Wenn diese Methode vorhanden ist, wird sie ausgef&uuml;hrt, wenn das Dokument versucht, ein Objekt wiederherzustellen, das die Klasse verwendet. Dies ist also die Gelegenheit, eine neue Klasse zuzuweisen, die Informationen zu manipulieren oder Nachrichten zu drucken.
</p><p>In diesem Fall nehmen wir an, dass wir auch einen neuen <a href="../de/Viewprovider.html" title="Viewprovider/de">AnsichtBereitsteller</a> im Modul <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">viewp/new_view.py</span> definiert haben. Wenn wir diese Klasse nicht migrieren wollen, k&ouml;nnen wir nach der Pr&uuml;fung <code>App.GuiUp</code> alles weglassen.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="kn">import</span> <span class="nn">FreeCAD</span> <span class="k">as</span> <span class="nn">App</span>
<span class="kn">import</span> <span class="nn">objects.new_module</span> <span class="k">as</span> <span class="nn">new_module</span>
<span class="kn">import</span> <span class="nn">viewp.new_view</span> <span class="k">as</span> <span class="nn">new_view</span>
<span class="n">_wrn</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">Console</span><span class="o">.</span><span class="n">PrintWarning</span>

<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">onDocumentRestored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New proxy class used</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">App</span><span class="o">.</span><span class="n">GuiUp</span><span class="p">:</span>
            <span class="n">new_view</span><span class="o">.</span><span class="n">ViewProviderNew</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ViewObject</span><span class="p">)</span>
            <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New viewprovider class used</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<p>In einem komplexeren Beispiel wird zun&auml;chst gepr&uuml;ft, ob die Proxy Klasse dem gesuchten Typ entspricht, und erst dann mit der Migration fortgefahren, wenn es sich um den richtigen Typ handelt.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">onDocumentRestored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">"Proxy"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s2">"Custom"</span><span class="p">:</span>
            <span class="n">_module</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
            <span class="n">_module</span> <span class="o">=</span> <span class="n">_module</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">"&lt;class '"</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">"'&gt;"</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_module</span> <span class="o">==</span> <span class="s2">"old_module.OldObject"</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_migrate</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_migrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New proxy class used</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">App</span><span class="o">.</span><span class="n">GuiUp</span><span class="p">:</span>
            <span class="n">new_view</span><span class="o">.</span><span class="n">ViewProviderNew</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ViewObject</span><span class="p">)</span>
            <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New viewprovider class used</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<p>Wenn wir davon ausgehen, dass wir das alte Modul bereits auf diese Weise ge&auml;ndert haben, werden wir, wenn wir ein Dokument mit einem alten Objekt &ouml;ffnen, die Meldungen sehen, in denen die Verwendung der neuen Klassen erw&auml;hnt wird.
</p><p>Wenn wir das Objekt von der <a href="../de/Python_console.html" class="mw-redirect" title="Python console/de">Python Konsole</a> aus inspizieren, werden wir sehen, dass die &auml;lteren Eigenschaften erhalten geblieben sind, und zus&auml;tzlich wurden zusammen mit der neuen Proxy Klasse neue Eigenschaften hinzugef&uuml;gt.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">Custom</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PropertiesList</span><span class="p">)</span>
<span class="p">[</span><span class="s1">'Area'</span><span class="p">,</span> <span class="s1">'Divisions'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'GeneralArea'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'Length'</span><span class="p">,</span> <span class="s1">'Length1'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">objects</span><span class="o">.</span><span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7fecb0ebd7b8</span><span class="o">&gt;</span>
</pre></div>
<p>Die alten Eigenschaften waren <code>Area</code> und <code>Length</code>; die neuen Eigenschaften sind <code>Divisions</code>, <code>GeneralArea</code> und <code>Length</code>. Das migrierte Objekt beh&auml;lt die beiden urspr&uuml;nglichen Eigenschaften bei und erh&auml;lt drei neue Eigenschaften. Da die neue <code>Length</code> jedoch denselben Namen wie die &auml;ltere Eigenschaft hat, wird die neue Eigenschaft mit einer inkrementellen Nummer umbenannt. Vermutlich ist dies nicht das, was wir wollen. Wir k&ouml;nnen die Situation verbessern, indem wir dem Zusatz 2.1 unten folgen.
</p><p>Da die Klassen den gleichen Objekttyp behandeln sollen, w&uuml;nschen wir uns eine Migration, bei der sich <code>Area</code> in <code>GeneralArea</code> verwandelt und <code>Length</code> einfach dem neuen <code>Length</code> zugewiesen wird und es keine doppelten Eigenschaften gibt.
</p><p><span id="Advantages_and_disadvantages"></span>
</p>
<h3><span class="mw-headline" id="Vor-_und_Nachteile_2">Vor- und Nachteile</span></h3>
<p><b>Vorteile</b>
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> This method allows us to check that the class that we are migrating is the right class, instead of simply redirecting to a newer class.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> Similar to method 1, old properties are kept as long as the new class doesn't override them.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> Unlike method 1, new properties are always added, however if they have the same name, they will be renamed.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> The migration is not immediate, we can still manipulate the information, or print messages while the object loads.</li></ul>
</div>
<p><b>Nachteile</b>
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> It is more verbose than method 1 because we need to implement the <code>onDocumentRestored</code> method to migrate the object.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> It always adds the new properties, so it may create duplicated properties in case the new properties have the same name as the old properties. This has to be handled manually.</li></ul>
</div>
<p><span id="Method_3._Migration_when_restoring_the_document,_manually_handling_the_properties"></span>
</p>
<h2><span id="Methode_3._Migration_beim_Wiederherstellen_des_Dokuments.2C_manuelle_Handhabung_der_Eigenschaften"></span><span class="mw-headline" id="Methode_3._Migration_beim_Wiederherstellen_des_Dokuments,_manuelle_Handhabung_der_Eigenschaften">Methode 3. Migration beim Wiederherstellen des Dokuments, manuelle Handhabung der Eigenschaften</span></h2>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>This is an extension of method 2. In the <code>onDocumentRestored</code> method we need to save the values of the properties that we want, and then we can remove these original properties. This is done so that when the new class is used, it will assign the new properties without risking name collisions with the older properties.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Like in method 2, if we want we can also add the piece of code that checks that the Proxy class is the right one. In this example once more we assume that we are using a custom <a href="../Viewprovider.html" title="Viewprovider">viewprovider</a>, with at least one custom property.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="kn">import</span> <span class="nn">FreeCAD</span> <span class="k">as</span> <span class="nn">App</span>
<span class="kn">import</span> <span class="nn">objects.new_module</span> <span class="k">as</span> <span class="nn">new_module</span>
<span class="kn">import</span> <span class="nn">viewp.new_view</span> <span class="k">as</span> <span class="nn">new_view</span>
<span class="n">_wrn</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">Console</span><span class="o">.</span><span class="n">PrintWarning</span>

<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">onDocumentRestored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">old</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Area</span>
        <span class="n">old</span><span class="p">[</span><span class="s2">"Length"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Length</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Area"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Length"</span><span class="p">)</span>

        <span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">GeneralArea</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="n">old</span><span class="p">[</span><span class="s2">"Length"</span><span class="p">]</span>
        <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New proxy class used; properties migrated</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">App</span><span class="o">.</span><span class="n">GuiUp</span><span class="p">:</span>
            <span class="n">vobj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">ViewObject</span>
            <span class="n">old</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

            <span class="n">old</span><span class="p">[</span><span class="s2">"LineScale"</span><span class="p">]</span> <span class="o">=</span> <span class="n">vobj</span><span class="o">.</span><span class="n">LineScale</span>
            <span class="n">vobj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"LineScale"</span><span class="p">)</span>

            <span class="n">new_view</span><span class="o">.</span><span class="n">ViewProviderNew</span><span class="p">(</span><span class="n">vobj</span><span class="p">)</span>

            <span class="n">vobj</span><span class="o">.</span><span class="n">LineScale</span> <span class="o">=</span> <span class="mf">1.05</span> <span class="o">*</span> <span class="n">old</span><span class="p">[</span><span class="s2">"LineScale"</span><span class="p">]</span>
            <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New viewprovider class used; view properties migrated</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>We can see that the old values are stored in an auxiliary dictionary, then the old properties are removed, then we add the new class, and finally we assign the previously saved values to the new properties. In this moment we can transform the saved values as necessary for the new class. For example, the <code>GeneralArea</code> is set to 3 times the old <code>Area</code>, and the new <code>Length</code> simply receives the value of the old <code>Length</code>. As we know how the old and new classes are supposed to behave, we have the liberty of manipulating the data to migrate the object as we want.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>We can only remove properties that were added by <a href="../Python.html" title="Python">Python</a> classes when we built the <a href="../Scripted_objects.html" title="Scripted objects">scripted object</a>. Other attributes belong to the base C++ object and can't be removed.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Visibility"</span><span class="p">)</span>
<span class="kc">False</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Assuming that we already changed the old module in this way, if we open a document with an old object, we will see the messages mentioning the use of the new classes. Inspecting the object from the <a href="../Python_console.html" class="mw-redirect" title="Python console">Python console</a> we see that the older properties are removed, and only the new properties exist.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">Custom</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PropertiesList</span><span class="p">)</span>
<span class="p">[</span><span class="s1">'Divisions'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'GeneralArea'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'Length'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">objects</span><span class="o">.</span><span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7efd456c9b00</span><span class="o">&gt;</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Since in the old class the <code>Divisions</code> property didn't exist, nothing was done with it. It simply was created by the new <code>objects.new_module.NewObject</code> class.
</p>
</div>
<p><span id="Advantages_and_disadvantages"></span>
</p>
<h3><span class="mw-headline" id="Vor-_und_Nachteile_3">Vor- und Nachteile</span></h3>
<p><b>Vorteile</b>
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> Similar to method 2, this method allows us to check that the class that we are migrating is the right class.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> We have complete control of what to do with the old properties. Typically they will be removed so that there is no name collision with new properties added. Thus we avoid duplicated properties.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> By saving the older values, we can manipulate the information in the restoring step as we want, and assign the corresponding values to the new properties.</li></ul>
</div>
<p><b>Nachteile</b>
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> This method is very verbose compared to the previous ones, because we must implement the <code>onDocumentRestored</code> method, and handle each of the properties individually (save value, delete property, re-assign value). This is problematic if the object that we want to migrate has many properties, or their values need to be transformed in very special ways.</li></ul>
</div>
<p><span id="Addendum_A._Creating_the_properties_only_if_they_do_not_already_exist"></span>
</p>
<h2><span id="Zusatz_A._Erstellen_der_Eigenschaften_nur.2C_wenn_sie_noch_nicht_vorhanden_sind"></span><span class="mw-headline" id="Zusatz_A._Erstellen_der_Eigenschaften_nur,_wenn_sie_noch_nicht_vorhanden_sind">Zusatz A. Erstellen der Eigenschaften nur, wenn sie noch nicht vorhanden sind</span></h2>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>One of the disadvantages of method 2 is that it will always try to add the new properties. If the older properties have the same name as the new properties, they will be duplicated with an incremental number, so <code>Length</code> will result in <code>Length1</code>, then <code>Length2</code>, and so on. This makes method 2 an unrealistic option in most cases, because the new class will only use one property anyway.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>To improve this method, the new class can also be modified to only add the properties if they don't already exist by the same name.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># objects/new_module.py</span>
<span class="k">class</span> <span class="nc">NewObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">"Length"</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyLength"</span><span class="p">,</span> <span class="s2">"Length"</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">"GeneralArea"</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyArea"</span><span class="p">,</span> <span class="s2">"GeneralArea"</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">GeneralArea</span> <span class="o">=</span> <span class="mi">600</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">"Divisions"</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyInteger"</span><span class="p">,</span> <span class="s2">"Divisions"</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">Divisions</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="s2">"Custom"</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>In this case, since <code>Length</code> already exists, it won't be added again; <code>GeneralArea</code> and <code>Divisions</code> don't exist, so these will be added. And just like before, <code>Area</code> will be retained because it is not explicitly removed, although possibly it is no longer used in the new class.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">Custom</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PropertiesList</span><span class="p">)</span>
<span class="p">[</span><span class="s1">'Area'</span><span class="p">,</span> <span class="s1">'Divisions'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'GeneralArea'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'Length'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">objects</span><span class="o">.</span><span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7f036bd4c6a0</span><span class="o">&gt;</span>
</pre></div>
<p>Das Gleiche kann f&uuml;r die Klasse der <a href="../de/Viewprovider.html" title="Viewprovider/de">Viewprovider</a> getan werden.
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>By using this method 2 + A, the result is similar to method 1 in that the object will retain all previous properties, but in addition it will gain the new properties provided by the new class.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Method 3 does not need this addendum to the new class because the older properties are explicitly removed, so there won't be any conflicts when installing the new properties. Nevertheless, it is still a good practice that every class adds its required properties only if these don't already exist. This is helpful both in the case of creating new <a href="../Scripted_objects.html" title="Scripted objects">scripted objects</a> or in migrating them.
</p>
</div>
<p><span id="Advantages_and_disadvantages"></span>
</p>
<h3><span class="mw-headline" id="Vor-_und_Nachteile_4">Vor- und Nachteile</span></h3>
<p><b>Vorteile</b>
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> The object will retain all previous properties, but in addition it will gain new properties without repetition.</li></ul>
</div>
<p><b>Nachteile</b>
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> Like method 2, it still doesn't deal with renamed properties. The old properties should be manually removed.</li></ul>
</div>
<p><span id="Addendum_B._Migrating_different_versions_of_the_old_object"></span>
</p>
<h2><span class="mw-headline" id="Zusatz_B._Migrieren_verschiedener_Versionen_des_alten_Objekts">Zusatz B. Migrieren verschiedener Versionen des alten Objekts</span></h2>
<p>Methode 3 ist die komplexeste Methode, da die Eigenschaften einzeln behandelt werden. Allerdings haben wir bei dieser Methode auch volle Flexibilit&auml;t bei der Bearbeitung der Daten, was ein Vorteil ist, wenn wir komplexe Operationen durchf&uuml;hren m&ouml;chten.
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>If from the beginning we create a property that holds the version number of our object, we can use this number in the future to perform specific migration from that version to any other. We set the property to be read-only, so that we cannot overwrite it in the <a href="../Property_editor.html" class="mw-redirect" title="Property editor">property editor</a>, although it is still accessible from the <a href="../Python_console.html" class="mw-redirect" title="Python console">Python console</a>.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyLength"</span><span class="p">,</span> <span class="s2">"Length"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyArea"</span><span class="p">,</span> <span class="s2">"Area"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyString"</span><span class="p">,</span> <span class="s2">"Version"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">setEditorMode</span><span class="p">(</span><span class="s2">"Version"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Area</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="s2">"0.18"</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="s2">"Custom"</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
<p>Wenn wir dann das Objekt migrieren m&ouml;chten, implementieren wir die Methode <code>onDocumentRestored</code> und testen diese Version.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="kn">import</span> <span class="nn">FreeCAD</span> <span class="k">as</span> <span class="nn">App</span>
<span class="kn">import</span> <span class="nn">objects.new_module</span> <span class="k">as</span> <span class="nn">new_module</span>
<span class="n">_wrn</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">Console</span><span class="o">.</span><span class="n">PrintWarning</span>

<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">onDocumentRestored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">"Version"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">Version</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">Version</span> <span class="o">==</span> <span class="s2">"0.18"</span><span class="p">:</span>
                <span class="n">_migrate_from_018</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Version</span> <span class="o">==</span> <span class="s2">"0.19"</span><span class="p">:</span>
                <span class="n">_migrate_from_019</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_migrate_from_018</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="n">old</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Area</span>
    <span class="n">old</span><span class="p">[</span><span class="s2">"Length"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Length</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Area"</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Length"</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Version"</span><span class="p">)</span>

    <span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="n">obj</span><span class="o">.</span><span class="n">GeneralArea</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="n">old</span><span class="p">[</span><span class="s2">"Length"</span><span class="p">]</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="s2">"0.20"</span>
    <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New proxy class used; properties migrated</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_migrate_from_019</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>We don't save the <code>Version</code> value as we will set a new <code>Version</code> number when doing the migration. As shown in the example, we can implement various functions for each corresponding version of the object that we intend to migrate. We omit the migration of the <a href="../Viewprovider.html" title="Viewprovider">viewprovider</a> properties but it follows the same pattern.
</p>
</div>
<p><span id="Advantages_and_disadvantages"></span>
</p>
<h3><span class="mw-headline" id="Vor-_und_Nachteile_5">Vor- und Nachteile</span></h3>
<p><b>Vorteile</b>
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> We have complete control of what to do with the old properties, and how to perform the migration.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> We can implement a particular method to migrate a particular version of the old object.</li></ul>
</div>
<p><b>Nachteile</b>
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> This method is very verbose because we must have a clear idea on how to handle each of the properties of each "version" that we want to migrate. If our object has many different versions created over the years, we may have to prepare a long list of methods to migrate them to the newest object.</li></ul>
</div>
<p><span id="Addendum_B2._Using_internal_class_attributes_instead_of_properties"></span>
</p>
<h2><span class="mw-headline" id="Zusatz_B2._Verwendung_interner_Klassenattribute_anstelle_von_Eigenschaften">Zusatz B2. Verwendung interner Klassenattribute anstelle von Eigenschaften</span></h2>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Instead of using a <a href="../Property.html" title="Property">property</a> of the object to hold the version information, we can use an attribute of the class. In this way we "hide" the version information, because properties are normally public, and visible in the <a href="../Property_editor.html" class="mw-redirect" title="Property editor">property editor</a>, while class attributes can only be manipulated from the <a href="../Python_console.html" class="mw-redirect" title="Python console">Python console</a>. Class attributes can be saved and restored as explained in <a href="../Scripted_objects_saving_attributes.html" title="Scripted objects saving attributes">Scripted objects saving attributes</a>.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyLength"</span><span class="p">,</span> <span class="s2">"Length"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyArea"</span><span class="p">,</span> <span class="s2">"Area"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Area</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="s2">"Custom"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ver</span> <span class="o">=</span> <span class="s2">"0.18"</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
<p>Dieses Attribut wird durch &Uuml;berpr&uuml;fen des Attributs <code>Proxy</code> &uuml;berpr&uuml;ft.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">Custom</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="n">ver</span><span class="p">)</span>
<span class="mf">0.18</span>
</pre></div>
<p>Anschlie&szlig;end wird die Datei ge&auml;ndert, um das Objekt zu migrieren.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="kn">import</span> <span class="nn">FreeCAD</span> <span class="k">as</span> <span class="nn">App</span>
<span class="kn">import</span> <span class="nn">objects.new_module</span> <span class="k">as</span> <span class="nn">new_module</span>
<span class="n">_wrn</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">Console</span><span class="o">.</span><span class="n">PrintWarning</span>

<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">onDocumentRestored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="p">,</span> <span class="s2">"ver"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="n">ver</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="n">ver</span> <span class="o">==</span> <span class="s2">"0.18"</span><span class="p">:</span>
                <span class="n">_migrate_from_018</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_migrate_from_018</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="n">old</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Area</span>
    <span class="n">old</span><span class="p">[</span><span class="s2">"Length"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Length</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Area"</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Length"</span><span class="p">)</span>

    <span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="n">obj</span><span class="o">.</span><span class="n">GeneralArea</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="n">old</span><span class="p">[</span><span class="s2">"Length"</span><span class="p">]</span>
    <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New proxy class used; properties migrated</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<p>Wenn wir die neue Klasse installieren, sollte diese neue Klasse den neuen Wert des Versionsattributs festlegen, zum Beispiel <code>self.ver = "0.20"</code>.
</p><p><span id="Addendum_C._Method_3_without_removing_old_properties_that_are_named_the_same"></span>
</p>
<h2><span class="mw-headline" id="Zusatz_C._Methode_3_ohne_Entfernung_alter_Eigenschaften_mit_gleichem_Namen">Zusatz C. Methode 3 ohne Entfernung alter Eigenschaften mit gleichem Namen</span></h2>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Like in Addendum A, we can write the new class to create properties only if they aren't already present. Using method 3, we save the values of the older properties, and subsequently delete the older properties. However, if the new properties are named the same as the older ones, we don't need to delete the older ones, we can just reuse the same property, as we know the property won't be duplicated. If we are using Addendum B, we have a way to query the version as well.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="kn">import</span> <span class="nn">FreeCAD</span> <span class="k">as</span> <span class="nn">App</span>
<span class="kn">import</span> <span class="nn">objects.new_module</span> <span class="k">as</span> <span class="nn">new_module</span>
<span class="n">_wrn</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">Console</span><span class="o">.</span><span class="n">PrintWarning</span>

<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">onDocumentRestored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">"Version"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">Version</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">Version</span> <span class="o">==</span> <span class="s2">"0.18"</span><span class="p">:</span>
                <span class="n">_migrate_from_018</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_migrate_from_018</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="n">old</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Area</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Area"</span><span class="p">)</span>

    <span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="n">obj</span><span class="o">.</span><span class="n">GeneralArea</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="s2">"0.20"</span>
    <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New proxy class used; properties migrated</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>As we see in the example, the old <code>Area</code> property is deleted and migrated to the new <code>GeneralArea</code> property as usual. We do not need to delete <code>Length</code> nor <code>Version</code> because in the new class they are still used with the same name, and they won't be created again (addendum A). As we don't want to modify <code>Length</code>, this property is not touched at all; it is migrated to the new class silently. However, we do update <code>Version</code> to the new value. We omit the migration of the <a href="../Viewprovider.html" title="Viewprovider">viewprovider</a> properties but it follows the same pattern.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>This should work like method 3, meaning that the old properties are removed and only the new properties remain in the new object. The only difference is that we omit removing and recreating the properties that are named the same. This process should work as long as the old <a href="../Property.html" title="Property">property</a> and the new <a href="../Property.html" title="Property">property</a> have the same type (for example, <code>App::PropertyLength</code> or <code>App::PropertyArea</code>), so the old property can pass its value directly. However, if the new property has a different type than the old property, then the old property should be removed, otherwise the old property will completely overwrite the new property, which is probably not what we want because the new class will be expecting the new type and not the old type.
</p>
</div>
<p><span id="Advantages_and_disadvantages"></span>
</p>
<h3><span class="mw-headline" id="Vor-_und_Nachteile_6">Vor- und Nachteile</span></h3>
<p><b>Vorteile</b>
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> Like method 3, this method allows us complete control of the migration of the old information.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> We avoid writing code that removes and recreates properties that are named the same.</li></ul>
</div>
<p><b>Nachteile</b>
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> Like method 3, this method is still very verbose because we have to handle the properties carefully.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span> If a new <a href="../Property.html" title="Property">property</a> and an old <a href="../Property.html" title="Property">property</a> share the same name, the new property will be overwritten, which may be undesired behavior, especially if the two properties have different types. In this case, removing the old property, and migrating its value manually is still necessary.</li></ul>
</div>
<p><span id="Summary"></span>
</p>
<h2><span class="mw-headline" id="Zusammenfassung">Zusammenfassung</span></h2>
<p>Jede der Methoden hat eine empfohlene Anwendung:
</p>
<ul><li>Methode 1. Das Modul wird verschoben oder umbenannt, aber die Eigenschaften sind die gleichen. Einfache Umleitung von Klassen, da die Eigenschaften &uuml;berhaupt nicht ge&auml;ndert werden m&uuml;ssen.</li>
<li>Methode 2+A. Einfache Migrationsszenarien. Anzeige einer Nachricht, wenn das Objekt von einer Klasse in eine andere migriert wird. Die Eigenschaften sind vom gleichen Typ und brauchen &uuml;berhaupt nicht ge&auml;ndert zu werden.</li>
<li>Methode 3, 3+A oder 3+B. Komplexe Migrationsszenarien. Volle Kontrolle &uuml;ber die Eigenschaften, L&ouml;schen der alten Eigenschaften und Hinzuf&uuml;gen neuer Eigenschaften. Ein Identifikator zur Kenntnis der Version des Objekts ist n&uuml;tzlich, um die richtige Funktion zur Durchf&uuml;hrung der Migration zu w&auml;hlen (Zusatz B oder B2).</li></ul>
<p>Vermeide vorzugsweise Folgendes:
</p>
<ul><li>Methode 2. Die Eigenschaften werden dupliziert, wenn die neue Klasse nicht auf vorhandene Eigenschaften pr&uuml;ft (Zusatz A).</li>
<li>Methode 3+C. Nur verwenden, wenn die alten Eigenschaften und die neuen Eigenschaften vom gleichen Typ sind. Andernfalls verwende Methode 3 oder 3+B, um &auml;ltere Eigenschaften zu entfernen, und behandele sie genau nach Bedarf.</li></ul>
<p><span id="Links"></span>
</p>
<h2><span class="mw-headline" id="Verweise">Verweise</span></h2>
<ul><li><a rel="nofollow" class="external text" href="https://forum.freecad.org/viewtopic.php?t=42948">Migrating and upgrading old scripted objects</a></li>
<li><a rel="nofollow" class="external text" href="https://forum.freecad.org/viewtopic.php?f=18&amp;t=46218">Migrate old scripted objects</a></li></ul>
<div class="NavFrame" style="margin: 0px; text-align: center; border-collapse: collapse; font-size: 100%; border-top-style: double; border-top-style: 1px; clear:both;">
    <div class="NavHead mw-collapsible mw-collapsed" style="margin: 1px; font-weight: normal; background-color: var(--background-color-neutral-subtle, #fefefe);"><span typeof="mw:File"><a href="../index.php?title=Power_user_hub.png&amp;filetimestamp=20200511213015&amp;.html" class="mw-file-description"><img src="../File/Power_user_hub.png" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="128" data-file-height="128"></a></span> <a href="../de/Power_users_hub.html" title="Power users hub/de">Power user documentation</a>
        <div class="NavContent mw-collapsible-content" style="margin: 10px; border: 1px solid var(--border-color-base, #aaaaaa); text-align: left; border-collapse: collapse; font-weight: normal; font-size: 100%; clear:both; margin-top: 1px; background-color: var(--background-color-neutral-subtle, #fefefe);">
<ul><li><b>FreeCAD scripting:</b> <a href="../de/Python.html" title="Python/de">Python</a>, <a href="../de/Introduction_to_Python.html" title="Introduction to Python/de">Introduction to Python</a>, <a href="../de/Python_scripting_tutorial.html" title="Python scripting tutorial/de">Python scripting tutorial</a>, <a href="../de/FreeCAD_Scripting_Basics.html" title="FreeCAD Scripting Basics/de">FreeCAD Scripting Basics</a></li></ul>
<hr>
<ul><li><b>Modules:</b> <a href="../de/Builtin_modules.html" title="Builtin modules/de">Builtin modules</a>, <a href="../de/Units.html" title="Units/de">Units</a>, <a href="../de/Quantity.html" title="Quantity/de">Quantity</a></li>
<li><b>Workbenches:</b> <a href="../de/Workbench_creation.html" title="Workbench creation/de">Workbench creation</a>, <a href="../de/Gui_Command.html" title="Gui Command/de">Gui Commands</a>, <a href="../de/Command.html" title="Command/de">Commands</a>, <a href="../de/Installing_more_workbenches.html" title="Installing more workbenches/de">Installing more workbenches</a></li>
<li><b>Meshes and Parts:</b> <a href="../de/Mesh_Scripting.html" title="Mesh Scripting/de">Mesh Scripting</a>, <a href="../de/Topological_data_scripting.html" title="Topological data scripting/de">Topological data scripting</a>, <a href="../de/Mesh_to_Part.html" title="Mesh to Part/de">Mesh to Part</a>, <a href="../de/PythonOCC.html" title="PythonOCC/de">PythonOCC</a></li></ul>
<hr>
<ul><li><b>Parametric objects:</b> <a href="../de/Scripted_objects.html" title="Scripted objects/de">Scripted objects</a>, <a href="../de/Viewprovider.html" title="Viewprovider/de">Viewproviders</a> <small>(<a href="../de/Custom_icon_in_tree_view.html" title="Custom icon in tree view/de">Custom icon in tree view</a>)</small></li>
<li><b>Scenegraph:</b> <a href="../de/Scenegraph.html" title="Scenegraph/de">Coin (Inventor) scenegraph</a>, <a href="../de/Pivy.html" title="Pivy/de">Pivy</a></li>
<li><b>Graphical interface:</b> <a href="../de/Interface_creation.html" title="Interface creation/de">Interface creation</a>, <a href="../de/Dialog_creation.html" title="Dialog creation/de">Interface creation completely in Python</a> <small>(<a href="../de/Dialog_creation_with_various_widgets.html" title="Dialog creation with various widgets/de">1</a>, <a href="../de/Dialog_creation_reading_and_writing_files.html" title="Dialog creation reading and writing files/de">2</a>, <a href="../de/Dialog_creation_setting_colors.html" title="Dialog creation setting colors/de">3</a>, <a href="../de/Dialog_creation_image_and_animated_GIF.html" title="Dialog creation image and animated GIF/de">4</a>, <a href="../de/PySide_usage_snippets.html" title="PySide usage snippets/de">5</a>)</small>, <a href="../de/PySide.html" title="PySide/de">PySide</a>, PySide examples <a href="../de/PySide_Beginner_Examples.html" title="PySide Beginner Examples/de">beginner</a>, <a href="../de/PySide_Intermediate_Examples.html" title="PySide Intermediate Examples/de">intermediate</a>, <a href="../de/PySide_Advanced_Examples.html" title="PySide Advanced Examples/de">advanced</a></li>
<li><b>Macros:</b> <a href="../de/Macros.html" title="Macros/de">Macros</a>, <a href="../de/How_to_install_macros.html" title="How to install macros/de">How to install macros</a></li>
<li><b>Embedding:</b> <a href="../de/Embedding_FreeCAD.html" title="Embedding FreeCAD/de">Embedding FreeCAD</a>, <a href="../de/Embedding_FreeCADGui.html" title="Embedding FreeCADGui/de">Embedding FreeCADGui</a></li></ul>
<hr>
<ul><li><b>Other:</b> <a href="../de/Expressions.html" title="Expressions/de">Expressions</a>, <a href="../de/Code_snippets.html" title="Code snippets/de">Code snippets</a>, <a href="../de/Line_drawing_function.html" title="Line drawing function/de">Line drawing function</a>, <a href="../de/FreeCAD_vector_math_library.html" title="FreeCAD vector math library/de">FreeCAD vector math library</a> <small>(deprecated)</small></li></ul>
<hr>
<ul><li><b>Hubs:</b> <a href="../de/User_hub.html" title="User hub/de">User hub</a>, <a href="../de/Power_users_hub.html" title="Power users hub/de">Power users hub</a>, <a href="../de/Developer_hub.html" title="Developer hub/de">Developer hub</a></li></ul></div>
    </div></div>
<div style="clear:both"></div>
<!-- 
NewPP limit report
Cached time: 20251115220015
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.168 seconds
Real time usage: 0.230 seconds
Preprocessor visited node count: 862/1000000
Post&#8208;expand include size: 9924/2097152 bytes
Template argument size: 11478/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 24/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 52349/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   24.886      1 -total
 34.19%    8.507     24 Template:Code
 28.33%    7.049      1 Template:Powerdocnavi/de
 10.36%    2.579     48 Template:Incode
  7.74%    1.927      1 Template:Navigation_menu_2
  6.53%    1.626      5 Template:FileName
  4.87%    1.212      1 Template:Clear
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:207994-0!canonical and timestamp 20251115220015 and revision id 1692603. Rendering was triggered because: api-parse
 -->
</div>
</div><script src="../site.js"></script>