<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro TNP Solution/de</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="de" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Macro+TNP+Solution&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--high" lang="de" dir="ltr">Deutsch</span></li>
<li><a href="../Macro_TNP_Solution.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro TNP Solution (100% translated)" lang="en" dir="ltr">English</a></li>
<li><a href="../fr/Macro_TNP_Solution.html" class="mw-pt-progress mw-pt-progress--med" title="Macro TNP Solution (52% translated)" lang="fr" dir="ltr">fran&ccedil;ais</a></li>
<li><a href="../pl/Macro_TNP_Solution.html" class="mw-pt-progress mw-pt-progress--low" title="Makrodefinicja: Rozwi&#261;zanie TNP (4% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../index.php?title=TNP_solution.png&amp;filetimestamp=20220816091251&amp;.html" class="mw-file-description"><img src="../File/TNP_solution.png" decoding="async" width="32" height="26" class="mw-file-element" data-file-width="500" data-file-height="406"></a></span><span> </span>
Makro TNP-L&ouml;sung
</p>
</td></tr>
<tr>
<th class="ctOdd">Beschreibung
</th></tr>
<tr>
<td class="ctEven left macro-description">Dies ist eine L&ouml;sung f&uuml;r das Problem der topologischen Benennung.<br><br>Versionsmakro&nbsp;: 1.0<br>Datum der letzten &Auml;nderung&nbsp;: 2022-08-16<br>Herunterladen&nbsp;: <a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/e/e4/TNP_solution.png">Werkzeugleisten-Symbol</a><br>Autor: Dprojects<br>
</td></tr>
<tr>
<th class="ctOdd">Autor
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../User;Dprojects.html" title="User:Dprojects">Dprojects</a>
</td></tr>
<tr>
<th class="ctOdd">Herunterladen
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/e/e4/TNP_solution.png">Werkzeugleisten-Symbol</a>
</td></tr>
<tr>
<th class="ctOdd">Links
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../de/Macros_recipes.html" title="Macros recipes/de">Makros Rezepte</a><br><a href="../de/How_to_install_macros.html" title="How to install macros/de">Wie installiere ich Makros</a><br><a href="../de/Customize_Toolbars.html" title="Customize Toolbars/de">So passen Sie Symbolleisten an</a>
</td></tr>
<tr>
<th class="ctOdd">Macro-Version
</th></tr>
<tr>
<td class="ctEven macro-version">1.0
</td></tr>
<tr>
<th class="ctOdd">Datum der letzten &Auml;nderung
</th></tr>
<tr>
<td class="ctEven macro-date">2022-08-16
</td></tr>
<tr>
<th class="ctOdd">FreeCAD-Version(s)
</th></tr>
<tr>
<td class="ctEven FreeCAD-version"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Standardverkn&uuml;pfung
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Siehe auch
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<p><span id="Description"></span>
</p>
<h2><span class="mw-headline" id="Beschreibung">Beschreibung</span></h2>
<p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=TNP_solution.gif&amp;filetimestamp=20220816091158&amp;.html" class="mw-file-description"><img src="../File/TNP_solution.gif" decoding="async" width="1362" height="694" class="mw-file-element" data-file-width="1362" data-file-height="694"></a></span>
</p><p>Dies ist eine L&ouml;sung f&uuml;r das Problem der topologischen Benennung, Beispielhaft beschrieben auf der Seite: <a href="../de/Topological_naming_problem.html" title="Topological naming problem/de">Problem der topologischen Benennung</a>
</p><p>Wenn ein Objekt an einem anderen Objekt erstellt wird, und zwar ebenfalls mit einer Skizze, ist die L&ouml;sung ganz einfach, da Sie zwei Dinge wissen:
</p>
<ol><li>Punkte aus einer Skizze sind immer Teil der darunter liegenden Fl&auml;che</li>
<li>Die Skizze und die darunter liegende Fl&auml;che befinden sich in derselben Ebene</li></ol>
<p>Um das Problem der topologischen Benennung zu l&ouml;sen, kann Folgendes getan werden:
</p><p><b>Speichere den Schl&uuml;ssel vor jeder Operation:</b>
</p><p>Vor jeder Operation muss nur der Schl&uuml;ssel gespeichert werden. F&uuml;r dieses Beispiel, das sich auf der Seite  <a href="../de/Topological_naming_problem.html" title="Topological naming problem/de">Problem der topologischen Benennung</a>, befindet sich das Objekt auf der XY-Ebene. Daher verwende ich den Z-Achsenwert aus der Mitte des Begrenzungsrahmens der Skizze:
</p>
<pre>ad = FreeCAD.ActiveDocument
p2 = ad.Pad002
s2 = p2.Profile[0]
key = round(s2.Shape.BoundBox.Center[2], precision)</pre>
<p><b>Als n&auml;chstes werden alle Fl&auml;chen nach dem gespeicherten Schl&uuml;ssel durchsucht:</b>
</p><p>Nach der Gr&ouml;&szlig;en&auml;nderung suche ich alle Fl&auml;chen nach dem gespeicherten Schl&uuml;ssel. Denn wenn die Skizze und die Fl&auml;che auf derselben Ebene XY lagen, war der Z-Achsenwert f&uuml;r beide gleich. Im <a href="../de/PartDesign_Workbench.html" title="PartDesign Workbench/de">Arbeitsbereich PartDesign</a> kann das dritte Pad nicht &uuml;ber das zweite Pad verschoben werden, um einen Abstand zwischen ihnen zu schaffen, da es sich um ein einzelnes Objekt handelt und das n&auml;chste Pad mit der Skizze immer die Fl&auml;che ber&uuml;hrt. An der neuen Fl&auml;che ist der Z-Achsenwert immer derselbe wie der gespeicherte Schl&uuml;ssel. Es wird der Fl&auml;chenindex zur&uuml;ckgegeben. Es muss nichts weiter getan werden. 
</p>
<pre>def getFaceIndex(iObj, iBB):
	
	index = 0	

	for f in iObj.Shape.Faces:

		index += 1
		bb = round(f.BoundBox.Center[2], precision)
		if bb == iBB:
			return index

	return -1</pre>
<p><b>Abschlie&szlig;ende Schritte</b>
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>At the end, I assign the new face to the Sketch and recompute. To be honest, the most difficult part was to assign the face to Sketch.Support, for me the syntax is mind-blowing&nbsp;;-)
</p>
</div>
<p><span id="Code_for_the_example"></span>
</p>
<h2><span id="Code_f.C3.BCr_das_Beispiel"></span><span class="mw-headline" id="Code_f&uuml;r_das_Beispiel">Code f&uuml;r das Beispiel</span></h2>
<p>Testdateien wurden ins FreeCAD-Forum hochgeladen: <a rel="nofollow" class="external text" href="https://forum.freecad.org/download/file.php?id=198537">TNP.FCStd</a>. 
</p>
<pre>__Title__="TNP_solution"
__Author__ = "Dprojects"
__Version__ = "1.0"
__Date__    = "2022-08-16"
__Comment__ = ""
__Web__ = "https://github.com/dprojects/Woodworking"
__Wiki__ = "https://wiki.freecad.org/TNP_solution"
__Icon__  = "https://wiki.freecad.org/images/e/e4/TNP_solution.png"
__IconW__  = "https://wiki.freecad.org/images/e/e4/TNP_solution.png"
__Help__ = "solution for Topological Naming Problem"
__Status__ = "stable"
__Requires__ = ""
__Communication__ = "https://wiki.freecad.org/index.php?title=User:Dprojects"

# ####################################################################
#
# This is solution for Topological Naming Problem described at 
# https://wiki.freecad.org/Topological_naming_problem
#
# MIT License
# 
# Copyright (c) 2022 Darek L github.com/dprojects
# 
# Permission is hereby granted, free of charge, to any 
# person obtaining a copy of this software and associated 
# documentation files (the "Software"), to deal in the 
# Software without restriction, including without limitation 
# the rights to use, copy, modify, merge, publish, distribute, 
# sublicense, and/or sell copies of the Software, and to permit 
# persons to whom the Software is furnished to do so, subject 
# to the following conditions:
# 
# The above copyright notice and this permission notice shall 
# be included in all copies or substantial portions of the Software.
# 
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, 
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES 
# OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND 
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT 
# HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, 
# WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, 
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
# DEALINGS IN THE SOFTWARE.
# 
# ####################################################################

import FreeCAD

# this should be set according 
# FreeCAD user GUI precision settings
precision = 5

# global settings
ad = FreeCAD.ActiveDocument

# middle object to be resized
p1 = ad.Pad001
s1 = p1.Profile[0]

# top object bottom to store key
p2 = ad.Pad002
s2 = p2.Profile[0]

# ####################################################################
def getFaceIndex(iObj, iBB):
	
	index = 0	

	for f in iObj.Shape.Faces:

		index += 1
		bb = round(f.BoundBox.Center[2], precision)
		
		FreeCAD.Console.PrintMessage("\n")
		FreeCAD.Console.PrintMessage(index)
		FreeCAD.Console.PrintMessage(" ")
		FreeCAD.Console.PrintMessage(bb)

		if bb == iBB:
			FreeCAD.Console.PrintMessage(" &lt;=== found")
			return index

	return -1

# ####################################################################
def makeTNP():

	# set key
	key = round(s2.Shape.BoundBox.Center[2], precision)

	# resize and cause TNP
	s1.setDatum(9, FreeCAD.Units.Quantity('350'))

	# recompute
	s1.recompute()
	p1.recompute()
	ad.recompute()

	FreeCAD.Console.PrintMessage("\n\n")
	FreeCAD.Console.PrintMessage("Stored key:"+str(key))
	FreeCAD.Console.PrintMessage("\n")

	# search all faces for solution
	solutionIndex = getFaceIndex(p1, key)
	solution = "Face"+str(solutionIndex)
	
	FreeCAD.Console.PrintMessage("\n\n")
	FreeCAD.Console.PrintMessage("Solution: "+solution)
	
	# set exact face to Sketch
	s2.Support = (p1, (solution,))
	ad.recompute()

# ####################################################################
def moveBack():

	s1.setDatum(9, FreeCAD.Units.Quantity('250'))
	s2.Support = (p1, ('Face13',))
	ad.recompute()

# ####################################################################
# main
# ####################################################################

# uncomment what you want
makeTNP()
#moveBack()

# ####################################################################</pre>
<p><span id="THE_Solution"></span>
</p>
<h2><span id="DIE_L.C3.B6sung"></span><span class="mw-headline" id="DIE_L&ouml;sung">DIE L&ouml;sung</span></h2>
<p>Der obige Code zeigt, wie das Beispiel aus dem Problem der topologischen Benennung gel&ouml;st werden kann, das unter folgender Adresse beschrieben wird: <a href="../de/Topological_naming_problem.html" title="Topological naming problem/de">Problem der topologischen Benennung</a> Es k&ouml;nnen aber genau dieselben Regeln anwendet werden, um andere Probleme zu l&ouml;sen. Der Ansatz ist einfach:
</p>
<ol><li>Den Schl&uuml;ssel vor jeder Operation speichern</li>
<li>Nach der Operation nach dem Schl&uuml;ssel suchen</li></ol>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>The specific implementation may be different. In this example the plane is XY, but you can do exactly the same for other axes. Also you can choose other key. At <a rel="nofollow" class="external text" href="https://github.com/dprojects/Woodworking">Woodworking project</a> I make many operations at non-existing objects, so I had to solve the Topological Naming Problem many times.
</p>
</div> 
<p>Hier wandle ich W&uuml;rfelobjekte in PartDesign-Dicke-Objekte um:
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=TNP_solution_1.gif&amp;filetimestamp=20220817105054&amp;.html" class="mw-file-description"><img src="../File/TNP_solution_1.gif" decoding="async" width="1362" height="694" class="mw-file-element" data-file-width="1362" data-file-height="694"></a></span>
</p>
</div>
<p>Im folgenden Beispiel wandle ich W&uuml;rfel in PartDesign-Fasen um, daher musste ich Schl&uuml;ssel f&uuml;r Kanten speichern: 
</p><p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=TNP_solution_2.gif&amp;filetimestamp=20220817105128&amp;.html" class="mw-file-description"><img src="../File/TNP_solution_2.gif" decoding="async" width="1362" height="694" class="mw-file-element" data-file-width="1362" data-file-height="694"></a></span>
</p><p>Das folgende Beispiel ist etwas komplizierter, da sich, wie auf dem GUI-Bildschirm zu sehen ist, die Verweise auf das Objekt und die Fl&auml;che automatisch &auml;ndern. Aber auch um ein Loch zu erstellen, rufe ich eine Funktion auf, die in meiner Bibliothek definiert ist, nicht direkt im Werkzeug. Daher musste ich einen kleinen Trick mit Auswahl und Abwahl anwenden, um den neuen Verweis zu erhalten:
</p><p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=TNP_solution_3.gif&amp;filetimestamp=20220817105206&amp;.html" class="mw-file-description"><img src="../File/TNP_solution_3.gif" decoding="async" width="1362" height="694" class="mw-file-element" data-file-width="1362" data-file-height="694"></a></span>
</p><p><br>
Bei der Programmierung in FreeCAD gibt es viele solcher Probleme, aber sie lassen sich alle auf &auml;hnliche Weise l&ouml;sen. Ich hoffe, das hilft weiter.
</p><p><br>
</p>
<div style="clear:both"></div>
<!-- 
NewPP limit report
Cached time: 20251019180011
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.074 seconds
Real time usage: 0.120 seconds
Preprocessor visited node count: 113/1000000
Post&#8208;expand include size: 2113/2097152 bytes
Template argument size: 4532/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 5159/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   14.236      1 -total
 41.89%    5.963      3 Template:MacroCode
 36.15%    5.147      1 Template:Macro/de
 18.02%    2.565      1 Template:Clear
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:391894-0!canonical and timestamp 20251019180011 and revision id 1668226. Rendering was triggered because: api-parse
 -->
</div>
</div><script src="../site.js"></script>