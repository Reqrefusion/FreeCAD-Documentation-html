<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro TNP Solution/de</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="de" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Macro+TNP+Solution&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--med" lang="de" dir="ltr">Deutsch</span></li>
<li><a href="../Macro_TNP_Solution.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro TNP Solution (100% translated)" lang="en" dir="ltr">English</a></li>
<li><a href="../fr/Macro_TNP_Solution.html" class="mw-pt-progress mw-pt-progress--complete" title="Macro TNP Solution (100% translated)" lang="fr" dir="ltr">fran&ccedil;ais</a></li>
<li><a href="../pl/Macro_TNP_Solution.html" class="mw-pt-progress mw-pt-progress--low" title="Makrodefinicja: Rozwi&#261;zanie TNP (4% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../index.php?title=TNP_solution.png&amp;filetimestamp=20220816091251&amp;.html" class="mw-file-description"><img src="../File/TNP_solution.png" decoding="async" width="32" height="26" class="mw-file-element" data-file-width="500" data-file-height="406"></a></span><span> </span>
Macro TNP solution
</p>
</td></tr>
<tr>
<th class="ctOdd">Beschreibung
</th></tr>
<tr>
<td class="ctEven left macro-description">Dies ist eine L&ouml;sung f&uuml;r das topologische Benennungsproblem.<br><br>Versionsmakro&nbsp;: 1.0<br>Datum der letzten &Auml;nderung&nbsp;: 2022-08-16<br>Herunterladen&nbsp;: <a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/e/e4/TNP_solution.png">Werkzeugleisten-Symbol</a><br>Autor: Dprojects<br>
</td></tr>
<tr>
<th class="ctOdd">Autor
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../User;Dprojects.html" title="User:Dprojects">Dprojects</a>
</td></tr>
<tr>
<th class="ctOdd">Herunterladen
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/e/e4/TNP_solution.png">Werkzeugleisten-Symbol</a>
</td></tr>
<tr>
<th class="ctOdd">Links
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../de/Macros_recipes.html" title="Macros recipes/de">Makros Rezepte</a><br><a href="../de/How_to_install_macros.html" title="How to install macros/de">Wie installiere ich Makros</a><br><a href="../de/Customize_Toolbars.html" title="Customize Toolbars/de">So passen Sie Symbolleisten an</a>
</td></tr>
<tr>
<th class="ctOdd">Macro-Version
</th></tr>
<tr>
<td class="ctEven macro-version">1.0
</td></tr>
<tr>
<th class="ctOdd">Datum der letzten &Auml;nderung
</th></tr>
<tr>
<td class="ctEven macro-date">2022-08-16
</td></tr>
<tr>
<th class="ctOdd">FreeCAD-Version(s)
</th></tr>
<tr>
<td class="ctEven FreeCAD-version"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Standardverkn&uuml;pfung
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Siehe auch
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<p><span id="Description"></span>
</p>
<h2><span class="mw-headline" id="Beschreibung">Beschreibung</span></h2>
<p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=TNP_solution.gif&amp;filetimestamp=20220816091158&amp;.html" class="mw-file-description"><img src="../File/TNP_solution.gif" decoding="async" width="1362" height="694" class="mw-file-element" data-file-width="1362" data-file-height="694"></a></span>
</p><p>Dies ist eine L&ouml;sung f&uuml;r das topologische Benennungsproblem-Beispiel, beschrieben auf der Seite: <a href="../index.php?title=Topological_Naming_Problem/de&amp;action=edit&amp;redlink=1.html" class="new" title="Topological Naming Problem/de (page does not exist)">Problem der topologischen Benennung</a>
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>If you build object at another object, and also with Sketch it is straightforward to solve, because you know two things:
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ol><li>Points from Sketch is always part of the face below</li>
<li>The Sketch and the face below are in the same plane</li></ol>
</div> 
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>To solve Topological Naming Problem problem you can:
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Store the key before any operation:</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>You need only store the key before any operation. For this example described at <a href="../Topological_naming_problem.html" title="Topological naming problem">Topological Naming Problem</a> page, the object is at XY plane. So, I use Z axis value from Sketch BoundBox center:
</p>
</div>
<pre>ad = FreeCAD.ActiveDocument
p2 = ad.Pad002
s2 = p2.Profile[0]
key = round(s2.Shape.BoundBox.Center[2], precision)</pre>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Next search all faces for the stored key:</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>After the resize, I search all faces for the stored key. Because if the Sketch and Face were at the same plane XY, the Z axis value was the same for both. In PartDesign Worbench, you cannot move 3rd Pad above the 2nd Pad, to have gap between, this is single object, the next Pad with the Sketch always will be touching the face. At the new face the Z axis value always will be the same with the stored key. So, return the face index. Nothing more to be done.
</p>
</div> 
<pre>def getFaceIndex(iObj, iBB):
	
	index = 0	

	for f in iObj.Shape.Faces:

		index += 1
		bb = round(f.BoundBox.Center[2], precision)
		if bb == iBB:
			return index

	return -1</pre>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Final steps</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>At the end, I assign the new face to the Sketch and recompute. To be honest, the most difficult part was to assign the face to Sketch.Support, for me the syntax is mind-blowing&nbsp;;-)
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Code_for_the_example">Code for the example</span></h2>
</div>
<p>Testdateien wurden ins FreeCAD-Forum hochgeladen: <a rel="nofollow" class="external text" href="https://forum.freecad.org/download/file.php?id=198537">TNP.FCStd</a>. 
</p>
<pre>__Title__="TNP_solution"
__Author__ = "Dprojects"
__Version__ = "1.0"
__Date__    = "2022-08-16"
__Comment__ = ""
__Web__ = "https://github.com/dprojects/Woodworking"
__Wiki__ = "https://wiki.freecad.org/TNP_solution"
__Icon__  = "https://wiki.freecad.org/images/e/e4/TNP_solution.png"
__IconW__  = "https://wiki.freecad.org/images/e/e4/TNP_solution.png"
__Help__ = "solution for Topological Naming Problem"
__Status__ = "stable"
__Requires__ = ""
__Communication__ = "https://wiki.freecad.org/index.php?title=User:Dprojects"

# ####################################################################
#
# This is solution for Topological Naming Problem described at 
# https://wiki.freecad.org/Topological_naming_problem
#
# MIT License
# 
# Copyright (c) 2022 Darek L github.com/dprojects
# 
# Permission is hereby granted, free of charge, to any 
# person obtaining a copy of this software and associated 
# documentation files (the "Software"), to deal in the 
# Software without restriction, including without limitation 
# the rights to use, copy, modify, merge, publish, distribute, 
# sublicense, and/or sell copies of the Software, and to permit 
# persons to whom the Software is furnished to do so, subject 
# to the following conditions:
# 
# The above copyright notice and this permission notice shall 
# be included in all copies or substantial portions of the Software.
# 
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, 
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES 
# OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND 
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT 
# HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, 
# WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, 
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
# DEALINGS IN THE SOFTWARE.
# 
# ####################################################################

import FreeCAD

# this should be set according 
# FreeCAD user GUI precision settings
precision = 5

# global settings
ad = FreeCAD.ActiveDocument

# middle object to be resized
p1 = ad.Pad001
s1 = p1.Profile[0]

# top object bottom to store key
p2 = ad.Pad002
s2 = p2.Profile[0]

# ####################################################################
def getFaceIndex(iObj, iBB):
	
	index = 0	

	for f in iObj.Shape.Faces:

		index += 1
		bb = round(f.BoundBox.Center[2], precision)
		
		FreeCAD.Console.PrintMessage("\n")
		FreeCAD.Console.PrintMessage(index)
		FreeCAD.Console.PrintMessage(" ")
		FreeCAD.Console.PrintMessage(bb)

		if bb == iBB:
			FreeCAD.Console.PrintMessage(" &lt;=== found")
			return index

	return -1

# ####################################################################
def makeTNP():

	# set key
	key = round(s2.Shape.BoundBox.Center[2], precision)

	# resize and cause TNP
	s1.setDatum(9, FreeCAD.Units.Quantity('350'))

	# recompute
	s1.recompute()
	p1.recompute()
	ad.recompute()

	FreeCAD.Console.PrintMessage("\n\n")
	FreeCAD.Console.PrintMessage("Stored key:"+str(key))
	FreeCAD.Console.PrintMessage("\n")

	# search all faces for solution
	solutionIndex = getFaceIndex(p1, key)
	solution = "Face"+str(solutionIndex)
	
	FreeCAD.Console.PrintMessage("\n\n")
	FreeCAD.Console.PrintMessage("Solution: "+solution)
	
	# set exact face to Sketch
	s2.Support = (p1, (solution,))
	ad.recompute()

# ####################################################################
def moveBack():

	s1.setDatum(9, FreeCAD.Units.Quantity('250'))
	s2.Support = (p1, ('Face13',))
	ad.recompute()

# ####################################################################
# main
# ####################################################################

# uncomment what you want
makeTNP()
#moveBack()

# ####################################################################</pre>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="THE_Solution">THE Solution</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>This code above shows how to solve the example from Topological Naming Problem described at: <a href="../Topological_naming_problem.html" title="Topological naming problem">Topological Naming Problem</a> but exactly the same rules you can use to solve other problems. The approach is simple:
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ol><li>Store the key before any operation</li>
<li>Search for the key after operation</li></ol>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>The specific implementation may be different. In this example the plane is XY, but you can do exactly the same for other axes. Also you can choose other key. At <a rel="nofollow" class="external text" href="https://github.com/dprojects/Woodworking">Woodworking project</a> I make many operations at non-existing objects, so I had to solve the Topological Naming Problem many times.
</p>
</div> 
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Here I change Cube objects into PartDesign Thickness objects:
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=TNP_solution_1.gif&amp;filetimestamp=20220817105054&amp;.html" class="mw-file-description"><img src="../File/TNP_solution_1.gif" decoding="async" width="1362" height="694" class="mw-file-element" data-file-width="1362" data-file-height="694"></a></span>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>On the example below, I change Cubes into PartDesign Chamfers, so I had to store key for edges:
</p>
</div> 
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=TNP_solution_2.gif&amp;filetimestamp=20220817105128&amp;.html" class="mw-file-description"><img src="../File/TNP_solution_2.gif" decoding="async" width="1362" height="694" class="mw-file-element" data-file-width="1362" data-file-height="694"></a></span>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>This example below is little more complicated because as you see at the GUI screen, the references to the object and face changes automatically. But also to make a hole I call function defined in my library not directly in the tool. So, I had to use small trick with selection and deselection, to get new reference:
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=TNP_solution_3.gif&amp;filetimestamp=20220817105206&amp;.html" class="mw-file-description"><img src="../File/TNP_solution_3.gif" decoding="async" width="1362" height="694" class="mw-file-element" data-file-width="1362" data-file-height="694"></a></span>
</p>
</div>
<p><br>
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>There are many such problems when programming in FreeCAD, but they can all be solved in a similar way. I hope, it helps.
</p>
</div>
<p><br>
</p>
<div style="clear:both"></div>
<!-- 
NewPP limit report
Cached time: 20251019115549
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.040 seconds
Real time usage: 0.084 seconds
Preprocessor visited node count: 129/1000000
Post&#8208;expand include size: 2110/2097152 bytes
Template argument size: 4528/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 5164/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   14.924      1 -total
 54.19%    8.088      1 Template:Macro/de
 25.04%    3.737      3 Template:MacroCode
 16.73%    2.497      1 Template:Clear
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:391894-0!canonical and timestamp 20251019115549 and revision id 1667921. Rendering was triggered because: edit-page
 -->
</div>
</div><script src="../site.js"></script>