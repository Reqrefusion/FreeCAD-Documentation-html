<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro clone explicit/de</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="de" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Macro+clone+explicit&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" lang="de" dir="ltr">Deutsch</span></li>
<li><a href="../Macro_clone_explicit.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro clone explicit (100% translated)" lang="en" dir="ltr">English</a></li>
<li><a href="../fr/Macro_clone_explicit.html" class="mw-pt-progress mw-pt-progress--complete" title="Macro clone explicit (100% translated)" lang="fr" dir="ltr">fran&ccedil;ais</a></li>
<li><a href="../pl/Macro_clone_explicit.html" class="mw-pt-progress mw-pt-progress--low" title="Makrodefinicja: Jawny klon (5% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../index.php?title=Macro_clone_explicit.png&amp;filetimestamp=20190614140456&amp;.html" class="mw-file-description"><img src="../File/Macro_clone_explicit.png" decoding="async" width="32" height="32" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span><span> </span>
Makro Expliziter Klon
</p>
</td></tr>
<tr>
<th class="ctOdd">Beschreibung
</th></tr>
<tr>
<td class="ctEven left macro-description">Erstellt eine Kopie jedes ausgew&auml;hlten Objekts und legt dessen Eigenschaften auf einen Ausdruck fest, der mit dem Originalobjekt verkn&uuml;pft ist, wodurch es zu einem expliziten und bearbeitbaren Klon wird.<br><br>Versionsmakro&nbsp;: 0.1<br>Datum der letzten &Auml;nderung&nbsp;: 2018-12-15<br>FreeCAD version&nbsp;: 18 und sp&auml;ter<br>Herunterladen&nbsp;: <a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/a/ab/Macro_clone_explicit.png">Werkzeugleisten-Symbol</a><br>Autor: Raph82<br>
</td></tr>
<tr>
<th class="ctOdd">Autor
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../index.php?title=User;Raph82&amp;action=edit&amp;redlink=1.html" class="new" title="User:Raph82 (page does not exist)">Raph82</a>
</td></tr>
<tr>
<th class="ctOdd">Herunterladen
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/a/ab/Macro_clone_explicit.png">Werkzeugleisten-Symbol</a>
</td></tr>
<tr>
<th class="ctOdd">Links
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../de/Macros_recipes.html" title="Macros recipes/de">Makros Rezepte</a><br><a href="../de/How_to_install_macros.html" title="How to install macros/de">Wie installiere ich Makros</a><br><a href="../de/Customize_Toolbars.html" title="Customize Toolbars/de">So passen Sie Symbolleisten an</a>
</td></tr>
<tr>
<th class="ctOdd">Macro-Version
</th></tr>
<tr>
<td class="ctEven macro-version">0.1
</td></tr>
<tr>
<th class="ctOdd">Datum der letzten &Auml;nderung
</th></tr>
<tr>
<td class="ctEven macro-date">2018-12-15
</td></tr>
<tr>
<th class="ctOdd">FreeCAD-Version(s)
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">18 und sp&auml;ter
</td></tr>
<tr>
<th class="ctOdd">Standardverkn&uuml;pfung
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Siehe auch
</th></tr>
<tr>
<td class="ctEven"><a href="../de/Expressions.html" title="Expressions/de">Ausdr&uuml;cke</a>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<p><span id="Description"></span>
</p>
<h2><span class="mw-headline" id="Beschreibung">Beschreibung</span></h2>
<p>Dieses Makro erstellt eine Kopie jedes ausgew&auml;hlten Objekts und setzt dessen Eigenschaften auf einen <a href="../Expressions.html" title="Expressions">Ausdruck</a>, der mit dem Originalobjekt verkn&uuml;pft ist, wodurch es zu einem expliziten und bearbeitbaren Klon wird.
</p><p>Dieser Klon ist eine Kopie des Originalobjekts, wie im Befehl <b>Bearbeiten &rarr; Auswahl duplizieren</b>, aber seine Eigenschaften werden durch Ausdr&uuml;cke definiert.
</p><p><span id="How_does_this_'explicit_and_editable_clone'_differ_from_a_Clone_object?"></span>
</p>
<h3><span id="Wie_unterscheidet_sich_dieser_.E2.80.9Eexplizite_und_bearbeitbare_Klon.E2.80.9D_von_einem_Klonobjekt.3F"></span><span class="mw-headline" id="Wie_unterscheidet_sich_dieser_&bdquo;explizite_und_bearbeitbare_Klon&rdquo;_von_einem_Klonobjekt?">Wie unterscheidet sich dieser &bdquo;explizite und bearbeitbare Klon&rdquo; von einem Klonobjekt?</span></h3>
<p>&bdquo;Explizit&ldquo;, weil alle urspr&uuml;nglichen Objekteigenschaften sichtbar sind. Kannst du beispielsweise in einem Klonobjekt eines W&uuml;rfels dessen H&ouml;he sehen? Wenn du einen Ausdruck f&uuml;r ein Klonobjekt verwendest, kannst du dann einfach auf dessen &uuml;bergeordnete Eigenschaften zugreifen?
</p><p>&bdquo;Bearbeitbar&ldquo;, weil Sie im Gegensatz zu einem Klonobjekt den Ausdruck jeder Eigenschaft bearbeiten k&ouml;nnen. So ist es m&ouml;glich, dass das Objekt nur bestimmte Eigenschaften seines &uuml;bergeordneten Objekts klont, w&auml;hrend man die anderen &auml;ndert.
</p><p><span id="Usage"></span>
</p>
<h2><span class="mw-headline" id="Anwendung">Anwendung</span></h2>
<ol><li>W&auml;hle mindestens ein Objekt.</li>
<li><b>Makro &rarr; Makros...</b></li>
<li>Aus der Liste  <b>clone_explicit.FCMacro</b> ausw&auml;hlen.</li>
<li>Die Schaltfl&auml;che <span class="ButtonTemplate" style="background: #f5f5f5; -moz-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); border: 2px solid #989898; border-radius: 0.3em; padding: 0px 8px 1px 8px; font-weight:normal;color: #202122;">Ausf&uuml;hren</span> dr&uuml;cken.</li></ol>
<p><span id="Script"></span>
</p>
<h2><span class="mw-headline" id="Skript">Skript</span></h2>
<p>Werkzeugleistensymbol <span class="mw-default-size" typeof="mw:File"><a href="../index.php?title=Macro_clone_explicit.png&amp;filetimestamp=20190614140456&amp;.html" class="mw-file-description"><img src="../File/Macro_clone_explicit.png" decoding="async" width="64" height="64" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span>
</p><p><b>Macro_clone_explicit.FCMacro</b>
</p>
<pre>__Title__ = "clone_explicit"
__Author__ = "Raph82"
__URL__     = "https://freecad.org/index-fr.html"
__Version__ = "0.1"
__Date__    = "2018-12-15" #YYYY-MM-DD
__Comment__ = "This macro creates a copy of the selected objects and sets their properties to an expression linking to the original object, making it an explicit and editable clone"
__Web__ = "https://freecad.org/"
__Wiki__ = "https://wiki.freecad.org/index.php?title=Macro_clone_explicit"
__Icon__  = "https://wiki.freecad.org/images/a/ab/Macro_clone_explicit.png"
__IconW__  = "C:/Users/User Name/AppData/Roaming/FreeCAD/Macro_clone_explicit.png"
__Help__ = "Select at least one object and run the macro to make explicit and editable clone(s)"
__Status__ = "dev"
__Requires__ = "All FreeCAD"
__Communication__ = "https://wiki.freecad.org/index.php?title=User:raph82"

#IMPORTS:
import sys

##################################################
def set_expression(obj, property_to_set, expression):
    """"""
    try:
        print type(obj)
        obj.setExpression(property_to_set, expression)
#    except 'Base.FreeCADError':
    except Exception as detail:
        print detail
        print type(detail)
        if detail['swhat'] == 'Property not found':
            App.Console.PrintMessage('Object "{obj}" has no property "{prop}"\r\n'.format(obj=obj.Name, prop=property_to_set))
        else:
            raise

##################################################
def clone_explicit(mode):
    """Copy the selected objects and sets their properties to an expression, making it an explicit and editable clone.

     This clone is called "explicit and editable" because the link with its parent is visible and can be changed in the object properties.

     The link to the original object can be either "direct" or "transient", depending on the mode argument:
     - a direct clone has expressions pointing to its parent: clone.Length = parent.Length
     - a transient clone has expressions pointing to its ancestor. Say parent.Length = Box001.Length. With a transient clone, clone.Length = Box001.Length, whereas with a direct clone, clone.Length = parent.Length.
       This indirect link to Box001 (via the parent object) could be severed, accidentally or not, depending on what relationship you're looking for.

     If you're lost, try with a direct clone first."""

    App.Console.PrintMessage("Start of clone_explicit macro"+"\r\n")

    #Current selection check:
    sel = FreeCADGui.Selection.getSelection()

    App.Console.PrintMessage(str(len(sel))+" object(s) selected\r\n")
    if len(sel)&nbsp;!= 0:
        for i in range(len(sel)):
            obj=sel[i]

            #copying current object:
            App.Console.PrintMessage('Copying "'+obj.Label+'" ('+obj.Name+')\r\n')
            obj_copy=App.ActiveDocument.copyObject(obj, False) #https://freecad.org/api/d8/d3e/classApp_1_1Document.html#a08f1d7d90f4a7276a02918fb6445a04a
            App.Console.PrintMessage('"'+obj_copy.Label+'" ('+obj_copy.Name+') created\r\n')

            if mode == 'direct':
                #defining expressions pointing to the original object:
                set_expression(obj_copy, 'Placement.Base.x',          obj.Name+u'.Placement.Base.x')
                set_expression(obj_copy, 'Placement.Base.y',          obj.Name+u'.Placement.Base.y')
                set_expression(obj_copy, 'Placement.Base.z',          obj.Name+u'.Placement.Base.z')
                set_expression(obj_copy, 'Placement.Rotation.Angle',  obj.Name+u'.Placement.Rotation.Angle')
                set_expression(obj_copy, 'Placement.Rotation.Axis.x', obj.Name+u'.Placement.Rotation.Axis.x')
                set_expression(obj_copy, 'Placement.Rotation.Axis.y', obj.Name+u'.Placement.Rotation.Axis.y')
                set_expression(obj_copy, 'Placement.Rotation.Axis.z', obj.Name+u'.Placement.Rotation.Axis.z')
                set_expression(obj_copy, 'Length',                    obj.Name+u'.Length')
                set_expression(obj_copy, 'Width',                     obj.Name+u'.Width')
                set_expression(obj_copy, 'Height',                    obj.Name+u'.Height')

            elif mode == 'transient':
                #defining expressions pointing to the utmost original object:
                define_transient_expression(obj, obj_copy, 'Placement.Base.x')
                define_transient_expression(obj, obj_copy, 'Placement.Base.y')
                define_transient_expression(obj, obj_copy, 'Placement.Base.z')
                define_transient_expression(obj, obj_copy, 'Placement.Rotation.Angle')
                define_transient_expression(obj, obj_copy, 'Placement.Rotation.Axis.x')
                define_transient_expression(obj, obj_copy, 'Placement.Rotation.Axis.y')
                define_transient_expression(obj, obj_copy, 'Placement.Rotation.Axis.z')
                define_transient_expression(obj, obj_copy, 'Length')
                define_transient_expression(obj, obj_copy, 'Width')
                define_transient_expression(obj, obj_copy, 'Height')
            else:
                App.Console.PrintError('Programming error: mode value not recognized.\r\n')

            App.Console.PrintMessage('('+obj_copy.Label+'" ('+obj_copy.Name+') expressions set\r\n')

        FreeCAD.ActiveDocument.recompute()
        App.Console.PrintMessage('End of clone_explicit macro\r\n')

    else:
        App.Console.PrintError('Select at least one object first\r\n')

    sel = ""
    obj = ""
    obj_copy = ""

##################################################
def find_expression(source_object, property_to_define):
    """"""

    for var_tuple in source_object.ExpressionEngine: #https://forum.freecad.org/viewtopic.php?f=22&amp;t=21950
        # .ExpressionEngine returns tuple like [('Placement.Base.z', 'Length')], see https://docs.python.org/2.7/tutorial/datastructures.html#tuples-and-sequences
        App.Console.PrintMessage('var_tuple[0]='+var_tuple[0]+'\r\n')
        if var_tuple[0] == property_to_define:
           return var_tuple[1]

##################################################
def define_transient_expression(source_object, target_object, property_to_define):
    """"""
    expressions = source_object.ExpressionEngine #https://forum.freecad.org/viewtopic.php?f=22&amp;t=21950
    # returns tuple like [('Placement.Base.z', 'Length')], see https://docs.python.org/2.7/tutorial/datastructures.html#tuples-and-sequences

    expression = find_expression(source_object, property_to_define)
    if expression&nbsp;!= None:
#        App.Console.PrintMessage("target_object.Name="+target_object.Name+"\r\n")
#        App.Console.PrintMessage("property_to_define="+property_to_define+"\r\n")
#        App.Console.PrintMessage("expressions[property_to_define]="+expressions[property_to_define]+"\r\n")

        set_expression(target_object, property_to_define, expression)
    else:
        set_expression(target_object, property_to_define, source_object.Name+'.'+property_to_define)

    expressions = ""

##################################################
clone_explicit('direct')
#clone_explicit('transient')</pre>
<p><span id="Options"></span>
</p>
<h2><span class="mw-headline" id="Optionen">Optionen</span></h2>
<p>Eine <code>Modus</code>-Option war geplant. Ist aber noch nicht implementiert. Es scheint nun viel komplexer zu sein als urspr&uuml;nglich angenommen, vielleicht zu komplex, als dass ich es umsetzen k&ouml;nnte.
</p><p>Die Idee dahinter ist, dass man eines von zwei Verhaltensweisen bevorzugen k&ouml;nnte:
</p>
<ul><li>Der Klon ahmt seinen Elternteil weiterhin nach, auch wenn sich die Eigenschaften &bdquo;Ausdr&uuml;cke&rdquo; des Elternteils &auml;ndern. Dies ist der <code>direkte</code> Modus.</li>
<li>Der Klon beh&auml;lt die Eigenschaften &bdquo;Ausdr&uuml;cke&rdquo; bei, die der Elternteil zum Zeitpunkt der Klon-Erstellung hatte. Dies ist der <code>vor&uuml;bergehende</code> Modus.</li></ul>
<p>Beachten Sie die Betonung des Wortes &bdquo;Ausdr&uuml;cke&rdquo;. Ein Ausdruck ist eine Abstraktionsebene &uuml;ber einem Wert.
</p><p>Hier ein Beispiel: Man Stelle sich vor, das &uuml;bergeordnete Objekt (das vor dem Ausf&uuml;hren des Makros ausw&auml;hlt wird) hat seine Eigenschaft <code>Height</code> auf den Ausdruck <code>Object<b>3</b>.Height * 2</code> gesetzt.
</p>
<ul><li>Bei Ausf&uuml;hrung im <code>direkten</code> Modus:
<ul><li><code>Clone.Height = Parent.Height</code>,</li>
<li>&Auml;nderungen am Wert <code>Object<b>3</b>.Height</code> w&uuml;rden sich sowohl auf das &uuml;bergeordnete als auch auf das geklonte Objekt auswirken,</li>
<li>&Auml;nderungen am Ausdruck <code>Parent.Height</code> w&uuml;rden sich ebenfalls auf beide Objekte auswirken:
<ul><li><code>Parent.Height = Object<b>4</b>.Height * 2</code> und</li>
<li><code>Clone.Height = Parent.Height</code> weiterhin.</li></ul></li></ul></li>
<li>Bei Ausf&uuml;hrung im <code>transient</code>-Modus:
<ul><li><code>Clone.Height = Object<b>3</b>.Height * 2</code>,</li>
<li>&Auml;nderungen am Wert von <code>Object<b>3</b>.Height</code> w&uuml;rden sich sowohl auf das &uuml;bergeordnete als auch auf das geklonte Objekt auswirken,</li>
<li>&Auml;nderungen am Ausdruck <code>Parent. Height</code> <i>Ausdruck</i> <b>nur</b> das &uuml;bergeordnete Objekt:
<ul><li><code>Parent.Height = Object<b>4</b>.Height * 2</code> und</li>
<li><code>Clone.Height = Object<b>3</b>.Height * 2</code> weiterhin.</li></ul></li></ul></li></ul>
<p>Derzeit wird das Makro mit dem Modusparameter <code>direct</code> ausgef&uuml;hrt, und dem Benutzer wird keine Auswahlm&ouml;glichkeit angeboten.
</p><p><span id="Limitations"></span>
</p>
<h2><span id="Einschr.C3.A4nkungen"></span><span class="mw-headline" id="Einschr&auml;nkungen">Einschr&auml;nkungen</span></h2>
<ul><li>Funktioniert derzeit nur mit W&uuml;rfeln. Um auf viele Typen zu erweitern, muss ich:
<ul><li>herausfinden, wie man einen Objekttyp identifiziert, um seine unterschiedlichen Eigenschaften entsprechend zu behandeln;</li>
<li>herausfinden, wie man den Fehler <code>Property not found</code> abf&auml;ngt.</li></ul></li></ul>
<p><span id="Version_history"></span>
</p>
<h2><span class="mw-headline" id="Versionsverlauf">Versionsverlauf</span></h2>
<ul><li>0.1: Erstver&ouml;ffentlichung</li></ul>
<!-- 
NewPP limit report
Cached time: 20251021110033
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.065 seconds
Real time usage: 0.104 seconds
Preprocessor visited node count: 133/1000000
Post&#8208;expand include size: 2674/2097152 bytes
Template argument size: 7844/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 8136/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   12.840      1 -total
 46.81%    6.011      1 Template:Macro/de
 20.66%    2.653      1 Template:MacroCode
 15.17%    1.948      3 Template:MenuCommand
 13.21%    1.696      1 Template:Button
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:394850-0!canonical and timestamp 20251021110033 and revision id 1669383. Rendering was triggered because: api-parse
 -->
</div>
</div><script src="../site.js"></script>