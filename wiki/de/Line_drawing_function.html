<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Line drawing function/de</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="de" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Line+drawing+function&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><a href="../id/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--low" title="Line drawing function (3% translated)" lang="id" dir="ltr">Bahasa Indonesia</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" lang="de" dir="ltr">Deutsch</span></li>
<li><a href="../Line_drawing_function.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Line drawing function (100% translated)" lang="en" dir="ltr">English</a></li>
<li><a href="../tr/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--low" title="Line drawing function (3% translated)" lang="tr" dir="ltr">T&uuml;rk&ccedil;e</a></li>
<li><a href="../es/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--low" title="Line drawing function (12% translated)" lang="es" dir="ltr">espa&ntilde;ol</a></li>
<li><a href="../fr/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--complete" title="Fonction - tracer une ligne (100% translated)" lang="fr" dir="ltr">fran&ccedil;ais</a></li>
<li><a href="../it/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--med" title="Funzione per disegnare delle linee (35% translated)" lang="it" dir="ltr">italiano</a></li>
<li><a href="../pl/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--complete" title="Funkcja rysowania linii (100% translated)" lang="pl" dir="ltr">polski</a></li>
<li><a href="../ro/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--low" title="Func&#539;ia de Desenare a liniei (12% translated)" lang="ro" dir="ltr">rom&acirc;n&#259;</a></li>
<li><a href="../sv/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--low" title="Line drawing function (12% translated)" lang="sv" dir="ltr">svenska</a></li>
<li><a href="../cs/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--low" title="Line drawing function (3% translated)" lang="cs" dir="ltr">&#269;e&scaron;tina</a></li>
<li><a href="../ru/Line_drawing_function.html" class="mw-pt-progress mw-pt-progress--complete" title="&#1060;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; &#1088;&#1080;&#1089;&#1086;&#1074;&#1072;&#1085;&#1080;&#1103; &#1083;&#1080;&#1085;&#1080;&#1080; (100% translated)" lang="ru" dir="ltr">&#1088;&#1091;&#1089;&#1089;&#1082;&#1080;&#1081;</a></li></ul></div>
<div style="clear:right; margin-bottom: .5em; float: right; padding: .5em 0 .8em 1.4em; background: none;"><meta property="mw:PageProp/toc"></div>
<p><span id="Introduction"></span>
</p>
<h2><span class="mw-headline" id="Einleitung">Einleitung</span></h2>
<p>Diese Seite zeigt, wie erweiterte Funktionalit&auml;t einfach in Python erstellt werden kann. In dieser &Uuml;bung erstellen wir ein neues Werkzeug, das eine Linie zeichnet. Dieses Werkzeug kann dann mit einem FreeCAD-Befehl verkn&uuml;pft werden und dieser Befehl kann von jedem Element der Oberfl&auml;che aufgerufen werden, wie z.B. von einem Men&uuml;eintrag oder von einer Schaltfl&auml;che in einer Symbolleiste .
</p><p><span id="The_main_script"></span>
</p>
<h2><span class="mw-headline" id="Das_Hauptskript">Das Hauptskript</span></h2>
<p>Zuerst werden wir ein Skript schreiben, das unsere gesamte Funktionalit&auml;t enth&auml;lt. Dann werden wir dieses in einer Datei speichern und in FreeCAD importieren, so dass alle von uns geschriebenen Klassen und Funktionen in FreeCAD zur Verf&uuml;gung stehen. In unserem bevorzugten Codeeditor geben wir folgende Zeilen ein:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">FreeCADGui</span><span class="o">,</span> <span class="nn">Part</span>
<span class="kn">from</span> <span class="nn">pivy.coin</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">line</span><span class="p">:</span>

<span class="w">    </span><span class="sd">"""This class will create a line after the user clicked 2 points on the screen"""</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">FreeCADGui</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">ActiveView</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getpoint</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_cb</span><span class="p">):</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">event_cb</span><span class="o">.</span><span class="n">getEvent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span> <span class="o">==</span> <span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">DOWN</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">getPosition</span><span class="p">()</span>
            <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">getPoint</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">Part</span><span class="o">.</span><span class="n">LineSegment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">toShape</span><span class="p">()</span>
                <span class="n">Part</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">removeEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
</pre></div>
<p><a href="#top">Anfang</a></p>
<p><span id="Detailed_explanation"></span>
</p>
<h2><span id="Detaillierte_Erkl.C3.A4rung"></span><span class="mw-headline" id="Detaillierte_Erkl&auml;rung">Detaillierte Erkl&auml;rung</span></h2>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">Part</span><span class="o">,</span> <span class="nn">FreeCADGui</span>
<span class="kn">from</span> <span class="nn">pivy.coin</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
<p>Sollen in Python Funktionen aus einem anderen Modul verwendet werden, musst es importiert werden. In unserem Fall ben&ouml;tigen wir Funktionen aus dem Modul <a href="../de/Part_Workbench.html" title="Part Workbench/de">Part</a>, um die Linie zu erstellen, und aus dem GUI-Modul <code>FreeCADGui</code>, um auf die <a href="../de/3D_View.html" title="3D View/de">3D-Ansicht</a> zuzugreifen. Au&szlig;erdem ben&ouml;tigen wir die kompletten Inhalte der Coin-Bibliothek, damit wir alle Coin-Objekte wie <code>SoMouseButtonEvent</code>, usw. direkt verwenden k&ouml;nnen.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">line</span><span class="p">:</span>
</pre></div>
<p>Hier definieren wir unsere Hauptklasse. Warum verwenden wir eine Klasse und keine Funktion? Der Grund daf&uuml;r ist, dass unser Werkzeug "lebendig" bleiben muss, w&auml;hrend wir darauf warten, dass der Benutzer auf den Bildschirm klickt. Eine Funktion endet, wenn ihre Aufgabe erledigt ist, aber ein Objekt (eine Klasse definiert ein Objekt) bleibt lebendig, bis es zerst&ouml;rt wird.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="sd">"""This class will create a line after the user clicked 2 points on the screen"""</span>
</pre></div>
<p>In Python kann jede Klasse oder Funktion einen Dokumentationszeichenkette (docstring) besitzen. Dies ist in FreeCAD besonders n&uuml;tzlich, denn wird diese Klasse im Interpreter aufgerufen, wird die Beschreibung in dieser Zeichenkette als QuickInfo (Tooltip) angezeigt.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<p>Python-Klassen k&ouml;nnen immer eine Funktion <code>__init__</code> enthalten, die beim Aufruf der Klasse zur Erzeugung eines Objekts ausgef&uuml;hrt wird. Wir werden hier also alles ablegen, was sich ereignen soll, wenn unser Linienwerkzeug seine Arbeit aufnimmt.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">FreeCADGui</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">ActiveView</span>
</pre></div>
<p>In einer Klasse wird normalerweise <code>self.</code> einem Variablennamen vorangestellt, damit sie f&uuml;r alle Funktionen innerhalb und au&szlig;erhalb dieser Klasse leicht zug&auml;nglich ist. Hier werden wir <code>self.view</code> verwenden, um auf die aktive 3D-Ansicht zuzugreifen und sie zu bearbeiten.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
<p>Hier erstellen wir eine leere Liste, die die 3D-Punkte aufnimmt, die von der Funktion <code>getpoint()</code> zur&uuml;ckgegeben werden.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getpoint</span><span class="p">)</span>
</pre></div>
<p>Dies ist der wichtige Teil: Da es sich eigentlich um eine <a rel="nofollow" class="external text" href="http://www.coin3d.org/">coin3D</a>-Szene handelt, verwendet FreeCAD einen Coin-R&uuml;ckrufmechanismus (callback mechanism), der erm&ouml;glicht, dass eine Funktion aufgerufen wird, wann immer ein bestimmtes Szenenereignis eintritt. In unserem Fall erstellen wir eine R&uuml;ckruffunktion f&uuml;r <a rel="nofollow" class="external text" href="http://doc.coin3d.org/Coin/group__events.html">SoMouseButtonEvent</a>-Ereignisse und verbinden sie mit der Funktion <code>getpoint()</code>. Ab jetzt wird jedes Mal, wenn eine Maustaste gedr&uuml;ckt oder losgelassen wird, die Funktion <code>getpoint()</code> ausgef&uuml;hrt.
</p><p>Man beachte, dass es auch eine Alternative zu <code>addEventCallbackPivy()</code> namens <code>addEventCallback()</code> gibt, die nicht auf pivy angewiesen ist. Aber da pivy eine sehr effiziente und nat&uuml;rliche Weise ist, um auf alle Teile einer Coin-Szene zuzugreifen, ist es die bessere Wahl.
</p>
<p><a href="#top">Anfang</a></p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">def</span> <span class="nf">getpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_cb</span><span class="p">):</span>
</pre></div>
<p>Nun definieren wir die Funktion <code>getpoint()</code>, die ausgef&uuml;hrt wird, wenn eine Maustaste in einer 3D-Ansicht gedr&uuml;ckt wird. Diese Funktion empf&auml;ngt ein Argument, das wir <code>event_cb</code> nennen. Von diesem Ereignisr&uuml;ckruf (event callback) aus k&ouml;nnen wir auf das Ereignisobjekt zugreifen, das verschiedene Informationen enth&auml;lt (weitere Infos findet man <a href="../de/Code_snippets.html#Mausereignisse_in_der_3D-Ansicht_beobachten_mit_Python" title="Code snippets/de">hier</a>).
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span> <span class="o">==</span> <span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">DOWN</span><span class="p">:</span>
</pre></div>
<p>Die <code>getpoint()</code> Funktion wird aufgerufen, wenn eine Maustaste gedr&uuml;ckt oder losgelassen wird. Aber wir wollen einen 3D-Punkt nur dann ausw&auml;hlen, wenn eine Maustaste gedr&uuml;ckt wird, andernfalls w&uuml;rden wir zwei 3D-Punkte sehr nahe beieinander erhalten. Daher m&uuml;ssen wir das an dieser Stelle &uuml;berpr&uuml;fen.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">pos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">getPosition</span><span class="p">()</span>
</pre></div>
<p>Hier erhalten wir die Bildschirmkoordinaten des Mauszeigers.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">getPoint</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
<p>Diese Funktion liefert uns einen FreeCAD-Vektor (x,y,z), der den 3D-Punkt enth&auml;lt, der auf der fokussierten Ebene direkt unter unserem Mauszeiger liegt. Befindet man sich in der Kameraansicht befindest, kann man sich einen Strahl vorstellen, der von der Kamera kommt, durch den Mauszeiger hindurchgeht und auf die fokussierte Ebene trifft. Das ist die Position unseres 3D-Punktes. Wenn wir uns in der orthogonalen Ansicht befinden, ist der Strahl parallel zur Blickrichtung.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</pre></div>
<p>Wir f&uuml;gen unseren neuen Punkt dem Stapel hinzu.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</pre></div>
<p>Haben wir schon genug Punkte? Wenn ja, dann zeichnen wir jetzt die Linie!
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="n">Part</span><span class="o">.</span><span class="n">LineSegment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
<p>Hier verwenden wir die Funktion <code>LineSegment()</code> aus dem Modul Part, die eine Linie aus zwei FreeCAD-Vektoren erstellt. Die Linie ist nicht an irgendein Objekt unseres aktiven Dokuments gebunden, so dass nichts auf dem Bildschirm erscheint.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">shape</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">toShape</span><span class="p">()</span>
</pre></div>
<p>Das FreeCAD-Dokument kann nur Formen (Shapes) aus dem Modul Part &uuml;bernehmen. Formen sind der grundlegendste Typ des Moduls Part. Daher m&uuml;ssen wir unsere Linie in eine Form konvertieren, bevor wir sie dem Dokument hinzuf&uuml;gen.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">Part</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<p>Das Modul Part hat eine sehr n&uuml;tzliche Funktion <code>show()</code>, die ein neues Objekt im Dokument erzeugt und eine Form daran bindet. Wir h&auml;tten auch zuerst ein neues Objekt im Dokument erstellen k&ouml;nnen und dann die Form manuell an dieses Objekt binden.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">removeEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
</pre></div>
<p>Da wir mit unserer Linie fertig sind, entfernen wir den R&uuml;ckrufmechanismus an dieser Stelle.
</p>
<p><a href="#top">Anfang</a></p>
<p><span id="Testing_the_script"></span>
</p>
<h2><span class="mw-headline" id="Testen_des_Skripts">Testen des Skripts</span></h2>
<p>Nun speichern wir unser Skript an einem Ort, an dem FreeCADs Python-Interpreter es finden kann. Beim Import von Modulen wird der Interpreter an folgenden Stellen suchen: die Python-Installationspfade, FreeCADs <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">bin</span>-Verzeichnis und alle FreeCAD <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">Mod</span>-Verzeichnisse (Modulverzeichnisse). Die beste L&ouml;sung ist also, ein neues Verzeichnis in einem von FreeCADs <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">Mod</span>-Verzeichnissen anzulegen. Erstellen wir also ein Verzeichnis <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">MyScripts</span> und sichern darin unser Skript unter dem Namen <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">exercise.py</span>.
</p><p>Jetzt, da alles bereit ist, starten wir FreeCAD, erstellen ein neues Dokument und geben im Python-Interpreter ein:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">exercise</span>
</pre></div>
<p>Wenn keine Fehlermeldung erscheint, wurde unser &Uuml;bungsskript erfolgreich geladen. Wir k&ouml;nnen nun seinen Inhalt &uuml;berpr&uuml;fen mit:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="nb">dir</span><span class="p">(</span><span class="n">exercise</span><span class="p">)</span>
</pre></div>
<p>Der Befehl <code>dir()</code> ist ein eingebauter Python-Befehl, der den Inhalt eines Moduls auflistet. Wir k&ouml;nnen pr&uuml;fen, dass unsere Klasse <code>line()</code> vorhanden ist mit:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="s1">'line'</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">exercise</span><span class="p">)</span>
</pre></div>
<p>Nun wollen wir es testen:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">exercise</span><span class="o">.</span><span class="n">line</span><span class="p">()</span>
</pre></div>
<p>Zwei Mal in die 3D-Ansicht klicken und Bingo: Hier ist unsere Linie! Um es zu wiederholen, einfach erneut <code>exercise.line()</code> eintippen.
</p>
<p><a href="#top">Anfang</a></p>
<p><span id="Registering_the_script"></span>
</p>
<h2><span class="mw-headline" id="Registrierung_des_Skripts">Registrierung des Skripts</span></h2>
<p>Damit unser neues Linienwerkzeug wirklich n&uuml;tzlich ist und um l&auml;stiges Tippen zu vermeiden, sollte es eine Schaltfl&auml;che auf der Oberfl&auml;che haben. Eine M&ouml;glichkeit ist, unseren neuen Ordner <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">MyScripts</span> in einen vollst&auml;ndigen FreeCAD-Arbeitsbereich umzuwandeln. Dies ist einfach: Es muss nur eine Datei <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">InitGui.py</span> im Ordner <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">MyScripts</span> abgelegt werden. <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">InitGui.py</span> enth&auml;lt die Anweisungen zum Erstellen eines neuen Arbeitsbereiches und f&uuml;gt unser neues Werkzeug hinzu. Au&szlig;erdem m&uuml;ssen wir auch unseren &Uuml;bungscode ein wenig umwandeln, damit das Werkzeug <code>line()</code> als offizieller FreeCAD Befehl erkannt wird. Beginnen wir damit, eine Datei <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">InitGui.py</span> zu erstellen und den folgenden Code hineinzuschreiben:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">MyWorkbench</span> <span class="p">(</span><span class="n">Workbench</span><span class="p">):</span>

    <span class="n">MenuText</span> <span class="o">=</span> <span class="s2">"MyScripts"</span>

    <span class="k">def</span> <span class="nf">Initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">exercise</span>
        <span class="n">commandslist</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"line"</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appendToolbar</span><span class="p">(</span><span class="s2">"My Scripts"</span><span class="p">,</span> <span class="n">commandslist</span><span class="p">)</span>

<span class="n">Gui</span><span class="o">.</span><span class="n">addWorkbench</span><span class="p">(</span><span class="n">MyWorkbench</span><span class="p">())</span>
</pre></div>
<p>Inzwischen sollten wir das obige Skript schon verstehen. Wir erstellen eine neue Klasse, die wir <code>MyWorkbench</code> nennen, wir geben ihr den Namen <code>MenuText</code> und wir definieren eine Funktion <code>Initialize()</code>, die ausgef&uuml;hrt wird, wenn der Arbeitsbereich in FreeCAD geladen wird. Mit dieser Funktion laden wir den Inhalt unserer &Uuml;bungsdatei und erweitern eine Befehlsliste mit den darin enthaltenen FreeCAD-Anweisungen. Dann erstellen wir eine Symbolleiste "My Scripts" und weisen ihr unsere Befehlsliste zu. Derzeit haben wir nat&uuml;rlich nur ein Werkzeug, so dass unsere Befehlsliste nur ein Element enth&auml;lt. Und sobald unser Arbeitsbereich fertig ist, f&uuml;gen wir ihn zur Hauptoberfl&auml;che hinzu.
</p><p>Aber dies wird noch nicht funktionieren, da ein FreeCAD-Befehl auf eine bestimmte Weise formatiert werden muss. Damit er funktioniert, m&uuml;ssen wir unser Werkzeug <code>line()</code> anpassen. Unser neues Skript <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">exercise.py</span> sollte nun so aussehen:
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">FreeCADGui</span><span class="o">,</span> <span class="nn">Part</span>
<span class="kn">from</span> <span class="nn">pivy.coin</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">line</span><span class="p">:</span>

<span class="w">    </span><span class="sd">"""This class will create a line after the user clicked 2 points on the screen"""</span>

    <span class="k">def</span> <span class="nf">Activated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">FreeCADGui</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">ActiveView</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getpoint</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_cb</span><span class="p">):</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">event_cb</span><span class="o">.</span><span class="n">getEvent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span> <span class="o">==</span> <span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">DOWN</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">getPosition</span><span class="p">()</span>
            <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">getPoint</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">Part</span><span class="o">.</span><span class="n">LineSegment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">toShape</span><span class="p">()</span>
                <span class="n">Part</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">removeEventCallbackPivy</span><span class="p">(</span><span class="n">SoMouseButtonEvent</span><span class="o">.</span><span class="n">getClassTypeId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">GetResources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">'Pixmap'</span><span class="p">:</span> <span class="s1">'path_to_an_icon/line_icon.png'</span><span class="p">,</span> <span class="s1">'MenuText'</span><span class="p">:</span> <span class="s1">'Line'</span><span class="p">,</span> <span class="s1">'ToolTip'</span><span class="p">:</span> <span class="s1">'Creates a line by clicking 2 points on the screen'</span><span class="p">}</span>

<span class="n">FreeCADGui</span><span class="o">.</span><span class="n">addCommand</span><span class="p">(</span><span class="s1">'line'</span><span class="p">,</span> <span class="n">line</span><span class="p">())</span>
</pre></div>
<p>Was wir hier gemacht haben, ist unsere Funktion <code>__init__()</code> in eine Funktion <code>Activated()</code> umzuwandeln, denn wenn FreeCAD-Befehle gestartet werden, f&uuml;hren sie automatisch die Funktion <code>Activated()</code> aus. Wir haben auch eine Funktion <code>GetResources()</code> hinzugef&uuml;gt, die FreeCAD dar&uuml;ber informiert, wo ein Symbol f&uuml;r das Werkzeug zu finden ist und wie sein Name sowie die zugeh&ouml;rige Quickinfo lautet. Jedes <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">jpg</span>-, <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">png</span>- oder <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">svg</span>-Bild funktioniert als Symbol und kann eine beliebige Gr&ouml;&szlig;e haben, aber am besten ist es, eine Gr&ouml;&szlig;e zu verwenden, die dem endg&uuml;ltigen Seitenverh&auml;ltnis nahe kommt, wie 16x16, 24x24 oder 32x32.
Dann f&uuml;gen wir die Klasse <code>line()</code> als offiziellen FreeCAD-Befehl mit der Methode <code>addCommand()</code> hinzu.
</p><p>Das war's; anschlie&szlig;end m&uuml;ssen wir nur noch FreeCAD neu starten und schon haben wir einen sch&ouml;nen neuen Arbeitsbereich mit unserem nagelneuen Linienwerkzeug!
</p>
<p><a href="#top">Anfang</a></p>
<p><span id="So_you_want_more?"></span>
</p>
<h2><span id="Das_war_noch_nicht_genug.3F"></span><span class="mw-headline" id="Das_war_noch_nicht_genug?">Das war noch nicht genug?</span></h2>
<p>Wenn diese &Uuml;bung gefallen hat, kann man versuchen, dieses kleine Werkzeug zu verbessern. Es gibt viele Dinge, die man tun kann, wie zum Beispiel:
</p>
<ul><li>R&uuml;ckmeldungen f&uuml;r den Benutzer hinzuf&uuml;gen: Bis jetzt haben wir ein sehr nacktes Werkzeug erstellt, der Benutzer k&ouml;nnte sich etwas verloren f&uuml;hlen, wenn er es verwendet. Wir k&ouml;nnten ihm eine R&uuml;ckmeldung geben, die ihm sagt, welcher Schritt als n&auml;chstes folgt. Wir k&ouml;nnten z.B. Meldungen an die FreeCAD-Konsole ausgeben. Siehe das Modul <code>FreeCAD.Console</code>.</li>
<li>Eine M&ouml;glichkeit hinzuf&uuml;gen, die Koordinaten der 3D-Punkte manuell einzugeben. Siehe beispielsweise die Python-Funktion <code>input()</code>.</li>
<li>Eine M&ouml;glichkeit hinzuf&uuml;gen, mehr als 2 Punkte hinzuzuf&uuml;gen</li>
<li>Ereignisse f&uuml;r andere Dinge hinzuf&uuml;gen: Jetzt &uuml;berpr&uuml;fen wir nur, ob es Ereignisse f&uuml;r die Maustaste gibt; was w&auml;re, wenn wir auch etwas ausf&uuml;hren w&uuml;rden, wenn die Maus bewegt wird, wie z.B. die aktuellen Koordinaten anzuzeigen?</li>
<li>Dem erstellten Objekt einen Namen geben.</li></ul>
<p>Und im <a rel="nofollow" class="external text" href="https://forum.freecad.org/">Forum</a> k&ouml;nnen jederzeit Fragen gestellt und Ideen geteilt werden!
</p>
<p><a href="#top">Anfang</a></p>
<div class="NavFrame" style="margin: 0px; text-align: center; border-collapse: collapse; font-size: 100%; border-top-style: double; border-top-style: 1px; clear:both;">
    <div class="NavHead mw-collapsible mw-collapsed" style="margin: 1px; font-weight: normal; background-color: var(--background-color-neutral-subtle, #fefefe);"><span typeof="mw:File"><a href="../index.php?title=Power_user_hub.png&amp;filetimestamp=20200511213015&amp;.html" class="mw-file-description"><img src="../File/Power_user_hub.png" decoding="async" width="24" height="24" class="mw-file-element" data-file-width="128" data-file-height="128"></a></span> <a href="../de/Power_users_hub.html" title="Power users hub/de">Power user documentation</a>
        <div class="NavContent mw-collapsible-content" style="margin: 10px; border: 1px solid var(--border-color-base, #aaaaaa); text-align: left; border-collapse: collapse; font-weight: normal; font-size: 100%; clear:both; margin-top: 1px; background-color: var(--background-color-neutral-subtle, #fefefe);">
<ul><li><b>FreeCAD scripting:</b> <a href="../de/Python.html" title="Python/de">Python</a>, <a href="../de/Introduction_to_Python.html" title="Introduction to Python/de">Introduction to Python</a>, <a href="../de/Python_scripting_tutorial.html" title="Python scripting tutorial/de">Python scripting tutorial</a>, <a href="../de/FreeCAD_Scripting_Basics.html" title="FreeCAD Scripting Basics/de">FreeCAD Scripting Basics</a></li></ul>
<hr>
<ul><li><b>Modules:</b> <a href="../de/Builtin_modules.html" title="Builtin modules/de">Builtin modules</a>, <a href="../de/Units.html" title="Units/de">Units</a>, <a href="../de/Quantity.html" title="Quantity/de">Quantity</a></li>
<li><b>Workbenches:</b> <a href="../de/Workbench_creation.html" title="Workbench creation/de">Workbench creation</a>, <a href="../de/Gui_Command.html" title="Gui Command/de">Gui Commands</a>, <a href="../de/Command.html" title="Command/de">Commands</a>, <a href="../de/Installing_more_workbenches.html" title="Installing more workbenches/de">Installing more workbenches</a></li>
<li><b>Meshes and Parts:</b> <a href="../de/Mesh_Scripting.html" title="Mesh Scripting/de">Mesh Scripting</a>, <a href="../de/Topological_data_scripting.html" title="Topological data scripting/de">Topological data scripting</a>, <a href="../de/Mesh_to_Part.html" title="Mesh to Part/de">Mesh to Part</a>, <a href="../de/PythonOCC.html" title="PythonOCC/de">PythonOCC</a></li></ul>
<hr>
<ul><li><b>Parametric objects:</b> <a href="../de/Scripted_objects.html" title="Scripted objects/de">Scripted objects</a>, <a href="../de/Viewprovider.html" title="Viewprovider/de">Viewproviders</a> <small>(<a href="../de/Custom_icon_in_tree_view.html" title="Custom icon in tree view/de">Custom icon in tree view</a>)</small></li>
<li><b>Scenegraph:</b> <a href="../de/Scenegraph.html" title="Scenegraph/de">Coin (Inventor) scenegraph</a>, <a href="../de/Pivy.html" title="Pivy/de">Pivy</a></li>
<li><b>Graphical interface:</b> <a href="../de/Interface_creation.html" title="Interface creation/de">Interface creation</a>, <a href="../de/Dialog_creation.html" title="Dialog creation/de">Interface creation completely in Python</a> <small>(<a href="../de/Dialog_creation_with_various_widgets.html" title="Dialog creation with various widgets/de">1</a>, <a href="../de/Dialog_creation_reading_and_writing_files.html" title="Dialog creation reading and writing files/de">2</a>, <a href="../de/Dialog_creation_setting_colors.html" title="Dialog creation setting colors/de">3</a>, <a href="../de/Dialog_creation_image_and_animated_GIF.html" title="Dialog creation image and animated GIF/de">4</a>, <a href="../de/PySide_usage_snippets.html" title="PySide usage snippets/de">5</a>)</small>, <a href="../de/PySide.html" title="PySide/de">PySide</a>, PySide examples <a href="../de/PySide_Beginner_Examples.html" title="PySide Beginner Examples/de">beginner</a>, <a href="../de/PySide_Intermediate_Examples.html" title="PySide Intermediate Examples/de">intermediate</a>, <a href="../de/PySide_Advanced_Examples.html" title="PySide Advanced Examples/de">advanced</a></li>
<li><b>Macros:</b> <a href="../de/Macros.html" title="Macros/de">Macros</a>, <a href="../de/How_to_install_macros.html" title="How to install macros/de">How to install macros</a></li>
<li><b>Embedding:</b> <a href="../de/Embedding_FreeCAD.html" title="Embedding FreeCAD/de">Embedding FreeCAD</a>, <a href="../de/Embedding_FreeCADGui.html" title="Embedding FreeCADGui/de">Embedding FreeCADGui</a></li></ul>
<hr>
<ul><li><b>Other:</b> <a href="../de/Expressions.html" title="Expressions/de">Expressions</a>, <a href="../de/Code_snippets.html" title="Code snippets/de">Code snippets</a>, <a class="mw-selflink selflink">Line drawing function</a>, <a href="../de/FreeCAD_vector_math_library.html" title="FreeCAD vector math library/de">FreeCAD vector math library</a> <small>(deprecated)</small></li></ul>
<hr>
<ul><li><b>Hubs:</b> <a href="../de/User_hub.html" title="User hub/de">User hub</a>, <a href="../de/Power_users_hub.html" title="Power users hub/de">Power users hub</a>, <a href="../de/Developer_hub.html" title="Developer hub/de">Developer hub</a></li></ul></div>
    </div></div>
<div style="clear:both"></div>
<!-- 
NewPP limit report
Cached time: 20250922080011
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.101 seconds
Real time usage: 0.129 seconds
Preprocessor visited node count: 714/1000000
Post&#8208;expand include size: 10633/2097152 bytes
Template argument size: 5545/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 24/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 21885/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   27.312      1 -total
 30.14%    8.231     24 Template:Code
 20.42%    5.578      1 Template:Powerdocnavi/de
  9.47%    2.586      6 Template:Top
  8.82%    2.408     31 Template:Incode
  6.05%    1.653      1 Template:Navigation_menu_2
  5.98%    1.634     14 Template:FileName
  4.92%    1.343      1 Template:TOCright
  2.70%    0.737      1 Template:Clear
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:56385-0!canonical and timestamp 20250922080011 and revision id 1647169. Rendering was triggered because: api-parse
 -->
</div>
</div><script src="../site.js"></script>