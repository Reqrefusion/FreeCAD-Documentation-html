<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro export transient FEM results/de</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="de" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../index.php?title=Special;Translate&amp;group=page-Macro+export+transient+FEM+results&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--high" lang="de" dir="ltr">Deutsch</span></li>
<li><a href="../Macro_export_transient_FEM_results.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Macro export transient FEM results (100% translated)" lang="en" dir="ltr">English</a></li>
<li><a href="../fr/Macro_export_transient_FEM_results.html" class="mw-pt-progress mw-pt-progress--complete" title="Macro Exportation de r&eacute;sultats transitoires FEM (100% translated)" lang="fr" dir="ltr">fran&ccedil;ais</a></li>
<li><a href="../it/Macro_export_transient_FEM_results.html" class="mw-pt-progress mw-pt-progress--low" title="Macro export transient FEM results/it (14% translated)" lang="it" dir="ltr">italiano</a></li>
<li><a href="../pl/Macro_export_transient_FEM_results.html" class="mw-pt-progress mw-pt-progress--low" title="Makrodefinicja: Eksport przej&#347;ciowych wynik&oacute;w MES (5% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="../index.php?title=Text-x-python.png&amp;filetimestamp=20121224162851&amp;.html" class="mw-file-description" title="Generisches Makro-Symbol Erstellen Sie Ihr pers&ouml;nliches Symbol mit demselben Namen des Makros"><img alt="Generisches Makro-Symbol Erstellen Sie Ihr pers&ouml;nliches Symbol mit demselben Namen des Makros" src="../File/Text-x-python.png" decoding="async" width="32" height="32" class="mw-file-element" data-file-width="48" data-file-height="48"></a></span><span> </span>
Exportieren von transienten FEM-Ergebnissen
</p>
</td></tr>
<tr>
<th class="ctOdd">Beschreibung
</th></tr>
<tr>
<td class="ctEven left macro-description">Exportiert mehrere FEM-Ergebnisse aus einer transienten Analyse zur Nachbearbeitung in ParaView.<br><br>Versionsmakro&nbsp;: 0.1<br>Datum der letzten &Auml;nderung&nbsp;: 2019-08-30<br>FreeCAD version&nbsp;: Alle<br>Herunterladen&nbsp;: <a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing">Macro file (3 kB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing">Beispieldatei ohne Ergebnisse (200 kB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing">Beispieldatei mit Ergebnissen (10 MB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing">Alle Beispieldateien, einschlie&szlig;lich des Ordners vtk-export (21 MB)</a><br>Autor: Luftschraube<br>
</td></tr>
<tr>
<th class="ctOdd">Autor
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../index.php?title=User;Luftschraube&amp;action=edit&amp;redlink=1.html" class="new" title="User:Luftschraube (page does not exist)">Luftschraube</a>
</td></tr>
<tr>
<th class="ctOdd">Herunterladen
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing">Macro file (3 kB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing">Beispieldatei ohne Ergebnisse (200 kB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing">Beispieldatei mit Ergebnissen (10 MB)</a><br><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing">Alle Beispieldateien, einschlie&szlig;lich des Ordners vtk-export (21 MB)</a>
</td></tr>
<tr>
<th class="ctOdd">Links
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../de/Macros_recipes.html" title="Macros recipes/de">Makros Rezepte</a><br><a href="../de/How_to_install_macros.html" title="How to install macros/de">Wie man Makros installiert</a><br><a href="../de/Customize_Toolbars.html" title="Customize Toolbars/de">Symbolleisten anpassen</a>
</td></tr>
<tr>
<th class="ctOdd">Macro-Version
</th></tr>
<tr>
<td class="ctEven macro-version">0.1
</td></tr>
<tr>
<th class="ctOdd">Datum der letzten &Auml;nderung
</th></tr>
<tr>
<td class="ctEven macro-date">2019-08-30
</td></tr>
<tr>
<th class="ctOdd">FreeCAD-Version(s)
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">Alle
</td></tr>
<tr>
<th class="ctOdd">Standardverkn&uuml;pfung
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Siehe auch
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<p><span id="Description"></span>
</p>
<h2><span class="mw-headline" id="Beschreibung">Beschreibung</span></h2>
<p>Dieses Makro exportiert mehrere FEM-Ergebnisobjekte aus einer transienten Analyse in das VTK-Format und generiert eine PVU-Datei, mit der die Ergebnisse direkt in ParaView zur Nachbearbeitung geladen werden k&ouml;nnen.
</p><p><span id="Background"></span>
</p>
<h2><span class="mw-headline" id="Hintergrund">Hintergrund</span></h2>
<p>Eine transiente Analyse in FreeCAD f&uuml;hrt zu einer Reihe von FEM-Ergebnisobjekten, eines f&uuml;r jeden Zeitstempel. Die einzelnen Ergebnisse k&ouml;nnen direkt in FreeCAD untersucht und mit <a href="../de/FEM_PostPipelineFromResult.html" title="FEM PostPipelineFromResult/de">Pipelines</a> nachbearbeitet werden. Die M&ouml;glichkeiten innerhalb von FreeCAD sind jedoch nach wie vor begrenzt, insbesondere f&uuml;r transiente Analysen. Ein besseres Werkzeug f&uuml;r die Nachbearbeitung und Visualisierung ist ParaView. Man kann einzelne FEM-Ergebnisobjekte aus FreeCAD als .vtk- oder .vtu-Datei exportieren, die dann mit ParaView ge&ouml;ffnet werden k&ouml;nnen. Leider unterst&uuml;tzt der Arbeitsbereich FEM (noch) nicht den Export mehrerer .vtk-Dateien auf einmal. Hier kommt dieses Makro ins Spiel.
</p><p><span id="How_to_use_(experienced_users)"></span>
</p>
<h2><span id="Anwendung_.28f.C3.BCr_erfahrene_Benutzer.29"></span><span class="mw-headline" id="Anwendung_(f&uuml;r_erfahrene_Benutzer)">Anwendung (f&uuml;r erfahrene Benutzer)</span></h2>
<p>Das Makro in einem FreeCAD-Projekt ausf&uuml;hren, das mehrere FEM-Ergebnisobjekte aus einer transienten Analyse enth&auml;lt. Neben der .FCStd-Datei wird ein neuer Ordner 'vtk-export' erstellt, der die einzelnen Ergebnisse (.vtu-Dateien) und eine .pvu-Datei enth&auml;lt, die mit ParaView ge&ouml;ffnet werden kann.
</p><p><span id="How_to_use_(step-by-step_with_example)"></span>
</p>
<h2><span id="Anwendung_.28Schritt_f.C3.BCr_Schritt_mit_Beispiel.29"></span><span class="mw-headline" id="Anwendung_(Schritt_f&uuml;r_Schritt_mit_Beispiel)">Anwendung (Schritt f&uuml;r Schritt mit Beispiel)</span></h2>
<p>Als Beispiel wird die Biegung eines Bimetallstreifens aus Aluminium/Stahl verwendet. Eine Schritt-f&uuml;r-Schritt-Anleitung zum Erstellen der Beispieldatei findet man <a href="../de/Transient_FEM_analysis.html" title="Transient FEM analysis/de">hier</a>, oder man kann die Datei aus dem <a href="#Downloads">Download-Bereich</a> dieser Seite herunterladen. Die FCMacro-Datei im FreeCAD-Makroordner speichern, den man &uuml;ber Bearbeiten &rarr; Einstellungen &rarr; Python &rarr; Makro findet.
</p><p>Nachdem die Beispieldatei ge&ouml;ffnet ist, gehen wir zu Makro &rarr; Makros..., w&auml;hlen &bdquo;ExportTransientResults_190830.FCMacro&ldquo; (oder den Namen, unter dem man die Datei gespeichert hat) aus und f&uuml;hrt sie aus. Das Makro erstellt nun neben der .FCStd-Datei einen Unterordner 'vtk-export'. Je nach Anzahl und Gr&ouml;&szlig;e der Ergebnisobjekte kann dies einige Zeit dauern. In der Berichtsansicht (Ansicht &rarr; Berichtsansicht) sollte &bdquo;Macro finished&ldquo; (Makro abgeschlossen) angezeigt werden, wenn alles geklappt hat &ndash; oder es werden Fehlermeldungen angezeigt. (Hinweis: Manchmal erscheinen Meldungen wie &bdquo;PropertyFloatList NOT exported to vtk&ldquo;, aber ich konnte trotzdem mit den VTK-Dateien arbeiten...) Im Unterordner &bdquo;vtk-export&rdquo; finden wir .vtu-Dateien, eine f&uuml;r jeden Ergebnissatz f&uuml;r jeden Zeitstempel. Zus&auml;tzlich wird eine .pvd-Datei erstellt, die ParaView mitteilt, welcher Ergebnissatz zu welchem Zeitstempel geh&ouml;rt. 
</p>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Now, we open ParaView and go to File &rarr; Open... and open the .pvd file. In the 'Properties' tab, we click 'Apply' to load the results. In the 'Information' tab we will see a list of <i>Index</i> and <i>Value</i>, corresponding to the timestamps of the results that we just imported. (Of course, it always makes sense to check if the times given here are correct or if something strange happened during the export.) From here, we can use ParaView to play around with the results. Since ParaView offers a lot of possibilities, please refer to the appropriate documentations around the internet.
</p>
</div> 
<p>Zur Veranschaulichung visualisieren wir nun die Temperatur des gebogenen Bimetallstreifens: In der Registerkarte 'Eigenschaften' auf der linken Seite w&auml;hlen wir unter 'Farbgebung' die Option 'Temperatur' aus, woraufhin das Bild entsprechend der lokalen Temperatur farblich dargestellt wird. &Uuml;ber das kleine Symbol mit einem Herz w&auml;hlen wir die Farbskala 'kalt bis warm' aus. Mit den rekorder&auml;hnlichen Symbolen oben k&ouml;nnen wir durch alle einzelnen Ergebnisse bl&auml;ttern, die w&auml;hrend der Analyse erstellt wurden. Die Schaltfl&auml;che 'Wiedergabe' zeigt die einzelnen Bilder in ihrer Reihenfolge an. Die einzelnen Ergebnisse sind jedoch nicht durch ein konstantes Zeitintervall voneinander getrennt, sodass die Animation nicht zeitlich proportional ist. 
</p><p>Was wir brauchen, ist eine Interpolation der Ergebnisse zwischen den Zeitschritten, die &uuml;ber Filters &rarr; Temporal &rarr; Temporal Interpolator verf&uuml;gbar ist. Hier w&auml;hlen wir erneut die Temperatur f&uuml;r die Farbgebung. In der 'animation view' (View &rarr; Animation View) k&ouml;nnen wir nun vom 'Sequenz'-Modus in den 'Echtzeit'-Modus wechseln ('sequence' mode to 'real time' mode). Wir k&ouml;nnen auch die Startzeit (Standard ist 0,01 s), die Endzeit und die Dauer festlegen. W&auml;hrend Start- und Endzeit sich auf die Simulationszeit beziehen, ist die Dauer die tats&auml;chliche Echtzeit, die die Animation ben&ouml;tigt, um vollst&auml;ndig abgespielt zu werden. Bei einer Dauer von 10 s wird unsere 60 s lange Simulationszeit auf 10 s Echtzeit komprimiert.
</p><p>Wir gehen noch einen Schritt weiter und m&ouml;chten die tats&auml;chliche Biegung des Streifens visualisieren. Bei ausgew&auml;hltem Temporal Interpolator f&uuml;gen wir Filter &rarr; Common &rarr; Warp by Vector hinzu. Unter 'Vektoren' w&auml;hlen wir 'DisplacementVectors' und setzen den 'Skalierungsfaktor' auf 10. Wenn wir nun die Animation abspielen, k&ouml;nnen wir tats&auml;chlich sehen, wie sich der farblich abgegebene Streifen biegt (um den Faktor 10 &uuml;bertrieben).
</p><p><span typeof="mw:File"><a href="../index.php?title=Transient_FEM_Bimetal_ParaView_(1).JPG&amp;filetimestamp=20190830121504&amp;.html" class="mw-file-description"><img src="../File/Transient_FEM_Bimetal_ParaView_%281%29.JPG" decoding="async" width="700" height="543" class="mw-file-element" data-file-width="1280" data-file-height="993"></a></span>
</p>
<div style="clear:both"></div>
<p>Die soeben durchgef&uuml;hrte Nachbearbeitung kann in ParaView als 'Zustand' gespeichert werden, der jederzeit wieder ge&ouml;ffnet und sogar auf einen anderen Satz von Ergebnissen angewendet werden kann.
</p><p><span id="Downloads"></span>
</p>
<h2><span class="mw-headline" id="Herunterladen">Herunterladen</span></h2>
<ul><li><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing">Makrodatei (3 kB)</a></li>
<li><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing">Beispieldatei ohne Ergebnisse (200 kB)</a></li>
<li><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing">Beispieldatei mit Ergebnissen (10 MB)</a></li>
<li><a rel="nofollow" class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing">Alle Beispieldateien, einschlie&szlig;lich des Ordners vtk-export (21 MB)</a></li></ul>
<p><span id="Script"></span>
</p>
<h2><span class="mw-headline" id="Skript">Skript</span></h2>
<p><b>Macro_export_transient_FEM_results.FCMacro</b>
</p>
<pre>#!/usr/bin/python
# -*- coding: utf-8 -*-

#
# Macro to export multiple FEM results objects from a transient analysis for
# post-processing in ParaView.
#
# Created by &lt;Luftschraube&gt; under the GNU Lesser General Public License (LGPL)
#
# Version 0.1 (30.08.2019)
#

import FreeCAD
import Fem
import feminout.importVTKResults
import os
from sys import exit

FreeCAD.Console.PrintMessage("&gt;&gt;&gt;---------Macro started\n")

#Get the file path and name of the active document 
p = FreeCAD.ActiveDocument.FileName
FilePath = "/".join(p.split("/")[:-1])
FileName = p.split("/")[-1].split(".")[0]
FreeCAD.Console.PrintMessage("File path:" + FilePath + "\n")
FreeCAD.Console.PrintMessage("File name:" + FileName + "\n")
FreeCAD.Console.PrintMessage("\n&lt;&lt;&lt;----------Macro finished with errors\n")

#Get FEM result objects into a list
FreeCAD.Console.PrintMessage("Looking for result objects...")
FEMResultObjects = []

for obj in App.ActiveDocument.Objects:
	if obj.TypeId == "Fem::FemResultObjectPython":	
		FEMResultObjects.append(obj.Label)
		#FreeCAD.Console.PrintMessage(obj.Label + '\n')

NumberOfResultObjects = len(FEMResultObjects)
FreeCAD.Console.PrintMessage(str(NumberOfResultObjects) + " found\n")

if NumberOfResultObjects &gt; 0:
	
	#Export result objects as .vtu file and generate .pvu file
	ExportFolderName = "vtk-export"
	ExportOutputPath = FilePath + "/" + ExportFolderName
	if not os.path.exists(ExportOutputPath):
		os.makedirs(ExportOutputPath)
		FreeCAD.Console.PrintMessage(ExportOutputPath + " has been created\n")
	else:
		FreeCAD.Console.PrintMessage(ExportOutputPath + " already exists\n")
	
	PVUFile = open(ExportOutputPath + "/" + FileName + ".pvd","w")
	PVUFile.write("&lt;VTKFile type=\"Collection\" version=\"1.0\" byte_order=\"LittleEndian\" header_type=\"UInt64\"&gt;\n\t&lt;Collection&gt;\n")
	
	n = 0
	for ExportObject in sorted(FEMResultObjects):
		n = n + 1
		
		#Read and format time stamp (e.g., 12.37 s = 0001237)
		FreeCADResultLabelParts = ExportObject.split("_")
		PreDecimal = FreeCADResultLabelParts[-3]
		PostDecimal = FreeCADResultLabelParts[-2]

		if len(PostDecimal) == 1:
			PostDecimal = PostDecimal + str(0)
		TimeValue = float(PreDecimal) + float(PostDecimal)/100
		TimeString = str(int(round(TimeValue*100,0))).zfill(7)
	
		#For some reason, the VTK exporter expects a list (although only one object is processed at once...) - so build a list with the current object
		ExportObjectList = []
		ExportObjectList.append(FreeCAD.ActiveDocument.getObject(ExportObject))
		FileNameOUT = FileName + "_" + TimeString + ".vtu"
		FilePath = ExportOutputPath + "/" + FileNameOUT
		FreeCAD.Console.PrintMessage(FilePath + " is to be created\n")
		feminout.importVTKResults.export(ExportObjectList,FilePath)
	
		PVUFile.write("\t\t&lt;DataSet timestep=\"" + str(TimeValue) + "\" file=\"" + FileNameOUT + "\"/&gt;\n")
	
	#Close the .pvu file
	PVUFile.write("\t&lt;/Collection&gt;\n&lt;/VTKFile&gt;")
	PVUFile.close()
else:
	FreeCAD.Console.PrintMessage("Nothing to export!")

FreeCAD.Console.PrintMessage('\n&lt;&lt;&lt;----------Macro finished\n')</pre>
<p><br>
<span id="Links"></span>
</p>
<h2><span class="mw-headline" id="Verweise">Verweise</span></h2>
<p>Beispiel <a href="../de/Transient_FEM_analysis.html" title="Transient FEM analysis/de">Transiente FEM-Analyse</a>
</p><p>Die Forumsdiskussion <a rel="nofollow" class="external text" href="https://forum.freecad.org/viewtopic.php?f=22&amp;t=37650">Export transient FEM results to vtk/vtu for ParaView</a>
</p>
<!-- 
NewPP limit report
Cached time: 20251222103841
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.036 seconds
Real time usage: 0.054 seconds
Preprocessor visited node count: 117/1000000
Post&#8208;expand include size: 4005/2097152 bytes
Template argument size: 4906/2097152 bytes
Highest expansion depth: 7/100
Expensive parser function count: 2/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 4462/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    7.121      1 -total
 53.66%    3.821      1 Template:Macro/de
 21.60%    1.538      1 Template:MacroCode
 21.48%    1.530      1 Template:Clear
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:391570-0!canonical and timestamp 20251222103841 and revision id 1719401. Rendering was triggered because: edit-page
 -->
</div>
</div><script src="../site.js"></script>