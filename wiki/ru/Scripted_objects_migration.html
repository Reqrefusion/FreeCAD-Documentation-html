<link href="../site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Scripted objects migration/ru</span></h1><?xml encoding="UTF-8"><div class="mw-parser-output"><div class="mw-pt-languages noprint" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="../de/Scripted_objects_migration.html" class="mw-pt-progress mw-pt-progress--high" title="Migration geskripteter Objekte (63% translated)" lang="de" dir="ltr">Deutsch</a></li>
<li><a href="../Scripted_objects_migration.html" class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" title="Scripted objects migration (100% translated)" lang="en" dir="ltr">English</a></li>
<li><a href="../fr/Scripted_objects_migration.html" class="mw-pt-progress mw-pt-progress--complete" title="Migration d'objets cr&eacute;&eacute;s par script (99% translated)" lang="fr" dir="ltr">fran&ccedil;ais</a></li>
<li><a href="../it/Scripted_objects_migration.html" class="mw-pt-progress mw-pt-progress--stub" title="Migrazione di oggetti creati con script (3% translated)" lang="it" dir="ltr">italiano</a></li>
<li><a href="../pl/Scripted_objects_migration.html" class="mw-pt-progress mw-pt-progress--complete" title="Obiekty tworzone skryptami, migracja (99% translated)" lang="pl" dir="ltr">polski</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--stub" lang="ru" dir="ltr">&#1088;&#1091;&#1089;&#1089;&#1082;&#1080;&#1081;</span></li></ul></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Introduction">Introduction</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><a href="../Scripted_objects.html" title="Scripted objects">Scripted objects</a> are rebuilt every time a <a href="../File_Format_FCStd.html" title="File Format FCStd">FCStd document</a> is opened. To do this the document keeps a reference to the module and Python class that were used to create the object, along with its properties.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-xml mw-content-ltr" dir="ltr"><pre><span></span><span class="nt">&lt;Document</span> <span class="na">SchemaVersion=</span><span class="s">"4"</span> <span class="na">ProgramVersion=</span><span class="s">"0.19R20959 (Git)"</span> <span class="na">FileVersion=</span><span class="s">"1"</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;Properties</span> <span class="na">Count=</span><span class="s">"15"</span> <span class="na">TransientCount=</span><span class="s">"3"</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;/Properties&gt;</span>
    <span class="nt">&lt;Objects</span> <span class="na">Count=</span><span class="s">"1"</span> <span class="na">Dependencies=</span><span class="s">"1"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ObjectDeps</span> <span class="na">Name=</span><span class="s">"Custom"</span> <span class="na">Count=</span><span class="s">"0"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;Object</span> <span class="na">type=</span><span class="s">"Part::FeaturePython"</span> <span class="na">name=</span><span class="s">"Custom"</span> <span class="na">id=</span><span class="s">"2715"</span> <span class="na">Touched=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/Objects&gt;</span>
    <span class="nt">&lt;ObjectData</span> <span class="na">Count=</span><span class="s">"1"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Object</span> <span class="na">name=</span><span class="s">"Custom"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Properties</span> <span class="na">Count=</span><span class="s">"9"</span> <span class="na">TransientCount=</span><span class="s">"0"</span><span class="nt">&gt;</span>
                ...
                <span class="nt">&lt;Property</span> <span class="na">name=</span><span class="s">"Proxy"</span> <span class="na">type=</span><span class="s">"App::PropertyPythonObject"</span> <span class="na">status=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;Python</span> <span class="na">value=</span><span class="s">"eyJUeXBlIjogIkN1c3RvbSJ9"</span> <span class="na">encoded=</span><span class="s">"yes"</span> <span class="na">module=</span><span class="s">"old_module"</span> <span class="na">class=</span><span class="s">"OldObject"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/Property&gt;</span>
                ...
            <span class="nt">&lt;/Properties&gt;</span>
        <span class="nt">&lt;/Object&gt;</span>
    <span class="nt">&lt;/ObjectData&gt;</span>
<span class="nt">&lt;/Document&gt;</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Particularly focus on this part:
</p>
</div>
<div class="mw-highlight mw-highlight-lang-xml mw-content-ltr" dir="ltr"><pre><span></span>...
                <span class="nt">&lt;Property</span> <span class="na">name=</span><span class="s">"Proxy"</span> <span class="na">type=</span><span class="s">"App::PropertyPythonObject"</span> <span class="na">status=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;Python</span> <span class="na">value=</span><span class="s">"eyJUeXBlIjogIkN1c3RvbSJ9"</span> <span class="na">encoded=</span><span class="s">"yes"</span> <span class="na">module=</span><span class="s">"old_module"</span> <span class="na">class=</span><span class="s">"OldObject"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/Property&gt;</span>
                ...
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>If the value of <code>module=</code> or <code>class=</code> is not found on the installed system, the object will fail to load correctly. This means that once an object is created using a particular class, the module should no longer be moved or renamed because if this is done, previously saved objects will break.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>However, a valid reason for moving or renaming the module or class is to improve the structure and maintainability of the original code, for example, when restructuring an entire workbench. In this case there are various strategies to migrate old objects to using a new class. This is done in order to retain backwards compatibility, when outright breaking of old documents must be avoided.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Old_object_and_new_object">Old object and new object</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h3><span class="mw-headline" id="Old_object">Old object</span></h3>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>An old object is defined in a module which is at the root of the workbench.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyLength"</span><span class="p">,</span> <span class="s2">"Length"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyArea"</span><span class="p">,</span> <span class="s2">"Area"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Area</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="s2">"Custom"</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>An object can be created using this class, and it can be saved to <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">my_document.FCstd</span>. If no particular <a href="../Viewprovider.html" title="Viewprovider">viewprovider</a> is assigned to the new object, its proxy class is simply set to a value different from <code>None</code>, in this case, to <code>1</code>.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="kn">import</span> <span class="nn">FreeCAD</span> <span class="k">as</span> <span class="nn">App</span>
<span class="kn">import</span> <span class="nn">old_module</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">newDocument</span><span class="p">()</span>
<span class="n">doc</span><span class="o">.</span><span class="n">FileName</span> <span class="o">=</span> <span class="s2">"my_document.FCStd"</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="s2">"Part::FeaturePython"</span><span class="p">,</span> <span class="s2">"Custom"</span><span class="p">)</span>
<span class="n">old_module</span><span class="o">.</span><span class="n">OldObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="k">if</span> <span class="n">App</span><span class="o">.</span><span class="n">GuiUp</span><span class="p">:</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">ViewObject</span><span class="o">.</span><span class="n">Proxy</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">doc</span><span class="o">.</span><span class="n">recompute</span><span class="p">()</span>
<span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><a href="../Python_console.html" title="Python console">Python console</a> session with the basic properties omitted.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">Custom</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PropertiesList</span><span class="p">)</span>
<span class="p">[</span><span class="s1">'Area'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'Length'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">old_module</span><span class="o">.</span><span class="n">OldObject</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7efc3c51c390</span><span class="o">&gt;</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h3><span class="mw-headline" id="New_object">New object</span></h3>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Now we consider that the workbench is restructured, so that classes aren't just at the root directory, but instead are inside an <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">objects</span> directory. Complex workbenches that have many different types of objects should be structured in directories including objects, <a href="../Viewprovider.html" title="Viewprovider">viewproviders</a>, <a href="../Command.html" title="Command">Gui Commands</a>, <a href="../Task_panel.html" title="Task panel">task panel</a> interfaces, etc.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># objects/new_module.py</span>
<span class="k">class</span> <span class="nc">NewObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyLength"</span><span class="p">,</span> <span class="s2">"Length"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyArea"</span><span class="p">,</span> <span class="s2">"GeneralArea"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyInteger"</span><span class="p">,</span> <span class="s2">"Divisions"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">GeneralArea</span> <span class="o">=</span> <span class="mi">600</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Divisions</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="s2">"Custom"</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>This new class will refer to the same type of object, but both the module name as well as the class name have been renamed. Moreover, the properties also have changed; one property has been renamed, and a completely new property has been added.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>If we create a new object with this new module we will have the following console session.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj2</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">Custom2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj2</span><span class="o">.</span><span class="n">PropertiesList</span><span class="p">)</span>
<span class="p">[</span><span class="s1">'Divisions'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'GeneralArea'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'Length'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj2</span><span class="o">.</span><span class="n">Proxy</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">objects</span><span class="o">.</span><span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7efc1cf68c50</span><span class="o">&gt;</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Method_1._Migration_by_redirecting_the_class">Method 1. Migration by redirecting the class</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>We will migrate the older object by redirecting the old class. The original class is deleted, and the name of the class is simply redirected to point to the new class.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="kn">import</span> <span class="nn">objects.new_module</span> <span class="k">as</span> <span class="nn">new_module</span>

<span class="n">OldObject</span> <span class="o">=</span> <span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Any document that tries to load <code>old_module.OldObject</code> will be redirected to load <code>objects.new_module.NewObject</code> instead.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>If we open the document, and inspect the properties of the object in the <a href="../Python_console.html" title="Python console">Python console</a> we will see that the older properties are conserved, but the object has a new Proxy class.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">Custom</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PropertiesList</span><span class="p">)</span>
<span class="p">[</span><span class="s1">'Area'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'Length'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">objects</span><span class="o">.</span><span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7f099700b2b0</span><span class="o">&gt;</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>However, in this case we don't see the new properties of the new class. The reason is simply that the older object didn't have these properties. When <code>old_module.OldObject</code> was redirected to <code>objects.new_module.NewObject</code>, only the proxy class changed, but previous information was retained.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Now, if the document is saved and opened again, it will automatically look for <code>objects.new_module.NewObject</code>, and it will not require <code>old_module.OldObject</code> any more. The <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">old_module.py</span> file may be removed permanently from the system as long as all older objects have been migrated to the new module. If the old module is removed but an object hasn't been migrated, the <a href="../Report_view.html" title="Report view">report view</a> will show a message like this when opening a document containing such object.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>&lt;class <span class="s1">'ModuleNotFoundError'</span>&gt;: No module named <span class="s1">'old_module'</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>If it is not realistically possible to migrate all older objects, say, because the old module was used in a workbench for many years, then <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">old_module.py</span> must be kept as long as it's deemed necessary to give users the opportunity to migrate their objects.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h3><span class="mw-headline" id="Advantages_and_disadvantages">Advantages and disadvantages</span></h3>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Advantages</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> This is the simplest method that just requires redirecting an old class to a new class.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> Old properties are conserved as long as the new class doesn't override them.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> This is good if the old class and the new class have the same properties (handle the same type of data) but only their module or class name is different.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Disadvantages</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24"></a></span> The new class keeps the old properties of the object, which is not always desired.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24"></a></span> New properties or renamed properties aren't handled, so the object will load but it may not show the correct behavior of the new class.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24"></a></span> The old module may have to be kept indefinitely to migrate all old objects created in the past.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Method_2._Migration_when_restoring_the_document">Method 2. Migration when restoring the document</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>We will migrate the older object by modifying the old class. The majority of the original class is deleted, and instead the <code>onDocumentRestored</code> method is implemented. When this method exists, it will run when the document tries to restore an object that uses the class, so this is the opportunity that we have to assign a new class, manipulate the information, or print messages.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>In this case, we assume that we have also defined a new <a href="../Viewprovider.html" title="Viewprovider">viewprovider</a> in the module <span style="font-weight:bold; font-family:monospace, Consolas, Courier New, Courier;">viewp/new_view.py</span>. If we don't want to migrate this class, we may omit everything after the <code>App.GuiUp</code> check.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="kn">import</span> <span class="nn">FreeCAD</span> <span class="k">as</span> <span class="nn">App</span>
<span class="kn">import</span> <span class="nn">objects.new_module</span> <span class="k">as</span> <span class="nn">new_module</span>
<span class="kn">import</span> <span class="nn">viewp.new_view</span> <span class="k">as</span> <span class="nn">new_view</span>
<span class="n">_wrn</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">Console</span><span class="o">.</span><span class="n">PrintWarning</span>

<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">onDocumentRestored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New proxy class used</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">App</span><span class="o">.</span><span class="n">GuiUp</span><span class="p">:</span>
            <span class="n">new_view</span><span class="o">.</span><span class="n">ViewProviderNew</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ViewObject</span><span class="p">)</span>
            <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New viewprovider class used</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>A more complex example checks first that the proxy class is of the type that we are looking for, and only proceeds with the migration if it's the right type.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">onDocumentRestored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">"Proxy"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s2">"Custom"</span><span class="p">:</span>
            <span class="n">_module</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
            <span class="n">_module</span> <span class="o">=</span> <span class="n">_module</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">"&lt;class '"</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">"'&gt;"</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_module</span> <span class="o">==</span> <span class="s2">"old_module.OldObject"</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_migrate</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_migrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New proxy class used</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">App</span><span class="o">.</span><span class="n">GuiUp</span><span class="p">:</span>
            <span class="n">new_view</span><span class="o">.</span><span class="n">ViewProviderNew</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ViewObject</span><span class="p">)</span>
            <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New viewprovider class used</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Assuming that we already changed the old module in this way, if we open a document with an old object, we will see the messages mentioning the use of the new classes.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Inspecting the object from the <a href="../Python_console.html" title="Python console">Python console</a> we will see that the older properties are conserved, and in addition, new properties were added together with the new Proxy class.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">Custom</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PropertiesList</span><span class="p">)</span>
<span class="p">[</span><span class="s1">'Area'</span><span class="p">,</span> <span class="s1">'Divisions'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'GeneralArea'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'Length'</span><span class="p">,</span> <span class="s1">'Length1'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">objects</span><span class="o">.</span><span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7fecb0ebd7b8</span><span class="o">&gt;</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>The old properties were <code>Area</code> and <code>Length</code>; the new properties are <code>Divisions</code>, <code>GeneralArea</code>, and <code>Length</code>. The migrated object retains the original two properties, and gains three new properties. However, since the new <code>Length</code> has the same name as the older property, the new property is renamed with an incremental number. Presumably this is not what we want. We can improve the situation by following the addendum 2.1 below.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Given that the classes are meant to handle the same type of object, we would like a migration in which <code>Area</code> transforms into <code>GeneralArea</code>, and <code>Length</code> is simply assigned to the new <code>Length</code>, and there are no duplicate properties.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h3><span class="mw-headline" id="Advantages_and_disadvantages_2">Advantages and disadvantages</span></h3>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Advantages</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> This method allows us to check that the class that we are migrating is the right class, instead of simply redirecting to a newer class.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> Similar to method 1, old properties are kept as long as the new class doesn't override them.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> Unlike method 1, new properties are always added, however if they have the same name, they will be renamed.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> The migration is not immediate, we can still manipulate the information, or print messages while the object loads.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Disadvantages</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24"></a></span> It is more verbose than method 1 because we need to implement the <code>onDocumentRestored</code> method to migrate the object.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24"></a></span> It always adds the new properties, so it may create duplicated properties in case the new properties have the same name as the old properties. This has to be handled manually.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span id="Method_3._Migration_when_restoring_the_document.2C_manually_handling_the_properties"></span><span class="mw-headline" id="Method_3._Migration_when_restoring_the_document,_manually_handling_the_properties">Method 3. Migration when restoring the document, manually handling the properties</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>This is an extension of method 2. In the <code>onDocumentRestored</code> method we need to save the values of the properties that we want, and then we can remove these original properties. This is done so that when the new class is used, it will assign the new properties without risking name collisions with the older properties.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Like in method 2, if we want we can also add the piece of code that checks that the Proxy class is the right one. In this example once more we assume that we are using a custom <a href="../Viewprovider.html" title="Viewprovider">viewprovider</a>, with at least one custom property.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="kn">import</span> <span class="nn">FreeCAD</span> <span class="k">as</span> <span class="nn">App</span>
<span class="kn">import</span> <span class="nn">objects.new_module</span> <span class="k">as</span> <span class="nn">new_module</span>
<span class="kn">import</span> <span class="nn">viewp.new_view</span> <span class="k">as</span> <span class="nn">new_view</span>
<span class="n">_wrn</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">Console</span><span class="o">.</span><span class="n">PrintWarning</span>

<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">onDocumentRestored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">old</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Area</span>
        <span class="n">old</span><span class="p">[</span><span class="s2">"Length"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Length</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Area"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Length"</span><span class="p">)</span>

        <span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">GeneralArea</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="n">old</span><span class="p">[</span><span class="s2">"Length"</span><span class="p">]</span>
        <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New proxy class used; properties migrated</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">App</span><span class="o">.</span><span class="n">GuiUp</span><span class="p">:</span>
            <span class="n">vobj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">ViewObject</span>
            <span class="n">old</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

            <span class="n">old</span><span class="p">[</span><span class="s2">"LineScale"</span><span class="p">]</span> <span class="o">=</span> <span class="n">vobj</span><span class="o">.</span><span class="n">LineScale</span>
            <span class="n">vobj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"LineScale"</span><span class="p">)</span>

            <span class="n">new_view</span><span class="o">.</span><span class="n">ViewProviderNew</span><span class="p">(</span><span class="n">vobj</span><span class="p">)</span>

            <span class="n">vobj</span><span class="o">.</span><span class="n">LineScale</span> <span class="o">=</span> <span class="mf">1.05</span> <span class="o">*</span> <span class="n">old</span><span class="p">[</span><span class="s2">"LineScale"</span><span class="p">]</span>
            <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New viewprovider class used; view properties migrated</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>We can see that the old values are stored in an auxiliary dictionary, then the old properties are removed, then we add the new class, and finally we assign the previously saved values to the new properties. In this moment we can transform the saved values as necessary for the new class. For example, the <code>GeneralArea</code> is set to 3 times the old <code>Area</code>, and the new <code>Length</code> simply receives the value of the old <code>Length</code>. As we know how the old and new classes are supposed to behave, we have the liberty of manipulating the data to migrate the object as we want.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>We can only remove properties that were added by <a href="../Python.html" title="Python">Python</a> classes when we built the <a href="../Scripted_objects.html" title="Scripted objects">scripted object</a>. Other attributes belong to the base C++ object and can't be removed.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Visibility"</span><span class="p">)</span>
<span class="kc">False</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Assuming that we already changed the old module in this way, if we open a document with an old object, we will see the messages mentioning the use of the new classes. Inspecting the object from the <a href="../Python_console.html" title="Python console">Python console</a> we see that the older properties are removed, and only the new properties exist.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">Custom</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PropertiesList</span><span class="p">)</span>
<span class="p">[</span><span class="s1">'Divisions'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'GeneralArea'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'Length'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">objects</span><span class="o">.</span><span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7efd456c9b00</span><span class="o">&gt;</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Since in the old class the <code>Divisions</code> property didn't exist, nothing was done with it. It simply was created by the new <code>objects.new_module.NewObject</code> class.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h3><span class="mw-headline" id="Advantages_and_disadvantages_3">Advantages and disadvantages</span></h3>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Advantages</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> Similar to method 2, this method allows us to check that the class that we are migrating is the right class.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> We have complete control of what to do with the old properties. Typically they will be removed so that there is no name collision with new properties added. Thus we avoid duplicated properties.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> By saving the older values, we can manipulate the information in the restoring step as we want, and assign the corresponding values to the new properties.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Disadvantages</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24"></a></span> This method is very verbose compared to the previous ones, because we must implement the <code>onDocumentRestored</code> method, and handle each of the properties individually (save value, delete property, re-assign value). This is problematic if the object that we want to migrate has many properties, or their values need to be transformed in very special ways.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Addendum_A._Creating_the_properties_only_if_they_do_not_already_exist">Addendum A. Creating the properties only if they do not already exist</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>One of the disadvantages of method 2 is that it will always try to add the new properties. If the older properties have the same name as the new properties, they will be duplicated with an incremental number, so <code>Length</code> will result in <code>Length1</code>, then <code>Length2</code>, and so on. This makes method 2 an unrealistic option in most cases, because the new class will only use one property anyway.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>To improve this method, the new class can also be modified to only add the properties if they don't already exist by the same name.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># objects/new_module.py</span>
<span class="k">class</span> <span class="nc">NewObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">"Length"</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyLength"</span><span class="p">,</span> <span class="s2">"Length"</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">"GeneralArea"</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyArea"</span><span class="p">,</span> <span class="s2">"GeneralArea"</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">GeneralArea</span> <span class="o">=</span> <span class="mi">600</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">"Divisions"</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyInteger"</span><span class="p">,</span> <span class="s2">"Divisions"</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">Divisions</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="s2">"Custom"</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>In this case, since <code>Length</code> already exists, it won't be added again; <code>GeneralArea</code> and <code>Divisions</code> don't exist, so these will be added. And just like before, <code>Area</code> will be retained because it is not explicitly removed, although possibly it is no longer used in the new class.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">Custom</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PropertiesList</span><span class="p">)</span>
<span class="p">[</span><span class="s1">'Area'</span><span class="p">,</span> <span class="s1">'Divisions'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'GeneralArea'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">'Length'</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">objects</span><span class="o">.</span><span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7f036bd4c6a0</span><span class="o">&gt;</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>The same can be done for the class of the <a href="../Viewprovider.html" title="Viewprovider">viewprovider</a>.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>By using this method 2 + A, the result is similar to method 1 in that the object will retain all previous properties, but in addition it will gain the new properties provided by the new class.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Method 3 does not need this addendum to the new class because the older properties are explicitly removed, so there won't be any conflicts when installing the new properties. Nevertheless, it is still a good practice that every class adds its required properties only if these don't already exist. This is helpful both in the case of creating new <a href="../Scripted_objects.html" title="Scripted objects">scripted objects</a> or in migrating them.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h3><span class="mw-headline" id="Advantages_and_disadvantages_4">Advantages and disadvantages</span></h3>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Advantages</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> The object will retain all previous properties, but in addition it will gain new properties without repetition.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Disadvantages</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24"></a></span> Like method 2, it still doesn't deal with renamed properties. The old properties should be manually removed.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Addendum_B._Migrating_different_versions_of_the_old_object">Addendum B. Migrating different versions of the old object</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Method 3 is the most complex method because the properties are handled individually. However, in this method we also have full flexibility in how we manipulate the data, and this is an advantage if we want to do complex operations.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>If from the beginning we create a property that holds the version number of our object, we can use this number in the future to perform specific migration from that version to any other. We set the property to be read-only, so that we cannot overwrite it in the <a href="../Property_editor.html" title="Property editor">property editor</a>, although it is still accessible from the <a href="../Python_console.html" title="Python console">Python console</a>.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyLength"</span><span class="p">,</span> <span class="s2">"Length"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyArea"</span><span class="p">,</span> <span class="s2">"Area"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyString"</span><span class="p">,</span> <span class="s2">"Version"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">setEditorMode</span><span class="p">(</span><span class="s2">"Version"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Area</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="s2">"0.18"</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="s2">"Custom"</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Then, when we want to migrate the object, we implement the <code>onDocumentRestored</code> method, and test for this version.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="kn">import</span> <span class="nn">FreeCAD</span> <span class="k">as</span> <span class="nn">App</span>
<span class="kn">import</span> <span class="nn">objects.new_module</span> <span class="k">as</span> <span class="nn">new_module</span>
<span class="n">_wrn</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">Console</span><span class="o">.</span><span class="n">PrintWarning</span>

<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">onDocumentRestored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">"Version"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">Version</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">Version</span> <span class="o">==</span> <span class="s2">"0.18"</span><span class="p">:</span>
                <span class="n">_migrate_from_018</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Version</span> <span class="o">==</span> <span class="s2">"0.19"</span><span class="p">:</span>
                <span class="n">_migrate_from_019</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_migrate_from_018</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="n">old</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Area</span>
    <span class="n">old</span><span class="p">[</span><span class="s2">"Length"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Length</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Area"</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Length"</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Version"</span><span class="p">)</span>

    <span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="n">obj</span><span class="o">.</span><span class="n">GeneralArea</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="n">old</span><span class="p">[</span><span class="s2">"Length"</span><span class="p">]</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="s2">"0.20"</span>
    <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New proxy class used; properties migrated</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_migrate_from_019</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>We don't save the <code>Version</code> value as we will set a new <code>Version</code> number when doing the migration. As shown in the example, we can implement various functions for each corresponding version of the object that we intend to migrate. We omit the migration of the <a href="../Viewprovider.html" title="Viewprovider">viewprovider</a> properties but it follows the same pattern.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h3><span class="mw-headline" id="Advantages_and_disadvantages_5">Advantages and disadvantages</span></h3>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Advantages</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> We have complete control of what to do with the old properties, and how to perform the migration.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> We can implement a particular method to migrate a particular version of the old object.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Disadvantages</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24"></a></span> This method is very verbose because we must have a clear idea on how to handle each of the properties of each "version" that we want to migrate. If our object has many different versions created over the years, we may have to prepare a long list of methods to migrate them to the newest object.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Addendum_B2._Using_internal_class_attributes_instead_of_properties">Addendum B2. Using internal class attributes instead of properties</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Instead of using a <a href="../Property.html" title="Property">property</a> of the object to hold the version information, we can use an attribute of the class. In this way we "hide" the version information, because properties are normally public, and visible in the <a href="../Property_editor.html" title="Property editor">property editor</a>, while class attributes can only be manipulated from the <a href="../Python_console.html" title="Python console">Python console</a>. Class attributes can be saved and restored as explained in <a href="../Scripted_objects_saving_attributes.html" title="Scripted objects saving attributes">Scripted objects saving attributes</a>.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyLength"</span><span class="p">,</span> <span class="s2">"Length"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s2">"App::PropertyArea"</span><span class="p">,</span> <span class="s2">"Area"</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Area</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">=</span> <span class="s2">"Custom"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ver</span> <span class="o">=</span> <span class="s2">"0.18"</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>This attribute is inspected by looking at the <code>Proxy</code> attribute.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">ActiveDocument</span><span class="o">.</span><span class="n">Custom</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="n">ver</span><span class="p">)</span>
<span class="mf">0.18</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Then the file is modified to migrate the object.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="kn">import</span> <span class="nn">FreeCAD</span> <span class="k">as</span> <span class="nn">App</span>
<span class="kn">import</span> <span class="nn">objects.new_module</span> <span class="k">as</span> <span class="nn">new_module</span>
<span class="n">_wrn</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">Console</span><span class="o">.</span><span class="n">PrintWarning</span>

<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">onDocumentRestored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="p">,</span> <span class="s2">"ver"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="n">ver</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="n">ver</span> <span class="o">==</span> <span class="s2">"0.18"</span><span class="p">:</span>
                <span class="n">_migrate_from_018</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_migrate_from_018</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="n">old</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Area</span>
    <span class="n">old</span><span class="p">[</span><span class="s2">"Length"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Length</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Area"</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Length"</span><span class="p">)</span>

    <span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="n">obj</span><span class="o">.</span><span class="n">GeneralArea</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">Length</span> <span class="o">=</span> <span class="n">old</span><span class="p">[</span><span class="s2">"Length"</span><span class="p">]</span>
    <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New proxy class used; properties migrated</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>When we install the new class, this new class should set the new value of the version attribute, for example, <code>self.ver = "0.20"</code>.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Addendum_C._Method_3_without_removing_old_properties_that_are_named_the_same">Addendum C. Method 3 without removing old properties that are named the same</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Like in Addendum A, we can write the new class to create properties only if they aren't already present. Using method 3, we save the values of the older properties, and subsequently delete the older properties. However, if the new properties are named the same as the older ones, we don't need to delete the older ones, we can just reuse the same property, as we know the property won't be duplicated. If we are using Addendum B, we have a way to query the version as well.
</p>
</div>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1"># old_module.py</span>
<span class="kn">import</span> <span class="nn">FreeCAD</span> <span class="k">as</span> <span class="nn">App</span>
<span class="kn">import</span> <span class="nn">objects.new_module</span> <span class="k">as</span> <span class="nn">new_module</span>
<span class="n">_wrn</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">Console</span><span class="o">.</span><span class="n">PrintWarning</span>

<span class="k">class</span> <span class="nc">OldObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">onDocumentRestored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">"Version"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">Version</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">Version</span> <span class="o">==</span> <span class="s2">"0.18"</span><span class="p">:</span>
                <span class="n">_migrate_from_018</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_migrate_from_018</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="n">old</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Area</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="s2">"Area"</span><span class="p">)</span>

    <span class="n">new_module</span><span class="o">.</span><span class="n">NewObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="n">obj</span><span class="o">.</span><span class="n">GeneralArea</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">old</span><span class="p">[</span><span class="s2">"Area"</span><span class="p">]</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="s2">"0.20"</span>
    <span class="n">_wrn</span><span class="p">(</span><span class="s2">"New proxy class used; properties migrated</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>As we see in the example, the old <code>Area</code> property is deleted and migrated to the new <code>GeneralArea</code> property as usual. We do not need to delete <code>Length</code> nor <code>Version</code> because in the new class they are still used with the same name, and they won't be created again (addendum A). As we don't want to modify <code>Length</code>, this property is not touched at all; it is migrated to the new class silently. However, we do update <code>Version</code> to the new value. We omit the migration of the <a href="../Viewprovider.html" title="Viewprovider">viewprovider</a> properties but it follows the same pattern.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>This should work like method 3, meaning that the old properties are removed and only the new properties remain in the new object. The only difference is that we omit removing and recreating the properties that are named the same. This process should work as long as the old <a href="../Property.html" title="Property">property</a> and the new <a href="../Property.html" title="Property">property</a> have the same type (for example, <code>App::PropertyLength</code> or <code>App::PropertyArea</code>), so the old property can pass its value directly. However, if the new property has a different type than the old property, then the old property should be removed, otherwise the old property will completely overwrite the new property, which is probably not what we want because the new class will be expecting the new type and not the old type.
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h3><span class="mw-headline" id="Advantages_and_disadvantages_6">Advantages and disadvantages</span></h3>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Advantages</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> Like method 3, this method allows us complete control of the migration of the old information.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_OK.svg&amp;filetimestamp=20240704192428&amp;.html" class="mw-file-description"><img src="../File/Edit_OK.svg" decoding="async" width="24" height="24"></a></span> We avoid writing code that removes and recreates properties that are named the same.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p><b>Disadvantages</b>
</p>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24"></a></span> Like method 3, this method is still very verbose because we have to handle the properties carefully.</li>
<li><span typeof="mw:File"><a href="../index.php?title=Edit_Cancel.svg&amp;filetimestamp=20240704192407&amp;.html" class="mw-file-description"><img src="../File/Edit_Cancel.svg" decoding="async" width="24" height="24"></a></span> If a new <a href="../Property.html" title="Property">property</a> and an old <a href="../Property.html" title="Property">property</a> share the same name, the new property will be overwritten, which may be undesired behavior, especially if the two properties have different types. In this case, removing the old property, and migrating its value manually is still necessary.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Summary">Summary</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Each of the methods has a recommended use:
</p>
<ul><li>Method 1. The module is moved or renamed but the properties are the same. Simple redirection of classes because the properties don't need to be modified at all.</li>
<li>Method 2+A. Simple migration scenarios. Display a message when the object is migrated from one class to another. The properties are of the same type and don't need to be modified at all.</li>
<li>Method 3, 3+A, or 3+B. Complex migration scenarios. Full control of the properties, deleting the old properties, and adding new properties. An identifier to know the version of the object is useful to choose the right function to perform the migration (Addendum B or B2).</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<p>Preferably avoid the following:
</p>
<ul><li>Method 2. The properties will be duplicated if the new class doesn't check for existing properties (Addendum A).</li>
<li>Method 3+C. Use only when the old properties and the new properties are of the same type. Otherwise use method 3 or 3+B to remove older properties, and handle them exactly as needed.</li></ul>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<h2><span class="mw-headline" id="Links">Links</span></h2>
</div>
<div lang="en" dir="ltr" class="mw-content-ltr">
<ul><li><a rel="nofollow" class="external text" href="https://forum.freecad.org/viewtopic.php?t=42948">Migrating and upgrading old scripted objects</a></li>
<li><a rel="nofollow" class="external text" href="https://forum.freecad.org/viewtopic.php?f=18&amp;t=46218">Migrate old scripted objects</a></li></ul>
</div>
<div class="NavFrame" style="margin: 0px; text-align: center; border-collapse: collapse; font-size: 100%; border-top-style: double; border-top-style: 1px; clear:both;">
    <div class="NavHead mw-collapsible mw-collapsed" style="margin: 1px; font-weight: normal; background-color: #fefefe;"><span typeof="mw:File"><a href="../index.php?title=Power_user_hub.png&amp;filetimestamp=20200511213015&amp;.html" class="mw-file-description"><img src="../File/Power_user_hub.png" decoding="async" width="24" height="24"></a></span> <a href="../ru/Power_users_hub.html" title="Power users hub/ru">Power user documentation</a>
        <div class="NavContent mw-collapsible-content" style="margin: 10px; border: 1px solid #aaaaaa; text-align: left; border-collapse: collapse; font-weight: normal; font-size: 100%; clear:both; margin-top: 1px; background-color: #fefefe;">
<ul><li><b>FreeCAD scripting:</b> <a href="../ru/Python.html" title="Python/ru">Python</a>, <a href="../ru/Introduction_to_Python.html" title="Introduction to Python/ru">Introduction to Python</a>, <a href="../ru/Python_scripting_tutorial.html" title="Python scripting tutorial/ru">Python scripting tutorial</a>, <a href="../ru/FreeCAD_Scripting_Basics.html" title="FreeCAD Scripting Basics/ru">FreeCAD Scripting Basics</a></li></ul>
<hr>
<ul><li><b>Modules:</b> <a href="../ru/Builtin_modules.html" title="Builtin modules/ru">Builtin modules</a>, <a href="../ru/Units.html" title="Units/ru">Units</a>, <a href="../index.php?title=Quantity/ru&amp;action=edit&amp;redlink=1.html" class="new" title="Quantity/ru (page does not exist)">Quantity</a></li>
<li><b>Workbenches:</b> <a href="../ru/Workbench_creation.html" title="Workbench creation/ru">Workbench creation</a>, <a href="../ru/Gui_Command.html" title="Gui Command/ru">Gui Commands</a>, <a href="../ru/Command.html" title="Command/ru">Commands</a>, <a href="../ru/Installing_more_workbenches.html" title="Installing more workbenches/ru">Installing more workbenches</a></li>
<li><b>Meshes and Parts:</b> <a href="../ru/Mesh_Scripting.html" title="Mesh Scripting/ru">Mesh Scripting</a>, <a href="../ru/Topological_data_scripting.html" title="Topological data scripting/ru">Topological data scripting</a>, <a href="../ru/Mesh_to_Part.html" title="Mesh to Part/ru">Mesh to Part</a>, <a href="../ru/PythonOCC.html" title="PythonOCC/ru">PythonOCC</a></li></ul>
<hr>
<ul><li><b>Parametric objects:</b> <a href="../ru/Scripted_objects.html" title="Scripted objects/ru">Scripted objects</a>, <a href="../ru/Viewprovider.html" title="Viewprovider/ru">Viewproviders</a> <small>(<a href="../index.php?title=Custom_icon_in_tree_view/ru&amp;action=edit&amp;redlink=1.html" class="new" title="Custom icon in tree view/ru (page does not exist)">Custom icon in tree view</a>)</small></li>
<li><b>Scenegraph:</b> <a href="../ru/Scenegraph.html" title="Scenegraph/ru">Coin (Inventor) scenegraph</a>, <a href="../ru/Pivy.html" title="Pivy/ru">Pivy</a></li>
<li><b>Graphical interface:</b> <a href="../ru/Interface_creation.html" title="Interface creation/ru">Interface creation</a>, <a href="../ru/Dialog_creation.html" title="Dialog creation/ru">Interface creation completely in Python</a> <small>(<a href="../index.php?title=Dialog_creation_with_various_widgets/ru&amp;action=edit&amp;redlink=1.html" class="new" title="Dialog creation with various widgets/ru (page does not exist)">1</a>, <a href="../index.php?title=Dialog_creation_reading_and_writing_files/ru&amp;action=edit&amp;redlink=1.html" class="new" title="Dialog creation reading and writing files/ru (page does not exist)">2</a>, <a href="../index.php?title=Dialog_creation_setting_colors/ru&amp;action=edit&amp;redlink=1.html" class="new" title="Dialog creation setting colors/ru (page does not exist)">3</a>, <a href="../index.php?title=Dialog_creation_image_and_animated_GIF/ru&amp;action=edit&amp;redlink=1.html" class="new" title="Dialog creation image and animated GIF/ru (page does not exist)">4</a>, <a href="../index.php?title=PySide_usage_snippets/ru&amp;action=edit&amp;redlink=1.html" class="new" title="PySide usage snippets/ru (page does not exist)">5</a>)</small>, <a href="../ru/PySide.html" title="PySide/ru">PySide</a>, PySide examples <a href="../ru/PySide_Beginner_Examples.html" title="PySide Beginner Examples/ru">beginner</a>, <a href="../ru/PySide_Intermediate_Examples.html" title="PySide Intermediate Examples/ru">intermediate</a>, <a href="../ru/PySide_Advanced_Examples.html" title="PySide Advanced Examples/ru">advanced</a></li>
<li><b>Macros:</b> <a href="../ru/Macros.html" title="Macros/ru">Macros</a>, <a href="../ru/How_to_install_macros.html" title="How to install macros/ru">How to install macros</a></li>
<li><b>Embedding:</b> <a href="../ru/Embedding_FreeCAD.html" title="Embedding FreeCAD/ru">Embedding FreeCAD</a>, <a href="../ru/Embedding_FreeCADGui.html" title="Embedding FreeCADGui/ru">Embedding FreeCADGui</a></li></ul>
<hr>
<ul><li><b>Other:</b> <a href="../ru/Expressions.html" title="Expressions/ru">Expressions</a>, <a href="../ru/Code_snippets.html" title="Code snippets/ru">Code snippets</a>, <a href="../ru/Line_drawing_function.html" title="Line drawing function/ru">Line drawing function</a>, <a href="../ru/FreeCAD_vector_math_library.html" title="FreeCAD vector math library/ru">FreeCAD vector math library</a> <small>(deprecated)</small></li></ul>
<hr>
<ul><li><b>Hubs:</b> <a href="../ru/User_hub.html" title="User hub/ru">User hub</a>, <a href="../ru/Power_users_hub.html" title="Power users hub/ru">Power users hub</a>, <a href="../ru/Developer_hub.html" title="Developer hub/ru">Developer hub</a></li></ul></div>
    </div></div>
<div style="clear:both"></div>
<!-- 
NewPP limit report
Cached time: 20250705151310
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc, no&#8208;toc&#8208;conversion]
CPU time usage: 0.139 seconds
Real time usage: 0.193 seconds
Preprocessor visited node count: 907/1000000
Post&#8208;expand include size: 9710/2097152 bytes
Template argument size: 11476/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 24/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 50742/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%   42.905      1 -total
 33.89%   14.539     24 Template:Code
 22.41%    9.614      1 Template:Powerdocnavi/ru
 15.73%    6.747     48 Template:Incode
 12.70%    5.447      5 Template:FileName
  5.23%    2.246      1 Template:Navigation_menu_2
  4.66%    2.000      1 Template:Clear
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:197510-0!canonical and timestamp 20250705151310 and revision id 1603612. Rendering was triggered because: edit-page
 -->
</div>
</div><script src="../site.js"></script>