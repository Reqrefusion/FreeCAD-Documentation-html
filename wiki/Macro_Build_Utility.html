<link href="site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro Build Utility</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="index.php?title=Special;Translate&amp;group=page-Macro+Build+Utility&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><a href="de/Macro_Build_Utility.html" class="mw-pt-progress mw-pt-progress--med" title="Macro Dienstprogramm Zusammenbau (21% translated)" lang="de" dir="ltr">Deutsch</a></li>
<li><span class="mw-pt-languages-ui mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" lang="en" dir="ltr">English</span></li>
<li><a href="fr/Macro_Build_Utility.html" class="mw-pt-progress mw-pt-progress--med" title="Macro Build Utility (55% translated)" lang="fr" dir="ltr">fran&ccedil;ais</a></li>
<li><a href="it/Macro_Build_Utility.html" class="mw-pt-progress mw-pt-progress--med" title="Macro Build Utility (55% translated)" lang="it" dir="ltr">italiano</a></li>
<li><a href="pl/Macro_Build_Utility.html" class="mw-pt-progress mw-pt-progress--low" title="Makrodefinicja: Narz&#281;dzie do budowania (3% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="index.php?title=Macro_Build_Utility.png&amp;filetimestamp=20240210201103&amp;.html" class="mw-file-description"><img src="File/Macro_Build_Utility.png" decoding="async" width="32" height="32" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span><span> </span>
Macro Build Utility
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">This macro provides a Build Utility to assemble multiple project files into one project file.<br><br>Macro version: 1.0<br>Last modified: 2015-01-21<br>FreeCAD version: All<br>Download: <a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/8/87/Macro_Build_Utility.png">ToolBar Icon</a><br>Author: Piffpoof<br>
</td></tr>
<tr>
<th class="ctOdd">Author
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="User;Piffpoof.html" title="User:Piffpoof">Piffpoof</a>
</td></tr>
<tr>
<th class="ctOdd">Download
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/8/87/Macro_Build_Utility.png">ToolBar Icon</a>
</td></tr>
<tr>
<th class="ctOdd">Links
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="Macros_recipes.html" title="Macros recipes">Macros recipes</a><br><a href="How_to_install_macros.html" title="How to install macros">How to install macros</a><br><a href="Customize_Toolbars.html" title="Customize Toolbars">How to customize toolbars</a>
</td></tr>
<tr>
<th class="ctOdd">Macro Version
</th></tr>
<tr>
<td class="ctEven macro-version">1.0
</td></tr>
<tr>
<th class="ctOdd">Date last modified
</th></tr>
<tr>
<td class="ctEven macro-date">2015-01-21
</td></tr>
<tr>
<th class="ctOdd">FreeCAD Version(s)
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">All
</td></tr>
<tr>
<th class="ctOdd">Default shortcut
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">See also
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p>This macro is intended for use on large projects, ones involving hundreds of objects. It's use on a small single file project would be pointless and unnecessary. However on a large project with many objects and many files to be merged into the final one, it will save time, avoid the user being involved in repetitive actions, and remove human errors.
</p>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>All the code for buildUtility.FCMacro is in one macro. So installation is comprised of copying the code to the appropriate Macro directory and invoking the Build Utility from the Macro menu, the Python console or a toolbar button (the preferred method).
</p>
<ul><li>see <a href="How_to_install_macros.html" title="How to install macros">How to install macros</a> for information on how to install this macro code</li>
<li>see <a href="Customize_Toolbars.html" title="Customize Toolbars">Customize Toolbars</a> for information how to install as a button on a toolbar</li></ul>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>The Build Utility works on the same principals as the build files that are used to assemble large software system (like FreeCAD). A text editor is used to create a text file which adheres to the formats required by the Build Utility. The Build Utility then simply reads each line of the text file and performs the actions specified by that text file.
</p><p>The macro asks the user for a "build file". It then parses that build file, there are 3 legal line types:
</p>
<ul><li>lines starting with the comment character "#" which are ignored as being comments or remarks</li>
<li>lines starting with the subfile character "@" which are ignored<br><b>Note</b>: the "@" character is for future enhancement when sub-build files will be handled</li>
<li>all other lines which may be a project file or a sub-directory</li></ul>
<p>The file extension for Build Utility file is ".FCBld". This is so file do not get mixed up with other uses and applications.
</p><p>Any file specified in the build file is assumed to have the extension ".FCStd"
If the line starts with a directory then the project file is read from that subfolder. Otherwise it is assumed the line specifies a project file. Directories within directories are supported so nesting of arbitrary depths is possible. The file specification format is the "Unix" style with different levels separated by the forward slash character "/".
</p><p>Any missing file is printed onto the Report view. Any missing directory is printed onto the Report view.
</p><p>A new document is created and each project is "Project Merged" into that new and empty document.
The document is not saved at the end, this is left for the user if desired.
If the file does not exist then the file name is Printed to the Report view
</p>
<h2><span class="mw-headline" id="User_Interface">User Interface</span></h2>
<p>There really isn't a GUI at all for this macro. The macro reads a text file that has been prepared with a text editor and produces a model in an output document. Other than clicking the button on the toolbar to start the process, there is no user interaction.
</p>
<h2><span class="mw-headline" id="Options">Options</span></h2>
<p>There is no GUI so there are no options. The only alternatives that exist are by using the 3 types of lines in the text file as described above.
</p>
<h2><span class="mw-headline" id="Remarks">Remarks</span></h2>
<p>To reiterate what was stated at the outset, there is no use for this macro on a small single file model. But for persons modeling a plane, locomotive, ship, building, physical plant, complex circuity there is a definitive use and advantage. By choosing the ".FCBld" file extension it is hoped a standard of sorts can be set for build files within FreeCAD. By reserving the "@" prefix character in the command file definition it is hoped that future use and (if needed) growth can be accommodated.
</p>
<h2><span class="mw-headline" id="Links">Links</span></h2>
<p>none (so far)
</p>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<p>ToolBar Icon <span class="mw-default-size" typeof="mw:File"><a href="index.php?title=Macro_Build_Utility.png&amp;filetimestamp=20240210201103&amp;.html" class="mw-file-description"><img src="File/Macro_Build_Utility.png" decoding="async" width="64" height="64" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span>
</p><p><b>Macro_Build_Utility.FCMacro</b>
</p>
<pre>#
#						Build Utility
#                       v 0.0 - build from files and files in sub-folders
#
#***********************************************************************************
# routine to read in a build file and merge all specified projects
"""
This function asks the user for a "build file". It then parses that build file, there
are 3 legal line types:
- lines starting with the comment character "#" which are ignored
- lines starting with the subfile character "@" which are ignored
	Note:	the "@" character is for future enhancement when sub-build files 
			will be handled
- all other lines which may be a project file or a subfolder (sub-directory)
If the line is a subfolder then the project file is read from that subfolder.
Otherwise it is assumed the line specifies a project file.
A new document is created and each project is "Project Merged" into that new and empty document.
The document is not saved at the end, this is left for the user if desired.
If the file does not exist then the file name is Printed to the Report view
"""
"""
Example file:
#this is a sample build file
#==============================
@sub-build-files - not presently inplemented
# first the top-level file
metal
# now some misc files
./black/black
./blue/blue
# file does not exist
zebra 
# folder does not exist
/bear/bear
# multiple files in one sub-folder
./engineering/green
./engineering/grey
#multiple files in hierarchical folders
./externalModules/white
./externalModules/red/red
#./externalModules/red/stackerAssembly - commented out as not currently loading
./externalModules/red/orange
./externalModules/red/level3/yellow
"""
# import statements
import FreeCAD
import os.path
from PySide import QtGui

# UI Class definitions

# Class definitions

# Function definitionss

# Constant definitions
buildTargetDocument = "build_target"
commentTag = "#"
subfileTag = "@"
lineFeed = "\n"
subfolder = "./"
carriageReturn = "\r"
fileSeparator = "/"
fcFileExtension      = ".FCStd"
fcFileExtensionUC  = ".FCSTD"
fcFileExtensionLen = -6

# code ***********************************************************************************
buildFilePathName=QtGui.QFileDialog.getOpenFileName()[0]
if len(buildFilePathName) &gt; 0:
	# set up a new empty "build_target" document
	FreeCAD.newDocument(buildTargetDocument)
	FreeCAD.setActiveDocument(buildTargetDocument)
	FreeCAD.ActiveDocument=FreeCAD.getDocument(buildTargetDocument)
	guiDoc=FreeCADGui.ActiveDocument
	#
	lastFileSeparator = buildFilePathName.rindex(fileSeparator)
	buildFilePath = buildFilePathName[: lastFileSeparator]
	buildFileName = buildFilePathName[lastFileSeparator +1:]
	#
	buildFileContents = open(buildFilePathName,"r")
	buildFileLines = buildFileContents.readlines()
	buildFileContents.close()
	#
	for line in buildFileLines:
		if line[0] == commentTag:
			# line of internal comment
			pass
		elif line[0] == subfileTag:
			# line of sub-build-file (not presently implemented)
			pass
		else:
			# a line which should specify a FreeCAD project file
			# - may be preceded by a sub-directory e.g. "./subdir309/"
			# - project file may be missing file extension
			#
			# if line break at end of file spec then remove
			if line[-1:] == lineFeed:
				line = line[:-1]
			if line[-1:] == carriageReturn:
				line = line[:-1]
			# if no FreeCAD project file extension supplied then append one
			# make an uppercase comparison in case of mixed case
			tempLine = fcFileExtension + line.upper()
			if fcFileExtensionUC&nbsp;!= tempLine[fcFileExtensionLen:]:
				line = line + fcFileExtension
			# if there is a leading subdirectory then remove "./" from beginning
			if subfolder[0:2] == line[0:2]:
				line = line[2:]
			projectFileSpec = str(buildFilePath) + str("/") + str(line)
			if os.path.exists(projectFileSpec):
				guiDoc.mergeProject(projectFileSpec)
			else:
				FreeCAD.Console.PrintMessage('project file "' + projectFileSpec + '" not found' + "\n")

	# set view back to "build_target", it is up to user to save it (if they want)
	FreeCAD.setActiveDocument(buildTargetDocument)
	FreeCAD.ActiveDocument=FreeCAD.getDocument(buildTargetDocument)
	FreeCADGui.ActiveDocument=FreeCADGui.getDocument(buildTargetDocument)
	FreeCADGui.SendMsgToActiveView("ViewFit")
	FreeCADGui.activeDocument().activeView().viewAxometric()
#
#OS: Mac OS X
#Word size: 64-bit
#Version: 0.14.3703 (Git)
#Branch: releases/FreeCAD-0-14
#Hash: c6edd47334a3e6f209e493773093db2b9b4f0e40
#Python version: 2.7.5
#Qt version: 4.8.6
#Coin version: 3.1.3
#SoQt version: 1.5.0
#OCC version: 6.7.0
#
#thus ends the macro...</pre>
<p><br>
</p>
<h2><span class="mw-headline" id="Example">Example</span></h2>
<p>You are working with some other departments in your company to use FreeCAD to generate a large CAD model for an external client. To prepare for the upcoming presentation you need to integrate the models represented in the 'black' and 'blue' subsystems, the engineering department has responsibility for the 'green' and 'grey' subsystems and you have the 'metal' subsystem on your own computer. The client also uses FreeCAD and your design must integrate with their subsystems "red', and 'yellow'. The external client has told you that the Stacker Assembly is not ready for you to use so you comment it out in your build file.
</p><p>There are a lot of directory paths to type in so you enter the commands into the Build Utility text file which means you can run it with a single click on a toolbar button.
</p><p><span typeof="mw:File"><a href="index.php?title=MacroBuildUtilityTreeDiagram.jpg&amp;filetimestamp=20150123081801&amp;.html" class="mw-file-description"><img src="File/MacroBuildUtilityTreeDiagram.jpg" decoding="async" width="500" height="371" class="mw-file-element" data-file-width="1622" data-file-height="1205"></a></span>
</p><p>The contents of the build file "buildFile.FCBld" shown below shows the file structure for the project described above.
</p>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1">#this is the build file for the complete assembly</span>
<span class="c1">#==============================</span>
<span class="nd">@sub</span><span class="o">-</span><span class="n">build</span><span class="o">-</span><span class="n">files</span> <span class="o">-</span> <span class="ow">not</span> <span class="n">presently</span> <span class="n">implemented</span>
<span class="c1"># first the top-level file</span>
<span class="n">metal</span>
<span class="c1"># now some misc files</span>
<span class="o">./</span><span class="n">black</span><span class="o">/</span><span class="n">black</span>
<span class="o">./</span><span class="n">blue</span><span class="o">/</span><span class="n">blue</span>
<span class="c1"># file does not exist</span>
<span class="n">zebra</span> 
<span class="c1"># folder does not exist</span>
<span class="o">/</span><span class="n">bear</span><span class="o">/</span><span class="n">bear</span>
<span class="c1"># multiple files in one sub-folder</span>
<span class="o">./</span><span class="n">engineering</span><span class="o">/</span><span class="n">green</span>
<span class="o">./</span><span class="n">engineering</span><span class="o">/</span><span class="n">grey</span>
<span class="c1">#multiple files in hierarchical folders</span>
<span class="o">./</span><span class="n">externalModules</span><span class="o">/</span><span class="n">white</span>
<span class="o">./</span><span class="n">externalModules</span><span class="o">/</span><span class="n">red</span><span class="o">/</span><span class="n">red</span>
<span class="c1">#./externalModules/red/stackerAssembly - commented out as not currently loading</span>
<span class="o">./</span><span class="n">externalModules</span><span class="o">/</span><span class="n">red</span><span class="o">/</span><span class="n">orange</span>
<span class="o">./</span><span class="n">externalModules</span><span class="o">/</span><span class="n">red</span><span class="o">/</span><span class="n">level3</span><span class="o">/</span><span class="n">yellow</span>
</pre></div>
<p>A summary of the file and how it is processed is:
</p>
<ul><li>the first two lines are treated as comments and everything following the initial character of the hash sign is ignored</li></ul>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1">#this is the build file for the complete assembly</span>
<span class="c1">#==============================</span>
</pre></div>
<ul><li>the third line is also ignored because it's first character is the ampersand character which is reserved for future use where command files can invoke other commend files</li></ul>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="nd">@sub</span><span class="o">-</span><span class="n">build</span><span class="o">-</span><span class="n">files</span> <span class="o">-</span> <span class="ow">not</span> <span class="n">presently</span> <span class="n">implemented</span>
</pre></div>
<ul><li>the fifth line is the first file specification, the file is in the same directory as the build file, not in a sub-directory</li></ul>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="n">metal</span>
</pre></div>
<ul><li>the seventh and eighth lines are both file specifications where the file is in a sub-directory, note that the sub-directory is of the form "./black/" where "black" is the directory name, so a file called "sheetFold.FCstd" in the directory "outsourcing" would appear "./outsourcing/sheetFold"</li></ul>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">./</span><span class="n">black</span><span class="o">/</span><span class="n">black</span>
<span class="o">./</span><span class="n">blue</span><span class="o">/</span><span class="n">blue</span>
</pre></div>
<ul><li>the nineteenth line shows a file specification which exists but is not being included in this build operation</li></ul>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="c1">#./externalModules/red/stackerAssembly - commented out as not currently loading</span>
</pre></div>
<ul><li>the last two lines show file specifications where the file is in more than one level of sub-directory</li></ul>
<div class="mw-highlight mw-highlight-lang-python mw-content-ltr" dir="ltr"><pre><span></span><span class="o">./</span><span class="n">externalModules</span><span class="o">/</span><span class="n">red</span><span class="o">/</span><span class="n">orange</span>
<span class="o">./</span><span class="n">externalModules</span><span class="o">/</span><span class="n">red</span><span class="o">/</span><span class="n">level3</span><span class="o">/</span><span class="n">yellow</span>
</pre></div>
<p><br>
</p>
<div style="clear:both"></div>
<!-- 
NewPP limit report
Cached time: 20251021160024
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.088 seconds
Real time usage: 0.891 seconds
Preprocessor visited node count: 220/1000000
Post&#8208;expand include size: 2691/2097152 bytes
Template argument size: 5906/2097152 bytes
Highest expansion depth: 7/100
Expensive parser function count: 9/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 10031/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%  793.025      1 -total
 98.81%  783.590      7 Template:Code
  0.66%    5.228      1 Template:Macro
  0.21%    1.695      1 Template:MacroCode
  0.17%    1.311      1 Template:Clear
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:55551-0!canonical and timestamp 20251021160024 and revision id 1670115. Rendering was triggered because: api-parse
 -->
</div>
</div><script src="site.js"></script>