<link href="site.css" rel="stylesheet" type="text/css"/>
<div class="mw-page-container"><h1 class="firstHeading mw-first-heading" id="firstHeading"><span class="mw-page-title-main">Macro export transient FEM results</span></h1><div class="mw-parser-output"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><span class="mw-pt-languages-ui mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" dir="ltr" lang="en">English</span></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="fr\Macro_export_transient_FEM_results.html" lang="fr" title="Macro Exportation de résultats transitoires FEM (100% translated)">français</a></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="it\Macro_export_transient_FEM_results.html" lang="it" title="Macro export transient FEM results/it (18% translated)">italiano</a></li>
<li><a class="mw-pt-progress mw-pt-progress--stub" dir="ltr" href="pl\Macro_export_transient_FEM_results.html" lang="pl" title="Makrodefinicja: Eksport przejściowych wyników MES (5% translated)">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" style="float: right; width: 230px; margin-left: 10px;" width="100%">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a class="mw-file-description" href="File/Text-x-python.png" title="Generic macro icon. Create your personal icon with the same name of the macro"><img alt="Generic macro icon. Create your personal icon with the same name of the macro" decoding="async" height="32" src="File/Text-x-python.png" width="32"/></a></span><span> </span>
export transient FEM results
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">Export multiple FEM results from a transient analysis for post-processing in ParaView.<br/><br/>Macro version: 0.1<br/>Last modified: 2019-08-30<br/>FreeCAD version: All<br/>Download: <a class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing" rel="nofollow">Macro file (3 kB)</a><br/><a class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing" rel="nofollow">Example file without results (200 kB)</a><br/><a class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing" rel="nofollow">Example file with results (10 MB)</a><br/><a class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing" rel="nofollow">All example files, including the vtk-export folder (21 MB)</a><br/>Author: Luftschraube<br/>
</td></tr>
<tr>
<th class="ctOdd">Author
</th></tr>
<tr>
<td class="ctEven macro-author"><a class="new" href="index.php?title=User;Luftschraube&amp;action=edit&amp;redlink=1.html" title="User:Luftschraube (page does not exist)">Luftschraube</a>
</td></tr>
<tr>
<th class="ctOdd">Download
</th></tr>
<tr>
<td class="ctEven macro-download"><a class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing" rel="nofollow">Macro file (3 kB)</a><br/><a class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing" rel="nofollow">Example file without results (200 kB)</a><br/><a class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing" rel="nofollow">Example file with results (10 MB)</a><br/><a class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing" rel="nofollow">All example files, including the vtk-export folder (21 MB)</a>
</td></tr>
<tr>
<th class="ctOdd">Links
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="Macros_recipes.html" title="Macros recipes">Macros recipes</a><br/><a href="How_to_install_macros.html" title="How to install macros">How to install macros</a><br/><a href="Customize_Toolbars.html" title="Customize Toolbars">How to customize toolbars</a>
</td></tr>
<tr>
<th class="ctOdd">Macro Version
</th></tr>
<tr>
<td class="ctEven macro-version">0.1
</td></tr>
<tr>
<th class="ctOdd">Date last modified
</th></tr>
<tr>
<td class="ctEven macro-date">2019-08-30
</td></tr>
<tr>
<th class="ctOdd">FreeCAD Version(s)
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">All
</td></tr>
<tr>
<th class="ctOdd">Default shortcut
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">See also
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br/><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Description"><span class="tocnumber">1</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Background"><span class="tocnumber">2</span> <span class="toctext">Background</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#How_to_use_(experienced_users)"><span class="tocnumber">3</span> <span class="toctext">How to use (experienced users)</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#How_to_use_(step-by-step_with_example)"><span class="tocnumber">4</span> <span class="toctext">How to use (step-by-step with example)</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Downloads"><span class="tocnumber">5</span> <span class="toctext">Downloads</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Script"><span class="tocnumber">6</span> <span class="toctext">Script</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Link"><span class="tocnumber">7</span> <span class="toctext">Link</span></a></li>
</ul>
</div>
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p>This macro exports multiple FEM result objects from a transient analysis to the VTK format and generates a PVU file which can be used to load the results directly into ParaView for post-processing.
</p>
<h2><span class="mw-headline" id="Background">Background</span></h2>
<p>A transient analysis in FreeCAD ends up with a bunch of FEM result objects, one for each timestamp. The individual results can be investigated directly in FreeCAD and be post-processed using <a href="FEM_PostPipelineFromResult.html" title="FEM PostPipelineFromResult">pipelines</a>. However, the possibilities within FreeCAD are still limited, especially for transient analyses. A better tool for post-processing and visualisation is ParaView. You can export single FEM result objects from FreeCAD as a .vtk or .vtu file, which can then be opened with ParaView. Unfortunately, the FEM workbench doesn't support the export of multiple .vtk files at one time (yet). That's where this macro comes into play.
</p>
<h2><span id="How_to_use_.28experienced_users.29"></span><span class="mw-headline" id="How_to_use_(experienced_users)">How to use (experienced users)</span></h2>
<p>Run the macro on a FreeCAD project that includes several FEM result objects from a transient analysis. Besides the .FCStd file, a new folder 'vtk-export' will be created, containing the individual results (.vtu files), and a .pvu file that can be opened from ParaView.
</p>
<h2><span id="How_to_use_.28step-by-step_with_example.29"></span><span class="mw-headline" id="How_to_use_(step-by-step_with_example)">How to use (step-by-step with example)</span></h2>
<p>As an example, the bending of a aluminium/steel bimetal strip is used. A step-by-step guide to create the sample file is given <a href="Transient_FEM_analysis.html" title="Transient FEM analysis">here</a>, or you can download the file from the <a href="#Downloads">downloads section</a> of this page. Save the FCMacro file in the FreeCAD macro folder, which can be found via Edit → Preferences → Python → Macro.
</p><p>With the example file opened, we go to Macro → Macros..., select "ExportTransientResults_190830.FCMacro" (or whatever name you saved it as) and execute it. The macro will now create a subfolder 'vtk-export' besides the .FCStd file. Depending on the number and size of the result objects, this may take some time. In the Report View (View → Report View), we should see 'Macro finished', if eveything went fine - or some error messages. (Note: Sometimes messages like 'PropertyFloatList NOT exported to vtk' appear, but I was able to work with the VTK files anyway...) In the subfolder 'vtk-export', we will find .vtu files, one for each result set for each timestamp. Additionally, a .pvd file is created, which tells ParaView which result set belongs to which timestamp. 
</p><p>Now, we open ParaView and go to File → Open... and open the .pvd file. In the 'Properties' tab, we click 'Apply' to load the results. In the 'Information' tab we will see a list of <i>Index</i> and <i>Value</i>, corresponding to the timestamps of the results that we just imported. (Of course, it always makes sense to check if the times given here are correct or if something strange happened during the export.) From here, we can use ParaView to play around with the results. Since ParaView offers a lot of possibilities, please refer to the appropriate documentations around the internet. 
</p><p>For demonstrating purposes, let us now visualise the temperature of the bent bimetal strip: In the 'properties' tab on the left, under 'coloring' we select temperature, and the image gets color-mapped according to the local temperature. Via the little icon with a heart, we select the color scale 'cool to warm'. With the recorder-like icons on the top, we can move through all the individual results that were created during the analysis. The 'play' button will display the individual images in their sequence. However, the individual results are not separated by a constant time interval, so the animation is not proportional in time. 
</p><p>What we need is an interpolation of the results in between the time steps, which is available via Filters → Temporal → Temporal Interpolator. Here we choose again the temperature for coloring. In the 'animation view' (View → Animation View), we can now switch from 'sequence' mode to 'real time' mode. We can also set the start time (default is 0.01 s), the end time, and the duration. While start and end time refer to simulation time, the duration is the actual real time that the animation takes to play completely. With 10 s duration, our 60 s simulation time will be squeezed into 10 s real time.
</p><p>We go one step further and want to visualise the actual bending of the strip. With the Temporal Interpolator selected, we add Filters → Common → Warp by Vector. Under 'vectors' we choose 'DisplacementVectors' and set the 'scale factor' to 10. When we play the animation now, we can actually see the color-mapped strip bending (exaggerated by a factor of 10).
</p><p><span typeof="mw:File"><a class="mw-file-description" href="File/Transient_FEM_Bimetal_ParaView_(1).JPG"><img decoding="async" height="543" src="File/Transient_FEM_Bimetal_ParaView_%281%29.JPG" width="700"/></a></span>
</p>
<div style="clear:both"></div>
<p>The post-processing we have just done can be saved as a 'state' in ParaView, which can be opened any time again and even be applied to a different set of results.
</p>
<h2><span class="mw-headline" id="Downloads">Downloads</span></h2>
<ul><li><a class="external text" href="https://drive.google.com/file/d/1MSBxLPlQ-TwzF-sFkgOeFb48zij5_scp/view?usp=sharing" rel="nofollow">Macro file (3 kB)</a></li>
<li><a class="external text" href="https://drive.google.com/file/d/1m3RiJ-JM7QSJ6YDhZnafHIbyL92V6sYU/view?usp=sharing" rel="nofollow">Example file without results (200 kB)</a></li>
<li><a class="external text" href="https://drive.google.com/file/d/157aIdVpIyfpVW9WxL-ReGz0FIsQebH_q/view?usp=sharing" rel="nofollow">Example file with results (10 MB)</a></li>
<li><a class="external text" href="https://drive.google.com/file/d/1g-QOJtl3G5KaY2bSrw03NNQ8mnfBi03T/view?usp=sharing" rel="nofollow">All example files, including the vtk-export folder (21 MB)</a></li></ul>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<p>The ToolBar Icon 
</p><p><b>Macro_export_transient_FEM_results.FCMacro</b>
</p>
<pre>#!/usr/bin/python
# -*- coding: utf-8 -*-

#
# Macro to export multiple FEM results objects from a transient analysis for
# post-processing in ParaView.
#
# Created by &lt;Luftschraube&gt; under the GNU Lesser General Public License (LGPL)
#
# Version 0.1 (30.08.2019)
#

import FreeCAD
import Fem
import feminout.importVTKResults
import os
from sys import exit

FreeCAD.Console.PrintMessage("&gt;&gt;&gt;---------Macro started\n")

#Get the file path and name of the active document 
p = FreeCAD.ActiveDocument.FileName
FilePath = "/".join(p.split("/")[:-1])
FileName = p.split("/")[-1].split(".")[0]
FreeCAD.Console.PrintMessage("File path:" + FilePath + "\n")
FreeCAD.Console.PrintMessage("File name:" + FileName + "\n")
FreeCAD.Console.PrintMessage("\n&lt;&lt;&lt;----------Macro finished with errors\n")

#Get FEM result objects into a list
FreeCAD.Console.PrintMessage("Looking for result objects...")
FEMResultObjects = []

for obj in App.ActiveDocument.Objects:
	if obj.TypeId == "Fem::FemResultObjectPython":	
		FEMResultObjects.append(obj.Label)
		#FreeCAD.Console.PrintMessage(obj.Label + '\n')

NumberOfResultObjects = len(FEMResultObjects)
FreeCAD.Console.PrintMessage(str(NumberOfResultObjects) + " found\n")

if NumberOfResultObjects &gt; 0:
	
	#Export result objects as .vtu file and generate .pvu file
	ExportFolderName = "vtk-export"
	ExportOutputPath = FilePath + "/" + ExportFolderName
	if not os.path.exists(ExportOutputPath):
		os.makedirs(ExportOutputPath)
		FreeCAD.Console.PrintMessage(ExportOutputPath + " has been created\n")
	else:
		FreeCAD.Console.PrintMessage(ExportOutputPath + " already exists\n")
	
	PVUFile = open(ExportOutputPath + "/" + FileName + ".pvd","w")
	PVUFile.write("&lt;VTKFile type=\"Collection\" version=\"1.0\" byte_order=\"LittleEndian\" header_type=\"UInt64\"&gt;\n\t&lt;Collection&gt;\n")
	
	n = 0
	for ExportObject in sorted(FEMResultObjects):
		n = n + 1
		
		#Read and format time stamp (e.g., 12.37 s = 0001237)
		FreeCADResultLabelParts = ExportObject.split("_")
		PreDecimal = FreeCADResultLabelParts[-3]
		PostDecimal = FreeCADResultLabelParts[-2]

		if len(PostDecimal) == 1:
			PostDecimal = PostDecimal + str(0)
		TimeValue = float(PreDecimal) + float(PostDecimal)/100
		TimeString = str(int(round(TimeValue*100,0))).zfill(7)
	
		#For some reason, the VTK exporter expects a list (although only one object is processed at once...) - so build a list with the current object
		ExportObjectList = []
		ExportObjectList.append(FreeCAD.ActiveDocument.getObject(ExportObject))
		FileNameOUT = FileName + "_" + TimeString + ".vtu"
		FilePath = ExportOutputPath + "/" + FileNameOUT
		FreeCAD.Console.PrintMessage(FilePath + " is to be created\n")
		feminout.importVTKResults.export(ExportObjectList,FilePath)
	
		PVUFile.write("\t\t&lt;DataSet timestep=\"" + str(TimeValue) + "\" file=\"" + FileNameOUT + "\"/&gt;\n")
	
	#Close the .pvu file
	PVUFile.write("\t&lt;/Collection&gt;\n&lt;/VTKFile&gt;")
	PVUFile.close()
else:
	FreeCAD.Console.PrintMessage("Nothing to export!")

FreeCAD.Console.PrintMessage('\n&lt;&lt;&lt;----------Macro finished\n')</pre>
<p><br/>
</p>
<h2><span class="mw-headline" id="Link">Link</span></h2>
<p>Example <a class="external text" href="https://www.freecadweb.org/wiki/Transient_FEM_analysis" rel="nofollow">Transient FEM analysis</a>
</p><p>The Forum discussion <a class="external text" href="https://forum.freecadweb.org/viewtopic.php?f=22&amp;t=37650" rel="nofollow">Export transient FEM results to vtk/vtu for ParaView</a>
</p>
<!-- 
NewPP limit report
Cached time: 20241214203142
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc, no‐toc‐conversion]
CPU time usage: 0.065 seconds
Real time usage: 0.074 seconds
Preprocessor visited node count: 133/1000000
Post‐expand include size: 3751/2097152 bytes
Template argument size: 4803/2097152 bytes
Highest expansion depth: 7/100
Expensive parser function count: 2/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 4035/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    4.997      1 -total
 60.62%    3.029      1 Template:Macro
 22.57%    1.128      1 Template:MacroCode
 13.13%    0.656      1 Template:Clear
-->
<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:157744-0!canonical and timestamp 20241214203142 and revision id 1296848. Rendering was triggered because: api-parse
 -->
</div></div><script src="script.js"></script>
