<link href="../site.css" rel="stylesheet" type="text/css"/>
<div class="mw-page-container"><h1 class="firstHeading mw-first-heading" id="firstHeading"><span class="mw-page-title-main">Macro TNP Solution/pl</span></h1><div class="mw-parser-output"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" dir="ltr" href="../Macro_TNP_Solution.html" lang="en" title="Macro TNP Solution (100% translated)">English</a></li>
<li><a class="mw-pt-progress mw-pt-progress--complete" dir="ltr" href="../fr\Macro_TNP_Solution.html" lang="fr" title="Macro TNP Solution (100% translated)">français</a></li>
<li><span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--stub" dir="ltr" lang="pl">polski</span></li></ul></div>
<table class="fcinfobox wikitable ct" style="float: right; width: 230px; margin-left: 10px;" width="100%">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a class="mw-file-description" href="../File/TNP_solution.png"><img decoding="async" height="26" src="../File/TNP_solution.png" width="32"/></a></span><span> </span>
Macro TNP solution
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">This is a solution for Topological Naming Problem.<br/><br/>Macro version: 1.0<br/>Last modified: 2022-08-16<br/>Download: <a class="external text" href="https://wiki.freecad.org/images/e/e4/TNP_solution.png" rel="nofollow">ToolBar Icon</a><br/>Author: Dprojects<br/>
</td></tr>
<tr>
<th class="ctOdd">Author
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="../User;Dprojects.html" title="User:Dprojects">Dprojects</a>
</td></tr>
<tr>
<th class="ctOdd">Download
</th></tr>
<tr>
<td class="ctEven macro-download"><a class="external text" href="https://wiki.freecad.org/images/e/e4/TNP_solution.png" rel="nofollow">ToolBar Icon</a>
</td></tr>
<tr>
<th class="ctOdd">Links
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="../Macros_recipes.html" title="Macros recipes">Macros recipes</a><br/><a href="../How_to_install_macros.html" title="How to install macros">How to install macros</a><br/><a href="../Customize_Toolbars.html" title="Customize Toolbars">How to customize toolbars</a>
</td></tr>
<tr>
<th class="ctOdd">Macro Version
</th></tr>
<tr>
<td class="ctEven macro-version">1.0
</td></tr>
<tr>
<th class="ctOdd">Date last modified
</th></tr>
<tr>
<td class="ctEven macro-date">2022-08-16
</td></tr>
<tr>
<th class="ctOdd">FreeCAD Version(s)
</th></tr>
<tr>
<td class="ctEven FreeCAD-version"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">Default shortcut
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">See also
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br/><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Description"><span class="tocnumber">1</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Code_for_the_example"><span class="tocnumber">2</span> <span class="toctext">Code for the example</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#THE_Solution"><span class="tocnumber">3</span> <span class="toctext">THE Solution</span></a></li>
</ul>
</div>
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p><span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/TNP_solution.gif"><img decoding="async" height="694" src="../File/TNP_solution.gif" width="1362"/></a></span>
</p><p>This is one solution for Topological Naming Problem example described at the page: <a href="../Topological_naming_problem.html" title="Topological naming problem">Topological Naming Problem</a>
</p><p>If you build object at another object, and also with Sketch it is straightforward to solve, because you know two things:
</p>
<ol><li>Points from Sketch is always part of the face below</li>
<li>The Sketch and the face below are in the same plane</li></ol>
<p>To solve Topological Naming Problem problem you can:
</p><p><b>Store the key before any operation:</b>
</p><p>You need only store the key before any operation. For this example described at <a href="../Topological_naming_problem.html" title="Topological naming problem">Topological Naming Problem</a> page, the object is at XY plane. So, I use Z axis value from Sketch BoundBox center:
</p>
<pre>ad = FreeCAD.ActiveDocument
p2 = ad.Pad002
s2 = p2.Profile[0]
key = round(s2.Shape.BoundBox.Center[2], precision)</pre>
<p><b>Next search all faces for the stored key:</b>
</p><p>After the resize, I search all faces for the stored key. Because if the Sketch and Face were at the same plane XY, the Z axis value was the same for both. In PartDesign Worbench, you cannot move 3rd Pad above the 2nd Pad, to have gap between, this is single object, the next Pad with the Sketch always will be touching the face. At the new face the Z axis value always will be the same with the stored key. So, return the face index. Nothing more to be done. 
</p>
<pre>def getFaceIndex(iObj, iBB):
	
	index = 0	

	for f in iObj.Shape.Faces:

		index += 1
		bb = round(f.BoundBox.Center[2], precision)
		if bb == iBB:
			return index

	return -1</pre>
<p><b>Final steps</b>
</p><p>At the end, I assign the new face to the Sketch and recompute. To be honest, the most difficult part was to assign the face to Sketch.Support, for me the syntax is mind-blowing ;-)
</p>
<h2><span class="mw-headline" id="Code_for_the_example">Code for the example</span></h2>
<p>File for testing has been uploaded at FreeCAD forum: <a class="external text" href="https://forum.freecadweb.org/download/file.php?id=198537" rel="nofollow">TNP.FCStd</a>. 
</p>
<pre>__Title__="TNP_solution"
__Author__ = "Dprojects"
__Version__ = "1.0"
__Date__    = "2022-08-16"
__Comment__ = ""
__Web__ = "https://github.com/dprojects/Woodworking"
__Wiki__ = "https://wiki.freecadweb.org/TNP_solution"
__Icon__  = "https://wiki.freecad.org/images/e/e4/TNP_solution.png"
__IconW__  = "https://wiki.freecad.org/images/e/e4/TNP_solution.png"
__Help__ = "solution for Topological Naming Problem"
__Status__ = "stable"
__Requires__ = ""
__Communication__ = "http://www.freecadweb.org/wiki/index.php?title=User:Dprojects"

# ####################################################################
#
# This is solution for Topological Naming Problem described at 
# https://wiki.freecadweb.org/Topological_naming_problem
#
# MIT License
# 
# Copyright (c) 2022 Darek L github.com/dprojects
# 
# Permission is hereby granted, free of charge, to any 
# person obtaining a copy of this software and associated 
# documentation files (the "Software"), to deal in the 
# Software without restriction, including without limitation 
# the rights to use, copy, modify, merge, publish, distribute, 
# sublicense, and/or sell copies of the Software, and to permit 
# persons to whom the Software is furnished to do so, subject 
# to the following conditions:
# 
# The above copyright notice and this permission notice shall 
# be included in all copies or substantial portions of the Software.
# 
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, 
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES 
# OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND 
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT 
# HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, 
# WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, 
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
# DEALINGS IN THE SOFTWARE.
# 
# ####################################################################

import FreeCAD

# this should be set according 
# FreeCAD user GUI precision settings
precision = 5

# global settings
ad = FreeCAD.ActiveDocument

# middle object to be resized
p1 = ad.Pad001
s1 = p1.Profile[0]

# top object bottom to store key
p2 = ad.Pad002
s2 = p2.Profile[0]

# ####################################################################
def getFaceIndex(iObj, iBB):
	
	index = 0	

	for f in iObj.Shape.Faces:

		index += 1
		bb = round(f.BoundBox.Center[2], precision)
		
		FreeCAD.Console.PrintMessage("\n")
		FreeCAD.Console.PrintMessage(index)
		FreeCAD.Console.PrintMessage(" ")
		FreeCAD.Console.PrintMessage(bb)

		if bb == iBB:
			FreeCAD.Console.PrintMessage(" &lt;=== found")
			return index

	return -1

# ####################################################################
def makeTNP():

	# set key
	key = round(s2.Shape.BoundBox.Center[2], precision)

	# resize and cause TNP
	s1.setDatum(9, FreeCAD.Units.Quantity('350'))

	# recompute
	s1.recompute()
	p1.recompute()
	ad.recompute()

	FreeCAD.Console.PrintMessage("\n\n")
	FreeCAD.Console.PrintMessage("Stored key:"+str(key))
	FreeCAD.Console.PrintMessage("\n")

	# search all faces for solution
	solutionIndex = getFaceIndex(p1, key)
	solution = "Face"+str(solutionIndex)
	
	FreeCAD.Console.PrintMessage("\n\n")
	FreeCAD.Console.PrintMessage("Solution: "+solution)
	
	# set exact face to Sketch
	s2.Support = (p1, (solution,))
	ad.recompute()

# ####################################################################
def moveBack():

	s1.setDatum(9, FreeCAD.Units.Quantity('250'))
	s2.Support = (p1, ('Face13',))
	ad.recompute()

# ####################################################################
# main
# ####################################################################

# uncomment what you want
makeTNP()
#moveBack()

# ####################################################################</pre>
<h2><span class="mw-headline" id="THE_Solution">THE Solution</span></h2>
<p>This code above shows how to solve the example from Topological Naming Problem described at: <a href="../Topological_naming_problem.html" title="Topological naming problem">Topological Naming Problem</a> but exactly the same rules you can use to solve other problems. The approach is simple:
</p>
<ol><li>Store the key before any operation</li>
<li>Search for the key after operation</li></ol>
<p>The specific implementation may be different. In this example the plane is XY, but you can do exactly the same for other axes. Also you can choose other key. At <a class="external text" href="https://github.com/dprojects/Woodworking" rel="nofollow">Woodworking project</a> I make many operations at non-existing objects, so I had to solve the Topological Naming Problem many times. 
</p><p>Here I change Cube objects into PartDesign Thickness objects:
</p><p><span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/TNP_solution_1.gif"><img decoding="async" height="694" src="../File/TNP_solution_1.gif" width="1362"/></a></span>
</p><p>On the example below, I change Cubes into PartDesign Chamfers, so I had to store key for edges: 
</p><p><span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/TNP_solution_2.gif"><img decoding="async" height="694" src="../File/TNP_solution_2.gif" width="1362"/></a></span>
</p><p>This example below is little more complicated because as you see at the GUI screen, the references to the object and face changes automatically. But also to make a hole I call function defined in my library not directly in the tool. So, I had to use small trick with selection and deselection, to get new reference:
</p><p><span class="mw-default-size" typeof="mw:File"><a class="mw-file-description" href="../File/TNP_solution_3.gif"><img decoding="async" height="694" src="../File/TNP_solution_3.gif" width="1362"/></a></span>
</p><p><br/>
There are many such problems when programming in FreeCAD, but they can all be solved in a similar way. I hope, it helps.
</p><p><br/>
</p>
<div style="clear:both"></div>
<!-- 
NewPP limit report
Cached time: 20241214202954
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc, no‐toc‐conversion]
CPU time usage: 0.045 seconds
Real time usage: 0.076 seconds
Preprocessor visited node count: 108/1000000
Post‐expand include size: 1993/2097152 bytes
Template argument size: 4498/2097152 bytes
Highest expansion depth: 5/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 4782/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    5.719      1 -total
 44.22%    2.529      1 Template:Macro
 33.96%    1.942      3 Template:MacroCode
 17.89%    1.023      1 Template:Clear
-->
<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:297198-0!canonical and timestamp 20241214202954 and revision id 1345047. Rendering was triggered because: api-parse
 -->
</div></div><script src="../script.js"></script>
