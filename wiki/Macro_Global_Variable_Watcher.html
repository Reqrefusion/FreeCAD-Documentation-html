<link href="site.css" rel="stylesheet" type="text/css"/><div class="mw-page-container"><h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Macro Global Variable Watcher</span></h1><?xml encoding="UTF-8"><div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr"><div class="mw-pt-languages noprint navigation-not-searchable" lang="en" dir="ltr"><div class="mw-pt-languages-label">Other languages:</div><ul class="mw-pt-languages-list"><li><a href="index.php?title=Special;Translate&amp;group=page-Macro+Global+Variable+Watcher&amp;language=&amp;task=view.html" class="new" title="Start translation for this language" lang="" dir="ltr"></a></li>
<li><a href="de/Macro_Global_Variable_Watcher.html" class="mw-pt-progress mw-pt-progress--complete" title="Makro Globale Variablen&uuml;berwachung (100% translated)" lang="de" dir="ltr">Deutsch</a></li>
<li><span class="mw-pt-languages-ui mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete" lang="en" dir="ltr">English</span></li>
<li><a href="fr/Macro_Global_Variable_Watcher.html" class="mw-pt-progress mw-pt-progress--complete" title="Macro Global Variable Watcher (100% translated)" lang="fr" dir="ltr">fran&ccedil;ais</a></li>
<li><a href="it/Macro_Global_Variable_Watcher.html" class="mw-pt-progress mw-pt-progress--med" title="Macro Global Variable Watcher (31% translated)" lang="it" dir="ltr">italiano</a></li>
<li><a href="pl/Macro_Global_Variable_Watcher.html" class="mw-pt-progress mw-pt-progress--low" title="Makrodefinicje: Podgl&#261;d zmiennych globalnych (8% translated)" lang="pl" dir="ltr">polski</a></li></ul></div>
<table class="fcinfobox wikitable ct" width="100%" style="float: right; width: 230px; margin-left: 10px;">
<tbody><tr>
<td class="ctTitle" style="font-weight: bold; font-size: 125%;">
<p><span typeof="mw:File"><a href="index.php?title=Macro_Global_Variable_Watcher.png&amp;filetimestamp=20240210201119&amp;.html" class="mw-file-description"><img src="File/Macro_Global_Variable_Watcher.png" decoding="async" width="32" height="32" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span><span> </span>
Macro Global Variable Watcher
</p>
</td></tr>
<tr>
<th class="ctOdd">Description
</th></tr>
<tr>
<td class="ctEven left macro-description">This macro displays the global variables within the FreeCAD system, (e.g. FreeCAD.myVariable).<br><br>Macro version: 1.0<br>Last modified: 2015-02-09<br>FreeCAD version: All<br>Download: <a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/c/c1/Macro_Global_Variable_Watcher.png">ToolBar Icon</a><br>Author: Piffpoof<br>
</td></tr>
<tr>
<th class="ctOdd">Author
</th></tr>
<tr>
<td class="ctEven macro-author"><a href="User;Piffpoof.html" title="User:Piffpoof">Piffpoof</a>
</td></tr>
<tr>
<th class="ctOdd">Download
</th></tr>
<tr>
<td class="ctEven macro-download"><a rel="nofollow" class="external text" href="https://wiki.freecad.org/images/c/c1/Macro_Global_Variable_Watcher.png">ToolBar Icon</a>
</td></tr>
<tr>
<th class="ctOdd">Links
</th></tr>
<tr>
<td class="ctEven macro-Links"><a href="Macros_recipes.html" title="Macros recipes">Macros recipes</a><br><a href="How_to_install_macros.html" title="How to install macros">How to install macros</a><br><a href="Customize_Toolbars.html" title="Customize Toolbars">How to customize toolbars</a>
</td></tr>
<tr>
<th class="ctOdd">Macro Version
</th></tr>
<tr>
<td class="ctEven macro-version">1.0
</td></tr>
<tr>
<th class="ctOdd">Date last modified
</th></tr>
<tr>
<td class="ctEven macro-date">2015-02-09
</td></tr>
<tr>
<th class="ctOdd">FreeCAD Version(s)
</th></tr>
<tr>
<td class="ctEven FreeCAD-version">All
</td></tr>
<tr>
<th class="ctOdd">Default shortcut
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">See also
</th></tr>
<tr>
<td class="ctEven"><i>None</i>
</td></tr>
<tr>
<th class="ctOdd">
</th></tr>
<tr>
<td class="ctToc"><br><meta property="mw:PageProp/toc">
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="Description">Description</span></h2>
<p>This macro displays the global variables within the FreeCAD system (e.g. FreeCAD.myVariable). The user may add and remove variables from the display, which may also be updated on a timed basis.
</p>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>All the code for variableWatcher.FCMacro is in one macro. So installation is comprised of copying the code to the appropriate Macro directory and invoking the Global Variable Watcher from the Macro menu, the Python console or a toolbar button (the preferred method).
</p>
<ul><li>see <a href="How_to_install_macros.html" title="How to install macros">How to install macros</a> for information on how to install this macro code</li>
<li>see <a href="Customize_Toolbars.html" title="Customize Toolbars">Customize Toolbars</a> for information how to install as a button on a toolbar</li></ul>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>Select global variables to be watched by using the rightmost pop-up menu. Click the "Display Now" button to immediately display the variable and its value, or click on the "Timer On" button to start an automatic timer. The interval for the timer is set in the far left pop-up menu. The topmost option on the rightmost pop-up menu is to update the list of global variables as they may have been created or deleted under program control.
</p><p>A variable may be removed from the watch list by right-clicking over it or it's value, and selecting "remove variable".
</p>
<h2><span class="mw-headline" id="User_Interface">User Interface</span></h2>
<p><span class="mw-default-size" typeof="mw:File"><a href="index.php?title=MacroVariableWatcherGui1.jpg&amp;filetimestamp=20150209102630&amp;.html" class="mw-file-description"><img src="File/MacroVariableWatcherGui1.jpg" decoding="async" width="500" height="148" class="mw-file-element" data-file-width="500" data-file-height="148"></a></span>
</p>
<h2><span class="mw-headline" id="Remarks">Remarks</span></h2>
<p>This is a pre-release version and not all aspects are finalized - especially the listing the global variable and their values.
</p>
<h2><span class="mw-headline" id="Script">Script</span></h2>
<p>ToolBar Icon <span class="mw-default-size" typeof="mw:File"><a href="index.php?title=Macro_Global_Variable_Watcher.png&amp;filetimestamp=20240210201119&amp;.html" class="mw-file-description"><img src="File/Macro_Global_Variable_Watcher.png" decoding="async" width="64" height="64" class="mw-file-element" data-file-width="64" data-file-height="64"></a></span>
</p><p><b>Macro_Global_Variable_Watcher.FCMacro</b>
</p>
<pre># -*- coding: utf-8 -*-
#
#			Variable Watcher
#			displays variables of the form FreeCAD.*,
#			either manually or on a timed basis
#
################################
# routine to &lt;description goes here&gt;
"""
script does &lt;long winded description goes here&gt;
"""
################################

# import statements
import FreeCAD
import math, collections, time
from datetime import datetime
from threading import Timer
from PySide import QtGui, QtCore

# UI Class definitions

class VariableWatcher(QtGui.QDialog):
	""""""
	def __init__(self):
		super(VariableWatcher, self).__init__()
		self.initUI()
	def initUI(self):
		column1LH	= 10
		column2LH	= 350
		headerY		= 20
		row1		= 50
		row2		= 75
		row3		= 100
		row4		= 125
		row5		= 150
		# define window		xLoc,yLoc,xDim,yDim
		self.setGeometry(	250, 250, 750, 200)
		self.setWindowTitle("Variable Watcher")
		self.setWindowFlags(QtCore.Qt.WindowStaysOnTopHint)
		self.intervalDefault = str(2)
		# labels
		self.name1 = QtGui.QLabel(varLabelSpaces, self)
		self.name1.move(column1LH, row1)
		self.value1 = QtGui.QLabel(varValueSpaces, self)
		self.value1.move(column2LH, row1)
		self.name2 = QtGui.QLabel(varLabelSpaces, self)
		self.name2.move(column1LH, row2)
		self.value2 = QtGui.QLabel(varValueSpaces, self)
		self.value2.move(column2LH, row2)
		self.name3 = QtGui.QLabel(varLabelSpaces, self)
		self.name3.move(column1LH, row3)
		self.value3 = QtGui.QLabel(varValueSpaces, self)
		self.value3.move(column2LH, row3)
		self.name4 = QtGui.QLabel(varLabelSpaces, self)
		self.name4.move(column1LH, row4)
		self.value4 = QtGui.QLabel(varValueSpaces, self)
		self.value4.move(column2LH, row4)
		self.name5 = QtGui.QLabel(varLabelSpaces, self)
		self.name5.move(column1LH, row5)
		self.value5 = QtGui.QLabel(varValueSpaces, self)
		self.value5.move(column2LH, row5)
		self.intervalLbl = QtGui.QLabel("interval", self)
		self.intervalLbl.move(90, headerY)
		self.timestampLbl = QtGui.QLabel("                 ", self)
		self.timestampLbl.move(300, 180)
		# radio buttons
		self.timerOnRB  = QtGui.QRadioButton("Timer On",self)
		self.timerOnRB.setEnabled(True)
		self.timerOnRB.clicked.connect(self.onTimerOnRB)
		self.timerOnRB.move(150,headerY-10)
		self.timerOffRB = QtGui.QRadioButton("Timer Off",self)
		self.timerOffRB.setEnabled(True)
		self.timerOffRB.setChecked(True)
		self.timerOffRB.clicked.connect(self.onTimerOffRB)
		self.timerOffRB.move(150,headerY+10)
		#
		nowButton = QtGui.QPushButton('Display Now', self)
		nowButton.clicked.connect(self.onDisplayNow)
		nowButton.move(250, headerY-7)
		# set up lists for pop-ups
		self.intervalPopupItems = ("0.5","1","2","3","4","5","6","7","8","9","10")
		# set up pop-up menu for timer interval
		self.intervalPop = QtGui.QComboBox(self)
		self.intervalPop.addItems(self.intervalPopupItems)
		self.intervalPop.setCurrentIndex(self.intervalPopupItems.index(self.intervalDefault))
		self.interval = self.intervalDefault
		self.intervalPop.move(10,headerY-5)
		self.intervalPop.activated[str].connect(self.onIntervalActivated)
		# set up pop-up menu FreeCAD global variables to watch
		self.globVar = QtGui.QComboBox(self)
		self.globVar.addItems(fcGlobalVars())
		self.globVar.setCurrentIndex(0)
		self.globVar.setGeometry(0,0,250,30)
		self.globVar.move(375,headerY-7)
		self.globVar.activated[str].connect(self.onMenuChoice)
		#
		cancelButton = QtGui.QPushButton('Cancel', self)
		cancelButton.clicked.connect(self.onCancel)
		cancelButton.move(650, headerY-7)
		# contextual menu for removing variable from watch list
		mnuRemove = QtGui.QAction(self)
		mnuRemove.setText("remove variable")
		mnuRemove.triggered.connect(self.onRemoveVariable)
		# define menu and add option
		self.name1.setContextMenuPolicy(QtCore.Qt.ActionsContextMenu)
		self.name1.addAction(mnuRemove)
		self.name2.setContextMenuPolicy(QtCore.Qt.ActionsContextMenu)
		self.name2.addAction(mnuRemove)
		self.name3.setContextMenuPolicy(QtCore.Qt.ActionsContextMenu)
		self.name3.addAction(mnuRemove)
		self.name4.setContextMenuPolicy(QtCore.Qt.ActionsContextMenu)
		self.name4.addAction(mnuRemove)
		self.name5.setContextMenuPolicy(QtCore.Qt.ActionsContextMenu)
		self.name5.addAction(mnuRemove)
		self.value1.setContextMenuPolicy(QtCore.Qt.ActionsContextMenu)
		self.value1.addAction(mnuRemove)
		self.value2.setContextMenuPolicy(QtCore.Qt.ActionsContextMenu)
		self.value2.addAction(mnuRemove)
		self.value3.setContextMenuPolicy(QtCore.Qt.ActionsContextMenu)
		self.value3.addAction(mnuRemove)
		self.value4.setContextMenuPolicy(QtCore.Qt.ActionsContextMenu)
		self.value4.addAction(mnuRemove)
		self.value5.setContextMenuPolicy(QtCore.Qt.ActionsContextMenu)
		self.value5.addAction(mnuRemove)

		self.show()
		#
	def onIntervalActivated(self, text):
		self.interval = text
	
	def onTimerOffRB(self):
		# don't do much, this button serves as a semaphore for the timer routine
		pass

	def onTimerOnRB(self):
		# launch timer routine which is based on the Off radio button
		self.timerRoutine()

	def timerRoutine(self):
		if self.timerOnRB.isChecked():
			# if the On button is still checked then launch another timer event
			#print self.interval
			Timer(float(self.interval), self.timerRoutine, ()).start()
			#Timer(2, self.timerRoutine, ()).start()
		else:
			FreeCAD.Console.PrintMessage("Timer ceasing\n")
		# now do what should be done
		self.timerRoutineActions()

	def timerRoutineActions(self):
		global watchedVariables
		if len(watchedVariables)&gt;0:
			self.displayVariables()
		else:
			FreeCAD.Console.PrintMessage("Timer found no variables\n")
		self.timestamp()

	def timestamp(self):
		self.timestampLbl.setText(datetime.now().strftime('%H:%M:%S'))

	def onDisplayNow(self):
		self.timestamp()
		if len(watchedVariables)&gt;0:
			self.displayVariables()
		else:
			FreeCAD.Console.PrintMessage("Found no variables\n")

	def onMenuChoice(self,aChoice):
		# handle the user choice from the list of FreeCAD global variables
		if aChoice==topOfMenuChoices:
			# wants to update list of Global variable in FreeCAD
			self.globVarPopupItems  = fcGlobalVars()
			self.globVar.clear()
			self.globVar.addItems(self.globVarPopupItems)
		else:
			if hasattr(FreeCAD,aChoice):
				varStr = "FreeCAD."+aChoice
				exec "varVal = "+varStr
				exec "dataTypeStr = str(type(" + varStr + "))"
				self.addVariable(varStr,varVal.__repr__())

	def addVariable(self, aNameStr, aValueStr):
		global watchedVariables
		if len(watchedVariables)&lt;watchVariableLimit:
			# screen limited in size for now
			if aNameStr not in watchedVariables.keys():
				# prevent adding same variable twice
				watchedVariables[aNameStr] = aValueStr
				self.displayVariables()
		
	def onRemoveVariable(self):
		global watchedVariables
		if self.name1.underMouse() or self.value1.underMouse():
			variableToRemove = self.name1.text()
		if self.name2.underMouse() or self.value2.underMouse():
			variableToRemove = self.name2.text()
		if self.name3.underMouse() or self.value3.underMouse():
			variableToRemove = self.name3.text()
		#print variableToRemove
		watchedVariables.pop(variableToRemove)
		self.displayVariables()

	def displayVariables(self):
		global watchedVariables
		
		sortedKeys = watchedVariables.keys()
		sortedKeysCount = len(sortedKeys)
		# clear display variables
		self.name1.setText("")
		self.value1.setText("")
		self.name2.setText("")
		self.value2.setText("")
		self.name3.setText("")
		self.value3.setText("")
		self.name4.setText("")
		self.value4.setText("")
		self.name5.setText("")
		self.value5.setText("")
		# now display variable names and values
		# use 'if hasattr(FreeCAD,"ABC"):' to ensure that variable still exists
		for i in range(0,min(len(watchedVariables),5)):
			aNameStr = sortedKeys[i]
			exec "aValueStr = "+aNameStr+".__repr__()"
			#print aNameStr, " ", aValueStr
			if i==0:
				self.name1.setText(aNameStr)
				self.value1.setText(aValueStr)
			elif i==1:
				self.name2.setText(aNameStr)
				self.value2.setText(aValueStr)
			elif i==2:
				self.name3.setText(aNameStr)
				self.value3.setText(aValueStr)
			elif i==3:
				self.name4.setText(aNameStr)
				self.value4.setText(aValueStr)
			elif i==4:
				self.name5.setText(aNameStr)
				self.value5.setText(aValueStr)

	def onCancel(self):
		# need to shut down timer if running
		self.close()

# Class definitions

# Functions definitions

def fcGlobalVars():
	varDict = list()
	varDict.append(topOfMenuChoices)
	for i in FreeCAD.__dict__.keys():
		typeStr = type(FreeCAD.__dict__[i])
		# disregard functions or methods, module
		if str(typeStr) in ("&lt;type 'type'&gt;","&lt;type 'builtin_function_or_method'&gt;","&lt;type 'module'&gt;"):
			pass
		else:
			# ignore reserved variable names
			if str(i) in ("PythonAssistantWindowStatus","GuiUp","ActiveDocument", "__path__", "__package__", "__doc__", "__name__"):
				pass
			else:
				varDict.append(i)
	return varDict

# Constant definitions
topOfMenuChoices = "&gt;Update list of global variables&lt;"
varLabelSpaces = "&gt;                                                                    &lt;"
varValueSpaces = "&gt;                                                                                      &lt;"

# code ***********************************************************************************
global watchVariables, watchVariableLimit
watchedVariables = {}
watchVariableLimit = 5 # number of lines on screen

form = VariableWatcher()
form.exec_()
#
#OS: Mac OS X
#Word size: 64-bit
#Version: 0.14.3703 (Git)
#Branch: releases/FreeCAD-0-14
#Hash: c6edd47334a3e6f209e493773093db2b9b4f0e40
#Python version: 2.7.5
#Qt version: 4.8.6
#Coin version: 3.1.3
#SoQt version: 1.5.0
#OCC version: 6.7.0
#
#thus ends the macro...</pre>
<div style="clear:both"></div>
<!-- 
NewPP limit report
Cached time: 20251021131201
Cache expiry: 86400
Reduced expiry: false
Complications: [show&#8208;toc]
CPU time usage: 0.051 seconds
Real time usage: 0.060 seconds
Preprocessor visited node count: 114/1000000
Post&#8208;expand include size: 2190/2097152 bytes
Template argument size: 10156/2097152 bytes
Highest expansion depth: 7/100
Expensive parser function count: 2/100
Unstrip recursion depth: 0/20
Unstrip post&#8208;expand size: 10977/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    7.182      1 -total
 62.41%    4.482      1 Template:Macro
 22.98%    1.650      1 Template:MacroCode
 12.27%    0.881      1 Template:Clear
-->

<!-- Saved in parser cache with key freecadweb_db01-wiki_:pcache:idhash:56727-0!canonical and timestamp 20251021131201 and revision id 1669620. Rendering was triggered because: unknown
 -->
</div>
</div><script src="site.js"></script>